<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="Do one thing at a time, and do well.">
<meta property="og:type" content="website">
<meta property="og:title" content="XueCheng Notes">
<meta property="og:url" content="https://bloodorange2017.github.io/archives/index.html">
<meta property="og:site_name" content="XueCheng Notes">
<meta property="og:description" content="Do one thing at a time, and do well.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="XueCheng Notes">
<meta name="twitter:description" content="Do one thing at a time, and do well.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://bloodorange2017.github.io/archives/"/>





  <title>XueCheng Notes</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">XueCheng Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Where there is a will, there is a way.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2099/09/09/img-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2099/09/09/img-01/" itemprop="url">欢迎来到薛成的博客</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2099-09-09T12:00:00+08:00">
                2099-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://dtbfiles.oss-cn-shenzhen.aliyuncs.com/img/2017/05/05/asong.jpg"></p>
<div class="collection-title"><br>          <h2>博客中文章仅本人学习使用，如有侵权请尽快通知博主删除</h2><br>        </div>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2099/09/08/pptCatalog-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2099/09/08/pptCatalog-01/" itemprop="url">JAVAEE 学习资料</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2099-09-08T15:56:57+08:00">
                2099-09-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p></p><h2>JAVAEE PPT目录</h2><br><br><p></p>
<p><b>1.</b><a href="/stutyData/架构第一代码和ppt/ActiveMQ快速上手.pdf">ActiveMQ快速上手.pdf</a></p><p><b>2.</b><a href="/stutyData/架构第一代码和ppt/Git快速上手.pdf">Git快速上手.pdf</a></p><p><b>3.</b><a href="/stutyData/架构第一代码和ppt/Maven补充.pdf">Maven补充.pdf</a></p><p><b>4.</b><a href="/stutyData/架构第一代码和ppt/Memcached快速上手.pdf">Memcached快速上手.pdf</a></p><p><b>5.</b><a href="/stutyData/架构第一代码和ppt/MogileFS快速上手.pdf">MogileFS快速上手.pdf</a></p><p><b>6.</b><a href="/stutyData/架构第一代码和ppt/MongoDB快速上手.pdf">MongoDB快速上手.pdf</a></p><p><b>7.</b><a href="/stutyData/架构第一代码和ppt/Nginx快速上手.pdf">Nginx快速上手.pdf</a></p><p><b>8.</b><a href="/stutyData/架构第一代码和ppt/Varnish快速上手.pdf">Varnish快速上手.pdf</a></p><p><b>9.</b><a href="/stutyData/架构第一代码和ppt/基本业务功能.pdf">基本业务功能.pdf</a></p><br><h2><a name="t0"></a>💻章节隔断💻</h2><br><p><b>1.</b><a href="/stutyData/x-gen-ppt/使用外部主题.pdf">使用外部主题.pdf</a></p><p><b>2.</b><a href="/stutyData/x-gen-ppt/具体调用.pdf">具体调用.pdf</a></p><p><b>3.</b><a href="/stutyData/x-gen-ppt/分发调度.pdf">分发调度.pdf</a></p><p><b>4.</b><a href="/stutyData/x-gen-ppt/整体介绍.pdf">整体介绍.pdf</a></p><p><b>5.</b><a href="/stutyData/x-gen-ppt/模板管理.pdf">模板管理.pdf</a></p><p><b>6.</b><a href="/stutyData/x-gen-ppt/生成代理.pdf">生成代理.pdf</a></p><p><b>7.</b><a href="/stutyData/x-gen-ppt/生成输出.pdf">生成输出.pdf</a></p><p><b>8.</b><a href="/stutyData/x-gen-ppt/自定义外部主题.pdf">自定义外部主题.pdf</a></p><p><b>9.</b><a href="/stutyData/x-gen-ppt/配置管理.pdf">配置管理.pdf</a></p><br><h2><a name="t1"></a>💻章节隔断💻</h2><br><p><b>1.</b><a href="/stutyData/05Java架构师实战/MySQL入门到精通经典教程.pdf">MySQL入门到精通经典教程.pdf</a></p><p><b>2.</b><a href="/stutyData/05Java架构师实战/了不起的NodeJS.pdf">了不起的NodeJS.pdf</a></p><p><b>3.</b><a href="/stutyData/05Java架构师实战/分布式Java应用.pdf">分布式Java应用.pdf</a></p><p><b>4.</b><a href="/stutyData/05Java架构师实战/删除：大数据取舍之道（英）维克托·迈尔-舍恩伯格.pdf">删除：大数据取舍之道（英）维克托·迈尔-舍恩伯格.pdf</a></p><p><b>5.</b><a href="/stutyData/05Java架构师实战/大规模分布式存储系统：原理解析与架构实战.pdf">大规模分布式存储系统：原理解析与架构实战.pdf</a></p><p><b>6.</b><a href="/stutyData/05Java架构师实战/构建高性能Web站点.pdf">构建高性能Web站点.pdf</a></p><p><b>7.</b><a href="/stutyData/05Java架构师实战/淘宝技术架构.pdf">淘宝技术架构.pdf</a></p><p><b>8.</b><a href="/stutyData/05Java架构师实战/淘宝技术这十年，完整最终确认版.pdf.pdf">淘宝技术这十年，完整最终确认版.pdf.pdf</a></p><p><b>9.</b><a href="/stutyData/05Java架构师实战/系统架构设计师教程.pdf">系统架构设计师教程.pdf</a></p><p><b>10.</b><a href="/stutyData/05Java架构师实战/让Oracle跑得更快.pdf">让Oracle跑得更快.pdf</a></p><p><b>11.</b><a href="/stutyData/05Java架构师实战/让Oracle跑得更快2  基于海量数据的数据库设计与优化.pdf">让Oracle跑得更快2  基于海量数据的数据库设计与优化.pdf</a></p><p><b>12.</b><a href="/stutyData/05Java架构师实战/豆瓣数据架构实践-员旭鹏.pdf">豆瓣数据架构实践-员旭鹏.pdf</a></p><p><b>13.</b><a href="/stutyData/05Java架构师实战/阿里分布式数据库服务实践wangjingyu.pdf">阿里分布式数据库服务实践wangjingyu.pdf</a></p><p><b>14.</b><a href="/stutyData/05Java架构师实战/高性能高并发服务器架构.pdf">高性能高并发服务器架构.pdf</a></p><br><h2><a name="t2"></a>💻章节隔断💻</h2><p><a href="http://dubbo.io/User+Guide-zh.htm#UserGuide-zh-配置参考手册" target="_blank" rel="external">Dubbo参考手册</a></p><br><p><b>1.</b><a href="/stutyData/架构第二代码实战知识/.DS_Store">.DS_Store</a></p><p><b>2.</b><a href="/stutyData/架构第二代码实战知识/Keepalived快速上手.pdf">Keepalived快速上手.pdf</a></p><p><b>3.</b><a href="/stutyData/架构第二代码实战知识/Nginx和Varnish优化补充.pdf">Nginx和Varnish优化补充.pdf</a></p><p><b>4.</b><a href="/stutyData/架构第二代码实战知识/Redis上手之后.pdf">Redis上手之后.pdf</a></p><p><b>5.</b><a href="/stutyData/架构第二代码实战知识/Redis快速上手.pdf">Redis快速上手.pdf</a></p><p><b>6.</b><a href="/stutyData/架构第二代码实战知识/SQL优化.pdf">SQL优化.pdf</a></p><p><b>7.</b><a href="/stutyData/架构第二代码实战知识/Web缓存和静态化.pdf">Web缓存和静态化.pdf</a></p><p><b>8.</b><a href="/stutyData/架构第二代码实战知识/Web表现层其它.pdf">Web表现层其它.pdf</a></p><p><b>9.</b><a href="/stutyData/架构第二代码实战知识/Web表现层性能优化.pdf">Web表现层性能优化.pdf</a></p><p><b>10.</b><a href="/stutyData/架构第二代码实战知识/分布式部署.pdf">分布式部署.pdf</a></p><p><b>11.</b><a href="/stutyData/架构第二代码实战知识/分布式部署后的常见问题.pdf">分布式部署后的常见问题.pdf</a></p><p><b>12.</b><a href="/stutyData/架构第二代码实战知识/大数据量处理.pdf">大数据量处理.pdf</a></p><p><b>13.</b><a href="/stutyData/架构第二代码实战知识/异步规划和集群和优化.pdf">异步规划和集群和优化.pdf</a></p><p><b>14.</b><a href="/stutyData/架构第二代码实战知识/数据层处理和性能优化.pdf">数据层处理和性能优化.pdf</a></p><p><b>15.</b><a href="/stutyData/架构第二代码实战知识/数据库性能优化.pdf">数据库性能优化.pdf</a></p><p><b>16.</b><a href="/stutyData/架构第二代码实战知识/整体介绍.pdf">整体介绍.pdf</a></p><p><b>17.</b><a href="/stutyData/架构第二代码实战知识/最后的话.pdf">最后的话.pdf</a></p><p><b>18.</b><a href="/stutyData/架构第二代码实战知识/缓存规划和集群.pdf">缓存规划和集群.pdf</a></p><p><b>19.</b><a href="/stutyData/架构第二代码实战知识/逻辑层其它.pdf">逻辑层其它.pdf</a></p><p><b>20.</b><a href="/stutyData/架构第二代码实战知识/高并发处理.pdf">高并发处理.pdf</a></p><br><h2>💻微服务架构💻</h2><br><p><b>1.</b><a href="/stutyData/微服务ppt/.DS_Store">.DS_Store</a></p><p><b>2.</b><a href="/stutyData/微服务ppt/第01节--课程介绍.pdf">第01节–课程介绍.pdf</a></p><p><b>3.</b><a href="/stutyData/微服务ppt/第02节--解决方案的效果演示.pdf">第02节–解决方案的效果演示.pdf</a></p><p><b>4.</b><a href="/stutyData/微服务ppt/第03节--常用的分布式事务解决方案介绍.pdf">第03节–常用的分布式事务解决方案介绍.pdf</a></p><p><b>5.</b><a href="/stutyData/微服务ppt/第04节--消息发送一致性（可靠消息的前提保障）.pdf">第04节–消息发送一致性（可靠消息的前提保障）.pdf</a></p><p><b>6.</b><a href="/stutyData/微服务ppt/第05节--消息发送一致性的异常流程处理.pdf">第05节–消息发送一致性的异常流程处理.pdf</a></p><p><b>7.</b><a href="/stutyData/微服务ppt/第06节--常规MQ队列消息的处理流程和特点.pdf">第06节–常规MQ队列消息的处理流程和特点.pdf</a></p><p><b>8.</b><a href="/stutyData/微服务ppt/第07节--消息重复发送问题与业务接口的幂等性设计.pdf">第07节–消息重复发送问题与业务接口的幂等性设计.pdf</a></p>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2099/09/07/download-file/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2099/09/07/download-file/" itemprop="url">框架软件-下载页</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2099-09-07T11:45:53+08:00">
                2099-09-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://bloodorange2017.github.io//software/dobbo-admin.war"><h4>Dubbo-admin</h4></a><br><a href="https://bloodorange2017.github.io//software/dobbo-admin.war"><img src="https://bloodorange2017.github.io//images/bubbo_01.png"> </a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/07/20/dubbox-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/20/dubbox-01/" itemprop="url">转载:dubbox 2.8.4搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-20T10:27:33+08:00">
                2017-07-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="article_c"><br>        <div class="markdown_views"><p>关于dubbox的核心原理和细节会另开一篇文章来介绍，这篇文章主要是从配置和应用层面来介绍dubbox 2.8.4的使用。</p><br><br><br><br><h3 id="dubbox的服务监控和日志采集httpblogcsdnnetu011282930articledetails52786414"><strong>dubbox的服务监控和日志采集</strong>：<a href="http://blog.csdn.net/u011282930/article/details/52786414" target="_blank" rel="external">http://blog.csdn.net/u011282930/article/details/52786414</a></h3><br><br><h2 id="zookeeper的安装"><strong>zookeeper的安装</strong></h2><br><br><p>1、准备工作</p><br><br><p>-下载zookeeper <br><br>官方地址：<a href="http://apache.fayea.com/zookeeper/zookeeper-3.4.6/" target="_blank" rel="external">http://apache.fayea.com/zookeeper/zookeeper-3.4.6/</a> <br><br>下载版本：zookeeper-3.4.6.tar.gz</p><br><br><p>-下载JDK <br><br>下载地址：<a href="http://www.oracle.com/technetwork/java/javase/downloads/index-jsp-138363.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/javase/downloads/index-jsp-138363.html</a> <br><br>下载版本：JDK1.7.X版本，32位或64位看操作系统 <br><br>JDK的安装就跳过了，直接百度一大堆，一定记得设置PATH，classpath，JAVA_HOME环境变量</p><br><br><p>2、解压和安装zookeeper <br><br>zookeeper的目录我是放置在/usr/zookeeper-3.4.6/这个位置，所以： <br><br><code>tar -zxvf ./zookeeper-3.4.6.tar.gz</code> <br><br><code>mv ./zookeeper-3.4.6 /usr/zookeeper-3.4.6/</code></p><br><br><p>同样的，设置全局环境变量： <br><br><code>export PATH=/usr/zookeeper-3.4.6/bin:$PATH</code></p><br><br><p>好的，安装完成了，是不是简单。接下来，我们讲解一下zookeeper的主配置文件。zookeeper的主配置文件所在的地址是：${您的zookeeper安装位置}/conf/zoo.cfg <br><br>但是，解压后的zookeeper并没有这个配置文件，有一个名叫zoo_sample.cfg，所以，我们复制一个zoo.cfg文件： <br><br><code>cp /usr/zookeeper-3.4.6/conf/zoo_sample.cfg /usr/zookeeper-3.4.6/conf/zoo.cfg</code></p><br><br><p>最后，使用zkServer.sh start命令，启动zookeeper：</p><br><br><br><br><pre class="prettyprint"><code class=" hljs r">[root@vm2 ~]<span class="hljs-comment"># zkServer.sh start</span><br>JMX enabled by default<br>Using config: /usr/zookeeper-<span class="hljs-number">3.4</span><span class="hljs-number">.6</span>/bin/../conf/zoo.cfg<br>Starting zookeeper <span class="hljs-keyword">…</span> STARTED</code></pre><br><br><br><br><h1 id="dubbox"><strong>dubbox</strong></h1><br><br><p>1、准备工作 <br><br>下载dubbox的源代码 <br><br>下载地址：<a href="https://github.com/dangdangdotcom/dubbox" target="_blank" rel="external">https://github.com/dangdangdotcom/dubbox</a></p><br><br><p>2、编译源码（此处默认大家会用maven了） <br><br>运行maven命令：mvn clean install -Dmaven.test.skip=true <br><br>将dubbox的源码打包发布到本地仓库，目的是为了获取：dubbo-admin-2.8.4.war和dubbo-monitor.war</p><br><br><br><br><h2 id="dubbox-admin管理端"><strong>dubbox-admin管理端</strong></h2><br><br><p>懒人下载：<a href="http://download.csdn.net/detail/u011282930/9477514" target="_blank" rel="external">http://download.csdn.net/detail/u011282930/9477514</a></p><br><br><p>1、部署dubbo-admin管理端，将dubbo-admin-2.8.4.war放置到准备好的tomcat目录 <br><br>2、修改WEB-INF下dubbo.properties <br><br>主要是修改zookeeper的地址 <br><br><code>dubbo.registry.address=zookeeper://127.0.0.1:2181</code> <br><br>3、运行tomcat <br><br>输入地址：<a href="http://localhost:8080/dubbo-admin-2.8.4" target="_blank" rel="external">http://localhost:8080/dubbo-admin-2.8.4</a> <br><br>默认登录账户和密码均为：root <br><br>4、登录后首页 <br><br><img src="http://img.blog.csdn.net/20160331083357772" alt="这里写图片描述" title=""> <br><br>到此为止，dubbox的后台管理端就配置成功了</p><br><br><br><br><h2 id="dubbox-monitor监控端"><strong>dubbox-monitor监控端</strong></h2><br><br><p>懒人下载：<a href="http://download.csdn.net/detail/u011282930/9477515" target="_blank" rel="external">http://download.csdn.net/detail/u011282930/9477515</a> <br><br>我们对于dubbo的监控用的是改装后的（页面非常好看）</p><br><br><p>下载dubbox-monitor的源代码 <br><br>下载地址：<a href="http://git.oschina.net/handu/dubbo-monitor" target="_blank" rel="external">http://git.oschina.net/handu/dubbo-monitor</a></p><br><br><p>Dubbo-Monitor配置介绍 <br><br>1、创建数据库 首先创建名称为monitor数据库，编码格式UTF-8。然后将项目sql文件夹下面的create.sql导入到数据库，生成dubbo_invoke表代表成功导入。 <br><br>下载地址：<a href="http://download.csdn.net/detail/u011282930/9650381" target="_blank" rel="external">http://download.csdn.net/detail/u011282930/9650381</a></p><br><br><p>2、编辑项目中application.properties，配置如下：</p><br><br><br><br><pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-preprocessor">####Dubbo Settings</span><br>dubbo<span class="hljs-preprocessor">.application</span><span class="hljs-preprocessor">.name</span>=dubbo-monitor<br>dubbo<span class="hljs-preprocessor">.application</span><span class="hljs-preprocessor">.owner</span>=handu<span class="hljs-preprocessor">.com</span><br>dubbo<span class="hljs-preprocessor">.registry</span><span class="hljs-preprocessor">.address</span>=zookeeper://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">2181</span><br>dubbo<span class="hljs-preprocessor">.protocol</span><span class="hljs-preprocessor">.port</span>=<span class="hljs-number">6060</span><br><br><span class="hljs-preprocessor">####Database Settings</span><br>db<span class="hljs-preprocessor">.url</span>=jdbc:mysql://&lt;database_host&gt;:&lt;database_port&gt;/monitor?prepStmtCacheSize=<span class="hljs-number">517</span>&amp;cachePrepStmts=true&amp;autoReconnect=true&amp;characterEncoding=utf-<span class="hljs-number">8</span><br>db<span class="hljs-preprocessor">.username</span>=root<br>db<span class="hljs-preprocessor">.password</span>=root<br>db<span class="hljs-preprocessor">.maxActive</span>=<span class="hljs-number">500</span><br><br><span class="hljs-preprocessor">####System Manager</span><br>manager<span class="hljs-preprocessor">.username</span>=admin<br>manager<span class="hljs-preprocessor">.password</span>=admin</code></pre><br><br><p>3、打包运行项目 执行maven命令：mvn clean package target文件夹下生成的dubbo-monitor.war即为项目部署文件，将其放置到对应服务器目录下，启动服务器即可。例如：tomcat的webapps文件夹下。</p><br><br><p>4、访问项目 启动web服务器后，访问地址：<a href="http://IP:[port]/dubbo-moniotor" target="_blank" rel="external">http://IP:[port]/dubbo-moniotor</a>，采用配置文件中manager.username和manager.password设置值进行登录。 <br><br><img src="http://img.blog.csdn.net/20160331084239712" alt="这里写图片描述" title=""> <br><br>5、透过dubbox服务管理端，我们会发现多了一个monitor的服务 <br><br><img src="http://img.blog.csdn.net/20160331084141868" alt="这里写图片描述" title=""></p><br><br><br><br><h4 id="下文默认大家已经用maven引入相关依赖或者导入相关包了"><strong>下文默认大家已经用maven引入相关依赖或者导入相关包了</strong></h4><br><br><p>具体依赖jar包如下图所示 <br><br><img src="http://img.blog.csdn.net/20160331172455088" alt="这里写图片描述" title=""> <br><br>maven依赖库</p><br><br><br><br><pre class="prettyprint"><code class=" hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>dubbo<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>2.8.4<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>dubbo-rpc-rest<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>2.8.4<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>dubbo-rpc-webservice<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>2.8.4<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>com.101tec<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>zkclient<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>0.2<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.apache.zookeeper<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>zookeeper<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>3.3.6<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">exclusions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-title">exclusion</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-title">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-title">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.2.16<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span></code></pre><br><br><br><br><h2 id="服务提供者实例开发"><strong>服务提供者实例开发</strong></h2><br><br><p>1、定义一个Service接口和相关实现类 <br><br>定义一个接口，IUserService.java</p><br><br><br><br><pre class="prettyprint"><code class=" hljs cs">package service;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> IUserService {<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span>();<br>}<br></code></pre><br><br><p>实现这个接口，UserService.java</p><br><br><br><br><pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> service;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IUserService</span> {</span><br><br>    <span class="hljs-annotation">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span>() {<br>        System.err.println(<span class="hljs-string">“HELLO WORLD!”</span>);<br>    }<br><br>}<br></code></pre><br><br><p>2、配置这个接口的xml文件，dubbo-provider.xml</p><br><br><br><br><pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version=”1.1” encoding=”UTF-8”?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-title">beans</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">“<a href="http://www.springframework.org/schema/beans" target="_blank" rel="external">http://www.springframework.org/schema/beans</a>“</span><br>    <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">“<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank" rel="external">http://www.w3.org/2001/XMLSchema-instance</a>“</span> <span class="hljs-attribute">xmlns:dubbo</span>=<span class="hljs-value">“<a href="http://code.alibabatech.com/schema/dubbo" target="_blank" rel="external">http://code.alibabatech.com/schema/dubbo</a>“</span><br>    <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">“<a href="http://www.springframework.org/schema/beans" target="_blank" rel="external">http://www.springframework.org/schema/beans</a><br>       <a href="http://www.springframework.org/schema/beans/spring-beans.xsd" target="_blank" rel="external">http://www.springframework.org/schema/beans/spring-beans.xsd</a><br>       <a href="http://code.alibabatech.com/schema/dubbo" target="_blank" rel="external">http://code.alibabatech.com/schema/dubbo</a><br>       <a href="http://code.alibabatech.com/schema/dubbo/dubbo.xsd" target="_blank" rel="external">http://code.alibabatech.com/schema/dubbo/dubbo.xsd</a>“</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-title">dubbo:application</span> <span class="hljs-attribute">owner</span>=<span class="hljs-value">“whb”</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">“hello-world-app”</span> /&gt;</span><br>    <span class="hljs-comment">&lt;!–zookeeper注册中心 –&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-title">dubbo:registry</span> <span class="hljs-attribute">address</span>=<span class="hljs-value">“zookeeper://172.17.84.84:2181”</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!–使用multicast广播注册中心暴露服务地址 –&gt;</span><br>    <span class="hljs-comment">&lt;!–&lt;dubbo:registry address=”multicast://10.57.41.19:1234” /&gt; –&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-title">dubbo:protocol</span> <span class="hljs-attribute">name</span> =<span class="hljs-value">“dubbo”</span> <span class="hljs-attribute">port</span>=<span class="hljs-value">“20880”</span> /&gt;</span><br>    <span class="hljs-comment">&lt;!– 配置监控的服务地址和IP–&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-title">dubbo:monitor</span> <span class="hljs-attribute">address</span>=<span class="hljs-value">“127.0.0.1:7070”</span>  /&gt;</span><br>    <span class="hljs-comment">&lt;!– 发布这个服务 –&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-title">dubbo:service</span>  <span class="hljs-attribute">protocol</span>=<span class="hljs-value">“dubbo”</span>  <span class="hljs-attribute">timeout</span>=<span class="hljs-value">“2000”</span> <span class="hljs-attribute">connections</span>=<span class="hljs-value">“100”</span> <span class="hljs-attribute">interface</span> =<span class="hljs-value">“service.IUserService”</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">“userService”</span> /&gt;</span><br>    <span class="hljs-comment">&lt;!– 和本地bean一样实现服务 –&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">“userService”</span><br>        <span class="hljs-attribute">class</span>=<span class="hljs-value">“service.UserService”</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-title">beans</span>&gt;</span>  </code></pre><br><br><p>3、运行发布我们的接口，LuncherProvider.java</p><br><br><br><br><pre class="prettyprint"><code class=" hljs cs">package demo;<br>import org.springframework.context.ApplicationContext;<br>import org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> LuncherProvider {<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(String[] args) throws InterruptedException {<br>        LuncherProvider luncher = <span class="hljs-keyword">new</span> LuncherProvider();<br>        luncher.start();<br>        Thread.sleep(<span class="hljs-number">1000</span> <em> <span class="hljs-number">60</span> </em> <span class="hljs-number">10</span>);<br>    }<br><br>    <span class="hljs-keyword">void</span> start() {<br>        String configLocation = <span class="hljs-string">“classpath<em>:/dubbo-provider.xml”</em></span>;<br>        ApplicationContext context = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<br>                configLocation);<br>        String[] names = context.getBeanDefinitionNames();<br>        System.<span class="hljs-keyword">out</span>.print(<span class="hljs-string">“Beans:”</span>);<br>        <span class="hljs-keyword">for</span> (String <span class="hljs-keyword">string</span> : names)<br>            System.<span class="hljs-keyword">out</span>.print(<span class="hljs-keyword">string</span> + <span class="hljs-string">“,”</span>);<br>        System.<span class="hljs-keyword">out</span>.println();<br>    }<br>}</code></pre><br><br><p>控制台输出如下内容，为成功 <br><br><img src="http://img.blog.csdn.net/20160331090743347" alt="这里写图片描述" title=""> <br><br>通过dubbox管理端来查看我们的服务，通过下图，我们可以看到我们的服务已经注册到zookeeper了 <br><br><img src="http://img.blog.csdn.net/20160331085207982" alt="这里写图片描述" title=""></p><br><br><br><br><h2 id="消费者实例开发"><strong>消费者实例开发</strong></h2><br><br><p>如何调用我们发布的服务呢？ <br><br>1、定义一个一模一样的接口，IUserService.java</p><br><br><br><br><pre class="prettyprint"><code class=" hljs cs">package service;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> IUserService {<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span>();<br>}<br></code></pre><br><br><p>2、配置这个接口调用信息，</p><br><br><br><br><pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version=”1.1” encoding=”UTF-8”?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-title">beans</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">“<a href="http://www.springframework.org/schema/beans" target="_blank" rel="external">http://www.springframework.org/schema/beans</a>“</span><br>    <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">“<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank" rel="external">http://www.w3.org/2001/XMLSchema-instance</a>“</span> <span class="hljs-attribute">xmlns:dubbo</span>=<span class="hljs-value">“<a href="http://code.alibabatech.com/schema/dubbo" target="_blank" rel="external">http://code.alibabatech.com/schema/dubbo</a>“</span><br>    <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">“<a href="http://www.springframework.org/schema/beans" target="_blank" rel="external">http://www.springframework.org/schema/beans</a><br>       <a href="http://www.springframework.org/schema/beans/spring-beans.xsd" target="_blank" rel="external">http://www.springframework.org/schema/beans/spring-beans.xsd</a><br>       <a href="http://code.alibabatech.com/schema/dubbo" target="_blank" rel="external">http://code.alibabatech.com/schema/dubbo</a><br>       <a href="http://code.alibabatech.com/schema/dubbo/dubbo.xsd" target="_blank" rel="external">http://code.alibabatech.com/schema/dubbo/dubbo.xsd</a>“</span>&gt;</span><br>         <span class="hljs-comment">&lt;!–消费方应用名，用于计算依赖关系，不是匹配条件，不要与提供方一样 –&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-title">dubbo:application</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">“consumer-of-helloworld-app”</span> /&gt;</span><br>         <span class="hljs-comment">&lt;!–zookeeper注册中心 –&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-title">dubbo:registry</span>  <span class="hljs-attribute">protocol</span>=<span class="hljs-value">“zookeeper”</span> <span class="hljs-attribute">address</span>=<span class="hljs-value">“172.17.84.84:2181”</span> /&gt;</span><br>         <span class="hljs-comment">&lt;!–使用multicast广播注册中心暴露的服务地址 –&gt;</span><br>         <span class="hljs-comment">&lt;!–&lt;dubbo:registryaddress=”multicast://10.57.41.19:1234” /&gt; –&gt;</span><br>          <span class="hljs-comment">&lt;!–         &lt;dubbo:monitor address=”127.0.0.1:7070”  /&gt; –&gt;</span><br>          <span class="hljs-comment">&lt;!– 生成远程服务代理，可以和本地bean一样使用IUserService–&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-title">dubbo:reference</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">“userService”</span> <span class="hljs-attribute">interface</span>=<span class="hljs-value">“service.IUserService”</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-title">beans</span>&gt;</span>  </code></pre><br><br><p>3、测试调用服务的代码，LuncherConsumer.java</p><br><br><br><br><pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> demo;<br><br><br><br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">import</span> service.IUserService;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LuncherConsumer</span>  {</span><br>         <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(String[] args) <span class="hljs-keyword">throws</span> InterruptedException{<br>                   LuncherConsumer luncher=<span class="hljs-keyword">new</span> LuncherConsumer();<br>                   String configLocation=<span class="hljs-string">“classpath:/dubbo-consumer.xml”</span>;<br>                   ApplicationContext context =<span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(configLocation);<br>                   IUserService us=(IUserService) context.getBean(<span class="hljs-string">“userService”</span>);<br>                   String[] names=context.getBeanDefinitionNames();<br>                   us.sayHello();<br>         }<br>}  </code></pre><br><br><p>观察服务端的控制台，会输出“HELLO WORLD” <br><br><img src="http://img.blog.csdn.net/20160331090854144" alt="这里写图片描述" title=""></p><br><br><p>至此，dubbox的配置和使用就成功了！</p></div>

</div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/07/17/thread-pool-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/17/thread-pool-01/" itemprop="url">转载:线程池原理及实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-17T15:06:49+08:00">
                2017-07-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post"><br><br><p><span style="font-size:16px"><span style="color:#ff0000"><strong>1、线程池简介：</strong></span><br><br>&nbsp;&nbsp;&nbsp; 多线程技术主要解决处理器单元内多个线程执行的问题，它可以显著减少处理器单元的闲置时间，增加处理器单元的吞吐能力。&nbsp;&nbsp;&nbsp; <br><br>&nbsp;&nbsp;&nbsp; 假设一个服务器完成一项任务所需时间为：T1 创建线程时间，T2 在线程中执行任务的时间，T3 销毁线程时间。<br><br><br><br>&nbsp;&nbsp;&nbsp; 如果：T1 &#43; T3 远大于 T2，则可以采用线程池，以提高服务器性能。<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 一个线程池包括以下四个基本组成部分：<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1、线程池管理器（ThreadPool）：用于创建并管理线程池，包括 创建线程池，销毁线程池，添加新任务；<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2、工作线程（PoolWorker）：线程池中线程，在没有任务时处于等待状态，可以循环的执行任务；<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3、任务接口（Task）：每个任务必须实现的接口，以供工作线程调度任务的执行，它主要规定了任务的入口，任务执行完后的收尾工作，任务的执行状态等；<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4、任务队列（taskQueue）：用于存放没有处理的任务。提供一种缓冲机制。<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br><br>&nbsp;&nbsp;&nbsp; 线程池技术正是关注如何缩短或调整T1,T3时间的技术，从而提高服务器程序性能的。它把T1，T3分别安排在服务器程序的启动和结束的时间段或者一些空闲的时间段，这样在服务器程序处理客户请求时，不会有T1，T3的开销了。<br><br>&nbsp;&nbsp;&nbsp; 线程池不仅调整T1,T3产生的时间段，而且它还显著减少了创建线程的数目，看一个例子：<br><br>&nbsp;&nbsp;&nbsp; 假设一个服务器一天要处理50000个请求，并且每个请求需要一个单独的线程完成。在线程池中，线程数一般是固定的，所以产生线程总数不会超过线程池中线程的数目，而如果服务器不利用线程池来处理这些请求则线程总数为50000。一般线程池大小是远小于50000。所以利用线程池的服务器程序不会为了创建50000而在处理请求时浪费时间，从而提高效率。<br><br></span></p><br><p><span style="font-size:16px">&nbsp;&nbsp;&nbsp; 代码实现中并没有实现任务接口，而是把Runnable对象加入到线程池管理器（ThreadPool），然后剩下的事情就由线程池管理器（ThreadPool）来完成了</span></p><br><p><span style="font-size:16px"></span>&nbsp;</p><br><span style="font-size:16px"></span><br><div class="dp-highlighter bg_java"><br><div class="bar"><br><div class="tools"><strong>[java]</strong> <a href="http://blog.csdn.net/touch_2011/article/details/6914468#" class="ViewSource" title="view plain" target="_blank" rel="external"><br>view plain</a><a href="http://blog.csdn.net/touch_2011/article/details/6914468#" class="CopyToClipboard" title="copy" target="_blank" rel="external">copy</a></div><br></div><br><ol class="dp-j" start="1"><br><li class="alt"><span><span class="keyword">package</span><span>&nbsp;mine.util.thread;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li class="alt"><span><span class="keyword">import</span><span>&nbsp;java.util.LinkedList;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;java.util.List;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li><span><span class="comment">/<strong></strong></span>&nbsp;</span></li><li class="alt"><span><span class="comment">&nbsp;<em>&nbsp;线程池类，线程管理器：创建线程，执行任务，销毁线程，获取线程基本信息</em></span>&nbsp;</span></li><li><span><span class="comment">&nbsp;/</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;ThreadPool&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;线程池中默认线程的个数为5</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;worker_num&nbsp;=&nbsp;</span><span class="number">5</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;工作线程</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;WorkThread[]&nbsp;workThrads;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;未处理的任务</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">volatile</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;finished_task&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;任务队列，作为一个缓冲,List线程不安全</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;List&lt;Runnable&gt;&nbsp;taskQueue&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;LinkedList&lt;Runnable&gt;();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;ThreadPool&nbsp;threadPool;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;创建具有默认线程个数的线程池</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;ThreadPool()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>(</span><span class="number">5</span><span>);&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;创建线程池,worker_num为线程池中工作线程的个数</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;ThreadPool(</span><span class="keyword">int</span><span>&nbsp;worker_num)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadPool.worker_num&nbsp;=&nbsp;worker_num;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workThrads&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;WorkThread[worker_num];&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(</span><span class="keyword">int</span><span>&nbsp;i&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;i&nbsp;&lt;&nbsp;worker_num;&nbsp;i&#43;&#43;)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workThrads[i]&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;WorkThread();&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workThrads[i].start();<span class="comment">//&nbsp;开启线程池中的线程</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;单态模式，获得一个默认线程个数的线程池</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;ThreadPool&nbsp;getThreadPool()&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;getThreadPool(ThreadPool.worker_num);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;单态模式，获得一个指定线程个数的线程池,worker_num(&gt;0)为线程池中工作线程的个数</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;worker_num&lt;=0创建默认的工作线程个数</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;ThreadPool&nbsp;getThreadPool(</span><span class="keyword">int</span><span>&nbsp;worker_num1)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(worker_num1&nbsp;&lt;=&nbsp;</span><span class="number">0</span><span>)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;worker_num1&nbsp;=&nbsp;ThreadPool.worker_num;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(threadPool&nbsp;==&nbsp;</span><span class="keyword">null</span><span>)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threadPool&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;ThreadPool(worker_num1);&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;threadPool;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;执行任务,其实只是把任务加入任务队列，什么时候执行有线程池管理器觉定</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;execute(Runnable&nbsp;task)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">synchronized</span><span>&nbsp;(taskQueue)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskQueue.add(task);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskQueue.notify();&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;批量执行任务,其实只是把任务加入任务队列，什么时候执行有线程池管理器觉定</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;execute(Runnable[]&nbsp;task)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">synchronized</span><span>&nbsp;(taskQueue)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(Runnable&nbsp;t&nbsp;:&nbsp;task)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskQueue.add(t);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskQueue.notify();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;批量执行任务,其实只是把任务加入任务队列，什么时候执行有线程池管理器觉定</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;execute(List&lt;Runnable&gt;&nbsp;task)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">synchronized</span><span>&nbsp;(taskQueue)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(Runnable&nbsp;t&nbsp;:&nbsp;task)&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskQueue.add(t);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskQueue.notify();&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;销毁线程池,该方法保证在所有任务都完成的情况下才销毁所有线程，否则等待任务完成才销毁</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;destroy()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span><span>&nbsp;(!taskQueue.isEmpty())&nbsp;{</span><span class="comment">//&nbsp;如果还有任务没执行完成，就先睡会吧</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.sleep(<span class="number">10</span><span>);&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">catch</span><span>&nbsp;(InterruptedException&nbsp;e)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;工作线程停止工作，且置为null</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(</span><span class="keyword">int</span><span>&nbsp;i&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;i&nbsp;&lt;&nbsp;worker_num;&nbsp;i&#43;&#43;)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workThrads[i].stopWorker();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workThrads[i]&nbsp;=&nbsp;<span class="keyword">null</span><span>;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threadPool=<span class="keyword">null</span><span>;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskQueue.clear();<span class="comment">//&nbsp;清空任务队列</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;返回工作线程的个数</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;getWorkThreadNumber()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;worker_num;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;返回已完成任务的个数,这里的已完成是只出了任务队列的任务个数，可能该任务并没有实际执行完成</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;getFinishedTasknumber()&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;finished_task;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;返回任务队列的长度，即还没处理的任务个数</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;getWaitTasknumber()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;taskQueue.size();&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;覆盖toString方法，返回线程池信息：工作线程个数和已完成任务个数</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Override</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;String&nbsp;toString()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;</span><span class="string">&quot;WorkThread&nbsp;number:&quot;</span><span>&nbsp;&#43;&nbsp;worker_num&nbsp;&#43;&nbsp;</span><span class="string">&quot;&nbsp;&nbsp;finished&nbsp;task&nbsp;number:&quot;</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#43;&nbsp;finished_task&nbsp;&#43;&nbsp;<span class="string">&quot;&nbsp;&nbsp;wait&nbsp;task&nbsp;number:&quot;</span><span>&nbsp;&#43;&nbsp;getWaitTasknumber();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/</span>&nbsp;</span></li><li class="alt"><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>&nbsp;内部类，工作线程</em></span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;WorkThread&nbsp;</span><span class="keyword">extends</span><span>&nbsp;Thread&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;该工作线程是否有效，用于结束该工作线程</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">boolean</span><span>&nbsp;isRunning&nbsp;=&nbsp;</span><span class="keyword">true</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/<em></em></span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关键所在啊，如果任务队列不空，则取出任务执行，若任务队列空，则等待</span>&nbsp;</span></li><li class="alt"><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Override</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;run()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Runnable&nbsp;r&nbsp;=&nbsp;<span class="keyword">null</span><span>;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span><span>&nbsp;(isRunning)&nbsp;{</span><span class="comment">//&nbsp;注意，若线程无效则自然结束run方法，该线程就没用了</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">synchronized</span><span>&nbsp;(taskQueue)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span><span>&nbsp;(isRunning&nbsp;&amp;&amp;&nbsp;taskQueue.isEmpty())&nbsp;{</span><span class="comment">//&nbsp;队列为空</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskQueue.wait(<span class="number">20</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">catch</span><span>&nbsp;(InterruptedException&nbsp;e)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(!taskQueue.isEmpty())&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;taskQueue.remove(<span class="number">0</span><span>);</span><span class="comment">//&nbsp;取出任务</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(r&nbsp;!=&nbsp;</span><span class="keyword">null</span><span>)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.run();<span class="comment">//&nbsp;执行任务</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finished_task&#43;&#43;;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;<span class="keyword">null</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;停止工作，让该线程自然执行完run方法，自然结束</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;stopWorker()&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isRunning&nbsp;=&nbsp;<span class="keyword">false</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol><br></div><br><p>&nbsp;</p><br><p>测试代码：</p><br><div class="dp-highlighter bg_java"><br><div class="bar"><br><div class="tools"><strong>[java]</strong> <a href="http://blog.csdn.net/touch_2011/article/details/6914468#" class="ViewSource" title="view plain" target="_blank" rel="external"><br>view plain</a><a href="http://blog.csdn.net/touch_2011/article/details/6914468#" class="CopyToClipboard" title="copy" target="_blank" rel="external">copy</a></div><br></div><br><ol class="dp-j" start="1"><br><li class="alt"><span><span class="keyword">package</span><span>&nbsp;mine.util.thread;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li class="alt"><span><span class="comment">//测试线程池</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;TestThreadPool&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;main(String[]&nbsp;args)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;创建3个线程的线程池</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadPool&nbsp;t&nbsp;=&nbsp;ThreadPool.getThreadPool(<span class="number">3</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.execute(<span class="keyword">new</span><span>&nbsp;Runnable[]&nbsp;{&nbsp;</span><span class="keyword">new</span><span>&nbsp;Task(),&nbsp;</span><span class="keyword">new</span><span>&nbsp;Task(),&nbsp;</span><span class="keyword">new</span><span>&nbsp;Task()&nbsp;});&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.execute(<span class="keyword">new</span><span>&nbsp;Runnable[]&nbsp;{&nbsp;</span><span class="keyword">new</span><span>&nbsp;Task(),&nbsp;</span><span class="keyword">new</span><span>&nbsp;Task(),&nbsp;</span><span class="keyword">new</span><span>&nbsp;Task()&nbsp;});&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(t);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.destroy();<span class="comment">//&nbsp;所有线程都执行完成才destory</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(t);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;任务类</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;Task&nbsp;</span><span class="keyword">implements</span><span>&nbsp;Runnable&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">volatile</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;i&nbsp;=&nbsp;</span><span class="number">1</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Override</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;run()&nbsp;{</span><span class="comment">//&nbsp;执行任务</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="string">&quot;任务&nbsp;&quot;</span><span>&nbsp;&#43;&nbsp;(i&#43;&#43;)&nbsp;&#43;&nbsp;</span><span class="string">&quot;&nbsp;完成&quot;</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol><br></div><br><p><br><br>&nbsp;</p><br><p><span style="font-size:16px">运行结果：</span></p><br><p><span style="font-size:16px">WorkThread number:3&nbsp; finished task number:0&nbsp; wait task number:6<br><br>任务 1 完成<br><br>任务 2 完成<br><br>任务 3 完成<br><br>任务 4 完成<br><br>任务 5 完成<br><br>任务 6 完成<br><br>WorkThread number:3&nbsp; finished task number:6&nbsp; wait task number:0<br><br></span></p><br><p><span style="font-size:16px">分析：由于并没有任务接口，传入的可以是自定义的任何任务，所以线程池并不能准确的判断该任务是否真正的已经完成（真正完成该任务是这个任务的run方法执行完毕），只能知道该任务已经出了任务队列，正在执行或者已经完成。</span></p><br><p><span style="font-size:16px"></span></p><br><p><span style="color:#ff0000; font-size:16px"><strong>2、java类库中提供的线程池简介：</strong></span></p><br><p><span style="color:#000000"><span style="font-size:16px"><strong>&nbsp;&nbsp;&nbsp;&nbsp; java提供的线程池更加强大，相信理解线程池的工作原理，看类库中的线程池就不会感到陌生了。</strong><br><br></span></span></p><br><p><span style="font-size:16px"><img alt="" src="http://hi.csdn.net/attachment/201110/28/0_1319784225fRSR.gif"></span></p><br><p><span style="font-size:16px"><img alt="" src="http://hi.csdn.net/attachment/201110/28/0_1319784243mu5f.gif"></span></p><br><br></div>


          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/07/04/redBlackTree-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/04/redBlackTree-01/" itemprop="url">转载:简单清晰的红黑树讲解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-04T10:49:40+08:00">
                2017-07-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post"><br><br><h1 style="text-align:center"><span style="font-family:Microsoft YaHei; font-size:48px; font-weight:normal">查找（一）</span></h1><br><p><span style="font-size:18px"><br><br></span></p><br><p><span style="font-size:18px"><br><br></span></p><br><p><span style="font-size:18px">我们使用<strong>符号表</strong>这个词来描述一张抽象的表&#26684;，我们会将信息（<u>&#20540;</u>）存储在其中，然后按照指定的<u>键</u>来搜索并获取这些信息。键和&#20540;的具体意义取决于不同的应用。</span></p><br><p><span style="font-size:18px">符号表中可能会保存很多键和很多信息，因此实现一张高效的符号表也是一项很有挑战性的任务。</span></p><br><p><span style="font-size:18px">我们会用三种经典的数据类型来实现高效的符号表：<strong>二叉查找数</strong>、<strong>红黑树</strong>、<strong>散列表</strong>。</span></p><br><p><span style="font-size:18px"><br><br></span></p><br><p></p><br><h1><span style="font-family:Microsoft YaHei; font-size:32px">二分查找</span></h1><br><p></p><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">我们使用有序数组存储键，经典的二分查找能够根据数组的索引大大减少每次查找所需的比较次数。</p><br><p style="font-size:18px">在查找时，我们先将被查找的键和子数组的中间键比较。如果被查找的键小于中间键，我们就在左子数组中继续查找，如果大于我们就在右子数组中继续查找，否则中间键就是我们要找的键。</p><br><p style="font-size:18px">&nbsp;</p><br><p style="font-size:18px">一般情况下二分查找都比顺序查找快的多，它也是众多实际应用程序的最佳选择。对于一个静态表（不允许插入）来说，将其在初始化时就排序是&#20540;得的。</p><br><p style="font-size:18px">&nbsp;</p><br><p style="font-size:18px">当然，二分查找也不适合很多应用。现代应用需要<u>同时</u>能够支持高效的查找和插入两种操作的符号表实现。也就是说，<u>我们需要在构造庞大的符号表的同时能够任意插入（也许还有删除）键&#20540;对，同时也要能够完成查找操作</u>。</p><br><p style="font-size:18px">&nbsp;</p><br><p style="font-size:18px">要支持高效的插入操作，我们&#20284;乎需要一种链式结构。当单链接的链表是无法使用二分查找的，因为二分查找的高效来自于能够快速通过索引取得任何子数组的中间元素。为了将二分查找的效率和链表的灵活性结合起来，我们需要更加复杂的数据结构。</p><br><p style="font-size:18px">能够同时拥有两者的就是<strong>二叉查找树</strong>。</p><br><p style="font-size:18px">&nbsp;</p><br><h1><span style="font-family:Microsoft YaHei; font-size:32px">二叉查找树</span></h1><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">一颗二叉查找树（<strong>BST</strong>）是一颗二叉树，其中每个节点都含有一个可比较的键（以及相关联的&#20540;）且<u>每个结点的键都大于其左子树中的任意结点的键而小于右子树的任意结点的键</u>。</p><br><p style="font-size:18px">&nbsp;<img src="http://img.blog.csdn.net/20140517140928015?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p><br><p style="font-size:18px"></p><br><p>一颗二叉查找树代表了一组键（及其相应的&#20540;）的集合，而同一个集合可以用多颗不同的二叉查找树表示。</p><br><p>如果我们将一颗二叉查找树的所有键<strong><u>投影</u></strong>到一条直线上，保证一个结点的左子树中的键出现在它的右边，右子树中的键出现在它的右边，那么我们一定可以得到一条有序的键列。</p><br><p>&nbsp;</p><br><img src="http://img.blog.csdn.net/20140517141025312?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br><br><p style="font-size:18px"><br><br></p><br><p></p><br><p><strong><span style="font-size:24px">查找</span></strong></p><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">在二叉查找树中查找一个键的递归算法：</p><br><p style="font-size:18px">如果树是空的，则查找未命中。如果被查找的键和根结点的键相等，查找命中。否则我们就在适当的子树中继续查找。如果被查找的键较小就选择左子树，较大就选择右子树。</p><br><p style="font-size:18px">在二叉查找树中，<u>随着我们不断向下查找，当前结点所表示的子树的大小也在减小</u>（理想情况下是减半）</p><br><p style="font-size:18px">&nbsp;</p><br><p><strong><span style="font-size:24px">插入</span></strong></p><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">查找代码几乎和二分查找的一样简单，这种<strong><span style="color:red">简洁性</span></strong>是二叉查找树的重要特性之一。而二叉查找树的另一个更重要的特性就是<u>插入的实现难度和查找差不多</u>。</p><br><p style="font-size:18px">当查找一个不存在于树中的结点并结束于一条空链接时，我们需要做的就是将链接指向一个含有被查找的键的新结点。如果被查找的键小于根结点的键，我们会继续在左子树中插入该键，否则在右子树中插入该键。</p><br><p style="font-size:18px">&nbsp;</p><br><p><strong><span style="font-size:24px">分析</span></strong></p><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">使用二叉查找树的算法的运行时间取决于<u>树的形状</u>，而树的形状又取决于键被插入的先后顺序。</p><br><p style="font-size:18px">在最好的情况下，一颗含有N个结点的树是完全平衡的，每条空链接和根结点的距离都为~lgN。在最坏的情况下，搜索路径上可能有N个结点。但在一般情况下树的形状和最好情况更接近。</p><br><span style="font-size:18px"><img src="http://img.blog.csdn.net/20140517141307031?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></span><br><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px"></p><br><p>我们假设键的插入顺序是随机的。对这个模型的分析而言，<u>二叉查找树和快速排序几乎就是“双胞胎”</u>。树的根结点就是快速排序中的第一个切分元素（左侧的键都比它小，右侧的键都比它大），而这对于所有的子树同样适用，这和快速排序中对于子数组的递归排序完全对应。</p><br><p>【在由N个随机键构造的二叉查找树中，查找命中平均所需的比较次数为~2lgN。 N越大这个公式越准确】</p><br><p>&nbsp;</p><br><h1>平衡查找树</h1><br><p><br><br></p><br><p>在一颗含有N个结点的树中，我们希望树高为~lgN，这样我们就能保证所有查找都能在~lgN此比较内结束，就和二分查找一样。不幸的是，在动态插入中保证树的完美平衡的代价太高了。我们放松对完美平衡的要求，使符号表API中所有操作均能够在对数时间内完成。</p><br><p>&nbsp;</p><br><h2><span style="color:red">2-3</span><span style="color:red">查找树</span></h2><br><p><br><br></p><br><p>为了保证查找树的平衡性，我们需要一些灵活性，因此在这里我们允许树中的一个结点保存多个键。</p><br><p><strong>2-结点</strong>：含有一个键(及&#20540;)和两条链接，左链接指向的2-3树中的键都小于该结点，右链接指向的2-3树中的键都大于该结点。</p><br><p><strong>3-结点</strong>：含有两个键(及&#20540;)和三条链接，左链接指向的2-3树中的键都小于该结点，中链接指向的2-3树中的键都位于该结点的两个键之间，右链接指向的2-3树中的键都大于该结点。</p><br><p>（2-3指的是2叉-3叉的意思）</p><br><img src="http://img.blog.csdn.net/20140517141525468?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br><br><span style="font-size:18px"><img src="http://img.blog.csdn.net/20140517141558937?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></span><br><br><p><span style="font-size:18px"><br><br></span></p><br><p></p><br><p style="font-size:18px">一颗完美平衡的2-3查找树中的所有空链接到根结点的距离都是相同的。</p><br><p style="font-size:18px">&nbsp;</p><br><p><strong><span style="font-size:24px">查找</span></strong></p><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">要判断一个键是否在树中，我们先将它和根结点中的键比较。如果它和其中的任何一个相等，查找命中。否则我们就根据比较的结果找到指向相应区间的链接，并在其指向的子树中递归地继续查找。如果这是个空链接，查找未命中。</p><br><p style="font-size:18px">&nbsp;</p><br><p><strong><span style="color:red"><span style="font-size:24px">插入</span></span></strong></p><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">要在2-3树中插入一个新结点，我们可以和二叉查找树一样先进行一次未命中的查找，然后把新结点挂在树的底部。但这样的话树无法保持完美平衡性。我们使用2-3树的主要原因就在于它能够在插入之后继续保持平衡。</p><br><p style="font-size:18px">如果未命中的查找结束于一个2-结点，我们只要把这个2-结点替换为一个3-结点，将要插入的键保存在其中即可。<u>如果未命中的查找结束于一个3-结点</u>，事情就要麻烦一些。</p><br><p style="font-size:18px">&nbsp;</p><br><p><span style="font-size:24px"><strong>热身</strong>：</span></p><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">先考虑最简单的例子：只有一个3-结点的树，向其插入一个新键。</p><br><p style="font-size:18px">这棵树唯一的结点中已经没有可插入的空间了。我们又不能把新键插在其空结点上（破坏了完美平衡）。为了将新键插入，我们先临时将新键存入该结点中，使之成为一个4-结点。创建一个4-结点很方便，因为很容易将它转换为一颗由3个2-结点组成的2-3树（如图所示），这棵树既是一颗含有3个结点的二叉查找树，同时也是一颗完美平衡的2-3树，其中所有空链接到根结点的距离都相等。</p><br><span style="font-size:18px"><img src="http://img.blog.csdn.net/20140517141709609?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></span><br><br><p><span style="font-size:18px"></span></p><br><p>&nbsp;</p><br><p><strong>向一个父结点为2-结点的3-结点中插入新键</strong></p><br><p>假设未命中的查找结束于一个3-结点，而它的父结点是一个2-结点。在这种情况下我们需要在维持树的完美平衡的前提下为新键腾出空间。</p><br><p>我们先像刚才一样构造一个临时的4-结点并将其分解，但此时我们不会为<u>中键</u>创建一个新结点，而是<u>将其移动至原来的父结点中</u>。（如图所示）</p><br><img src="http://img.blog.csdn.net/20140517141807656?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br><br><p><span style="font-size:18px"></span></p><br><p>这次转换也并不影响（完美平衡的）2-3树的主要性质。树仍然是有序的，因为中键被移动到父结点中去了，树仍然是完美平衡的，插入后所有的空链接到根结点的距离仍然相同。</p><br><p>&nbsp;</p><br><p><strong>向一个父结点为3-结点的3-结点中插入新键</strong></p><br><p>假设未命中的查找结束于一个3-结点，而它的父结点是一个3-结点。</p><br><p><u>我们再次和刚才一样构造一个临时的4-结点并分解它，然后将它的中键插入它的父结点中</u>。但父结点也是一个3-结点，因此我们再用这个中键构造一个新的临时4-结点，然后在这个结点上进行相同的变换，即分解这个父结点并将它的中键插入到它的父结点中去。</p><br><p>我们就这样<u>一直向上不断分解临时的4-结点并将中键插入更高的父结点</u>，直至遇到一个2-结点并将它替换为一个不需要继续分解的3-结点，或者是到达3-结点的根。</p><br><img src="http://img.blog.csdn.net/20140517141942296?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br><br><p></p><br><p><span style="font-size:24px"><strong>总结</strong>：</span></p><br><p style="font-size:18px"><strong>先找插入结点，若结点有空(即2-结点)，则直接插入。如结点没空(即3-结点)，则插入使其临时容纳这个元素，然后分裂此结点，把中间元素移到其父结点中。对父结点亦如此处理。</strong>（中键一直往上移，直到找到空位，在此过程中没有空位就先搞个临时的，再分裂。）</p><br><p style="font-size:18px">&nbsp;</p><br><p style="font-size:18px">&nbsp;</p><br><p style="font-size:18px">★2-3树插入算法的<span style="color:red">根本在于</span>这些变换都是局部的：除了相关的结点和链接之外不必修改或者检查树的其他部分。每次变换中，变更的链接数量不会超过一个很小的常数。所有局部变换都不会影响整棵树的有序性和平衡性。</p><br><p style="font-size:18px">&nbsp;</p><br><p style="font-size:18px"><strong>{你确定理解了2-3树的插入过程了吗？ 如果你理解了，那么你也就基本理解了红黑树的插入}</strong></p><br><p style="font-size:18px">&nbsp;</p><br><p><strong><span style="font-size:24px">构造</span></strong></p><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">和标准的二叉查找树由上向下生长不同，<span style="color:red">2-3</span><span style="color:red">树的生长是由下向上的</span>。</p><br><span style="font-size:18px"><img src="http://img.blog.csdn.net/20140517142043906?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></span><br><br><p><span style="font-size:18px"><br><br></span></p><br><p></p><br><p><strong><span style="font-size:24px">优点</span></strong></p><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">2-3树在最坏情况下仍有较好的性能。每个操作中处理每个结点的时间都不会超过一个很小的常数，且这两个操作都只会访问一条路径上的结点，所以<u>任何查找或者插入的成本都肯定不会超过对数级别</u>。</p><br><p style="font-size:18px">完美平衡的2-3树要平展的多。例如，含有10亿个结点的一颗2-3树的高度仅在19到30之间。我们最多只需要访问30个结点就能在10亿个键中进行任意查找和插入操作。</p><br><p style="font-size:18px">&nbsp;</p><br><p><strong><span style="font-size:24px">缺点</span></strong></p><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">我们需要维护两种不同类型的结点，查找和插入操作的实现需要大量的代码，而且它们所产生的额外开销可能会使算法比标准的二叉查找树更慢。</p><br><p style="font-size:18px">平衡一棵树的初衷是为了消除最坏情况，但我们希望这种保障所需的代码能够越少越好。</p><br><p style="font-size:18px">&nbsp;</p><br><p style="font-size:18px"><br><br></p><br><h2><span style="font-family:Microsoft YaHei; font-size:32px">红黑二叉查找树</span></h2><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">【前言：本文所讨论的红黑树之目的在于使读者能更简单清晰地了解红黑树的构造，使读者能在纸上清晰快速地画出红黑树，而不是为了写出红黑树的实现代码。</p><br><p style="font-size:18px">若是要在代码级理解红黑树，则势必需要记住其复杂的插入和旋转的各种情况，我认为那只有助于增加大家对红黑树的恐惧，实际面试和工作中几乎不会遇到需要自己动手实现红黑树的情况(很多语言的标准库中就有红黑树的实现)。&nbsp; 若对于红黑树的C代码实现有兴趣的，可移步至July的博客。】</p><br><p style="font-size:18px">&nbsp;</p><br><p style="font-size:18px">（<strong>理解红黑树一句话就够了</strong>：<span style="color:red">红黑树就是用红链接表示3-</span>结点的2-3树。那么红黑树的插入、构造就可转化为2-3树的问题，即：<u>在脑中用2-3树来操作，得到结果，再把结果中的3-结点转化为红链接即可</u>。而2-3树的插入，前面已有详细图文，实际也很简单：有空则插，没空硬插，再分裂。&nbsp; 这样，我们就不用记那么复杂且让人头疼的红黑树插入旋转的各种情况了。只要清楚2-3树的插入方式即可。&nbsp;<br> 下面图文详细演示。）</p><br><p style="font-size:18px">&nbsp;</p><br><p style="font-size:18px"><span style="font-family:Microsoft YaHei"><strong>红黑树的本质</strong>：</span></p><br><p style="font-size:18px">红黑树是对2-3查找树的改进，它能用一种统一的方式完成所有变换。</p><br><p style="font-size:18px">&nbsp;</p><br><p><span style="font-size:24px"><span style="color:red">替换</span><span style="color:red">3-</span><span style="color:red">结点</span></span></p><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">★红黑树背后的思想是用标准的二叉查找树（完全由2-结点构成）和一些额外的信息（替换3-结点）来表示2-3树。</p><br><p style="font-size:18px">我们将树中的链接分为两种类型：<span style="color:red">红链接</span>将两个2-结点连接起来构成一个3-结点，黑链接则是2-3树中的普通链接。确切地说，<span style="color:red">我们将</span><span style="color:red">3-</span><span style="color:red">结点表示为由一条<strong><u>左斜</u></strong>的红色链接相连的两个</span><span style="color:red">2-</span><span style="color:red">结点</span>。</p><br><p style="font-size:18px">这种表示法的一个优点是，我们无需修改就可以直接使用标准二叉查找树的get()方法。对于任意的2-3树，只要对结点进行转换，我们都可以立即派生出一颗对应的二叉查找树。我们将用这种方式表示2-3树的二叉查找树称为红黑树。</p><br><span style="font-size:18px"><img src="http://img.blog.csdn.net/20140517142303390?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></span><br><br><p><span style="font-size:18px"></span></p><br><p><strong>红黑树的另一种定义</strong>是满足下列条件的二叉查找树：</p><br><p>⑴红链接均为左链接。</p><br><p>⑵没有任何一个结点同时和两条红链接相连。</p><br><p>⑶该树是完美黑色平衡的，即任意空链接到根结点的路径上的黑链接数量相同。</p><br><p>&nbsp;</p><br><p>如果我们<span style="color:red">将一颗红黑树中的红链接画平</span>，那么所有的空链接到根结点的距离都将是相同的。如果我们将由红链接相连的结点合并，得到的就是一颗2-3树。</p><br><p>相反，如果将一颗2-3树中的3-结点画作由红色左链接相连的两个2-结点，那么不会存在能够和两条红链接相连的结点，且树必然是完美平衡的。</p><br><img src="http://img.blog.csdn.net/20140517142543921?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br><br><p></p><br><p style="font-size:18px">&nbsp;</p><br><p style="font-size:18px">无论我们用何种方式去定义它们，<span style="color:red">红黑树都既是二叉查找树，也是</span><span style="color:red">2-3</span><span style="color:red">树</span>。</p><br><p style="font-size:18px">（2-3树的深度很小，平衡性好，效率高，但是其有两种不同的结点，实际代码实现比较复杂。而红黑树用红链接表示2-3树中另类的3-结点，统一了树中的结点类型，使代码实现简单化，又不破坏其高效性。）</p><br><p style="font-size:18px">&nbsp;</p><br><p><span style="font-size:24px"><strong>颜色表示</strong>：</span></p><br><p style="font-size:18px">因为每个结点都只会有一条指向自己的链接（从它的父结点指向它），我们将链接的颜色保存在表示结点的Node数据类型的布尔变量color中（若指向它的链接是红色的，那么该变量为true，黑色则为false）。</p><br><p style="font-size:18px">当我们提到一个结点颜色时，我们指的是指向该结点的链接的颜色。</p><br><p style="font-size:18px">&nbsp;</p><br><p><strong><span style="font-size:24px">旋转</span></strong></p><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">在我们实现的某些操作中可能会出现红色右链接或者两条连续的红链接，但在操作完成前这些情况都会被小心地旋转并修复。</p><br><p style="font-size:18px">（我们在这里不讨论旋转的几种情况，把红黑树看做2-3树，自然可以得到正确的旋转后结果）</p><br><p style="font-size:18px">&nbsp;</p><br><p><strong><span style="color:red"><span style="font-size:24px">插入</span></span></strong></p><br><p style="font-size:18px"><br><br></p><br><p style="font-size:18px">在插入时我们可以使用旋转操作帮助我们保证2-3树和红黑树之间的一一对应关系，因为旋转操作可以保持红黑树的两个重要性质：<span style="color:red">有序性</span>和<span style="color:red">完美平衡性</span>。</p><br><p style="font-size:18px">&nbsp;</p><br><p><span style="font-size:24px"><strong>热身</strong>：</span></p><br><p style="font-size:18px"><strong><br><br></strong></p><br><p style="font-size:18px"><strong>向2-结点中插入新键</strong></p><br><p style="font-size:18px">（向红黑树中插入操作时，想想2-3树的插入操作。红黑树与2-3树在本质上是相同的，只是它们对3结点的表示不同。</p><br><p style="font-size:18px">向一个只含有一个2-结点的2-3树中插入新键后，2-结点变为3-结点。我们再把这个3-结点转化为红结点即可）</p><br><span style="font-size:18px"><img src="http://img.blog.csdn.net/20140517143549781?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></span><br><br><p><span style="font-size:18px"></span></p><br><p><strong>向一颗双键树（即一个3-结点）中插入新键</strong></p><br><p>（向红黑树中插入操作时，想想2-3树的插入操作。你把红黑树当做2-3树来处理插入，一切都变得简单了）</p><br><p>（向2-3树中的一个3-结点插入新键，这个3结点临时成为4-结点，然后分裂成3个2结点）</p><br><img src="http://img.blog.csdn.net/20140517143641906?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br><br><p><span style="font-size:18px"><br><br></span></p><br><p></p><br><p><strong><span style="font-size:24px">★一颗红黑树的构造全过程</span></strong></p><br><span style="font-size:18px"><img src="http://img.blog.csdn.net/20140517143739453?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWFuZ195dWxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></span><br><br><p><span style="font-size:18px"></span></p><br><h2>平衡二叉树（AVL树）</h2><br><p></p><br><p><span style="color:red"><br><br></span></p><br><p><span style="color:red">定义</span>：平衡二叉树(Balance Binary Tree)又称AVL树。它或者是一颗空树，或者是具有下列性质的二叉树：它的左子树和右子树都是平衡二叉树，且左子树和右子树的深度之差的绝对&#20540;不超过1。</p><br><p>若将二叉树上结点的平衡因子BF(BalanceFactor)定义为该结点的左子树深度减去它的右子树深度，则<strong>平衡因子的绝对&#20540;大于1</strong>。</p><br><p>&nbsp;</p><br><p>其旋转操作 用2-3树的分裂来类比想象。</p><br><br><br><p><span style="font-size:18px"><br><br></span></p><br><p><span style="font-size:18px"><br><br></span></p><br><p><span style="font-size:18px"><a target="_blank" href="http://blog.csdn.net/yang_yulei/article/details/26104921">下半部分——散列表、B树、B&#43;树、Trie树。</a></span></p><br><p><span style="font-size:18px"><br><br></span></p><br><p><span style="font-size:18px"><br><br></span></p><br><p><br><br></p><br><p><br><br></p><br><br></div>


          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/06/26/truncation-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/26/truncation-01/" itemprop="url">转载:分布式事务保持最终一致性</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-26T15:58:28+08:00">
                2017-06-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="cnblogs_post_body"><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 目前的应用系统，不管是企业级应用还是互联网应用，<strong>最终数据的一致性</strong>是每个应用系统都要面临的问题，随着分布式的逐渐普及，数据一致性更加艰难，但是也很难有银弹的解决方案，也并不是<strong>引入特定的中间件或者特定的开源框架</strong>能够解决的，更多的还是看<strong>业务场景</strong>，根据场景来给出解决方案。根据笔者最近几年的了解，总结了几个点，更多的应用系统在编码的时候，更加关注数据的一致性，这样系统才是健壮的。</p><br><p>一、基础理论</p><br><p>&nbsp;&nbsp; 目前关于事务的几大理论包括：<strong>ACID事务特性，CAP分布式理论，以及BASE</strong>等。<span style="color: #ff0000;"><strong>ACID在数据库事务中体现</strong></span>，<strong><span style="color: #ff0000;">CAP和BASE则是分布式事务的理论</span></strong>，结合业务系统，例如订单管理，例如仓储管理等，可以借鉴这些理论，从而解决问题。</p><br><p><strong>1、ACID 特性</strong></p><br><p><strong>2、CAP特性</strong></p><br><ul><br><li>C（一致性）一致性是指数据的原子性，在经典的数据库中通过事务来保障，事务完成时，无论成功或回滚，数据都会处于一致的状态，在分布式环境下，一致性是指多个节点数据是否一致；</li><br><li>A（可用性）服务一直保持可用的状态，当用户发出一个请求，服务能在一定的时间内返回结果；</li><br><li>P（分区容忍性）在分布式应用中，可能因为一些分布式的原因导致系统无法运转，好的分区容忍性，使应用虽然是一个分布式系统，但是好像一个可以正常运转的整体</li><br></ul><br><p><strong>3、BASE特性</strong></p><br><ul><br><li>BA: Basic Availability 基本业务可用性；</li><br><li>S: Soft state 柔性状态；</li><br><li>E: Eventual consistency 最终一致性；</li><br></ul><br><p>二、最终一致性的常用做法</p><br><p><img style="margin-right: auto; margin-left: auto; display: block;" src="http://images2015.cnblogs.com/blog/37237/201603/37237-20160329211439738-299763280.png" alt=""></p><br><p>1、<span style="font-size: 14px;">单数据库事务</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果应用系统是单一的数据库，那么这个很好保证，利用数据库的事务特性来满足事务的一致性，这时候的一致性是强一致性的。对于java应用系统来讲，很少直接通过事务的start和commit以及rollback来硬编码，大多通过spring的事务模板或者声明式事务来保证；</span></p><br><p><span style="font-size: 14px;">2、多数据库事务</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp; 针对多数据库事务可以根据二阶段提交协议，采用spring 3.0 + Atomikos + JTA进行支持； </span></p><br><p><span style="font-size: 14px;">3、基于<strong>事务型消息队列</strong>的最终一致性</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp; 借助消息队列，在处理业务逻辑的地方发送消息，业务逻辑处理成功后，提交消息，确保消息是发送成功的，之后消息队列投递来进行处理，如果成功，则结束，如果没有成功，则重试，直到成功，不过仅仅适用业务逻辑中，第一阶段成功，第二阶段必须成功的场景。对应上图中的C流程。</span></p><br><p><span style="font-size: 14px;">4、基于<strong>消息队列+定时补偿机制</strong>的最终一致性</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp; 前面部分和上面基于事务型消息的队列，不同的是，第二阶段重试的地方，不再是消息中间件自身的重试逻辑了，而是单独的补偿任务机制。其实在大多数的逻辑中，第二阶段失败的概率比较小，所以单独独立补偿任务表出来，可以更加清晰，能够比较明确的直到当前多少任务是失败的。对应上图的E流程。</span></p><br><p><span style="font-size: 14px;">5、异步回调机制的引入</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp; A应用调用B，在同步调用的返回结果中，B返回成功给到A，一般情况下，这时候就结束了，其实在99.99%的情况是没问题的，但是有时候为了确保100%，记住最起码在系统设计中100%，这时候B系统再回调A一下，告诉A，你调用我的逻辑，确实成功了。其实这个逻辑，非常类似TCP协议中的三次握手。上图中的B流程。</span></p><br><p><span style="font-size: 14px;">6、类似double check机制的确认机制</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;还是上图中异步回调的过程，A在同步调用B，B返回成功了。这次调用结束了，但是A为了确保，在过一段时间，这个时间可以是几秒，也可以是每天定时处理，再调用B一次，查询一下之前的那次调用是否成功。例如A调用B更新订单状态，这时候成功了，延迟几秒后，A查询B，确认一下状态是否是自己刚刚期望的。上图中的D流程。</span></p><br><p><span style="font-size: 14px;">三、分布式事务的缺点</span></p><br><p><span style="font-size: 14px;">1、二阶段提交协议缺点</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp; 两阶段提交涉及到多个节点的网络通信,通信时间如果过长,事务的相对时间也就会过长,那么锁定资源的时间也就长了.在高并发的服务中,就会存在严重的性能瓶劲</span></p><br><p>&nbsp;2、消息队列</p><br><p>&nbsp;&nbsp; 在高并发的环境中，我们一般会采用消息队列来避免分布式事务的执行。</p><br><p>&nbsp;&nbsp; 在使用消息队列时，我们需要做到可靠凭证的保存（分布式事务的消息），有如下几种方式：</p><br><p>&nbsp;&nbsp; 以支付宝和余额宝为例进行说明.</p><br><p>&nbsp;&nbsp; 支付宝完成扣钱的动作时,记录消息数据,将消息数据和业务数据存在同一个数据库实例中.</p><br><div class="cnblogs_code"><br><pre><span style="color: #000000;">Begin Transaction<br>  update A set amount</span>=amount-1000 where uid=100<span style="color: #000000;">;<br>  insert into message(uid,amount,status) values (</span>1,1000,1<span style="color: #000000;">)<br>End Transaction<br>Commit;</span></pre><br></div><br><p>将支付宝完成扣钱的消息及时发送给余额宝，余额宝完成处理后返回成功消息，支付宝收到消息后，消除消息表中对应的消息记录，即完成本次扣钱操作.</p><br><p><img style="margin-right: auto; margin-left: auto; display: block;" src="http://images2015.cnblogs.com/blog/37237/201604/37237-20160407223903047-1106443422.png" alt=""></p><br><p><span style="font-family: &lsquo;Times New Roman&lsquo;; font-size: 14px;">传统方式是，我做完了，发你消息。解决一致性的方案的意思就是，我先发你消息，我做完了再跟你确认我做完了。这是改进后的有事务的消息中间件。</span></p><br><p><span style="font-family: &lsquo;Times New Roman&lsquo;; font-size: 14px;">参见：<a href="http://coolshell.cn/articles/10910.html" target="_blank" rel="external">http://coolshell.cn/articles/10910.html</a></span></p></div><div id="MySignature"></div><br><div class="clear"></div><br><div id="blog_post_info_block"><br><div id="BlogPostCategory"></div><br><div id="EntryTag"></div><br><div id="blog_post_info"><br></div><br><div class="clear"></div><br><div id="post_next_prev"></div><br></div>


          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://bloodorange2017.github.io/images/img_head_001.jpg"
               alt="XueCheng" />
          <p class="site-author-name" itemprop="name">XueCheng</p>
           
              <p class="site-description motion-element" itemprop="description">Do one thing at a time, and do well.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">45</span>
                <span class="site-state-item-name">Artikel</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XueCheng</span>
</div>


<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

<script type="text/javascript"
color="160,160,233" opacity='0.4' zIndex="-2" count="16" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
