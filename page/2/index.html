<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="Do one thing at a time, and do well.">
<meta property="og:type" content="website">
<meta property="og:title" content="XueCheng Notes">
<meta property="og:url" content="https://bloodorange2017.github.io/archives/page/2/index.html">
<meta property="og:site_name" content="XueCheng Notes">
<meta property="og:description" content="Do one thing at a time, and do well.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="XueCheng Notes">
<meta name="twitter:description" content="Do one thing at a time, and do well.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://bloodorange2017.github.io/archives/page/2/"/>





  <title>XueCheng Notes</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">XueCheng Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Where there is a will, there is a way.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/06/26/truncation-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/26/truncation-01/" itemprop="url">转载:分布式事务保持最终一致性</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-26T15:58:28+08:00">
                2017-06-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="cnblogs_post_body"><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 目前的应用系统，不管是企业级应用还是互联网应用，<strong>最终数据的一致性</strong>是每个应用系统都要面临的问题，随着分布式的逐渐普及，数据一致性更加艰难，但是也很难有银弹的解决方案，也并不是<strong>引入特定的中间件或者特定的开源框架</strong>能够解决的，更多的还是看<strong>业务场景</strong>，根据场景来给出解决方案。根据笔者最近几年的了解，总结了几个点，更多的应用系统在编码的时候，更加关注数据的一致性，这样系统才是健壮的。</p><br><p>一、基础理论</p><br><p>&nbsp;&nbsp; 目前关于事务的几大理论包括：<strong>ACID事务特性，CAP分布式理论，以及BASE</strong>等。<span style="color: #ff0000;"><strong>ACID在数据库事务中体现</strong></span>，<strong><span style="color: #ff0000;">CAP和BASE则是分布式事务的理论</span></strong>，结合业务系统，例如订单管理，例如仓储管理等，可以借鉴这些理论，从而解决问题。</p><br><p><strong>1、ACID 特性</strong></p><br><p><strong>2、CAP特性</strong></p><br><ul><br><li>C（一致性）一致性是指数据的原子性，在经典的数据库中通过事务来保障，事务完成时，无论成功或回滚，数据都会处于一致的状态，在分布式环境下，一致性是指多个节点数据是否一致；</li><br><li>A（可用性）服务一直保持可用的状态，当用户发出一个请求，服务能在一定的时间内返回结果；</li><br><li>P（分区容忍性）在分布式应用中，可能因为一些分布式的原因导致系统无法运转，好的分区容忍性，使应用虽然是一个分布式系统，但是好像一个可以正常运转的整体</li><br></ul><br><p><strong>3、BASE特性</strong></p><br><ul><br><li>BA: Basic Availability 基本业务可用性；</li><br><li>S: Soft state 柔性状态；</li><br><li>E: Eventual consistency 最终一致性；</li><br></ul><br><p>二、最终一致性的常用做法</p><br><p><img style="margin-right: auto; margin-left: auto; display: block;" src="http://images2015.cnblogs.com/blog/37237/201603/37237-20160329211439738-299763280.png" alt=""></p><br><p>1、<span style="font-size: 14px;">单数据库事务</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果应用系统是单一的数据库，那么这个很好保证，利用数据库的事务特性来满足事务的一致性，这时候的一致性是强一致性的。对于java应用系统来讲，很少直接通过事务的start和commit以及rollback来硬编码，大多通过spring的事务模板或者声明式事务来保证；</span></p><br><p><span style="font-size: 14px;">2、多数据库事务</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp; 针对多数据库事务可以根据二阶段提交协议，采用spring 3.0 + Atomikos + JTA进行支持； </span></p><br><p><span style="font-size: 14px;">3、基于<strong>事务型消息队列</strong>的最终一致性</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp; 借助消息队列，在处理业务逻辑的地方发送消息，业务逻辑处理成功后，提交消息，确保消息是发送成功的，之后消息队列投递来进行处理，如果成功，则结束，如果没有成功，则重试，直到成功，不过仅仅适用业务逻辑中，第一阶段成功，第二阶段必须成功的场景。对应上图中的C流程。</span></p><br><p><span style="font-size: 14px;">4、基于<strong>消息队列+定时补偿机制</strong>的最终一致性</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp; 前面部分和上面基于事务型消息的队列，不同的是，第二阶段重试的地方，不再是消息中间件自身的重试逻辑了，而是单独的补偿任务机制。其实在大多数的逻辑中，第二阶段失败的概率比较小，所以单独独立补偿任务表出来，可以更加清晰，能够比较明确的直到当前多少任务是失败的。对应上图的E流程。</span></p><br><p><span style="font-size: 14px;">5、异步回调机制的引入</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp; A应用调用B，在同步调用的返回结果中，B返回成功给到A，一般情况下，这时候就结束了，其实在99.99%的情况是没问题的，但是有时候为了确保100%，记住最起码在系统设计中100%，这时候B系统再回调A一下，告诉A，你调用我的逻辑，确实成功了。其实这个逻辑，非常类似TCP协议中的三次握手。上图中的B流程。</span></p><br><p><span style="font-size: 14px;">6、类似double check机制的确认机制</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;还是上图中异步回调的过程，A在同步调用B，B返回成功了。这次调用结束了，但是A为了确保，在过一段时间，这个时间可以是几秒，也可以是每天定时处理，再调用B一次，查询一下之前的那次调用是否成功。例如A调用B更新订单状态，这时候成功了，延迟几秒后，A查询B，确认一下状态是否是自己刚刚期望的。上图中的D流程。</span></p><br><p><span style="font-size: 14px;">三、分布式事务的缺点</span></p><br><p><span style="font-size: 14px;">1、二阶段提交协议缺点</span></p><br><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp; 两阶段提交涉及到多个节点的网络通信,通信时间如果过长,事务的相对时间也就会过长,那么锁定资源的时间也就长了.在高并发的服务中,就会存在严重的性能瓶劲</span></p><br><p>&nbsp;2、消息队列</p><br><p>&nbsp;&nbsp; 在高并发的环境中，我们一般会采用消息队列来避免分布式事务的执行。</p><br><p>&nbsp;&nbsp; 在使用消息队列时，我们需要做到可靠凭证的保存（分布式事务的消息），有如下几种方式：</p><br><p>&nbsp;&nbsp; 以支付宝和余额宝为例进行说明.</p><br><p>&nbsp;&nbsp; 支付宝完成扣钱的动作时,记录消息数据,将消息数据和业务数据存在同一个数据库实例中.</p><br><div class="cnblogs_code"><br><pre><span style="color: #000000;">Begin Transaction<br>  update A set amount</span>=amount-1000 where uid=100<span style="color: #000000;">;<br>  insert into message(uid,amount,status) values (</span>1,1000,1<span style="color: #000000;">)<br>End Transaction<br>Commit;</span></pre><br></div><br><p>将支付宝完成扣钱的消息及时发送给余额宝，余额宝完成处理后返回成功消息，支付宝收到消息后，消除消息表中对应的消息记录，即完成本次扣钱操作.</p><br><p><img style="margin-right: auto; margin-left: auto; display: block;" src="http://images2015.cnblogs.com/blog/37237/201604/37237-20160407223903047-1106443422.png" alt=""></p><br><p><span style="font-family: &lsquo;Times New Roman&lsquo;; font-size: 14px;">传统方式是，我做完了，发你消息。解决一致性的方案的意思就是，我先发你消息，我做完了再跟你确认我做完了。这是改进后的有事务的消息中间件。</span></p><br><p><span style="font-family: &lsquo;Times New Roman&lsquo;; font-size: 14px;">参见：<a href="http://coolshell.cn/articles/10910.html" target="_blank" rel="external">http://coolshell.cn/articles/10910.html</a></span></p></div><div id="MySignature"></div><br><div class="clear"></div><br><div id="blog_post_info_block"><br><div id="BlogPostCategory"></div><br><div id="EntryTag"></div><br><div id="blog_post_info"><br></div><br><div class="clear"></div><br><div id="post_next_prev"></div><br></div>


          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/06/22/dubbo-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/22/dubbo-01/" itemprop="url">dubbo API 搭建流程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-22T14:40:36+08:00">
                2017-06-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1><a name="UserGuide-zh-%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97"></a>用户指南</h1>

<div><br><ul><br>    <li><a href="#UserGuide-zh-%E5%85%A5%E9%97%A8">入门</a></li><br><ul><br>    <li><a href="#UserGuide-zh-%E8%83%8C%E6%99%AF">背景</a></li><br>    <li><a href="#UserGuide-zh-%E9%9C%80%E6%B1%82">需求</a></li><br>    <li><a href="#UserGuide-zh-%E6%9E%B6%E6%9E%84">架构</a></li><br>    <li><a href="#UserGuide-zh-%E7%94%A8%E6%B3%95">用法</a></li><br></ul><br>    <li><a href="#UserGuide-zh-%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8">快速启动</a></li><br><ul><br>    <li><a href="#UserGuide-zh-%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85">服务提供者</a></li><br>    <li><a href="#UserGuide-zh-%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85">服务消费者</a></li><br></ul><br>    <li><a href="#UserGuide-zh-%E4%BE%9D%E8%B5%96">依赖</a></li><br><ul><br>    <li><a href="#UserGuide-zh-%E5%BF%85%E9%9C%80%E4%BE%9D%E8%B5%96">必需依赖</a></li><br>    <li><a href="#UserGuide-zh-%E7%BC%BA%E7%9C%81%E4%BE%9D%E8%B5%96">缺省依赖</a></li><br>    <li><a href="#UserGuide-zh-%E5%8F%AF%E9%80%89%E4%BE%9D%E8%B5%96">可选依赖</a></li><br></ul><br>    <li><a href="#UserGuide-zh-%E6%88%90%E7%86%9F%E5%BA%A6">成熟度</a></li><br><ul><br>    <li><a href="#UserGuide-zh-%E5%8A%9F%E8%83%BD%E6%88%90%E7%86%9F%E5%BA%A6">功能成熟度</a></li><br>    <li><a href="#UserGuide-zh-%E7%AD%96%E7%95%A5%E6%88%90%E7%86%9F%E5%BA%A6">策略成熟度</a></li><br></ul><br>    <li><a href="#UserGuide-zh-%E9%85%8D%E7%BD%AE">配置</a></li><br><ul><br>    <li><a href="#UserGuide-zh-Xml%E9%85%8D%E7%BD%AE">Xml配置</a></li><br>    <li><a href="#UserGuide-zh-%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE">属性配置</a></li><br>    <li><a href="#UserGuide-zh-%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE">注解配置</a></li><br>    <li><a href="#UserGuide-zh-API%E9%85%8D%E7%BD%AE">API配置</a></li><br></ul><br>    <li><a href="#UserGuide-zh-%E7%A4%BA%E4%BE%8B">示例</a></li><br><ul><br>    <li><a href="#UserGuide-zh-%E5%90%AF%E5%8A%A8%E6%97%B6%E6%A3%80%E6%9F%A5">启动时检查</a></li><br>    <li><a href="#UserGuide-zh-%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99">集群容错</a></li><br>    <li><a href="#UserGuide-zh-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">负载均衡</a></li><br>    <li><a href="#UserGuide-zh-%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B">线程模型</a></li><br>    <li><a href="#UserGuide-zh-%E7%9B%B4%E8%BF%9E%E6%8F%90%E4%BE%9B%E8%80%85">直连提供者</a></li><br>    <li><a href="#UserGuide-zh-%E5%8F%AA%E8%AE%A2%E9%98%85">只订阅</a></li><br>    <li><a href="#UserGuide-zh-%E5%8F%AA%E6%B3%A8%E5%86%8C">只注册</a></li><br>    <li><a href="#UserGuide-zh-%E9%9D%99%E6%80%81%E6%9C%8D%E5%8A%A1">静态服务</a></li><br>    <li><a href="#UserGuide-zh-%E5%A4%9A%E5%8D%8F%E8%AE%AE">多协议</a></li><br>    <li><a href="#UserGuide-zh-%E5%A4%9A%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">多注册中心</a></li><br>    <li><a href="#UserGuide-zh-%E6%9C%8D%E5%8A%A1%E5%88%86%E7%BB%84">服务分组</a></li><br>    <li><a href="#UserGuide-zh-%E5%A4%9A%E7%89%88%E6%9C%AC">多版本</a></li><br>    <li><a href="#UserGuide-zh-%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88">分组聚合</a></li><br>    <li><a href="#UserGuide-zh-%E5%8F%82%E6%95%B0%E9%AA%8C%E8%AF%81">参数验证</a></li><br>    <li><a href="#UserGuide-zh-%E7%BB%93%E6%9E%9C%E7%BC%93%E5%AD%98">结果缓存</a></li><br>    <li><a href="#UserGuide-zh-%E6%B3%9B%E5%8C%96%E5%BC%95%E7%94%A8">泛化引用</a></li><br>    <li><a href="#UserGuide-zh-%E6%B3%9B%E5%8C%96%E5%AE%9E%E7%8E%B0">泛化实现</a></li><br>    <li><a href="#UserGuide-zh-%E5%9B%9E%E5%A3%B0%E6%B5%8B%E8%AF%95">回声测试</a></li><br>    <li><a href="#UserGuide-zh-%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF">上下文信息</a></li><br>    <li><a href="#UserGuide-zh-%E9%9A%90%E5%BC%8F%E4%BC%A0%E5%8F%82">隐式传参</a></li><br>    <li><a href="#UserGuide-zh-%E5%BC%82%E6%AD%A5%E8%B0%83%E7%94%A8">异步调用</a></li><br>    <li><a href="#UserGuide-zh-%E6%9C%AC%E5%9C%B0%E8%B0%83%E7%94%A8">本地调用</a></li><br>    <li><a href="#UserGuide-zh-%E5%8F%82%E6%95%B0%E5%9B%9E%E8%B0%83">参数回调</a></li><br>    <li><a href="#UserGuide-zh-%E4%BA%8B%E4%BB%B6%E9%80%9A%E7%9F%A5">事件通知</a></li><br>    <li><a href="#UserGuide-zh-%E6%9C%AC%E5%9C%B0%E5%AD%98%E6%A0%B9">本地存根</a></li><br>    <li><a href="#UserGuide-zh-%E6%9C%AC%E5%9C%B0%E4%BC%AA%E8%A3%85">本地伪装</a></li><br>    <li><a href="#UserGuide-zh-%E5%BB%B6%E8%BF%9F%E6%9A%B4%E9%9C%B2">延迟暴露</a></li><br>    <li><a href="#UserGuide-zh-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6">并发控制</a></li><br>    <li><a href="#UserGuide-zh-%E8%BF%9E%E6%8E%A5%E6%8E%A7%E5%88%B6">连接控制</a></li><br>    <li><a href="#UserGuide-zh-%E5%BB%B6%E8%BF%9F%E8%BF%9E%E6%8E%A5">延迟连接</a></li><br>    <li><a href="#UserGuide-zh-%E7%B2%98%E6%BB%9E%E8%BF%9E%E6%8E%A5">粘滞连接</a></li><br>    <li><a href="#UserGuide-zh-%E4%BB%A4%E7%89%8C%E9%AA%8C%E8%AF%81">令牌验证</a></li><br>    <li><a href="#UserGuide-zh-%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99">路由规则</a></li><br>    <li><a href="#UserGuide-zh-%E9%85%8D%E7%BD%AE%E8%A7%84%E5%88%99">配置规则</a></li><br>    <li><a href="#UserGuide-zh-%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7">服务降级</a></li><br>    <li><a href="#UserGuide-zh-%E4%BC%98%E9%9B%85%E5%81%9C%E6%9C%BA">优雅停机</a></li><br>    <li><a href="#UserGuide-zh-%E4%B8%BB%E6%9C%BA%E7%BB%91%E5%AE%9A">主机绑定</a></li><br>    <li><a href="#UserGuide-zh-%E6%97%A5%E5%BF%97%E9%80%82%E9%85%8D">日志适配</a></li><br>    <li><a href="#UserGuide-zh-%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97">访问日志</a></li><br>    <li><a href="#UserGuide-zh-%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8">服务容器</a></li><br>    <li><a href="#UserGuide-zh-ReferenceConfig%E7%BC%93%E5%AD%98">Reference Config缓存</a></li><br>    <li><a href="#UserGuide-zh-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1">分布式事务</a></li><br></ul><br>    <li><a href="#UserGuide-zh-API%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">API参考手册</a></li><br><ul><br>    <li><a href="#UserGuide-zh-%E9%85%8D%E7%BD%AEAPI">配置API</a></li><br>    <li><a href="#UserGuide-zh-%E6%B3%A8%E8%A7%A3API">注解API</a></li><br>    <li><a href="#UserGuide-zh-%E6%A8%A1%E5%9E%8BAPI">模型API</a></li><br>    <li><a href="#UserGuide-zh-%E4%B8%8A%E4%B8%8B%E6%96%87API">上下文API</a></li><br>    <li><a href="#UserGuide-zh-%E6%9C%8D%E5%8A%A1API">服务API</a></li><br></ul><br>    <li><a href="#UserGuide-zh-%E9%85%8D%E7%BD%AE%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">配置参考手册</a></li><br><ul><br>    <li><a href="#UserGuide-zh-%3Cdubbo%3Aservice%2F%3E">&lt;dubbo:service/&gt;</a></li><br>    <li><a href="#UserGuide-zh-%3Cdubbo%3Areference%2F%3E">&lt;dubbo:reference/&gt;</a></li><br>    <li><a href="#UserGuide-zh-%3Cdubbo%3Aprotocol%2F%3E">&lt;dubbo:protocol/&gt;</a></li><br>    <li><a href="#UserGuide-zh-%3Cdubbo%3Aregistry%2F%3E">&lt;dubbo:registry/&gt;</a></li><br>    <li><a href="#UserGuide-zh-%3Cdubbo%3Amonitor%2F%3E">&lt;dubbo:monitor/&gt;</a></li><br>    <li><a href="#UserGuide-zh-%3Cdubbo%3Aapplication%2F%3E">&lt;dubbo:application/&gt;</a></li><br>    <li><a href="#UserGuide-zh-%3Cdubbo%3Amodule%2F%3E">&lt;dubbo:module/&gt;</a></li><br>    <li><a href="#UserGuide-zh-%3Cdubbo%3Aprovider%2F%3E">&lt;dubbo:provider/&gt;</a></li><br>    <li><a href="#UserGuide-zh-%3Cdubbo%3Aconsumer%2F%3E">&lt;dubbo:consumer/&gt;</a></li><br>    <li><a href="#UserGuide-zh-%3Cdubbo%3Amethod%2F%3E">&lt;dubbo:method/&gt;</a></li><br>    <li><a href="#UserGuide-zh-%3Cdubbo%3Aargument%2F%3E">&lt;dubbo:argument/&gt;</a></li><br>    <li><a href="#UserGuide-zh-%3Cdubbo%3Aparameter%2F%3E">&lt;dubbo:parameter/&gt;</a></li><br></ul><br>    <li><a href="#UserGuide-zh-%E5%8D%8F%E8%AE%AE%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">协议参考手册</a></li><br><ul><br>    <li><a href="#UserGuide-zh-dubbo%3A%2F%2F">dubbo://</a></li><br>    <li><a href="#UserGuide-zh-rmi%3A%2F%2F">rmi://</a></li><br>    <li><a href="#UserGuide-zh-hessian%3A%2F%2F">hessian://</a></li><br>    <li><a href="#UserGuide-zh-http%3A%2F%2F">http://</a></li><br>    <li><a href="#UserGuide-zh-webservice%3A%2F%2F">webservice://</a></li><br>    <li><a href="#UserGuide-zh-thrift%3A%2F%2F">thrift://</a></li><br>    <li><a href="#UserGuide-zh-memcached%3A%2F%2F">memcached://</a></li><br>    <li><a href="#UserGuide-zh-redis%3A%2F%2F">redis://</a></li><br></ul><br>    <li><a href="#UserGuide-zh-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">注册中心参考手册</a></li><br><ul><br>    <li><a href="#UserGuide-zh-Multicast%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">Multicast注册中心</a></li><br>    <li><a href="#UserGuide-zh-Zookeeper%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">Zookeeper注册中心</a></li><br>    <li><a href="#UserGuide-zh-Redis%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">Redis注册中心</a></li><br>    <li><a href="#UserGuide-zh-Simple%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">Simple注册中心</a></li><br>    <li><a href="#UserGuide-zh-Simple%E7%9B%91%E6%8E%A7%E4%B8%AD%E5%BF%83">Simple监控中心</a></li><br></ul><br>    <li><a href="#UserGuide-zh-Telnet%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">Telnet命令参考手册</a></li><br><ul><br>    <li><a href="#UserGuide-zh-ls">ls</a></li><br>    <li><a href="#UserGuide-zh-ps">ps</a></li><br>    <li><a href="#UserGuide-zh-cd">cd</a></li><br>    <li><a href="#UserGuide-zh-pwd">pwd</a></li><br>    <li><a href="#UserGuide-zh-trace">trace</a></li><br>    <li><a href="#UserGuide-zh-count">count</a></li><br>    <li><a href="#UserGuide-zh-invoke">invoke</a></li><br>    <li><a href="#UserGuide-zh-status">status</a></li><br>    <li><a href="#UserGuide-zh-log">log</a></li><br>    <li><a href="#UserGuide-zh-help">help</a></li><br>    <li><a href="#UserGuide-zh-clear">clear</a></li><br>    <li><a href="#UserGuide-zh-exit">exit</a></li><br></ul><br>    <li><a href="#UserGuide-zh-Maven%E6%8F%92%E4%BB%B6%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">Maven插件参考手册</a></li><br><ul><br>    <li><a href="#UserGuide-zh-mvndubbo%3Aregistry">mvn dubbo:registry</a></li><br>    <li><a href="#UserGuide-zh-mvndubbo%3Acreate">mvn dubbo:create</a></li><br></ul><br>    <li><a href="#UserGuide-zh-%E6%9C%8D%E5%8A%A1%E5%8C%96%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">服务化最佳实践</a></li><br><ul><br>    <li><a href="#UserGuide-zh-%E5%88%86%E5%8C%85">分包</a></li><br>    <li><a href="#UserGuide-zh-%E7%B2%92%E5%BA%A6">粒度</a></li><br>    <li><a href="#UserGuide-zh-%E7%89%88%E6%9C%AC">版本</a></li><br>    <li><a href="#UserGuide-zh-%E5%85%BC%E5%AE%B9%E6%80%A7">兼容性</a></li><br>    <li><a href="#UserGuide-zh-%E6%9E%9A%E4%B8%BE%E5%80%BC">枚举值</a></li><br>    <li><a href="#UserGuide-zh-%E5%BA%8F%E5%88%97%E5%8C%96">序列化</a></li><br>    <li><a href="#UserGuide-zh-%E5%BC%82%E5%B8%B8">异常</a></li><br>    <li><a href="#UserGuide-zh-%E8%B0%83%E7%94%A8">调用</a></li><br></ul><br>    <li><a href="#UserGuide-zh-%E6%8E%A8%E8%8D%90%E7%94%A8%E6%B3%95">推荐用法</a></li><br>    <li><a href="#UserGuide-zh-%E5%AE%B9%E9%87%8F%E8%A7%84%E5%88%92">容量规划</a></li><br>    <li><a href="#UserGuide-zh-%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E5%8C%85">基准测试工具包</a></li><br>    <li><a href="#UserGuide-zh-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A">性能测试报告</a></li><br><ul><br>    <li><a href="#UserGuide-zh-%E6%B5%8B%E8%AF%95%E8%AF%B4%E6%98%8E">测试说明</a></li><br>    <li><a href="#UserGuide-zh-%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83">测试环境</a></li><br>    <li><a href="#UserGuide-zh-%E6%B5%8B%E8%AF%95%E7%9B%AE%E7%9A%84">测试目的</a></li><br>    <li><a href="#UserGuide-zh-%E6%B5%8B%E8%AF%95%E8%84%9A%E6%9C%AC">测试脚本</a></li><br>    <li><a href="#UserGuide-zh-%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C">测试结果</a></li><br>    <li><a href="#UserGuide-zh-%E6%B5%8B%E8%AF%95%E5%88%86%E6%9E%90">测试分析</a></li><br></ul><br>    <li>测试覆盖率报告</li><br></ul></div>

<h2><a name="UserGuide-zh-%E5%85%A5%E9%97%A8"></a>入门</h2><br><p>(<a href="Getting+Started-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Getting+Started-zh" title="Getting Started-zh">+</a>) (<a href="#UserGuide-zh-%E5%85%A5%E9%97%A8">#</a>)</p><br><br><h3><a name="UserGuide-zh-%E8%83%8C%E6%99%AF"></a>背景</h3><br><p>(<a href="#UserGuide-zh-%E8%83%8C%E6%99%AF">#</a>)</p><br><br><p>随着互联网的发展，网站应用的规模不断扩大，常规的垂直应用架构已无法应对，分布式服务架构以及流动计算架构势在必行，亟需一个治理系统确保架构有条不紊的演进。</p><br><br><p><span class="image-wrap" style=""><img src="dubbo-architecture-roadmap.jpg-version=1&modificationDate=1331143666000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6947616/dubbo-architecture-roadmap.jpg?version=1&modificationDate=1331143666000" style="border: 0px solid black"></span></p><br><br><ul><br>    <li><b>单一应用架构</b><br>    <ul><br>        <li>当网站流量很小时，只需一个应用，将所有功能都部署在一起，以减少部署节点和成本。</li><br>        <li>此时，用于简化增删改查工作量的 <b>数据访问框架(ORM)</b> 是关键。</li><br>    </ul><br>    </li><br>    <li><b>垂直应用架构</b><br>    <ul><br>        <li>当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用拆成互不相干的几个应用，以提升效率。</li><br>        <li>此时，用于加速前端页面开发的 <b>Web框架(MVC)</b> 是关键。</li><br>    </ul><br>    </li><br>    <li><b>分布式服务架构</b><br>    <ul><br>        <li>当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。</li><br>        <li>此时，用于提高业务复用及整合的 <b>分布式服务框架(RPC)</b> 是关键。</li><br>    </ul><br>    </li><br>    <li><b>流动计算架构</b><br>    <ul><br>        <li>当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。</li><br>        <li>此时，用于提高机器利用率的 <b>资源调度和治理中心(SOA)</b> 是关键。</li><br>    </ul><br>    </li><br></ul><br><br><br><h3><a name="UserGuide-zh-%E9%9C%80%E6%B1%82"></a>需求</h3><br><p>(<a href="#UserGuide-zh-%E9%9C%80%E6%B1%82">#</a>)</p><br><br><p><span class="image-wrap" style=""><img src="dubbo-service-governance.jpg-version=1&modificationDate=1331887614000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6947616/dubbo-service-governance.jpg?version=1&modificationDate=1331887614000" style="border: 0px solid black"></span></p><br><br><p>在大规模服务化之前，应用可能只是通过RMI或Hessian等工具，简单的暴露和引用远程服务，通过配置服务的URL地址进行调用，通过F5等硬件进行负载均衡。</p><br><br><p><b>(1) 当服务越来越多时，服务URL配置管理变得非常困难，F5硬件负载均衡器的单点压力也越来越大。</b></p><br><br><p>此时需要一个服务注册中心，动态的注册和发现服务，使服务的位置透明。</p><br><br><p>并通过在消费方获取服务提供方地址列表，实现软负载均衡和Failover，降低对F5硬件负载均衡器的依赖，也能减少部分成本。</p><br><br><p><b>(2) 当进一步发展，服务间依赖关系变得错踪复杂，甚至分不清哪个应用要在哪个应用之前启动，架构师都不能完整的描述应用的架构关系。</b></p><br><br><p>这时，需要自动画出应用间的依赖关系图，以帮助架构师理清理关系。</p><br><br><p><b>(3) 接着，服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？</b></p><br><br><p>为了解决这些问题，第一步，要将服务现在每天的调用量，响应时间，都统计出来，作为容量规划的参考指标。</p><br><br><p>其次，要可以动态调整权重，在线上，将某台机器的权重一直加大，并在加大的过程中记录响应时间的变化，直到响应时间到达阀值，记录此时的访问量，再以此访问量乘以机器数反推总容量。</p><br><br><p>以上是Dubbo最基本的几个需求，更多服务治理问题参见：</p><br><br><p><a href="javascript:if(confirm(%27http://code.alibabatech.com/blog/experience_1402/service-governance-process.html  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://code.alibabatech.com/blog/experience_1402/service-governance-process.html%27" tppabs="http://code.alibabatech.com/blog/experience_1402/service-governance-process.html" class="external-link" rel="external" target="_blank">http://code.alibabatech.com/blog/experience_1402/service-governance-process.html</a></p><br><br><h3><a name="UserGuide-zh-%E6%9E%B6%E6%9E%84"></a>架构</h3><br><p>(<a href="#UserGuide-zh-%E6%9E%B6%E6%9E%84">#</a>)</p><br><br><p><span class="image-wrap" style=""><img src="dubbo-architecture.jpg-version=1&modificationDate=1330892870000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6947616/dubbo-architecture.jpg?version=1&modificationDate=1330892870000" style="border: 0px solid black"></span></p><br><br><p><b>节点角色说明：</b></p><br><br><ul><br>    <li><b>Provider:</b> 暴露服务的服务提供方。</li><br>    <li><b>Consumer:</b> 调用远程服务的服务消费方。</li><br>    <li><b>Registry:</b> 服务注册与发现的注册中心。</li><br>    <li><b>Monitor:</b> 统计服务的调用次调和调用时间的监控中心。</li><br>    <li><b>Container:</b> 服务运行容器。</li><br></ul><br><br><br><p><b>调用关系说明：</b></p><br><br><ul><br>    <li>0. 服务容器负责启动，加载，运行服务提供者。</li><br>    <li>1. 服务提供者在启动时，向注册中心注册自己提供的服务。</li><br>    <li>2. 服务消费者在启动时，向注册中心订阅自己所需的服务。</li><br>    <li>3. 注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。</li><br>    <li>4. 服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</li><br>    <li>5. 服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</li><br></ul><br><br><br><p><b>(1) 连通性：</b></p><br><ul><br>    <li>注册中心负责服务地址的注册与查找，相当于目录服务，服务提供者和消费者只在启动时与注册中心交互，注册中心不转发请求，压力较小</li><br>    <li>监控中心负责统计各服务调用次数，调用时间等，统计先在内存汇总后每分钟一次发送到监控中心服务器，并以报表展示</li><br>    <li>服务提供者向注册中心注册其提供的服务，并汇报调用时间到监控中心，此时间不包含网络开销</li><br>    <li>服务消费者向注册中心获取服务提供者地址列表，并根据负载算法直接调用提供者，同时汇报调用时间到监控中心，此时间包含网络开销</li><br>    <li>注册中心，服务提供者，服务消费者三者之间均为长连接，监控中心除外</li><br>    <li>注册中心通过长连接感知服务提供者的存在，服务提供者宕机，注册中心将立即推送事件通知消费者</li><br>    <li>注册中心和监控中心全部宕机，不影响已运行的提供者和消费者，消费者在本地缓存了提供者列表</li><br>    <li>注册中心和监控中心都是可选的，服务消费者可以直连服务提供者</li><br></ul><br><br><br><p><b>(2) 健状性：</b></p><br><ul><br>    <li>监控中心宕掉不影响使用，只是丢失部分采样数据</li><br>    <li>数据库宕掉后，注册中心仍能通过缓存提供服务列表查询，但不能注册新服务</li><br>    <li>注册中心对等集群，任意一台宕掉后，将自动切换到另一台</li><br>    <li>注册中心全部宕掉后，服务提供者和服务消费者仍能通过本地缓存通讯</li><br>    <li>服务提供者无状态，任意一台宕掉后，不影响使用</li><br>    <li>服务提供者全部宕掉后，服务消费者应用将无法使用，并无限次重连等待服务提供者恢复</li><br></ul><br><br><br><p><b>(3) 伸缩性：</b></p><br><ul><br>    <li>注册中心为对等集群，可动态增加机器部署实例，所有客户端将自动发现新的注册中心</li><br>    <li>服务提供者无状态，可动态增加机器部署实例，注册中心将推送新的服务提供者信息给消费者</li><br></ul><br><br><br><p><b>(4) 升级性：</b></p><br><ul><br>    <li>当服务集群规模进一步扩大，带动IT治理结构进一步升级，需要实现动态部署，进行流动计算，现有分布式服务架构不会带来阻力：</li><br></ul><br><br><br><p><span class="image-wrap" style=""><img src="dubbo-architecture-future.jpg-version=1&modificationDate=1329978098000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6947616/dubbo-architecture-future.jpg?version=1&modificationDate=1329978098000" style="border: 0px solid black"></span></p><br><ul><br>    <li><del><b>Deployer:</b> 自动部署服务的本地代理。</del></li><br>    <li><del><b>Repository:</b> 仓库用于存储服务应用发布包。</del></li><br>    <li><del><b>Scheduler:</b> 调度中心基于访问压力自动增减服务提供者。</del></li><br>    <li><del><b>Admin:</b> 统一管理控制台。</del></li><br></ul><br><br><br><h3><a name="UserGuide-zh-%E7%94%A8%E6%B3%95"></a>用法</h3><br><p>(<a href="#UserGuide-zh-%E7%94%A8%E6%B3%95">#</a>)</p><br><br><h4><a name="UserGuide-zh-%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%EF%BC%9A%28Spring%E9%85%8D%E7%BD%AE%29"></a>本地服务：(Spring配置)</h4><br><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>local.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;bean id=“xxxService” class=“com.xxx.XxxServiceImpl” /&gt;<br><br>&lt;bean id=“xxxAction” class=“com.xxx.XxxAction”&gt;<br>    &lt;property name=“xxxService” ref=“xxxService” /&gt;<br>&lt;/bean&gt;]]&gt;</script><br></div></div><br><br><h4><a name="UserGuide-zh-%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%EF%BC%9A%28Spring%E9%85%8D%E7%BD%AE%29"></a>远程服务：(Spring配置)</h4><br><br><p>在本地服务的基础上，只需做简单配置，即可完成远程化：</p><br><ul><br>    <li>将上面的local.xml配置拆分成两份，将服务定义部分放在服务提供方remote-provider.xml，将服务引用部分放在服务消费方remote-consumer.xml。</li><br>    <li>并在提供方增加暴露服务配置&lt;dubbo:service&gt;，在消费方增加引用服务配置&lt;dubbo:reference&gt;。</li><br></ul><br><br><br><p>如下：</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>remote-provider.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;bean id=“xxxService” class=“com.xxx.XxxServiceImpl” /&gt; &lt;!– 和本地服务一样实现远程服务 –&gt;<br><br>&lt;dubbo:service interface=“com.xxx.XxxService” ref=“xxxService” /&gt; &lt;!– 增加暴露远程服务配置 –&gt;]]&gt;</script><br></div></div><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>remote-consumer.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=“xxxService” interface=“com.xxx.XxxService” /&gt; &lt;!– 增加引用远程服务配置 –&gt;<br><br>&lt;bean id=“xxxAction” class=“com.xxx.XxxAction”&gt; &lt;!– 和本地服务一样使用远程服务 –&gt;<br>    &lt;property name=“xxxService” ref=“xxxService” /&gt;<br>&lt;/bean&gt;]]&gt;</script><br></div></div><br><h2><a name="UserGuide-zh-%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8"></a>快速启动</h2><br><p>(<a href="Quick+Start-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Quick+Start-zh" title="Quick Start-zh">+</a>) (<a href="#UserGuide-zh-%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Dubbo采用全Spring配置方式，透明化接入应用，对应用没有任何API侵入，只需用Spring加载Dubbo的配置即可，Dubbo基于Spring的Schema扩展进行加载。</td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>如果不想使用Spring配置，而希望通过API的方式进行调用（不推荐），请参见：<a href="User+Guide-zh.htm#UserGuide-zh-API%E9%85%8D%E7%BD%AE" tppabs="http://dubbo.io/wiki/display/dubbo/User+Guide-zh#UserGuide-zh-API%E9%85%8D%E7%BD%AE">API配置</a> (<a href="API+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/API+Config-zh" title="API Config-zh">+</a>)</td></tr></table></div><br><br><h3><a name="UserGuide-zh-%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85"></a>服务提供者</h3><br><p>(<a href="#UserGuide-zh-%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>完整安装步骤，请参见：<a href="Administrator+Guide-zh.htm#AdministratorGuide-zh-%E7%A4%BA%E4%BE%8B%E6%8F%90%E4%BE%9B%E8%80%85%E5%AE%89%E8%A3%85" tppabs="http://dubbo.io/wiki/display/dubbo/Administrator+Guide-zh#AdministratorGuide-zh-%E7%A4%BA%E4%BE%8B%E6%8F%90%E4%BE%9B%E8%80%85%E5%AE%89%E8%A3%85">示例提供者安装</a> (<a href="Demo+Provider+Installation-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Demo+Provider+Installation-zh" title="Demo Provider Installation-zh">+</a>)</td></tr></table></div><br><br><p>定义服务接口: (该接口需单独打包，在服务提供方和消费方共享)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>DemoService.java</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[package com.alibaba.dubbo.demo;<br><br>public interface DemoService {<br><br>    String sayHello(String name);<br><br>}]]&gt;</script><br></div></div><br><br><p>在服务提供方实现接口：(对服务消费方隐藏实现)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>DemoServiceImpl.java</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[package com.alibaba.dubbo.demo.provider;<br><br>import com.alibaba.dubbo.demo.DemoService;<br><br>public class DemoServiceImpl implements DemoService {<br><br>    public String sayHello(String name) {<br>        return “Hello “ + name;<br>    }<br><br>}]]&gt;</script><br></div></div><br><br><p>用Spring配置声明暴露服务：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>provider.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;<br>&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>“<br>    xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>“<br>    xmlns:dubbo=”<a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>“<br>    xsi:schemaLocation=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>        <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>        <a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>        <a href="http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt">http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt</a>;<br><br>    &lt;!– 提供方应用信息，用于计算依赖关系 –&gt;<br>    &lt;dubbo:application name=”hello-world-app”  /&gt;<br><br>    &lt;!– 使用multicast广播注册中心暴露服务地址 –&gt;<br>    &lt;dubbo:registry address=”multicast://224.5.6.7:1234” /&gt;<br><br>    &lt;!– 用dubbo协议在20880端口暴露服务 –&gt;<br>    &lt;dubbo:protocol name=”dubbo” port=”20880” /&gt;<br><br>    &lt;!– 声明需要暴露的服务接口 –&gt;<br>    &lt;dubbo:service interface=”com.alibaba.dubbo.demo.DemoService” ref=”demoService” /&gt;<br><br>    &lt;!– 和本地bean一样实现服务 –&gt;<br>    &lt;bean id=”demoService” class=”com.alibaba.dubbo.demo.provider.DemoServiceImpl” /&gt;<br><br>&lt;/beans&gt;]]&gt;</script><br></div></div><br><br><p>加载Spring配置：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Provider.java</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[import org.springframework.context.support.ClassPathXmlApplicationContext;<br><br>public class Provider {<br><br>    public static void main(String[] args) throws Exception {<br>        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(new String[] {“<a href="http://dubbo.io/wiki/display/dubbo/provider.xml&quot;}">http://dubbo.io/wiki/display/dubbo/provider.xml&quot;}</a>);<br>        context.start();<br><br>        System.in.read(); // 按任意键退出<br>    }<br><br>}]]&gt;</script><br></div></div><br><br><h3><a name="UserGuide-zh-%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85"></a>服务消费者</h3><br><p>(<a href="#UserGuide-zh-%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>完整安装步骤，请参见：<a href="Administrator+Guide-zh.htm#AdministratorGuide-zh-%E7%A4%BA%E4%BE%8B%E6%B6%88%E8%B4%B9%E8%80%85%E5%AE%89%E8%A3%85" tppabs="http://dubbo.io/wiki/display/dubbo/Administrator+Guide-zh#AdministratorGuide-zh-%E7%A4%BA%E4%BE%8B%E6%B6%88%E8%B4%B9%E8%80%85%E5%AE%89%E8%A3%85">示例消费者安装</a> (<a href="Demo+Consumer+Installation-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Demo+Consumer+Installation-zh" title="Demo Consumer Installation-zh">+</a>)</td></tr></table></div><br><br><p>通过Spring配置引用远程服务：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>consumer.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;<br>&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>“<br>    xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>“<br>    xmlns:dubbo=”<a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>“<br>    xsi:schemaLocation=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>        <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>        <a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>        <a href="http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt">http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt</a>;<br><br>    &lt;!– 消费方应用名，用于计算依赖关系，不是匹配条件，不要与提供方一样 –&gt;<br>    &lt;dubbo:application name=”consumer-of-helloworld-app”  /&gt;<br><br>    &lt;!– 使用multicast广播注册中心暴露发现服务地址 –&gt;<br>    &lt;dubbo:registry address=”multicast://224.5.6.7:1234” /&gt;<br><br>    &lt;!– 生成远程服务代理，可以和本地bean一样使用demoService –&gt;<br>    &lt;dubbo:reference id=”demoService” interface=”com.alibaba.dubbo.demo.DemoService” /&gt;<br><br>&lt;/beans&gt;]]&gt;</script><br></div></div><br><br><p>加载Spring配置，并调用远程服务：(也可以使用IoC注入)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Consumer.java</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[import org.springframework.context.support.ClassPathXmlApplicationContext;<br>import com.alibaba.dubbo.demo.DemoService;<br><br>public class Consumer {<br><br>    public static void main(String[] args) throws Exception {<br>        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(new String[] {“<a href="http://dubbo.io/wiki/display/dubbo/consumer.xml&quot;}">http://dubbo.io/wiki/display/dubbo/consumer.xml&quot;}</a>);<br>        context.start();<br><br>        DemoService demoService = (DemoService)context.getBean(“demoService”); // 获取远程服务代理<br>        String hello = demoService.sayHello(“world”); // 执行远程方法<br><br>        System.out.println( hello ); // 显示调用结果<br>    }<br><br>}]]&gt;</script><br></div></div><br><h2><a name="UserGuide-zh-%E4%BE%9D%E8%B5%96"></a>依赖</h2>

<p>(<a href="Dependencies-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Dependencies-zh" title="Dependencies-zh">+</a>) (<a href="#UserGuide-zh-%E4%BE%9D%E8%B5%96">#</a>)</p>

<h3><a name="UserGuide-zh-%E5%BF%85%E9%9C%80%E4%BE%9D%E8%B5%96"></a>必需依赖</h3>

<ul><br>    <li>JDK1.5+</li><br></ul>


<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>理论上Dubbo可以只依赖JDK，不依赖于任何三方库运行，只需配置使用JDK相关实现策略。</td></tr></table></div>

<h3><a name="UserGuide-zh-%E7%BC%BA%E7%9C%81%E4%BE%9D%E8%B5%96"></a>缺省依赖</h3>

<p>通过mvn dependency:tree &gt; dep.log命令分析，Dubbo缺省依赖以下三方库：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: text; gutter: false">&lt;![CDATA[[INFO] +- com.alibaba:dubbo:jar:2.1.2:compile<br>[INFO] |  +- log4j:log4j:jar:1.2.16:compile<br>[INFO] |  +- org.javassist:javassist:jar:3.15.0-GA:compile<br>[INFO] |  +- org.springframework:spring:jar:2.5.6.SEC03:compile<br>[INFO] |  +- commons-logging:commons-logging:jar:1.1.1:compile<br>[INFO] |  - org.jboss.netty:netty:jar:3.2.5.Final:compile]]&gt;</script><br></div></div><br><br><p>这里所有依赖都是换照Dubbo缺省配置选的，这些缺省值是基于稳定性和性能考虑的。</p>

<ul><br>    <li>log4j.jar和commons-logging.jar日志输出包。<br>    <ul><br>        <li>可以直接去掉，dubbo本身的日志会自动切换为JDK的java.util.logging输出。</li><br>        <li>但如果其它三方库比如spring.jar间接依赖commons-logging，则不能去掉。</li><br>    </ul><br>    </li><br>    <li>javassist.jar 字节码生成。<br>    <ul><br>        <li>如果&lt;dubbo:provider proxy=”jdk” /&gt;或&lt;dubbo:consumer proxy=”jdk” /&gt;，以及&lt;dubbo:application compiler=”jdk” /&gt;，则不需要。</li><br>    </ul><br>    </li><br>    <li>spring.jar 配置解析。<br>    <ul><br>        <li>如果用ServiceConfig和ReferenceConfig的API调用，则不需要。</li><br>    </ul><br>    </li><br>    <li>netty.jar 网络传输。<br>    <ul><br>        <li>如果&lt;dubbo:protocol server=”mina”/&gt;或&lt;dubbo:protocol server=”grizzly”/&gt;，则换成mina.jar或grizzly.jar。</li><br>        <li>如果&lt;protocol name=”rmi”/&gt;，则不需要。</li><br>    </ul><br>    </li><br></ul>


<h3><a name="UserGuide-zh-%E5%8F%AF%E9%80%89%E4%BE%9D%E8%B5%96"></a>可选依赖</h3>

<p>以下依赖，在主动配置使用相应实现策略时用到，需自行加入依赖。</p>

<ul><br>    <li>mina: 1.1.7</li><br>    <li>grizzly: 2.1.4</li><br>    <li>httpclient: 4.1.2</li><br>    <li>hessian_lite: 3.2.1-fixed</li><br>    <li>xstream: 1.4.1</li><br>    <li>fastjson: 1.1.8</li><br>    <li>zookeeper: 3.3.3</li><br>    <li>jedis: 2.0.0</li><br>    <li>xmemcached: 1.3.6</li><br>    <li>jfreechart: 1.0.13</li><br>    <li>hessian: 4.0.7</li><br>    <li>jetty: 6.1.26</li><br>    <li>hibernate-validator: 4.2.0.Final</li><br>    <li>zkclient: 0.1</li><br>    <li>curator: 1.1.10</li><br>    <li>cxf: 2.6.1</li><br>    <li>thrift: 0.8.0</li><br></ul>


<p>JEE:</p><br><ul><br>    <li>servlet: 2.5</li><br>    <li>bsf: 3.1</li><br>    <li>validation-api: 1.0.0.GA</li><br>    <li>jcache: 0.4</li><br></ul><br><br><h2><a name="UserGuide-zh-%E6%88%90%E7%86%9F%E5%BA%A6"></a>成熟度</h2><br><p>(<a href="Maturity-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Maturity-zh" title="Maturity-zh">+</a>) (<a href="#UserGuide-zh-%E6%88%90%E7%86%9F%E5%BA%A6">#</a>)</p>

<h3><a name="UserGuide-zh-%E5%8A%9F%E8%83%BD%E6%88%90%E7%86%9F%E5%BA%A6"></a>功能成熟度</h3><br><p>(<a href="#UserGuide-zh-%E5%8A%9F%E8%83%BD%E6%88%90%E7%86%9F%E5%BA%A6">#</a>)</p><br><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> <font color="#000000">Feature</font> </th><br><th class="confluenceTh"> <font color="#000000">Maturity</font> </th><br><th class="confluenceTh"> <font color="#000000">Strength</font> </th><br><th class="confluenceTh"> <font color="#000000">Problem</font> </th><br><th class="confluenceTh"> <font color="#000000">Advise</font> </th><br><th class="confluenceTh"> <font color="#000000">User</font> </th><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6">并发控制</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 并发控制 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E8%BF%9E%E6%8E%A5%E6%8E%A7%E5%88%B6">连接控制</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 连接数控制 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E7%9B%B4%E8%BF%9E%E6%8F%90%E4%BE%9B%E8%80%85">直连提供者</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 点对点直连服务提供方，用于测试 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 测试环境使用 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88">分组聚合</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 分组聚合返回值，用于菜单聚合等服务 </td><br><td class="confluenceTd"> 特殊场景使用 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E5%8F%82%E6%95%B0%E9%AA%8C%E8%AF%81">参数验证</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 参数验证，JSR303验证框架集成 </td><br><td class="confluenceTd"> 对性能有影响 </td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd"> LaiWang </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E7%BB%93%E6%9E%9C%E7%BC%93%E5%AD%98">结果缓存</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 结果缓存，用于加速请求 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E6%B3%9B%E5%8C%96%E5%BC%95%E7%94%A8">泛化引用</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 泛化调用，无需业务接口类进行远程调用，用于测试平台，开放网关桥接等 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E6%B3%9B%E5%8C%96%E5%AE%9E%E7%8E%B0">泛化实现</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 泛化实现，无需业务接口类实现任意接口，用于Mock平台 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E5%9B%9E%E5%A3%B0%E6%B5%8B%E8%AF%95">回声测试</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 回声测试 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E9%9A%90%E5%BC%8F%E4%BC%A0%E5%8F%82">隐式传参</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 附加参数 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E5%BC%82%E6%AD%A5%E8%B0%83%E7%94%A8">异步调用</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 不可靠异步调用 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E6%9C%AC%E5%9C%B0%E8%B0%83%E7%94%A8">本地调用</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 本地调用 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E5%8F%82%E6%95%B0%E5%9B%9E%E8%B0%83">参数回调</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 参数回调 </td><br><td class="confluenceTd"> 特殊场景使用 </td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd"> Registry </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E4%BA%8B%E4%BB%B6%E9%80%9A%E7%9F%A5">事件通知</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 事件通知，在远程调用执行前后触发 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E6%9C%AC%E5%9C%B0%E5%AD%98%E6%A0%B9">本地存根</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 在客户端执行部分逻辑 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E6%9C%AC%E5%9C%B0%E4%BC%AA%E8%A3%85">本地伪装</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 伪造返回结果，可在失败时执行，或直接执行，用于服务降级 </td><br><td class="confluenceTd"> 需注册中心支持 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E5%BB%B6%E8%BF%9F%E6%9A%B4%E9%9C%B2">延迟暴露</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 延迟暴露服务，用于等待应用加载warmup数据，或等待spring加载完成 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E5%BB%B6%E8%BF%9F%E8%BF%9E%E6%8E%A5">延迟连接</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 延迟建立连接，调用时建立 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd"> Registry </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E7%B2%98%E6%BB%9E%E8%BF%9E%E6%8E%A5">粘滞连接</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 粘滞连接，总是向同一个提供方发起请求，除非此提供方挂掉，再切换到另一台 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd"> Registry </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E4%BB%A4%E7%89%8C%E9%AA%8C%E8%AF%81">令牌验证</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 令牌验证，用于服务授权 </td><br><td class="confluenceTd"> 需注册中心支持 </td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99">路由规则</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 动态决定调用关系 </td><br><td class="confluenceTd"> 需注册中心支持 </td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E9%85%8D%E7%BD%AE%E8%A7%84%E5%88%99">配置规则</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 动态下发配置，实现功能的开关 </td><br><td class="confluenceTd"> 需注册中心支持 </td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97">访问日志</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 访问日志，用于记录调用信息 </td><br><td class="confluenceTd"> 本地存储，影响性能，受磁盘大小限制 </td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1">分布式事务</a> </td><br><td class="confluenceTd"> Research </td><br><td class="confluenceTd"> JTA/XA三阶段提交事务 </td><br><td class="confluenceTd"> 不稳定 </td><br><td class="confluenceTd"> 不可用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br></tbody></table><br></div><br><br><br><h3><a name="UserGuide-zh-%E7%AD%96%E7%95%A5%E6%88%90%E7%86%9F%E5%BA%A6"></a>策略成熟度</h3><br><p>(<a href="#UserGuide-zh-%E7%AD%96%E7%95%A5%E6%88%90%E7%86%9F%E5%BA%A6">#</a>)</p><br><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> <font color="#000000">Feature</font> </th><br><th class="confluenceTh"> <font color="#000000">Maturity</font> </th><br><th class="confluenceTh"> <font color="#000000">Strength</font> </th><br><th class="confluenceTh"> <font color="#000000">Problem</font> </th><br><th class="confluenceTh"> <font color="#000000">Advise</font> </th><br><th class="confluenceTh"> <font color="#000000">User</font> </th><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-Zookeeper%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">Zookeeper注册中心</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 支持基于网络的集群方式，有广泛周边开源产品，建议使用dubbo-2.3.3以上版本（推荐使用） </td><br><td class="confluenceTd"> 依赖于Zookeeper的稳定性 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-Redis%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">Redis注册中心</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 支持基于客户端双写的集群方式，性能高 </td><br><td class="confluenceTd"> 要求服务器时间同步，用于检查心跳过期脏数据 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-Multicast%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">Multicast注册中心</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 去中心化，不需要安装注册中心 </td><br><td class="confluenceTd"> 依赖于网络拓普和路由，跨机房有风险 </td><br><td class="confluenceTd"> 小规模应用或开发测试环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-Simple%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">Simple注册中心</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> Dogfooding，注册中心本身也是一个标准的RPC服务 </td><br><td class="confluenceTd"> 没有集群支持，可能单点故障 </td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><th class="confluenceTh"> <font color="#000000">Feature</font> </th><br><th class="confluenceTh"> <font color="#000000">Maturity</font> </th><br><th class="confluenceTh"> <font color="#000000">Strength</font> </th><br><th class="confluenceTh"> <font color="#000000">Problem</font> </th><br><th class="confluenceTh"> <font color="#000000">Advise</font> </th><br><th class="confluenceTh"> <font color="#000000">User</font> </th><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-Simple%E7%9B%91%E6%8E%A7%E4%B8%AD%E5%BF%83">Simple监控中心</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 支持JFreeChart统计报表 </td><br><td class="confluenceTd"> 没有集群支持，可能单点故障，但故障后不影响RPC运行 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><th class="confluenceTh"> <font color="#000000">Feature</font> </th><br><th class="confluenceTh"> <font color="#000000">Maturity</font> </th><br><th class="confluenceTh"> <font color="#000000">Strength</font> </th><br><th class="confluenceTh"> <font color="#000000">Problem</font> </th><br><th class="confluenceTh"> <font color="#000000">Advise</font> </th><br><th class="confluenceTh"> <font color="#000000">User</font> </th><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-dubbo%253A%252F%252F">Dubbo协议</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 采用NIO复用单一长连接，并使用线程池并发处理请求，减少握手和加大并发效率，性能较好（推荐使用） </td><br><td class="confluenceTd"> 在大文件传输时，单一连接会成为瓶颈 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-rmi%253A%252F%252F">Rmi协议</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 可与原生RMI互操作，基于TCP协议 </td><br><td class="confluenceTd"> 偶尔会连接失败，需重建Stub </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-hessian%253A%252F%252F">Hessian协议</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 可与原生Hessian互操作，基于HTTP协议 </td><br><td class="confluenceTd"> 需hessian.jar支持，http短连接的开销大 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><th class="confluenceTh"> <font color="#000000">Feature</font> </th><br><th class="confluenceTh"> <font color="#000000">Maturity</font> </th><br><th class="confluenceTh"> <font color="#000000">Strength</font> </th><br><th class="confluenceTh"> <font color="#000000">Problem</font> </th><br><th class="confluenceTh"> <font color="#000000">Advise</font> </th><br><th class="confluenceTh"> <font color="#000000">User</font> </th><br></tr><br><tr><br><td class="confluenceTd"> Netty Transporter </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> JBoss的NIO框架，性能较好（推荐使用） </td><br><td class="confluenceTd"> 一次请求派发两种事件，需屏蔽无用事件 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> Mina Transporter </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 老牌NIO框架，稳定 </td><br><td class="confluenceTd"> 待发送消息队列派发不及时，大压力下，会出现FullGC </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> Grizzly Transporter </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> Sun的NIO框架，应用于GlassFish服务器中 </td><br><td class="confluenceTd"> 线程池不可扩展，Filter不能拦截下一Filter </td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><th class="confluenceTh"> <font color="#000000">Feature</font> </th><br><th class="confluenceTh"> <font color="#000000">Maturity</font> </th><br><th class="confluenceTh"> <font color="#000000">Strength</font> </th><br><th class="confluenceTh"> <font color="#000000">Problem</font> </th><br><th class="confluenceTh"> <font color="#000000">Advise</font> </th><br><th class="confluenceTh"> <font color="#000000">User</font> </th><br></tr><br><tr><br><td class="confluenceTd"> Hessian Serialization </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 性能较好，多语言支持（推荐使用） </td><br><td class="confluenceTd"> Hessian的各版本兼容性不好，可能和应用使用的Hessian冲突，Dubbo内嵌了hessian3.2.1的源码 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> Dubbo Serialization </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 通过不传送POJO的类元信息，在大量POJO传输时，性能较好 </td><br><td class="confluenceTd"> 当参数对象增加字段时，需外部文件声明 </td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> Json Serialization </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 纯文本，可跨语言解析，缺省采用FastJson解析 </td><br><td class="confluenceTd"> 性能较差 </td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> Java Serialization </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> Java原生支持 </td><br><td class="confluenceTd"> 性能较差 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><th class="confluenceTh"> <font color="#000000">Feature</font> </th><br><th class="confluenceTh"> <font color="#000000">Maturity</font> </th><br><th class="confluenceTh"> <font color="#000000">Strength</font> </th><br><th class="confluenceTh"> <font color="#000000">Problem</font> </th><br><th class="confluenceTh"> <font color="#000000">Advise</font> </th><br><th class="confluenceTh"> <font color="#000000">User</font> </th><br></tr><br><tr><br><td class="confluenceTd"> Javassist ProxyFactory </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 通过字节码生成代替反射，性能比较好（推荐使用） </td><br><td class="confluenceTd"> 依赖于javassist.jar包，占用JVM的Perm内存，Perm可能要设大一些：java&nbsp;-XX:PermSize=128m </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> Jdk ProxyFactory </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> JDK原生支持 </td><br><td class="confluenceTd"> 性能较差 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><th class="confluenceTh"> <font color="#000000">Feature</font> </th><br><th class="confluenceTh"> <font color="#000000">Maturity</font> </th><br><th class="confluenceTh"> <font color="#000000">Strength</font> </th><br><th class="confluenceTh"> <font color="#000000">Problem</font> </th><br><th class="confluenceTh"> <font color="#000000">Advise</font> </th><br><th class="confluenceTh"> <font color="#000000">User</font> </th><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-FailoverCluster">Failover Cluster</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 失败自动切换，当出现失败，重试其它服务器，通常用于读操作（推荐使用） </td><br><td class="confluenceTd"> 重试会带来更长延迟 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-FailfastCluster">Failfast Cluster</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 快速失败，只发起一次调用，失败立即报错,通常用于非幂等性的写操作 </td><br><td class="confluenceTd"> 如果有机器正在重启，可能会出现调用失败 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-FailsafeCluster">Failsafe Cluster</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 失败安全，出现异常时，直接忽略，通常用于写入审计日志等操作 </td><br><td class="confluenceTd"> 调用信息丢失 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Monitor </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-FailbackCluster">Failback Cluster</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 失败自动恢复，后台记录失败请求，定时重发，通常用于消息通知操作 </td><br><td class="confluenceTd"> 不可靠，重启丢失 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Registry </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-ForkingCluster">Forking Cluster</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 并行调用多个服务器，只要一个成功即返回，通常用于实时性要求较高的读操作 </td><br><td class="confluenceTd"> 需要浪费更多服务资源 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-BroadcastCluster">Broadcast Cluster</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 广播调用所有提供者，逐个调用，任意一台报错则报错，通常用于更新提供方本地状态 </td><br><td class="confluenceTd"> 速度慢，任意一台报错则报错 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><th class="confluenceTh"> <font color="#000000">Feature</font> </th><br><th class="confluenceTh"> <font color="#000000">Maturity</font> </th><br><th class="confluenceTh"> <font color="#000000">Strength</font> </th><br><th class="confluenceTh"> <font color="#000000">Problem</font> </th><br><th class="confluenceTh"> <font color="#000000">Advise</font> </th><br><th class="confluenceTh"> <font color="#000000">User</font> </th><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-RandomLoadBalance">Random LoadBalance</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 随机，按权重设置随机概率（推荐使用） </td><br><td class="confluenceTd"> 在一个截面上碰撞的概率高，重试时，可能出现瞬间压力不均 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-RoundRobinLoadBalance">RoundRobin LoadBalance</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 轮循，按公约后的权重设置轮循比率 </td><br><td class="confluenceTd"> 存在慢的机器累积请求问题，极端情况可能产生雪崩 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-LeastActiveLoadBalance">LeastActive LoadBalance</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 最少活跃调用数，相同活跃数的随机，活跃数指调用前后计数差，使慢的机器收到更少请求 </td><br><td class="confluenceTd"> 不支持权重，在容量规划时，不能通过权重把压力导向一台机器压测容量 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-ConsistentHashLoadBalance">ConsistentHash LoadBalance</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 一致性Hash，相同参数的请求总是发到同一提供者，当某一台提供者挂时，原本发往该提供者的请求，基于虚拟节点，平摊到其它提供者，不会引起剧烈变动 </td><br><td class="confluenceTd"> 压力分摊不均 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><th class="confluenceTh"> <font color="#000000">Feature</font> </th><br><th class="confluenceTh"> <font color="#000000">Maturity</font> </th><br><th class="confluenceTh"> <font color="#000000">Strength</font> </th><br><th class="confluenceTh"> <font color="#000000">Problem</font> </th><br><th class="confluenceTh"> <font color="#000000">Advise</font> </th><br><th class="confluenceTh"> <font color="#000000">User</font> </th><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E6%9D%A1%E4%BB%B6%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99">条件路由规则</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 基于条件表达式的路由规则，功能简单易用 </td><br><td class="confluenceTd"> 有些复杂多分支条件情况，规则很难描述 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-%E8%84%9A%E6%9C%AC%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99">脚本路由规则</a> </td><br><td class="confluenceTd"> Tested </td><br><td class="confluenceTd"> 基于脚本引擎的路由规则，功能强大 </td><br><td class="confluenceTd"> 没有运行沙箱，脚本能力过于强大，可能成为后门 </td><br><td class="confluenceTd"> 试用 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><th class="confluenceTh"> <font color="#000000">Feature</font> </th><br><th class="confluenceTh"> <font color="#000000">Maturity</font> </th><br><th class="confluenceTh"> <font color="#000000">Strength</font> </th><br><th class="confluenceTh"> <font color="#000000">Problem</font> </th><br><th class="confluenceTh"> <font color="#000000">Advise</font> </th><br><th class="confluenceTh"> <font color="#000000">User</font> </th><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-SpringContainer">Spring Container</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 自动加载META-INF/spring目录下的所有Spring配置 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-JettyContainer">Jetty Container</a> </td><br><td class="confluenceTd"> Stable </td><br><td class="confluenceTd"> 启动一个内嵌Jetty，用于汇报状态 </td><br><td class="confluenceTd"> 大量访问页面时，会影响服务器的线程和内存 </td><br><td class="confluenceTd"> 可用于生产环境 </td><br><td class="confluenceTd"> Alibaba </td><br></tr><br><tr><br><td class="confluenceTd"> <a href="#UserGuide-zh-Log4jContainer">Log4j Container</a> </td><br><td class="confluenceTd"> Stable  </td><br><td class="confluenceTd"> 自动配置log4j的配置，在多进程启动时，自动给日志文件按进程分目录 </td><br><td class="confluenceTd"> 用户不能控制log4j的配置，不灵活 </td><br><td class="confluenceTd"> 可用于生产环境  </td><br><td class="confluenceTd"> Alibaba  </td><br></tr><br></tbody></table><br></div><br><br><h2><a name="UserGuide-zh-%E9%85%8D%E7%BD%AE"></a>配置</h2><br><p>(<a href="Configs-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Configs-zh" title="Configs-zh">+</a>) (<a href="#UserGuide-zh-%E9%85%8D%E7%BD%AE">#</a>)</p><br><br><h3><a name="UserGuide-zh-Xml%E9%85%8D%E7%BD%AE"></a>Xml配置</h3><br><p>(<a href="Xml+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Xml+Config-zh" title="Xml Config-zh">+</a>) (<a href="#UserGuide-zh-Xml%E9%85%8D%E7%BD%AE">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>配置项说明</b><br>详细配置项，请参见：<a href="#UserGuide-zh-%E9%85%8D%E7%BD%AE%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">配置参考手册</a> (<a href="Configuration+Reference-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Configuration+Reference-zh" title="Configuration Reference-zh">+</a>)</td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>API使用说明</b><br>如果不想使用Spring配置，而希望通过API的方式进行调用，请参见：<a href="#UserGuide-zh-API%E9%85%8D%E7%BD%AE">API配置</a> (<a href="API+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/API+Config-zh" title="API Config-zh">+</a>)</td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>配置使用说明</b><br>想知道如何使用配置，请参见：<a href="#UserGuide-zh-%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8">快速启动</a> (<a href="Quick+Start-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Quick+Start-zh" title="Quick Start-zh">+</a>)</td></tr></table></div><br><br><p>示例：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>provider.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;<br>&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>“<br>    xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>“<br>    xmlns:dubbo=”<a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>“<br>    xsi:schemaLocation=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>        <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>        <a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>        <a href="http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt">http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt</a>;<br><br>    &lt;dubbo:application name=”hello-world-app”  /&gt;<br><br>    &lt;dubbo:registry address=”multicast://224.5.6.7:1234” /&gt;<br><br>    &lt;dubbo:protocol name=”dubbo” port=”20880” /&gt;<br><br>    &lt;dubbo:service interface=”com.alibaba.dubbo.demo.DemoService” ref=”demoServiceLocal” /&gt;<br><br>    &lt;dubbo:reference id=”demoServiceRemote” interface=”com.alibaba.dubbo.demo.DemoService” /&gt;<br><br>&lt;/beans&gt;]]&gt;</script><br></div></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>所有标签者支持自定义参数，用于不同扩展点实现的特殊配置。</td></tr></table></div><br><br><p>如：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”jms”&gt;<br>    &lt;dubbo:parameter key=”queue” value=”<a href="http://dubbo.io/wiki/display/dubbo/10.20.31.22">http://dubbo.io/wiki/display/dubbo/10.20.31.22</a>“ /&gt;<br>&lt;/dubbo:protocol&gt;]]&gt;</script><br></div></div><br><br><p>或：(2.1.0开始支持)</p><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>注意声明：xmlns:p=”<a href="http://www.springframework.org/schema/p" target="_blank" rel="external">http://www.springframework.org/schema/p</a>“</td></tr></table></div><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>“<br>    xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>“<br>    xmlns:dubbo=”<a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>“<br>    xmlns:p=”<a href="http://www.springframework.org/schema/p">http://www.springframework.org/schema/p</a>“<br>    xsi:schemaLocation=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>        <a href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a>        <a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>        <a href="http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt">http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt</a>;<br><br>    &lt;dubbo:protocol name=”jms” p:queue=”<a href="http://dubbo.io/wiki/display/dubbo/10.20.31.22">http://dubbo.io/wiki/display/dubbo/10.20.31.22</a>“ /&gt;<br><br>&lt;/beans&gt;]]&gt;</script><br></div></div><br><br><p><b>Configuration Relation:</b></p><br><br><p><span class="image-wrap" style=""><img src="dubbo-config.jpg-version=1&modificationDate=1330708121000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/7668102/dubbo-config.jpg?version=1&modificationDate=1330708121000" style="border: 0px solid black"></span></p><br><ul><br>    <li><a href="#UserGuide-zh-%253Cdubbo%253Aservice%252F%253E">&lt;dubbo:service/&gt;</a> 服务配置，用于暴露一个服务，定义服务的元信息，一个服务可以用多个协议暴露，一个服务也可以注册到多个注册中心。</li><br>    <li><a href="#UserGuide-zh-%253Cdubbo%253Areference%252F%253E">&lt;dubbo:reference/&gt;</a> 引用配置，用于创建一个远程服务代理，一个引用可以指向多个注册中心。</li><br>    <li><a href="#UserGuide-zh-%253Cdubbo%253Aprotocol%252F%253E">&lt;dubbo:protocol/&gt;</a>  协议配置，用于配置提供服务的协议信息，协议由提供方指定，消费方被动接受。</li><br>    <li><a href="#UserGuide-zh-%253Cdubbo%253Aapplication%252F%253E">&lt;dubbo:application/&gt;</a> 应用配置，用于配置当前应用信息，不管该应用是提供者还是消费者。</li><br>    <li><a href="#UserGuide-zh-%253Cdubbo%253Amodule%252F%253E">&lt;dubbo:module/&gt;</a> 模块配置，用于配置当前模块信息，可选。</li><br>    <li><a href="#UserGuide-zh-%253Cdubbo%253Aregistry%252F%253E">&lt;dubbo:registry/&gt;</a>  注册中心配置，用于配置连接注册中心相关信息。</li><br>    <li><a href="#UserGuide-zh-%253Cdubbo%253Amonitor%252F%253E">&lt;dubbo:monitor/&gt;</a>  监控中心配置，用于配置连接监控中心相关信息，可选。</li><br>    <li><a href="#UserGuide-zh-%253Cdubbo%253Aprovider%252F%253E">&lt;dubbo:provider/&gt;</a> 提供方的缺省值，当ProtocolConfig和ServiceConfig某属性没有配置时，采用此缺省值，可选。</li><br>    <li><a href="#UserGuide-zh-%253Cdubbo%253Aconsumer%252F%253E">&lt;dubbo:consumer/&gt;</a> 消费方缺省配置，当ReferenceConfig某属性没有配置时，采用此缺省值，可选。</li><br>    <li><a href="#UserGuide-zh-%253Cdubbo%253Amethod%252F%253E">&lt;dubbo:method/&gt;</a> 方法配置，用于ServiceConfig和ReferenceConfig指定方法级的配置信息。</li><br>    <li><a href="#UserGuide-zh-%253Cdubbo%253Aargument%252F%253E">&lt;dubbo:argument/&gt;</a> 用于指定方法参数配置。</li><br></ul><br><br><br><p><b>Configuration Override:</b></p><br><br><p><span class="image-wrap" style=""><img src="dubbo-config-override.jpg-version=1&modificationDate=1330708128000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/7668102/dubbo-config-override.jpg?version=1&modificationDate=1330708128000" style="border: 0px solid black"></span> </p><br><ul><br>    <li>上图中以timeout为例，显示了配置的查找顺序，其它retries, loadbalance, actives等类似。<br>    <ul><br>        <li>方法级优先，接口级次之，全局配置再次之。</li><br>        <li>如果级别一样，则消费方优先，提供方次之。</li><br>    </ul><br>    </li><br>    <li>其中，服务提供方配置，通过URL经由注册中心传递给消费方。</li><br>    <li>建议由服务提供方设置超时，因为一个方法需要执行多长时间，服务提供方更清楚，如果一个消费方同时引用多个服务，就不需要关心每个服务的超时设置。</li><br>    <li>理论上ReferenceConfig的非服务标识配置，在ConsumerConfig，ServiceConfig, ProviderConfig均可以缺省配置。</li><br></ul><br><br><h3><a name="UserGuide-zh-%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE"></a>属性配置</h3><br><p>(<a href="Properties+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Properties+Config-zh" title="Properties Config-zh">+</a>) (<a href="#UserGuide-zh-%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>如果公共配置很简单，没有多注册中心，多协议等情况，或者想多个Spring容器想共享配置，可以使用dubbo.properties作为缺省配置。</td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Dubbo将自动加载classpath根目录下的dubbo.properties，可以通过JVM启动参数：-Ddubbo.properties.file=xxx.properties 改变缺省配置位置。</td></tr></table></div><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>如果classpath根目录下存在多个dubbo.properties，比如多个jar包中有dubbo.properties，Dubbo会任意加载，并打印Error日志，后续可能改为抛异常。</td></tr></table></div><br><br><p>映射规则：</p><br><ul><br>    <li>将XML配置的标签名，加属性名，用点分隔，多个属性拆成多行：<br>    <ul><br>        <li>比如：dubbo.application.name=foo等价于&lt;dubbo:application name=”foo” /&gt;</li><br>        <li>比如：dubbo.registry.address=10.20.153.10:9090等价于&lt;dubbo:registry address=”10.20.153.10:9090” /&gt;</li><br>    </ul><br>    </li><br>    <li>如果XML有多行同名标签配置，可用id号区分，如果没有id号将对所有同名标签生效：<br>    <ul><br>        <li>比如：dubbo.protocol.rmi.port=1234等价于&lt;dubbo:protocol id=”rmi” name=”rmi” port=”1099” /&gt; (协议的id没配时，缺省使用协议名作为id)</li><br>        <li>比如：dubbo.registry.china.address=10.20.153.10:9090等价于&lt;dubbo:registry id=”china” address=”10.20.153.10:9090” /&gt;</li><br>    </ul><br>    </li><br></ul><br><br><br><p>典型配置如：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>dubbo.properties</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[dubbo.application.name=foo<br>dubbo.application.owner=bar<br>dubbo.registry.address=10.20.153.10:9090]]&gt;</script><br></div></div><br><br><p><span class="image-wrap" style=""><img src="dubbo-properties-override.jpg-version=1&modificationDate=1326771444000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6950129/dubbo-properties-override.jpg?version=1&modificationDate=1326771444000" style="border: 0px solid black"></span></p><br><br><p>覆盖策略：</p><br><ul><br>    <li>JVM启动-D参数优先，这样可以使用户在部署和启动时进行参数重写，比如在启动时需改变协议的端口。</li><br>    <li>XML次之，如果在XML中有配置，则dubbo.properties中的相应配置项无效。</li><br>    <li>Properties最后，相当于缺省值，只有XML没有配置时，dubbo.properties的相应配置项才会生效，通常用于共享公共配置，比如应用名。</li><br></ul><br><br><h3><a name="UserGuide-zh-%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE"></a>注解配置</h3><br><p>(<a href="Annotation+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Annotation+Config-zh" title="Annotation Config-zh">+</a>) (<a href="#UserGuide-zh-%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE">#</a>)</p><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.2.1以上版本支持</td></tr></table></div><br><br><p>服务提供方注解：</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[import com.alibaba.dubbo.config.annotation.Service;<br><br>@Service(version=”1.0.0”)<br>public class FooServiceImpl implements FooService {<br><br>    // ……<br><br>}]]&gt;</script><br></div></div><br><br><p>服务提供方配置：</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;!– 公共信息，也可以用dubbo.properties配置 –&gt;<br>&lt;dubbo:application name=”annotation-provider” /&gt;<br>&lt;dubbo:registry address=”127.0.0.1:4548” /&gt;<br><br>&lt;!– 扫描注解包路径，多个包用逗号分隔，不填pacakge表示扫描当前ApplicationContext中所有的类 –&gt;<br>&lt;dubbo:annotation package=”com.foo.bar.service” /&gt;]]&gt;</script><br></div></div><br><br><p>服务消费方注解：</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[import com.alibaba.dubbo.config.annotation.Reference;<br>import org.springframework.stereotype.Component;<br><br>@Component<br>public class BarAction {<br><br>    @Reference(version=”1.0.0”)<br>    private FooService fooService;<br><br>}]]&gt;</script><br></div></div><br><br><p>服务消费方配置：</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;!– 公共信息，也可以用dubbo.properties配置 –&gt;<br>&lt;dubbo:application name=”annotation-consumer” /&gt;<br>&lt;dubbo:registry address=”127.0.0.1:4548” /&gt;<br><br>&lt;!– 扫描注解包路径，多个包用逗号分隔，不填pacakge表示扫描当前ApplicationContext中所有的类 –&gt;<br>&lt;dubbo:annotation package=”com.foo.bar.action” /&gt;]]&gt;</script><br></div></div><br><br><p>也可以使用：(等价于前面的：&lt;dubbo:annotation package=”com.foo.bar.service” /&gt;)</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:annotation /&gt;<br>&lt;context:component-scan base-package=”com.foo.bar.service”&gt;<br>    &lt;context:include-filter type=”annotation” expression=”com.alibaba.dubbo.config.annotation.Service” /&gt;<br>&lt;/context:component-scan&gt;]]&gt;</script><br></div></div><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Spring2.5及以后版本支持component-scan，如果用的是Spring2.0及以前版本，需配置：<br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;!– Spring2.0支持@Service注解配置，但不支持package属性自动加载bean的实例，需人工定义bean的实例。–&gt;<br>&lt;dubbo:annotation /&gt;<br>&lt;bean id=”barService” class=”com.foo.BarServiceImpl” /&gt;]]&gt;</script><br></div></div></td></tr></table></div><br><h3><a name="UserGuide-zh-API%E9%85%8D%E7%BD%AE"></a>API配置</h3><br><p>(<a href="API+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/API+Config-zh" title="API Config-zh">+</a>) (<a href="#UserGuide-zh-API%E9%85%8D%E7%BD%AE">#</a>)</p><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>API使用范围</b><br>API仅用于OpenAPI, ESB, Test, Mock等系统集成，普通服务提供方或消费方，请采用配置方式使用Dubbo，请参见：<a href="#UserGuide-zh-Xml%E9%85%8D%E7%BD%AE">Xml配置</a> (<a href="Xml+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Xml+Config-zh" title="Xml Config-zh">+</a>)</td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>API属性含义参考</b><br>API属性与配置项一对一，各属性含义，请参见：<a href="#UserGuide-zh-%E9%85%8D%E7%BD%AE%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">配置参考手册</a> (<a href="Configuration+Reference-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Configuration+Reference-zh" title="Configuration Reference-zh">+</a>)，<br><br>比如：ApplicationConfig.setName(“xxx”) 对应 &lt;dubbo:application name=”xxx” /&gt;</td></tr></table></div><br><br><h4><a name="UserGuide-zh-%281%29%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85%EF%BC%9A"></a>(1) 服务提供者：</h4><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[import com.alibaba.dubbo.rpc.config.ApplicationConfig;<br>import com.alibaba.dubbo.rpc.config.RegistryConfig;<br>import com.alibaba.dubbo.rpc.config.ProviderConfig;<br>import com.alibaba.dubbo.rpc.config.ServiceConfig;<br>import com.xxx.XxxService;<br>import com.xxx.XxxServiceImpl;<br><br>// 服务实现<br>XxxService xxxService = new XxxServiceImpl();<br><br>// 当前应用配置<br>ApplicationConfig application = new ApplicationConfig();<br>application.setName(“xxx”);<br><br>// 连接注册中心配置<br>RegistryConfig registry = new RegistryConfig();<br>registry.setAddress(“10.20.130.230:9090”);<br>registry.setUsername(“aaa”);<br>registry.setPassword(“bbb”);<br><br>// 服务提供者协议配置<br>ProtocolConfig protocol = new ProtocolConfig();<br>protocol.setName(“dubbo”);<br>protocol.setPort(12345);<br>protocol.setThreads(200);<br><br>// 注意：ServiceConfig为重对象，内部封装了与注册中心的连接，以及开启服务端口<br><br>// 服务提供者暴露服务配置<br>ServiceConfig&lt;XxxService&gt; service = new ServiceConfig&lt;XxxService&gt;(); // 此实例很重，封装了与注册中心的连接，请自行缓存，否则可能造成内存和连接泄漏<br>service.setApplication(application);<br>service.setRegistry(registry); // 多个注册中心可以用setRegistries()<br>service.setProtocol(protocol); // 多个协议可以用setProtocols()<br>service.setInterface(XxxService.class);<br>service.setRef(xxxService);<br>service.setVersion(“1.0.0”);<br><br>// 暴露及注册服务<br>service.export();]]&gt;</script><br></div></div><br><br><h4><a name="UserGuide-zh-%282%29%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85%EF%BC%9A"></a>(2) 服务消费者：</h4><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[import com.alibaba.dubbo.rpc.config.ApplicationConfig;<br>import com.alibaba.dubbo.rpc.config.RegistryConfig;<br>import com.alibaba.dubbo.rpc.config.ConsumerConfig;<br>import com.alibaba.dubbo.rpc.config.ReferenceConfig;<br>import com.xxx.XxxService;<br><br>// 当前应用配置<br>ApplicationConfig application = new ApplicationConfig();<br>application.setName(“yyy”);<br><br>// 连接注册中心配置<br>RegistryConfig registry = new RegistryConfig();<br>registry.setAddress(“10.20.130.230:9090”);<br>registry.setUsername(“aaa”);<br>registry.setPassword(“bbb”);<br><br>// 注意：ReferenceConfig为重对象，内部封装了与注册中心的连接，以及与服务提供方的连接<br><br>// 引用远程服务<br>ReferenceConfig&lt;XxxService&gt; reference = new ReferenceConfig&lt;XxxService&gt;(); // 此实例很重，封装了与注册中心的连接以及与提供者的连接，请自行缓存，否则可能造成内存和连接泄漏<br>reference.setApplication(application);<br>reference.setRegistry(registry); // 多个注册中心可以用setRegistries()<br>reference.setInterface(XxxService.class);<br>reference.setVersion(“1.0.0”);<br><br>// 和本地bean一样使用xxxService<br>XxxService xxxService = reference.get(); // 注意：此代理对象内部封装了所有通讯细节，对象较重，请缓存复用]]&gt;</script><br></div></div><br><br><h4><a name="UserGuide-zh-%283%29%E7%89%B9%E6%AE%8A%E5%9C%BA%E6%99%AF"></a>(3) 特殊场景</h4><br><br><p><font color="green">注：下面只列出不同的地方，其它参见上面的写法</font></p><br><br><h4><a name="UserGuide-zh-%283.1%29%E6%96%B9%E6%B3%95%E7%BA%A7%E8%AE%BE%E7%BD%AE%EF%BC%9A"></a>(3.1) 方法级设置：</h4><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[…<br><br>// 方法级配置<br>List&lt;MethodConfig&gt; methods = new ArrayList&lt;MethodConfig&gt;();<br>MethodConfig method = new MethodConfig();<br>method.setName(“createXxx”);<br>method.setTimeout(10000);<br>method.setRetries(0);<br>methods.add(method);<br><br>// 引用远程服务<br>ReferenceConfig&lt;XxxService&gt; reference = new ReferenceConfig&lt;XxxService&gt;(); // 此实例很重，封装了与注册中心的连接以及与提供者的连接，请自行缓存，否则可能造成内存和连接泄漏<br>…<br>reference.setMethods(methods); // 设置方法级配置<br><br>…]]&gt;</script><br></div></div><br><br><h4><a name="UserGuide-zh-%283.2%29%E7%82%B9%E5%AF%B9%E7%82%B9%E7%9B%B4%E8%BF%9E%EF%BC%9A"></a>(3.2) 点对点直连：</h4><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[…<br><br>ReferenceConfig&lt;XxxService&gt; reference = new ReferenceConfig&lt;XxxService&gt;(); // 此实例很重，封装了与注册中心的连接以及与提供者的连接，请自行缓存，否则可能造成内存和连接泄漏<br>// 如果点对点直连，可以用reference.setUrl()指定目标地址，设置url后将绕过注册中心，<br>// 其中，协议对应provider.setProtocol()的值，端口对应provider.setPort()的值，<br>// 路径对应service.setPath()的值，如果未设置path，缺省path为接口名<br>reference.setUrl(“dubbo://10.20.130.230:20880/com.xxx.XxxService”);<br><br>…]]&gt;</script><br></div></div><br><h2><a name="UserGuide-zh-%E7%A4%BA%E4%BE%8B"></a>示例</h2><br><p>(<a href="Examples-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Examples-zh" title="Examples-zh">+</a>) (<a href="#UserGuide-zh-%E7%A4%BA%E4%BE%8B">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>想完整的运行起来，请参见：<a href="#UserGuide-zh-%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8">快速启动</a> (<a href="Quick+Start-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Quick+Start-zh" title="Quick Start-zh">+</a>)，这里只列出各种场景的配置方式</td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>以下示例全部使用基于Spring的<a href="#UserGuide-zh-Xml%E9%85%8D%E7%BD%AE">Xml配置</a> (<a href="Xml+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Xml+Config-zh" title="Xml Config-zh">+</a>)作为参考，如果不想使用Spring，而希望通过API的方式进行调用，请参见：<a href="#UserGuide-zh-API%E9%85%8D%E7%BD%AE">API配置</a> (<a href="API+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/API+Config-zh" title="API Config-zh">+</a>)</td></tr></table></div><br><br><h3><a name="UserGuide-zh-%E5%90%AF%E5%8A%A8%E6%97%B6%E6%A3%80%E6%9F%A5"></a>启动时检查</h3><br><p>(<a href="Check+On+Startup-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Check+On+Startup-zh" title="Check On Startup-zh">+</a>) (<a href="#UserGuide-zh-%E5%90%AF%E5%8A%A8%E6%97%B6%E6%A3%80%E6%9F%A5">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Dubbo缺省会在启动时检查依赖的服务是否可用，不可用时会抛出异常，阻止Spring初始化完成，以便上线时，能及早发现问题，默认check=tue。</td></tr></table></div><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>如果你的Spring容器是懒加载的，或者通过API编程延迟引用服务，请关闭check，否则服务临时不可用时，会抛出异常，拿到null引用，如果check=false，总是会返回引用，当服务恢复时，能自动连上。</td></tr></table></div><br><br><p>可以通过check=”false”关闭检查，比如，测试时，有些服务不关心，或者出现了循环依赖，必须有一方先启动。</p><br><br><p>关闭某个服务的启动时检查：(没有提供者时报错)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.foo.BarService” check=”false” /&gt;]]&gt;</script><br></div></div><br><br><p>关闭所有服务的启动时检查：(没有提供者时报错)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:consumer check=”false” /&gt;]]&gt;</script><br></div></div><br><br><p>关闭注册中心启动时检查：(注册订阅失败时报错)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry check=”false” /&gt;]]&gt;</script><br></div></div><br><br><p>也可以用dubbo.properties配置：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>dubbo.properties</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: text; gutter: false">&lt;![CDATA[dubbo.reference.com.foo.BarService.check=false<br>dubbo.reference.check=false<br>dubbo.consumer.check=false<br>dubbo.registry.check=false]]&gt;</script><br></div></div><br><br><p>也可以用-D参数：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: text; gutter: false">&lt;![CDATA[java -Ddubbo.reference.com.foo.BarService.check=false<br>java -Ddubbo.reference.check=false<br>java -Ddubbo.consumer.check=false<br>java -Ddubbo.registry.check=false]]&gt;</script><br></div></div><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>注意区别</b><br><ul><br>    <li>dubbo.reference.check=false，强制改变所有reference的check值，就算配置中有声明，也会被覆盖。</li><br>    <li>dubbo.consumer.check=false，是设置check的缺省值，如果配置中有显式的声明，如：&lt;dubbo:reference check=”true”/&gt;，不会受影响。</li><br>    <li>dubbo.registry.check=false，前面两个都是指订阅成功，但提供者列表是否为空是否报错，如果注册订阅失败时，也允许启动，需使用此选项，将在后台定时重试。</li><br></ul><br></td></tr></table></div><br><br><p>引用缺省是延迟初始化的，只有引用被注入到其它Bean，或被getBean()获取，才会初始化。<br><br>如果需要饥饿加载，即没有人引用也立即生成动态代理，可以配置：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.foo.BarService” init=”true” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99"></a>集群容错</h3><br><p>(<a href="Fault+Tolerance-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Fault+Tolerance-zh" title="Fault Tolerance-zh">+</a>) (<a href="#UserGuide-zh-%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>在集群调用失败时，Dubbo提供了多种容错方案，缺省为failover重试。</td></tr></table></div><br><br><p><span class="image-wrap" style=""><img src="cluster.jpg-version=1&modificationDate=1321028038000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6949932/cluster.jpg?version=1&modificationDate=1321028038000" style="border: 0px solid black"></span></p><br><br><p>各节点关系：</p><br><ul><br>    <li>这里的Invoker是Provider的一个可调用Service的抽象，Invoker封装了Provider地址及Service接口信息。</li><br>    <li>Directory代表多个Invoker，可以把它看成List&lt;Invoker&gt;，但与List不同的是，它的值可能是动态变化的，比如注册中心推送变更。</li><br>    <li>Cluster将Directory中的多个Invoker伪装成一个Invoker，对上层透明，伪装过程包含了容错逻辑，调用失败后，重试另一个。</li><br>    <li>Router负责从多个Invoker中按路由规则选出子集，比如读写分离，应用隔离等。</li><br>    <li>LoadBalance负责从多个Invoker中选出具体的一个用于本次调用，选的过程包含了负载均衡算法，调用失败后，需要重选。</li><br></ul><br><br><br><h5><a name="UserGuide-zh-%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99%E6%A8%A1%E5%BC%8F%EF%BC%9A"></a>集群容错模式：</h5><br><br><p>可以自行扩展集群容错策略，参见：<a href="Developer+Guide-zh.htm#DeveloperGuide-zh-%E9%9B%86%E7%BE%A4%E6%89%A9%E5%B1%95" tppabs="http://dubbo.io/wiki/display/dubbo/Developer+Guide-zh#DeveloperGuide-zh-%E9%9B%86%E7%BE%A4%E6%89%A9%E5%B1%95">集群扩展</a></p><br><br><h6><a name="UserGuide-zh-FailoverCluster"></a>Failover Cluster</h6><br><ul><br>    <li>失败自动切换，当出现失败，重试其它服务器。(缺省)</li><br>    <li>通常用于读操作，但重试会带来更长延迟。</li><br>    <li>可通过retries=”2”来设置重试次数(不含第一次)。</li><br></ul><br><br><br><h6><a name="UserGuide-zh-FailfastCluster"></a>Failfast Cluster</h6><br><ul><br>    <li>快速失败，只发起一次调用，失败立即报错。</li><br>    <li>通常用于非幂等性的写操作，比如新增记录。</li><br></ul><br><br><br><h6><a name="UserGuide-zh-FailsafeCluster"></a>Failsafe Cluster</h6><br><ul><br>    <li>失败安全，出现异常时，直接忽略。</li><br>    <li>通常用于写入审计日志等操作。</li><br></ul><br><br><br><h6><a name="UserGuide-zh-FailbackCluster"></a>Failback Cluster</h6><br><ul><br>    <li>失败自动恢复，后台记录失败请求，定时重发。</li><br>    <li>通常用于消息通知操作。</li><br></ul><br><br><br><h6><a name="UserGuide-zh-ForkingCluster"></a>Forking Cluster</h6><br><ul><br>    <li>并行调用多个服务器，只要一个成功即返回。</li><br>    <li>通常用于实时性要求较高的读操作，但需要浪费更多服务资源。</li><br>    <li>可通过forks=”2”来设置最大并行数。</li><br></ul><br><br><br><h6><a name="UserGuide-zh-BroadcastCluster"></a>Broadcast Cluster</h6><br><ul><br>    <li>广播调用所有提供者，逐个调用，任意一台报错则报错。(2.1.0开始支持)</li><br>    <li>通常用于通知所有提供者更新缓存或日志等本地资源信息。</li><br></ul><br><br><br><p>重试次数配置如：(failover集群模式生效)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service retries=”2” /&gt;]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference retries=”2” /&gt;]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference&gt;<br>    &lt;dubbo:method name=”findFoo” retries=”2” /&gt;<br>&lt;/dubbo:reference&gt;]]&gt;</script><br></div></div><br><br><p>集群模式配置如：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service cluster=”failsafe” /&gt;]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference cluster=”failsafe” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"></a>负载均衡</h3><br><p>(<a href="Load+Balance-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Load+Balance-zh" title="Load Balance-zh">+</a>) (<a href="#UserGuide-zh-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>在集群负载均衡时，Dubbo提供了多种均衡策略，缺省为random随机调用。</td></tr></table></div><br><br><p>可以自行扩展负载均衡策略，参见：<a href="Developer+Guide-zh.htm#DeveloperGuide-zh-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%89%A9%E5%B1%95" tppabs="http://dubbo.io/wiki/display/dubbo/Developer+Guide-zh#DeveloperGuide-zh-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%89%A9%E5%B1%95">负载均衡扩展</a></p><br><br><h6><a name="UserGuide-zh-RandomLoadBalance"></a>Random LoadBalance</h6><br><ul><br>    <li>随机，按权重设置随机概率。</li><br>    <li>在一个截面上碰撞的概率高，但调用量越大分布越均匀，而且按概率使用权重后也比较均匀，有利于动态调整提供者权重。</li><br></ul><br><br><br><h6><a name="UserGuide-zh-RoundRobinLoadBalance"></a>RoundRobin LoadBalance</h6><br><ul><br>    <li>轮循，按公约后的权重设置轮循比率。</li><br>    <li>存在慢的提供者累积请求问题，比如：第二台机器很慢，但没挂，当请求调到第二台时就卡在那，久而久之，所有请求都卡在调到第二台上。</li><br></ul><br><br><br><h6><a name="UserGuide-zh-LeastActiveLoadBalance"></a>LeastActive LoadBalance</h6><br><ul><br>    <li>最少活跃调用数，相同活跃数的随机，活跃数指调用前后计数差。</li><br>    <li>使慢的提供者收到更少请求，因为越慢的提供者的调用前后计数差会越大。</li><br></ul><br><br><br><h6><a name="UserGuide-zh-ConsistentHashLoadBalance"></a>ConsistentHash LoadBalance</h6><br><ul><br>    <li>一致性Hash，相同参数的请求总是发到同一提供者。</li><br>    <li>当某一台提供者挂时，原本发往该提供者的请求，基于虚拟节点，平摊到其它提供者，不会引起剧烈变动。</li><br>    <li>算法参见：<a href="javascript:if(confirm(%27http://en.wikipedia.org/wiki/Consistent_hashing  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://en.wikipedia.org/wiki/Consistent_hashing%27" tppabs="http://en.wikipedia.org/wiki/Consistent_hashing" class="external-link" rel="external" target="_blank">http://en.wikipedia.org/wiki/Consistent_hashing</a>。</li><br>    <li>缺省只对第一个参数Hash，如果要修改，请配置&lt;dubbo:parameter key=”hash.arguments” value=”0,1” /&gt;</li><br>    <li>缺省用160份虚拟节点，如果要修改，请配置&lt;dubbo:parameter key=”hash.nodes” value=”320” /&gt;</li><br></ul><br><br><br><p>配置如：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”…” loadbalance=”roundrobin” /&gt;]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”…” loadbalance=”roundrobin” /&gt;]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”…”&gt;<br>    &lt;dubbo:method name=”…” loadbalance=”roundrobin”/&gt;<br>&lt;/dubbo:service&gt;]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”…”&gt;<br>    &lt;dubbo:method name=”…” loadbalance=”roundrobin”/&gt;<br>&lt;/dubbo:reference&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B"></a>线程模型</h3><br><p>(<a href="Thread+Model-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Thread+Model-zh" title="Thread Model-zh">+</a>) (<a href="#UserGuide-zh-%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B">#</a>)</p><br><br><p><span class="image-wrap" style=""><img src="dubbo-protocol.jpg-version=1&modificationDate=1331068241000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6949458/dubbo-protocol.jpg?version=1&modificationDate=1331068241000" style="border: 0px solid black"></span></p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>事件处理线程说明</b><br><ul><br>    <li>如果事件处理的逻辑能迅速完成，并且不会发起新的IO请求，比如只是在内存中记个标识，则直接在IO线程上处理更快，因为减少了线程池调度。</li><br>    <li>但如果事件处理逻辑较慢，或者需要发起新的IO请求，比如需要查询数据库，则必须派发到线程池，否则IO线程阻塞，将导致不能接收其它请求。</li><br>    <li>如果用IO线程处理事件，又在事件处理过程中发起新的IO请求，比如在连接事件中发起登录请求，会报“可能引发死锁”异常，但不会真死锁。</li><br></ul><br></td></tr></table></div><br><br><ul><br>    <li>Dispatcher<br>    <ul><br>        <li>all 所有消息都派发到线程池，包括请求，响应，连接事件，断开事件，心跳等。</li><br>        <li>direct 所有消息都不派发到线程池，全部在IO线程上直接执行。</li><br>        <li>message 只有请求响应消息派发到线程池，其它连接断开事件，心跳等消息，直接在IO线程上执行。</li><br>        <li>execution 只请求消息派发到线程池，不含响应，响应和其它连接断开事件，心跳等消息，直接在IO线程上执行。</li><br>        <li>connection 在IO线程上，将连接断开事件放入队列，有序逐个执行，其它消息派发到线程池。</li><br>    </ul><br>    </li><br></ul><br><br><br><ul><br>    <li>ThreadPool<br>    <ul><br>        <li>fixed 固定大小线程池，启动时建立线程，不关闭，一直持有。(缺省)</li><br>        <li>cached 缓存线程池，空闲一分钟自动删除，需要时重建。</li><br>        <li>limited 可伸缩线程池，但池中的线程数只会增长不会收缩。(为避免收缩时突然来了大流量引起的性能问题)。</li><br>    </ul><br>    </li><br></ul><br><br><br><p>配置如：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”dubbo” dispatcher=”all” threadpool=”fixed” threads=”100” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E7%9B%B4%E8%BF%9E%E6%8F%90%E4%BE%9B%E8%80%85"></a>直连提供者</h3>

<p>(<a href="Directly+Provider-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Directly+Provider-zh" title="Directly Provider-zh">+</a>) (<a href="#UserGuide-zh-%E7%9B%B4%E8%BF%9E%E6%8F%90%E4%BE%9B%E8%80%85">&#35;</a>)</p>

<p>在开发及测试环境下，经常需要绕过注册中心，只测试指定服务提供者，这时候可能需要点对点直连，<br><br>点对点直联方式，将以服务接口为单位，忽略注册中心的提供者列表，<br><br>A接口配置点对点，不影响B接口从注册中心获取列表。</p>

<p><span class="image-wrap" style=""><img src="dubbo-directly.jpg-version=1&modificationDate=1326853485000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6949440/dubbo-directly.jpg?version=1&modificationDate=1326853485000" style="border: 0px solid black"></span></p>

<p>(1) 如果是线上需求需要点对点，可在&lt;dubbo:reference&gt;中配置url指向提供者，将绕过注册中心，<b>多个地址用分号隔开</b>，配置如下：(1.0.6及以上版本支持)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”xxxService” interface=”com.alibaba.xxx.XxxService” url=”dubbo://localhost:20890” /&gt;]]&gt;</script><br></div></div><br><br><p>(2) 在JVM启动参数中加入-D参数映射服务地址，如：<br><br>(key为服务名，value为服务提供者url，此配置优先级最高，1.0.15及以上版本支持)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[java -Dcom.alibaba.xxx.XxxService=dubbo://localhost:20890]]&gt;</script><br></div></div><br><br><div class="panelMacro"><table class="infoMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="information.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>注意</b><br>为了避免复杂化线上环境，不要在线上使用这个功能，只应在测试阶段使用。</td></tr></table></div><br><p>(3) 如果服务比较多，也可以用文件映射，如：<br><br>(用-Ddubbo.resolve.file指定映射文件路径，此配置优先级高于&lt;dubbo:reference&gt;中的配置，1.0.15及以上版本支持)<br><br>(2.0以上版本自动加载${user.home}/dubbo-resolve.properties文件，不需要配置)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[java -Ddubbo.resolve.file=xxx.properties]]&gt;</script><br></div></div><br><p>然后在映射文件xxx.properties中加入：<br><br>(key为服务名，value为服务提供者url)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false"><a href="![CDATA[com.alibaba.xxx.XxxService=dubbo://localhost:20890]]">![CDATA[com.alibaba.xxx.XxxService=dubbo://localhost:20890]]</a></script><br></div></div><br><div class="panelMacro"><table class="infoMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="information.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>注意</b><br>为了避免复杂化线上环境，不要在线上使用这个功能，只应在测试阶段使用。</td></tr></table></div><br><h3><a name="UserGuide-zh-%E5%8F%AA%E8%AE%A2%E9%98%85"></a>只订阅</h3><br><p>(<a href="Subscribe+Only-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Subscribe+Only-zh" title="Subscribe Only-zh">+</a>) (<a href="#UserGuide-zh-%E5%8F%AA%E8%AE%A2%E9%98%85">#</a>)</p>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>问题</b><br>为方便开发测试，经常会在线下共用一个所有服务可用的注册中心，这时，如果一个正在开发中的服务提供者注册，可能会影响消费者不能正常运行。</td></tr></table></div>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>解决方案</b><br>可以让服务提供者开发方，只订阅服务(开发的服务可能依赖其它服务)，而不注册正在开发的服务，通过直连测试正在开发的服务。</td></tr></table></div>

<p><span class="image-wrap" style=""><img src="subscribe-only.jpg-version=1&modificationDate=1326468174000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6949667/subscribe-only.jpg?version=1&modificationDate=1326468174000" style="border: 0px solid black"></span></p>

<p>禁用注册配置：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry address=”10.20.153.10:9090” register=”false” /&gt;]]&gt;</script><br></div></div><br><p>或者：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry address=”10.20.153.10:9090?register=false” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E5%8F%AA%E6%B3%A8%E5%86%8C"></a>只注册</h3><br><p>(<a href="Register+Only-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Register+Only-zh" title="Register Only-zh">+</a>) (<a href="#UserGuide-zh-%E5%8F%AA%E6%B3%A8%E5%86%8C">#</a>)</p>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>问题</b><br>如果有两个镜像环境，两个注册中心，有一个服务只在其中一个注册中心有部署，另一个注册中心还没来得及部署，而两个注册中心的其它应用都需要依赖此服务，所以需要将服务同时注册到两个注册中心，但却不能让此服务同时依赖两个注册中心的其它服务。</td></tr></table></div>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>解决方案</b><br>可以让服务提供者方，只注册服务到另一注册中心，而不从另一注册中心订阅服务。</td></tr></table></div>

<p>禁用订阅配置：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry id=”hzRegistry” address=”10.20.153.10:9090” /&gt;<br>&lt;dubbo:registry id=”qdRegistry” address=”10.20.141.150:9090” subscribe=”false” /&gt;]]&gt;</script><br></div></div><br><p>或者：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry id=”hzRegistry” address=”10.20.153.10:9090” /&gt;<br>&lt;dubbo:registry id=”qdRegistry” address=”10.20.141.150:9090?subscribe=false” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E9%9D%99%E6%80%81%E6%9C%8D%E5%8A%A1"></a>静态服务</h3><br><p>(<a href="Static+Provider-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Static+Provider-zh" title="Static Provider-zh">+</a>) (<a href="#UserGuide-zh-%E9%9D%99%E6%80%81%E6%9C%8D%E5%8A%A1">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>有时候希望人工管理服务提供者的上线和下线，此时需将注册中心标识为非动态管理模式。</td></tr></table></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry address=”10.20.141.150:9090” dynamic=”false” /&gt;]]&gt;</script><br></div></div>

<p>或者：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry address=”10.20.141.150:9090?dynamic=false” /&gt;]]&gt;</script><br></div></div><br><br><p>服务提供者初次注册时为禁用状态，需人工启用，断线时，将不会被自动删除，需人工禁用。</p>

<p>如果是一个第三方独立提供者，比如memcached等，可以直接向注册中心写入提供者地址信息，消费者正常使用：<br><br>(通常由脚本监控中心页面等调用)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[RegistryFactory registryFactory = ExtensionLoader.getExtensionLoader(RegistryFactory.class).getAdaptiveExtension();<br>Registry registry = registryFactory.getRegistry(URL.valueOf(“zookeeper://10.20.153.10:2181”));<br>registry.register(URL.valueOf(“memcached://10.20.153.11/com.foo.BarService?category=providers&amp;dynamic=false&amp;application=foo”));]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E5%A4%9A%E5%8D%8F%E8%AE%AE"></a>多协议</h3><br><p>(<a href="Multi+Protocol-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Multi+Protocol-zh" title="Multi Protocol-zh">+</a>) (<a href="#UserGuide-zh-%E5%A4%9A%E5%8D%8F%E8%AE%AE">#</a>)</p>

<p>可以自行扩展协议，参见：<a href="Developer+Guide-zh.htm#DeveloperGuide-zh-%E5%8D%8F%E8%AE%AE%E6%89%A9%E5%B1%95" tppabs="http://dubbo.io/wiki/display/dubbo/Developer+Guide-zh#DeveloperGuide-zh-%E5%8D%8F%E8%AE%AE%E6%89%A9%E5%B1%95">协议扩展</a></p>

<h4><a name="UserGuide-zh-%281%29%E4%B8%8D%E5%90%8C%E6%9C%8D%E5%8A%A1%E4%B8%8D%E5%90%8C%E5%8D%8F%E8%AE%AE"></a>(1) 不同服务不同协议</h4>

<p>比如：不同服务在性能上适用不同协议进行传输，比如大数据用短连接协议，小数据大并发用长连接协议。</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>consumer.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;<br>&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>“<br>    xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>“<br>    xmlns:dubbo=”<a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>“<br>    xsi:schemaLocation=”<a href="http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://code.alibabatech.com/schema/dubbohttp://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt">http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://code.alibabatech.com/schema/dubbohttp://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt</a>;<br><br>    &lt;dubbo:application name=”world”  /&gt;<br>    &lt;dubbo:registry id=”registry” address=”10.20.141.150:9090” username=”admin” password=”hello1234” /&gt;<br><br>    &lt;!– 多协议配置 –&gt;<br>    &lt;dubbo:protocol name=”dubbo” port=”20880” /&gt;<br>    &lt;dubbo:protocol name=”rmi” port=”1099” /&gt;<br><br>    &lt;!– 使用dubbo协议暴露服务 –&gt;<br>    &lt;dubbo:service interface=”com.alibaba.hello.api.HelloService” version=”1.0.0” ref=”helloService” protocol=”dubbo” /&gt;<br>    &lt;!– 使用rmi协议暴露服务 –&gt;<br>    &lt;dubbo:service interface=”com.alibaba.hello.api.DemoService” version=”1.0.0” ref=”demoService” protocol=”rmi” /&gt;<br><br>&lt;/beans&gt;]]&gt;</script><br></div></div>

<h4><a name="UserGuide-zh-%282%29%E5%A4%9A%E5%8D%8F%E8%AE%AE%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1"></a>(2) 多协议暴露服务</h4>

<p>比如：需要与http客户端互操作</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>consumer.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;<br>&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>“<br>    xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>“<br>    xmlns:dubbo=”<a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>“<br>    xsi:schemaLocation=”<a href="http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://code.alibabatech.com/schema/dubbohttp://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt">http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://code.alibabatech.com/schema/dubbohttp://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt</a>;<br><br>    &lt;dubbo:application name=”world”  /&gt;<br>    &lt;dubbo:registry id=”registry” address=”10.20.141.150:9090” username=”admin” password=”hello1234” /&gt;<br><br>    &lt;!– 多协议配置 –&gt;<br>    &lt;dubbo:protocol name=”dubbo” port=”20880” /&gt;<br>    &lt;dubbo:protocol name=”hessian” port=”8080” /&gt;<br><br>    &lt;!– 使用多个协议暴露服务 –&gt;<br>    &lt;dubbo:service id=”helloService” interface=”com.alibaba.hello.api.HelloService” version=”1.0.0” protocol=”dubbo,hessian” /&gt;<br><br>&lt;/beans&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E5%A4%9A%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"></a>多注册中心</h3><br><p>(<a href="Multi+Registry-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Multi+Registry-zh" title="Multi Registry-zh">+</a>) (<a href="#UserGuide-zh-%E5%A4%9A%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">#</a>)</p><br><br><p>可以自行扩展注册中心，参见：<a href="Developer+Guide-zh.htm#DeveloperGuide-zh-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E6%89%A9%E5%B1%95" tppabs="http://dubbo.io/wiki/display/dubbo/Developer+Guide-zh#DeveloperGuide-zh-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E6%89%A9%E5%B1%95">注册中心扩展</a></p><br><br><h4><a name="UserGuide-zh-%281%29%E5%A4%9A%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E6%B3%A8%E5%86%8C"></a>(1) 多注册中心注册</h4><br><br><p>比如：中文站有些服务来不及在青岛部署，只在杭州部署，而青岛的其它应用需要引用此服务，就可以将服务同时注册到两个注册中心。</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>consumer.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;<br>&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>“<br>    xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>“<br>    xmlns:dubbo=”<a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>“<br>    xsi:schemaLocation=”<a href="http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://code.alibabatech.com/schema/dubbohttp://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt">http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://code.alibabatech.com/schema/dubbohttp://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt</a>;<br><br>    &lt;dubbo:application name=”world”  /&gt;<br><br>    &lt;!– 多注册中心配置 –&gt;<br>    &lt;dubbo:registry id=”hangzhouRegistry” address=”10.20.141.150:9090” /&gt;<br>    &lt;dubbo:registry id=”qingdaoRegistry” address=”10.20.141.151:9010” default=”false” /&gt;<br><br>    &lt;!– 向多个注册中心注册 –&gt;<br>    &lt;dubbo:service interface=”com.alibaba.hello.api.HelloService” version=”1.0.0” ref=”helloService” registry=”hangzhouRegistry,qingdaoRegistry” /&gt;<br><br>&lt;/beans&gt;]]&gt;</script><br></div></div>

<h4><a name="UserGuide-zh-%282%29%E4%B8%8D%E5%90%8C%E6%9C%8D%E5%8A%A1%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"></a>(2) 不同服务使用不同注册中心</h4>

<p>比如：CRM有些服务是专门为国际站设计的，有些服务是专门为中文站设计的。</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>consumer.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;<br>&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>“<br>    xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>“<br>    xmlns:dubbo=”<a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>“<br>    xsi:schemaLocation=”<a href="http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://code.alibabatech.com/schema/dubbohttp://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt">http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://code.alibabatech.com/schema/dubbohttp://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt</a>;<br><br>    &lt;dubbo:application name=”world”  /&gt;<br><br>    &lt;!– 多注册中心配置 –&gt;<br>    &lt;dubbo:registry id=”chinaRegistry” address=”10.20.141.150:9090” /&gt;<br>    &lt;dubbo:registry id=”intlRegistry” address=”10.20.154.177:9010” default=”false” /&gt;<br><br>    &lt;!– 向中文站注册中心注册 –&gt;<br>    &lt;dubbo:service interface=”com.alibaba.hello.api.HelloService” version=”1.0.0” ref=”helloService” registry=”chinaRegistry” /&gt;<br><br>    &lt;!– 向国际站注册中心注册 –&gt;<br>    &lt;dubbo:service interface=”com.alibaba.hello.api.DemoService” version=”1.0.0” ref=”demoService” registry=”intlRegistry” /&gt;<br><br>&lt;/beans&gt;]]&gt;</script><br></div></div>

<h4><a name="UserGuide-zh-%283%29%E5%A4%9A%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%BC%95%E7%94%A8"></a>(3) 多注册中心引用</h4>

<p>比如：CRM需同时调用中文站和国际站的PC2服务，PC2在中文站和国际站均有部署，接口及版本号都一样，但连的数据库不一样。</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>consumer.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;<br>&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>“<br>    xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>“<br>    xmlns:dubbo=”<a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>“<br>    xsi:schemaLocation=”<a href="http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://code.alibabatech.com/schema/dubbohttp://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt">http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://code.alibabatech.com/schema/dubbohttp://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt</a>;<br><br>    &lt;dubbo:application name=”world”  /&gt;<br><br>    &lt;!– 多注册中心配置 –&gt;<br>    &lt;dubbo:registry id=”chinaRegistry” address=”10.20.141.150:9090” /&gt;<br>    &lt;dubbo:registry id=”intlRegistry” address=”10.20.154.177:9010” default=”false” /&gt;<br><br>    &lt;!– 引用中文站服务 –&gt;<br>    &lt;dubbo:reference id=”chinaHelloService” interface=”com.alibaba.hello.api.HelloService” version=”1.0.0” registry=”chinaRegistry” /&gt;<br><br>    &lt;!– 引用国际站站服务 –&gt;<br>    &lt;dubbo:reference id=”intlHelloService” interface=”com.alibaba.hello.api.HelloService” version=”1.0.0” registry=”intlRegistry” /&gt;<br><br>&lt;/beans&gt;]]&gt;</script><br></div></div>

<p>如果只是测试环境临时需要连接两个不同注册中心，使用竖号分隔多个不同注册中心地址：</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>consumer.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;<br>&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>“<br>    xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>“<br>    xmlns:dubbo=”<a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>“<br>    xsi:schemaLocation=”<a href="http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://code.alibabatech.com/schema/dubbohttp://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt">http://www.springframework.org/schema/beanshttp://www.springframework.org/schema/beans/spring-beans.xsdhttp://code.alibabatech.com/schema/dubbohttp://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt</a>;<br><br>    &lt;dubbo:application name=”world”  /&gt;<br><br>    &lt;!– 多注册中心配置，竖号分隔表示同时连接多个不同注册中心，同一注册中心的多个集群地址用逗号分隔 –&gt;<br>    &lt;dubbo:registry address=”10.20.141.150:9090|10.20.154.177:9010” /&gt;<br><br>    &lt;!– 引用服务 –&gt;<br>    &lt;dubbo:reference id=”helloService” interface=”com.alibaba.hello.api.HelloService” version=”1.0.0” /&gt;<br><br>&lt;/beans&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E6%9C%8D%E5%8A%A1%E5%88%86%E7%BB%84"></a>服务分组</h3><br><p>(<a href="Multi+Group-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Multi+Group-zh" title="Multi Group-zh">+</a>) (<a href="#UserGuide-zh-%E6%9C%8D%E5%8A%A1%E5%88%86%E7%BB%84">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>当一个接口有多种实现时，可以用group区分。</td></tr></table></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service group=”feedback” interface=”com.xxx.IndexService” /&gt;<br>&lt;dubbo:service group=”member” interface=”com.xxx.IndexService” /&gt;]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”feedbackIndexService” group=”feedback” interface=”com.xxx.IndexService” /&gt;<br>&lt;dubbo:reference id=”memberIndexService” group=”member” interface=”com.xxx.IndexService” /&gt;]]&gt;</script><br></div></div>

<p>任意组：(2.2.0以上版本支持，总是只调一个可用组的实现)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”barService” interface=”com.foo.BarService” group=”*” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E5%A4%9A%E7%89%88%E6%9C%AC"></a>多版本</h3><br><p>(<a href="Multi+Version-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Multi+Version-zh" title="Multi Version-zh">+</a>) (<a href="#UserGuide-zh-%E5%A4%9A%E7%89%88%E6%9C%AC">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>当一个接口实现，出现不兼容升级时，可以用版本号过渡，版本号不同的服务相互间不引用。</td></tr></table></div>

<ul><br>    <li>在低压力时间段，先升级一半提供者为新版本</li><br>    <li>再将所有消费者升级为新版本</li><br>    <li>然后将剩下的一半提供者升级为新版本</li><br></ul>


<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.foo.BarService” version=”1.0.0” /&gt;]]&gt;</script><br></div></div><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.foo.BarService” version=”2.0.0” /&gt;]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”barService” interface=”com.foo.BarService” version=”1.0.0” /&gt;]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”barService” interface=”com.foo.BarService” version=”2.0.0” /&gt;]]&gt;</script><br></div></div>

<p>不区分版本：(2.2.0以上版本支持)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”barService” interface=”com.foo.BarService” version=”*” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88"></a>分组聚合</h3><br><p>(<a href="Merge+By+Group-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Merge+By+Group-zh" title="Merge By Group-zh">+</a>) (<a href="#UserGuide-zh-%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>按组合并返回结果，比如菜单服务，接口一样，但有多种实现，用group区分，现在消费方需从每种group中调用一次返回结果，合并结果返回，这样就可以实现聚合菜单项。</td></tr></table></div>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>从2.1.0版本开始支持</td></tr></table></div>

<p><span class="image-wrap" style=""><img src="dubbo-merger.jpg-version=1&modificationDate=1329310196000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6952105/dubbo-merger.jpg?version=1&modificationDate=1329310196000" style="border: 0px solid black"></span></p>

<p>代码参见：<a href="javascript:if(confirm(%27https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/merge  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/merge%27" tppabs="https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/merge" class="external-link" rel="external" target="_blank">https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/merge</a></p>

<p>配置如：(搜索所有分组)</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.xxx.MenuService” group=”*” merger=”true” /&gt;]]&gt;</script><br></div></div>

<p>或：(合并指定分组)</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.xxx.MenuService” group=”aaa,bbb” merger=”true” /&gt;]]&gt;</script><br></div></div>

<p>或：(指定方法合并结果，其它未指定的方法，将只调用一个Group)</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.xxx.MenuService” group=”*”&gt;<br>    &lt;dubbo:method name=”getMenuItems” merger=”true” /&gt;<br>&lt;/dubbo:service&gt;]]&gt;</script><br></div></div>

<p>或：(某个方法不合并结果，其它都合并结果)</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.xxx.MenuService” group=”*” merger=”true”&gt;<br>    &lt;dubbo:method name=”getMenuItems” merger=”false” /&gt;<br>&lt;/dubbo:service&gt;]]&gt;</script><br></div></div>

<p>或：(指定合并策略，缺省根据返回值类型自动匹配，如果同一类型有两个合并器时，需指定合并器的名称)<br><br>参见：<span class="error">&#91;合并结果扩展&#93;</span></p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.xxx.MenuService” group=”*”&gt;<br>    &lt;dubbo:method name=”getMenuItems” merger=”mymerge” /&gt;<br>&lt;/dubbo:service&gt;]]&gt;</script><br></div></div>


<p>或：(指定合并方法，将调用返回结果的指定方法进行合并，合并方法的参数类型必须是返回结果类型本身)</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.xxx.MenuService” group=”*”&gt;<br>    &lt;dubbo:method name=”getMenuItems” merger=”.addAll” /&gt;<br>&lt;/dubbo:service&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E5%8F%82%E6%95%B0%E9%AA%8C%E8%AF%81"></a>参数验证</h3><br><p>(<a href="Parameter+Validation-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Parameter+Validation-zh" title="Parameter Validation-zh">+</a>) (<a href="#UserGuide-zh-%E5%8F%82%E6%95%B0%E9%AA%8C%E8%AF%81">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>参数验证功能是基于<a href="javascript:if(confirm(%27http://jcp.org/en/jsr/detail?id=303  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://jcp.org/en/jsr/detail?id=303%27" tppabs="http://jcp.org/en/jsr/detail?id=303" class="external-link" rel="external" target="_blank">JSR303</a>实现的，用户只需标识JSR303标准的验证Annotation，并通过声明filter来实现验证。</td></tr></table></div>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.1.0以上版本支持</td></tr></table></div>

<p>完整示例代码参见：<a href="javascript:if(confirm(%27https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/validation  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/validation%27" tppabs="https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/validation" class="external-link" rel="external" target="_blank">https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/validation</a></p>

<p>验证方式可扩展，参见：<a href="Developer+Guide-zh.htm#DeveloperGuide-zh-Validation" tppabs="http://dubbo.io/wiki/display/dubbo/Developer+Guide-zh#DeveloperGuide-zh-Validation">Validation扩展点</a></p>

<p>参数标注示例：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[import java.io.Serializable;<br>import java.util.Date;<br><br>import javax.validation.constraints.Future;<br>import javax.validation.constraints.Max;<br>import javax.validation.constraints.Min;<br>import javax.validation.constraints.NotNull;<br>import javax.validation.constraints.Past;<br>import javax.validation.constraints.Pattern;<br>import javax.validation.constraints.Size;<br><br>public class ValidationParameter implements Serializable {<br><br>    private static final long serialVersionUID = 7158911668568000392L;<br><br>    @NotNull // 不允许为空<br>    @Size(min = 1, max = 20) // 长度或大小范围<br>    private String name;<br><br>    @NotNull(groups = ValidationService.Save.class) // 保存时不允许为空，更新时允许为空 ，表示不更新该字段<br>    @Pattern(regexp = “^\s<em>\w+(?:\.{0,1}[\w-]+)</em>@[a-zA-Z0-9]+(?:[-.][a-zA-Z0-9]+)<em>\.[a-zA-Z]+\s</em>$”)<br>    private String email;<br><br>    @Min(18) // 最小值<br>    @Max(100) // 最大值<br>    private int age;<br><br>    @Past // 必须为一个过去的时间<br>    private Date loginDate;<br><br>    @Future // 必须为一个未来的时间<br>    private Date expiryDate;<br><br>    public String getName() {<br>        return name;<br>    }<br><br>    public void setName(String name) {<br>        this.name = name;<br>    }<br><br>    public String getEmail() {<br>        return email;<br>    }<br><br>    public void setEmail(String email) {<br>        this.email = email;<br>    }<br><br>    public int getAge() {<br>        return age;<br>    }<br><br>    public void setAge(int age) {<br>        this.age = age;<br>    }<br><br>    public Date getLoginDate() {<br>        return loginDate;<br>    }<br><br>    public void setLoginDate(Date loginDate) {<br>        this.loginDate = loginDate;<br>    }<br><br>    public Date getExpiryDate() {<br>        return expiryDate;<br>    }<br><br>    public void setExpiryDate(Date expiryDate) {<br>        this.expiryDate = expiryDate;<br>    }<br><br>}]]&gt;</script><br></div></div><br><br><p>分组验证示例：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[public interface ValidationService { // 缺省可按服务接口区分验证场景，如：@NotNull(groups = ValidationService.class)<br><br>    @interface Save{} // 与方法同名接口，首字母大写，用于区分验证场景，如：@NotNull(groups = ValidationService.Save.class)，可选<br>    void save(ValidationParameter parameter);<br><br>    void update(ValidationParameter parameter);<br><br>}]]&gt;</script><br></div></div><br><br><p>关联验证示例：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[import javax.validation.GroupSequence;<br><br>public interface ValidationService {<br><br>    @GroupSequence(Update.class) // 同时验证Update组规则<br>    @interface Save{}<br>    void save(ValidationParameter parameter);<br><br>    @interface Update{}<br>    void update(ValidationParameter parameter);<br><br>}]]&gt;</script><br></div></div><br><br><p>参数验证示例：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[import javax.validation.constraints.Min;<br>import javax.validation.constraints.NotNull;<br><br>public interface ValidationService {<br><br>    void save(@NotNull ValidationParameter parameter); // 验证参数不为空<br><br>    void delete(@Min(1) int id); // 直接对基本类型参数验证<br><br>}]]&gt;</script><br></div></div><br><br><p>在客户端验证参数：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”validationService” interface=”com.alibaba.dubbo.examples.validation.api.ValidationService” validation=”true” /&gt;]]&gt;</script><br></div></div><br><br><p>在服务器端验证参数：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.alibaba.dubbo.examples.validation.api.ValidationService” ref=”validationService” validation=”true” /&gt;]]&gt;</script><br></div></div><br><p>验证异常信息：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[import javax.validation.ConstraintViolationException;<br>import javax.validation.ConstraintViolationException;<br><br>import org.springframework.context.support.ClassPathXmlApplicationContext;<br><br>import com.alibaba.dubbo.examples.validation.api.ValidationParameter;<br>import com.alibaba.dubbo.examples.validation.api.ValidationService;<br>import com.alibaba.dubbo.rpc.RpcException;<br><br>public class ValidationConsumer {<br><br>    public static void main(String[] args) throws Exception {<br>        String config = ValidationConsumer.class.getPackage().getName().replace(‘.’, ‘/‘) + “/validation-consumer.xml”;<br>        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(config);<br>        context.start();<br>        ValidationService validationService = (ValidationService)context.getBean(“validationService”);<br>        // Error<br>        try {<br>            parameter = new ValidationParameter();<br>            validationService.save(parameter);<br>            System.out.println(“Validation ERROR”);<br>        } catch (RpcException e) { // 抛出的是RpcException<br>            ConstraintViolationException ve = (ConstraintViolationException) e.getCause(); // 里面嵌了一个ConstraintViolationException<br>            Set&lt;ConstraintViolation&lt;?&gt;&gt; violations = ve.getConstraintViolations(); // 可以拿到一个验证错误详细信息的集合<br>            System.out.println(violations);<br>        }<br>    }<br><br>}]]&gt;</script><br></div></div><br><br><p>需要加入依赖：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dependency&gt;<br>    &lt;groupId&gt;javax.validation&lt;/groupId&gt;<br>    &lt;artifactId&gt;validation-api&lt;/artifactId&gt;<br>    &lt;version&gt;1.0.0.GA&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.hibernate&lt;/groupId&gt;<br>    &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;<br>    &lt;version&gt;4.2.0.Final&lt;/version&gt;<br>&lt;/dependency&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E7%BB%93%E6%9E%9C%E7%BC%93%E5%AD%98"></a>结果缓存</h3><br><p>(<a href="Result+Cache-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Result+Cache-zh" title="Result Cache-zh">+</a>) (<a href="#UserGuide-zh-%E7%BB%93%E6%9E%9C%E7%BC%93%E5%AD%98">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>结果缓存，用于加速热门数据的访问速度，Dubbo提供声明式缓存，以减少用户加缓存的工作量。</td></tr></table></div>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.1.0以上版本支持</td></tr></table></div>

<p>示例代码：<a href="javascript:if(confirm(%27https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/cache  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/cache%27" tppabs="https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/cache" class="external-link" rel="external" target="_blank">https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/cache</a></p>

<ul><br>    <li>lru 基于最近最少使用原则删除多余缓存，保持最热的数据被缓存。</li><br>    <li>threadlocal 当前线程缓存，比如一个页面渲染，用到很多portal，每个portal都要去查用户信息，通过线程缓存，可以减少这种多余访问。</li><br>    <li>jcache 与<a href="javascript:if(confirm(%27http://jcp.org/en/jsr/detail?id=107  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://jcp.org/en/jsr/detail?id=107%27" tppabs="http://jcp.org/en/jsr/detail?id=107" class="external-link" rel="external" target="_blank">JSR107</a>集成，可以桥接各种缓存实现。</li><br></ul>


<p>缓存类型可扩展，参见：<a href="Developer+Guide-zh.htm#DeveloperGuide-zh-CacheFactory" tppabs="http://dubbo.io/wiki/display/dubbo/Developer+Guide-zh#DeveloperGuide-zh-CacheFactory">CacheFactory扩展点</a></p>

<p>配置如：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.foo.BarService” cache=”lru” /&gt;]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.foo.BarService”&gt;<br>    &lt;dubbo:method name=”findBar” cache=”lru” /&gt;<br>&lt;/dubbo:reference&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E6%B3%9B%E5%8C%96%E5%BC%95%E7%94%A8"></a>泛化引用</h3><br><p>(<a href="Generic+Reference-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Generic+Reference-zh" title="Generic Reference-zh">+</a>) (<a href="#UserGuide-zh-%E6%B3%9B%E5%8C%96%E5%BC%95%E7%94%A8">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>泛接口调用方式主要用于客户端没有API接口及模型类元的情况，参数及返回值中的所有POJO均用Map表示，通常用于框架集成，比如：实现一个通用的服务测试框架，可通过GenericService调用所有服务实现。</td></tr></table></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”barService” interface=”com.foo.BarService” generic=”true” /&gt;]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[GenericService barService = (GenericService) applicationContext.getBean(“barService”);<br>Object result = barService.$invoke(“sayHello”, new String[] { “java.lang.String” }, new Object[] { “World” });]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[import com.alibaba.dubbo.rpc.service.GenericService;<br>…<br><br>// 引用远程服务<br>ReferenceConfig&lt;GenericService&gt; reference = new ReferenceConfig&lt;GenericService&gt;(); // 该实例很重量，里面封装了所有与注册中心及服务提供方连接，请缓存<br>reference.setInterface(“com.xxx.XxxService”); // 弱类型接口名<br>reference.setVersion(“1.0.0”);<br>reference.setGeneric(true); // 声明为泛化接口<br><br>GenericService genericService = reference.get(); // 用com.alibaba.dubbo.rpc.service.GenericService可以替代所有接口引用<br><br>// 基本类型以及Date,List,Map等不需要转换，直接调用<br>Object result = genericService.$invoke(“sayHello”, new String[] {“java.lang.String”}, new Object[] {“world”});<br><br>// 用Map表示POJO参数，如果返回值为POJO也将自动转成Map<br>Map&lt;String, Object&gt; person = new HashMap&lt;String, Object&gt;();<br>person.put(“name”, “xxx”);<br>person.put(“password”, “yyy”);<br>Object result = genericService.$invoke(“findPerson”, new String[]{“com.xxx.Person”}, new Object[]{person}); // 如果返回POJO将自动转成Map<br><br>…]]&gt;</script><br></div></div> 

<p>假设存在POJO如： </p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[package com.xxx;<br>public class PersonImpl implements Person {<br>private String name;<br>private String password;<br>public String getName() {<br>return name;<br>}<br>public void setName(String name) {<br>this.name = name;<br>}<br>public String getPassword() {<br>return password;<br>}<br>public void setPassword(String password) {<br>this.password= password;<br>}<br>}]]&gt;</script><br></div></div><br><p>则POJO数据： </p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[Person person = new PersonImpl();<br>person.setName(“xxx”);<br>person.setPassword(“yyy”);]]&gt;</script><br></div></div><br><p>可用下面Map表示： </p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();<br>map.put(“class”, “com.xxx.PersonImpl”); // 注意：如果参数类型是接口，或者List等丢失泛型，可通过class属性指定类型。<br>map.put(“name”, “xxx”);<br>map.put(“password”, “yyy”);]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E6%B3%9B%E5%8C%96%E5%AE%9E%E7%8E%B0"></a>泛化实现</h3><br><p>(<a href="Generic+Implementation-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Generic+Implementation-zh" title="Generic Implementation-zh">+</a>) (<a href="#UserGuide-zh-%E6%B3%9B%E5%8C%96%E5%AE%9E%E7%8E%B0">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>泛接口实现方式主要用于服务器端没有API接口及模型类元的情况，参数及返回值中的所有POJO均用Map表示，通常用于框架集成，比如：实现一个通用的远程服务Mock框架，可通过实现GenericService接口处理所有服务请求。</td></tr></table></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;bean id=”genericService” class=”com.foo.MyGenericService” /&gt;<br>&lt;dubbo:service interface=”com.foo.BarService” ref=”genericService” /&gt;]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[package com.foo;<br>public class MyGenericService implements GenericService {<br><br>    public Object $invoke(String methodName, String[] parameterTypes, Object[] args) throws GenericException {<br>        if (“sayHello”.equals(methodName)) {<br>            return “Welcome “ + args[0];<br>        }<br>    }<br><br>}]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[…<br>GenericService xxxService = new XxxGenericService(); // 用com.alibaba.dubbo.rpc.service.GenericService可以替代所有接口实现<br><br>ServiceConfig&lt;GenericService&gt; service = new ServiceConfig&lt;GenericService&gt;(); // 该实例很重量，里面封装了所有与注册中心及服务提供方连接，请缓存<br>service.setInterface(“com.xxx.XxxService”); // 弱类型接口名<br>service.setVersion(“1.0.0”);<br>service.setRef(xxxService); // 指向一个通用服务实现<br><br>// 暴露及注册服务<br>service.export();]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E5%9B%9E%E5%A3%B0%E6%B5%8B%E8%AF%95"></a>回声测试</h3><br><p>(<a href="Echo+Test-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Echo+Test-zh" title="Echo Test-zh">+</a>) (<a href="#UserGuide-zh-%E5%9B%9E%E5%A3%B0%E6%B5%8B%E8%AF%95">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>回声测试用于检测服务是否可用，回声测试按照正常请求流程执行，能够测试整个调用是否通畅，可用于监控。</td></tr></table></div>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>所有服务自动实现EchoService接口，只需将任意服务引用强制转型为EchoService，即可使用。</td></tr></table></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”memberService” interface=”com.xxx.MemberService” /&gt;]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[MemberService memberService = ctx.getBean(“memberService”); // 远程服务引用<br><br>EchoService echoService = (EchoService) memberService; // 强制转型为EchoService<br><br>String status = echoService.$echo(“OK”); // 回声测试可用性<br><br>assert(status.equals(“OK”))]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF"></a>上下文信息</h3><br><p>(<a href="Rpc+Context-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Rpc+Context-zh" title="Rpc Context-zh">+</a>) (<a href="#UserGuide-zh-%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>上下文中存放的是当前调用过程中所需的环境信息。</td></tr></table></div>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>所有配置信息都将转换为URL的参数，参见《<a href="User+Guide.htm#UserGuide-ConfigurationReference" tppabs="http://dubbo.io/wiki/display/dubbo/User+Guide#UserGuide-ConfigurationReference">配置项一览表</a>》中的“对应URL参数”一列。</td></tr></table></div>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>注意</b><br>RpcContext是一个ThreadLocal的临时状态记录器，当接收到RPC请求，或发起RPC请求时，RpcContext的状态都会变化。<br><br>比如：A调B，B再调C，则B机器上，在B调C之前，RpcContext记录的是A调B的信息，在B调C之后，RpcContext记录的是B调C的信息。</td></tr></table></div>

<h4><a name="UserGuide-zh-%281%29%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E6%96%B9"></a>(1) 服务消费方</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[xxxService.xxx(); // 远程调用<br>boolean isConsumerSide = RpcContext.getContext().isConsumerSide(); // 本端是否为消费端，这里会返回true<br>String serverIP = RpcContext.getContext().getRemoteHost(); // 获取最后一次调用的提供方IP地址<br>String application = RpcContext.getContext().getUrl().getParameter(“application”); // 获取当前服务配置信息，所有配置信息都将转换为URL的参数<br>// …<br>yyyService.yyy(); // 注意：每发起RPC调用，上下文状态会变化<br>// …]]&gt;</script><br></div></div>

<h4><a name="UserGuide-zh-%282%29%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9"></a>(2) 服务提供方</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[public class XxxServiceImpl implements XxxService {<br><br>    public void xxx() { // 服务方法实现<br>        boolean isProviderSide = RpcContext.getContext().isProviderSide(); // 本端是否为提供端，这里会返回true<br>        String clientIP = RpcContext.getContext().getRemoteHost(); // 获取调用方IP地址<br>        String application = RpcContext.getContext().getUrl().getParameter(“application”); // 获取当前服务配置信息，所有配置信息都将转换为URL的参数<br>        // …<br>        yyyService.yyy(); // 注意：每发起RPC调用，上下文状态会变化<br>        boolean isProviderSide = RpcContext.getContext().isProviderSide(); // 此时本端变成消费端，这里会返回false<br>        // …<br>    }<br><br>}]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E9%9A%90%E5%BC%8F%E4%BC%A0%E5%8F%82"></a>隐式传参</h3><br><br><p>(<a href="Attachment+Parameter-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Attachment+Parameter-zh" title="Attachment Parameter-zh">+</a>) (<a href="#UserGuide-zh-%E9%9A%90%E5%BC%8F%E4%BC%A0%E5%8F%82">&#35;</a>)</p><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>注：path,group,version,dubbo,token,timeout几个key有特殊处理，请使用其它key值。</td></tr></table></div>

<p><span class="image-wrap" style=""><img src="context.png-version=1&modificationDate=1320941797000.png" tppabs="http://dubbo.io/wiki/download/attachments/6950004/context.png?version=1&modificationDate=1320941797000" style="border: 0px solid black"></span></p>

<h4><a name="UserGuide-zh-%281%29%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E6%96%B9"></a>(1) 服务消费方</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[RpcContext.getContext().setAttachment(“index”, “1”); // 隐式传参，后面的远程调用都会隐式将这些参数发送到服务器端，类似cookie，用于框架集成，不建议常规业务使用<br>xxxService.xxx(); // 远程调用<br>// …]]&gt;</script><br></div></div>

<p>【注】 setAttachment设置的KV，在完成下面一次远程调用会被清空。即多次远程调用要多次设置。</p>

<h4><a name="UserGuide-zh-%282%29%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9"></a>(2) 服务提供方</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[public class XxxServiceImpl implements XxxService {<br><br>    public void xxx() { // 服务方法实现<br>        String index = RpcContext.getContext().getAttachment(“index”); // 获取客户端隐式传入的参数，用于框架集成，不建议常规业务使用<br>        // …<br>    }<br><br>}]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E5%BC%82%E6%AD%A5%E8%B0%83%E7%94%A8"></a>异步调用</h3><br><p>(<a href="Async+Call-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Async+Call-zh" title="Async Call-zh">+</a>) (<a href="#UserGuide-zh-%E5%BC%82%E6%AD%A5%E8%B0%83%E7%94%A8">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>基于NIO的非阻塞实现并行调用，客户端不需要启动多线程即可完成并行调用多个远程服务，相对多线程开销较小。</td></tr></table></div>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.0.6及其以上版本支持</td></tr></table></div>

<p><span class="image-wrap" style=""><img src="future.jpg-version=1&modificationDate=1320417743000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6949442/future.jpg?version=1&modificationDate=1320417743000" style="border: 0px solid black"></span></p>

<p><b>配置声明：</b></p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>consumer.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”fooService” interface=”com.alibaba.foo.FooService”&gt;<br>      &lt;dubbo:method name=”findFoo” async=”true” /&gt;<br>&lt;/dubbo:reference&gt;<br>&lt;dubbo:reference id=”barService” interface=”com.alibaba.bar.BarService”&gt;<br>      &lt;dubbo:method name=”findBar” async=”true” /&gt;<br>&lt;/dubbo:reference&gt;]]&gt;</script><br></div></div><br><br><p><b>调用代码：</b></p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[fooService.findFoo(fooId); // 此调用会立即返回null<br>Future&lt;Foo&gt; fooFuture = RpcContext.getContext().getFuture(); // 拿到调用的Future引用，当结果返回后，会被通知和设置到此Future。<br><br>barService.findBar(barId); // 此调用会立即返回null<br>Future&lt;Bar&gt; barFuture = RpcContext.getContext().getFuture(); // 拿到调用的Future引用，当结果返回后，会被通知和设置到此Future。<br><br>// 此时findFoo和findBar的请求同时在执行，客户端不需要启动多线程来支持并行，而是借助NIO的非阻塞完成。<br><br>Foo foo = fooFuture.get(); // 如果foo已返回，直接拿到返回值，否则线程wait住，等待foo返回后，线程会被notify唤醒。<br>Bar bar = barFuture.get(); // 同理等待bar返回。<br><br>// 如果foo需要5秒返回，bar需要6秒返回，实际只需等6秒，即可获取到foo和bar，进行接下来的处理。]]&gt;</script><br></div></div><br><br><p>你也可以设置是否等待消息发出：(异步总是不等待返回)</p><br><ul><br>    <li>sent=”true” 等待消息发出，消息发送失败将抛出异常。</li><br>    <li>sent=”false” 不等待消息发出，将消息放入IO队列，即刻返回。<br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:method name=”findFoo” async=”true” sent=”true” /&gt;]]&gt;</script><br></div></div></li><br></ul><br><br><br><p>如果你只是想异步，完全忽略返回值，可以配置return=”false”，以减少Future对象的创建和管理成本：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:method name=”findFoo” async=”true” return=”false” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E6%9C%AC%E5%9C%B0%E8%B0%83%E7%94%A8"></a>本地调用</h3><br><br><p>(<a href="Local+Call-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Local+Call-zh" title="Local Call-zh">+</a>) (<a href="#UserGuide-zh-%E6%9C%AC%E5%9C%B0%E8%B0%83%E7%94%A8">&#35;</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>本地调用，使用了Injvm协议，是一个伪协议，它不开启端口，不发起远程调用，只在JVM内直接关联，但执行Dubbo的Filter链。</td></tr></table></div>

<p>Define injvm protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”injvm” /&gt;]]&gt;</script><br></div></div><br><br><p>Set default protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:provider protocol=”injvm” /&gt;]]&gt;</script><br></div></div><br><br><p>Set service protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service protocol=”injvm” /&gt;]]&gt;</script><br></div></div><br><br><p>Use injvm first:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:consumer injvm=”true” …/&gt;<br>&lt;dubbo:provider injvm=”true” …/&gt;]]&gt;</script><br></div></div><br><p>或</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference injvm=”true” …/&gt;<br>&lt;dubbo:service injvm=”true” …/&gt;]]&gt;</script><br></div></div><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>注意：服务暴露与服务引用都需要声明injvm=”true”</td></tr></table></div><br><br><br><p><a name="UserGuide-zh-automatic"></a><b>自动暴露、引用本地服务</b></p>

<p>从 dubbo 2.2.0 开始，每个服务默认都会在本地暴露；在引用服务的时候，默认优先引用本地服务；如果希望引用远程服务可以使用一下配置强制引用远程服务。</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[…<br>    &lt;dubbo:reference … scope=”remote” /&gt;<br>…]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E5%8F%82%E6%95%B0%E5%9B%9E%E8%B0%83"></a>参数回调</h3><br><p>(<a href="Parameter+Callback-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Parameter+Callback-zh" title="Parameter Callback-zh">+</a>) (<a href="#UserGuide-zh-%E5%8F%82%E6%95%B0%E5%9B%9E%E8%B0%83">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>参数回调方式与调用本地callback或listener相同，只需要在Spring的配置文件中声明哪个参数是callback类型即可，Dubbo将基于长连接生成反向代理，这样就可以从服务器端调用客户端逻辑。</td></tr></table></div>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.0.6及其以上版本支持</td></tr></table></div>

<p>代码参见：<a href="javascript:if(confirm(%27https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/callback  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/callback%27" tppabs="https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/callback" class="external-link" rel="external" target="_blank">https://github.com/alibaba/dubbo/tree/master/dubbo-test/dubbo-test-examples/src/main/java/com/alibaba/dubbo/examples/callback</a></p>

<p><b>(1) 共享服务接口：</b></p>

<p>服务接口示例：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>CallbackService.java</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[package com.callback;<br><br>public interface CallbackService {<br>    void addListener(String key, CallbackListener listener);<br>}]]&gt;</script><br></div></div><br><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>CallbackListener.java</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[package com.callback;<br><br>public interface CallbackListener {<br>    void changed(String msg);<br>}]]&gt;</script><br></div></div><br><br><p><b>(2) 服务提供者：</b></p>

<p>服务提供者接口实现示例：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>CallbackServiceImpl.java</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[package com.callback.impl;<br><br>import java.text.SimpleDateFormat;<br>import java.util.Date;<br>import java.util.Map;<br>import java.util.concurrent.ConcurrentHashMap;<br><br>import com.callback.CallbackListener;<br>import com.callback.CallbackService;<br><br>public class CallbackServiceImpl implements CallbackService {<br><br>    private final Map&lt;String, CallbackListener&gt; listeners = new ConcurrentHashMap&lt;String, CallbackListener&gt;();<br><br>    public CallbackServiceImpl() {<br>        Thread t = new Thread(new Runnable() {<br>            public void run() {<br>                while(true) {<br>                    try {<br>                        for(Map.Entry&lt;String, CallbackListener&gt; entry : listeners.entrySet()){<br>                           try {<br>                               entry.getValue().changed(getChanged(entry.getKey()));<br>                           } catch (Throwable t) {<br>                               listeners.remove(entry.getKey());<br>                           }<br>                        }<br>                        Thread.sleep(5000); // 定时触发变更通知<br>                    } catch (Throwable t) { // 防御容错<br>                        t.printStackTrace();<br>                    }<br>                }<br>            }<br>        });<br>        t.setDaemon(true);<br>        t.start();<br>    }<br><br>    public void addListener(String key, CallbackListener listener) {<br>        listeners.put(key, listener);<br>        listener.changed(getChanged(key)); // 发送变更通知<br>    }<br><br>    private String getChanged(String key) {<br>        return “Changed: “ + new SimpleDateFormat(“yyyy-MM-dd HH:mm:ss”).format(new Date());<br>    }<br><br>}]]&gt;</script><br></div></div><br><br><p>服务提供者配置示例：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;bean id=”callbackService” class=”com.callback.impl.CallbackServiceImpl” /&gt;<br>&lt;dubbo:service interface=”com.callback.CallbackService” ref=”callbackService” connections=”1” callbacks=”1000”&gt;<br>    &lt;dubbo:method name=”addListener”&gt;<br>        &lt;dubbo:argument index=”1” callback=”true” /&gt;<br>        &lt;!–也可以通过指定类型的方式–&gt;<br>        &lt;!–&lt;dubbo:argument type=”com.demo.CallbackListener” callback=”true” /&gt;–&gt;<br>    &lt;/dubbo:method&gt;<br>&lt;/dubbo:service&gt;]]&gt;</script><br></div></div><br><br><p><b>(2) 服务消费者：</b></p>

<p>服务消费者配置示例：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>consumer.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”callbackService” interface=”com.callback.CallbackService” /&gt;]]&gt;</script><br></div></div><br><br><p>服务消费者调用示例：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>CallbackServiceTest.java</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(“classpath:consumer.xml”);<br>context.start();<br><br>CallbackService callbackService = (CallbackService) context.getBean(“callbackService”);<br><br>callbackService.addListener(“<a href="http://dubbo.io/wiki/display/dubbo/foo.bar">http://dubbo.io/wiki/display/dubbo/foo.bar</a>“, new CallbackListener(){<br>    public void changed(String msg) {<br>        System.out.println(“callback1:” + msg);<br>    }<br>});]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E4%BA%8B%E4%BB%B6%E9%80%9A%E7%9F%A5"></a>事件通知</h3><br><p>(<a href="Event+Notify-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Event+Notify-zh" title="Event Notify-zh">+</a>) (<a href="#UserGuide-zh-%E4%BA%8B%E4%BB%B6%E9%80%9A%E7%9F%A5">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>在调用之前，调用之后，出现异常时，会触发oninvoke, onreturn, onthrow三个事件，可以配置当事件发生时，通知哪个类的哪个方法。</td></tr></table></div>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>支持版本：2.0.7之后</td></tr></table></div>

<p><b>(1) 服务提供者与消费者共享服务接口：</b></p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>IDemoService.java</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[interface IDemoService {<br>    public Person get(int id);<br>}]]&gt;</script><br></div></div><br><p><b>(2) 服务提供者实现：</b></p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>DemoServiceImpl.java</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[class NormalDemoService implements IDemoService {<br>    public Person get(int id) {<br>        return new Person(id, “charles`son”, 4);<br>    }<br>}]]&gt;</script><br></div></div><br><p><b>(3) 服务提供者配置：</b></p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>provider.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:application name=”rpc-callback-demo” /&gt;<br>&lt;dubbo:registry address=”<a href="http://dubbo.io/wiki/display/dubbo/10.20.153.186">http://dubbo.io/wiki/display/dubbo/10.20.153.186</a>“ /&gt;<br>&lt;bean id=”demoService” class=”com.alibaba.dubbo.callback.implicit.NormalDemoService” /&gt;<br>&lt;dubbo:service interface=”com.alibaba.dubbo.callback.implicit.IDemoService” ref=”demoService” version=”1.0.0” group=”cn”/&gt;]]&gt;</script><br></div></div><br><p><b>(4) 服务消费者Callback接口及实现：</b></p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Nofify.java</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[interface Nofify {<br>    public void onreturn(Person msg, Integer id);<br>    public void onthrow(Throwable ex, Integer id);<br>}]]&gt;</script><br></div></div><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>NofifyImpl.java</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[class NofifyImpl implements Nofify {<br>    public Map&lt;Integer, Person&gt;    ret    = new HashMap&lt;Integer, Person&gt;();<br>    public Map&lt;Integer, Throwable&gt; errors = new HashMap&lt;Integer, Throwable&gt;();<br>    public void onreturn(Person msg, Integer id) {<br>        System.out.println(“onreturn:” + msg);<br>        ret.put(id, msg);<br>    }<br>    public void onthrow(Throwable ex, Integer id) {<br>        errors.put(id, ex);<br>    }<br>}]]&gt;</script><br></div></div><br><p><b>(5) 服务消费者Callback接口及实现：</b></p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>consumer.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;bean id =”demoCallback” class = “com.alibaba.dubbo.callback.implicit.NofifyImpl” /&gt;<br>&lt;dubbo:reference id=”demoService” interface=”com.alibaba.dubbo.callback.implicit.IDemoService” version=”1.0.0” group=”cn” &gt;<br>      &lt;dubbo:method name=”get” async=”true” onreturn = “demoCallback.onreturn” onthrow=”demoCallback.onthrow” /&gt;<br>&lt;/dubbo:reference&gt;]]&gt;</script><br></div></div><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>注：<br><br>callback与async功能正交分解：<br><br>async=true，表示结果是否马上返回.<br><br>onreturn 表示是否需要回调.<br><br><p>组合情况：(async=false 默认)<br><br>异步回调模式：async=true onreturn=”xxx”<br><br>同步回调模式：async=false onreturn=”xxx”<br><br>异步无回调 ：async=true<br><br>同步无回调 ：async=false</p></td></tr></table></div><br><p><b>(6) TEST CASE：</b></p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Test.java</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[IDemoService demoService = (IDemoService) context.getBean(“demoService”);<br>NofifyImpl notify = (NofifyImpl) context.getBean(“demoCallback”);<br>int requestId = 2;<br>Person ret = demoService.get(requestId);<br>Assert.assertEquals(null, ret);<br>//for Test：只是用来说明callback正常被调用，业务具体实现自行决定.<br>for (int i = 0; i &lt; 10; i++) {<br>    if (!notify.ret.containsKey(requestId)) {<br>        Thread.sleep(200);<br>    } else {<br>        break;<br>    }<br>}<br>Assert.assertEquals(requestId, notify.ret.get(requestId).getId());]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E6%9C%AC%E5%9C%B0%E5%AD%98%E6%A0%B9"></a>本地存根</h3><br><p>(<a href="Stub+Proxy-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Stub+Proxy-zh" title="Stub Proxy-zh">+</a>) (<a href="#UserGuide-zh-%E6%9C%AC%E5%9C%B0%E5%AD%98%E6%A0%B9">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>远程服务后，客户端通常只剩下接口，而实现全在服务器端，但提供方有些时候想在客户端也执行部分逻辑，比如：做ThreadLocal缓存，提前验证参数，调用失败后伪造容错数据等等，此时就需要在API中带上Stub，客户端生成Proxy实，会把Proxy通过构造函数传给Stub，然后把Stub暴露组给用户，Stub可以决定要不要去调Proxy。</td></tr></table></div>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Stub必须有可传入Proxy的构造函数。</td></tr></table></div>

<p><span class="image-wrap" style=""><img src="stub.jpg-version=1&modificationDate=1320417778000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6949448/stub.jpg?version=1&modificationDate=1320417778000" style="border: 0px solid black"></span></p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.foo.BarService” stub=”true” /&gt;]]&gt;</script><br></div></div>

<p>Or:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.foo.BarService” stub=”com.foo.BarServiceStub” /&gt;]]&gt;</script><br></div></div>

<p>api.jar:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: text; gutter: false">&lt;![CDATA[com.foo.BarService<br>com.foo.BarServiceStub // 在API旁边放一个Stub实现，它实现BarService接口，并有一个传入远程BarService实例的构造函数]]&gt;</script><br></div></div><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[package com.foo<br>public class BarServiceStub implements BarService {<br><br>    private final BarService barService;<br><br>    // 构造函数传入真正的远程代理对象<br>    public (BarService barService) {<br>        this.barService = barService;<br>    }<br><br>    public String sayHello(String name) {<br>        // 此代码在客户端执行<br>        // 你可以在客户端做ThreadLocal本地缓存，或预先验证参数是否合法，等等<br>        try {<br>            return barService.sayHello(name);<br>        } catch (Exception e) {<br>            // 你可以容错，可以做任何AOP拦截事项<br>            return “容错数据”;<br>        }<br>    }<br>}]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E6%9C%AC%E5%9C%B0%E4%BC%AA%E8%A3%85"></a>本地伪装</h3><br><p>(<a href="Mock+Proxy-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Mock+Proxy-zh" title="Mock Proxy-zh">+</a>) (<a href="#UserGuide-zh-%E6%9C%AC%E5%9C%B0%E4%BC%AA%E8%A3%85">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Mock通常用于服务降级，比如某验权服务，当服务提供方全部挂掉后，客户端不抛出异常，而是通过Mock数据返回授权失败。</td></tr></table></div>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Mock是Stub的一个子集，便于服务提供方在客户端执行容错逻辑，因经常需要在出现RpcException(比如网络失败，超时等)时进行容错，而在出现业务异常(比如登录用户名密码错误)时不需要容错，如果用Stub，可能就需要捕获并依赖RpcException类，而用Mock就可以不依赖RpcException，因为它的约定就是只有出现RpcException时才执行。</td></tr></table></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.foo.BarService” mock=”true” /&gt;]]&gt;</script><br></div></div>

<p>Or:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.foo.BarService” mock=”com.foo.BarServiceMock” /&gt;]]&gt;</script><br></div></div>

<p>api.jar:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: text; gutter: false">&lt;![CDATA[com.foo.BarService<br>com.foo.BarServiceMock // 在API旁边放一个Mock实现，它实现BarService接口，并有一个无参构造函数]]&gt;</script><br></div></div><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[package com.foo<br>public class BarServiceMock implements BarService {<br><br>    public String sayHello(String name) {<br>        // 你可以伪造容错数据，此方法只在出现RpcException时被执行<br>        return “容错数据”;<br>    }<br>}]]&gt;</script><br></div></div><br><br><p>如果服务的消费方经常需要try-catch捕获异常，如：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[Offer offer = null;<br>try {<br>    offer = offerService.findOffer(offerId);<br>} catch (RpcException e) {<br>   logger.error(e);<br>}]]&gt;</script><br></div></div><br><p>请考虑改为Mock实现，并在Mock中return null。</p>

<p>如果只是想简单的忽略异常，在2.0.11以上版本可用：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.foo.BarService” mock=”return null” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E5%BB%B6%E8%BF%9F%E6%9A%B4%E9%9C%B2"></a>延迟暴露</h3><br><p>(<a href="Delay+Export-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Delay+Export-zh" title="Delay Export-zh">+</a>) (<a href="#UserGuide-zh-%E5%BB%B6%E8%BF%9F%E6%9A%B4%E9%9C%B2">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>如果你的服务需要Warmup时间，比如初始化缓存，等待相关资源就位等，可以使用delay进行延迟暴露。</td></tr></table></div>

<p>延迟5秒暴露服务：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service delay=”5000” /&gt;]]&gt;</script><br></div></div><br><br><p>延迟到Spring初始化完成后，再暴露服务：(基于Spring的ContextRefreshedEvent事件触发暴露)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service delay=”-1” /&gt;]]&gt;</script><br></div></div><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Spring2.x初始化死锁问题</b><br>在Spring解析到&lt;dubbo:service /&gt;时，就已经向外暴露了服务，而Spring还在接着初始化其它Bean。<br><br>如果这时有请求进来，并且服务的实现类里有调用applicationContext.getBean()的用法。<br><br><p>1. 请求线程的applicationContext.getBean()调用，先同步singletonObjects判断Bean是否存在，不存在就同步beanDefinitionMap进行初始化，并再次同步singletonObjects写入Bean实例缓存。<br><br><span class="image-wrap" style=""><img src="lock-get-bean.jpg-version=1&modificationDate=1330949876000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6950732/lock-get-bean.jpg?version=1&modificationDate=1330949876000" style="border: 0px solid black"></span><br><br>2. 而Spring初始化线程，因不需要判断Bean的存在，直接同步beanDefinitionMap进行初始化，并同步singletonObjects写入Bean实例缓存。<br><br><span class="image-wrap" style=""><img src="lock-init-context.jpg-version=1&modificationDate=1330949881000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6950732/lock-init-context.jpg?version=1&modificationDate=1330949881000" style="border: 0px solid black"></span></p>

<p>这样就导致getBean线程，先锁singletonObjects，再锁beanDefinitionMap，再次锁singletonObjects。<br><br>而Spring初始化线程，先锁beanDefinitionMap，再锁singletonObjects。<br><br>反向锁导致线程死锁，不能提供服务，启动不了。</p></td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>规避办法</b><br>1. 强烈建议不要在服务的实现类中有applicationContext.getBean()的调用，全部采用IoC注入的方式使用Spring的Bean。<br><br>2. 如果实在要调getBean()，可以将Dubbo的配置放在Spring的最后加载。<br><br>3. 如果不想依赖配置顺序，可以使用&lt;dubbo:provider deplay=”-1” /&gt;，使Dubbo在Spring容器初始化完后，再暴露服务。<br><br>4. 如果大量使用getBean()，相当于已经把Spring退化为工厂模式在用，可以将Dubbo的服务隔离单独的Spring容器。</td></tr></table></div><br><br><h3><a name="UserGuide-zh-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"></a>并发控制</h3><br><p>(<a href="Concurrent+Control-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Concurrent+Control-zh" title="Concurrent Control-zh">+</a>) (<a href="#UserGuide-zh-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6">#</a>)</p>

<p>限制com.foo.BarService的每个方法，<b>服务器端</b>并发执行（或占用线程池线程数）不能超过10个：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.foo.BarService” executes=”10” /&gt;]]&gt;</script><br></div></div><br><br><p>限制com.foo.BarService的sayHello方法，<b>服务器端</b>并发执行（或占用线程池线程数）不能超过10个：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.foo.BarService”&gt;<br>    &lt;dubbo:method name=”sayHello” executes=”10” /&gt;<br>&lt;/dubbo:service&gt;]]&gt;</script><br></div></div><br><br><p>限制com.foo.BarService的每个方法，每<b>客户端</b>并发执行（或占用连接的请求数）不能超过10个：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.foo.BarService” actives=”10” /&gt;]]&gt;</script><br></div></div><br><p>Or:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.foo.BarService” actives=”10” /&gt;]]&gt;</script><br></div></div><br><br><p>限制com.foo.BarService的sayHello方法，每<b>客户端</b>并发执行（或占用连接的请求数）不能超过10个：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.foo.BarService”&gt;<br>    &lt;dubbo:method name=”sayHello” actives=”10” /&gt;<br>&lt;/dubbo:service&gt;]]&gt;</script><br></div></div><br><p>Or:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.foo.BarService”&gt;<br>    &lt;dubbo:method name=”sayHello” actives=”10” /&gt;<br>&lt;/dubbo:service&gt;]]&gt;</script><br></div></div><br><p>如果&lt;dubbo:service&gt;和&lt;dubbo:reference&gt;都配了actives，&lt;dubbo:reference&gt;优先，参见：<a href="Configuration+Reference.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Configuration+Reference" title="Configuration Reference">配置的覆盖策略</a>。</p>

<p>Load Balance均衡：</p>

<p>配置服务的<b>客户端</b>的loadbalance属性为leastactive，此Loadbalance会调用并发数最小的Provider（Consumer端并发数）。</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.foo.BarService” loadbalance=”leastactive” /&gt;]]&gt;</script><br></div></div><br><p>Or:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.foo.BarService” loadbalance=”leastactive” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E8%BF%9E%E6%8E%A5%E6%8E%A7%E5%88%B6"></a>连接控制</h3><br><p>(<a href="Connection+Control-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Connection+Control-zh" title="Connection Control-zh">+</a>) (<a href="#UserGuide-zh-%E8%BF%9E%E6%8E%A5%E6%8E%A7%E5%88%B6">#</a>)</p><br><br><p>限制<b>服务器端</b>接受的连接不能超过10个：（以连接在Server上，所以配置在Provider上）</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:provider protocol=”dubbo” accepts=”10” /&gt;]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”dubbo” accepts=”10” /&gt;]]&gt;</script><br></div></div>

<p>限制<b>客户端服务</b>使用连接连接数：(如果是长连接，比如Dubbo协议，connections表示该服务对每个提供者建立的长连接数)</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.foo.BarService” connections=”10” /&gt;]]&gt;</script><br></div></div><br><p>Or:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.foo.BarService” connections=”10” /&gt;]]&gt;</script><br></div></div>

<p>如果&lt;dubbo:service&gt;和&lt;dubbo:reference&gt;都配了connections，&lt;dubbo:reference&gt;优先，参见：<a href="Configuration+Reference.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Configuration+Reference" title="Configuration Reference">配置的覆盖策略</a>。</p><br><h3><a name="UserGuide-zh-%E5%BB%B6%E8%BF%9F%E8%BF%9E%E6%8E%A5"></a>延迟连接</h3><br><p>(<a href="Lazy+Connection-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Lazy+Connection-zh" title="Lazy Connection-zh">+</a>) (<a href="#UserGuide-zh-%E5%BB%B6%E8%BF%9F%E8%BF%9E%E6%8E%A5">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>延迟连接，用于减少长连接数，当有调用发起时，再创建长连接。</td></tr></table></div>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>只对使用长连接的dubbo协议生效。</td></tr></table></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”dubbo” lazy=”true” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E7%B2%98%E6%BB%9E%E8%BF%9E%E6%8E%A5"></a>粘滞连接</h3><br><p>(<a href="Sticky+Connection-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Sticky+Connection-zh" title="Sticky Connection-zh">+</a>) (<a href="#UserGuide-zh-%E7%B2%98%E6%BB%9E%E8%BF%9E%E6%8E%A5">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>粘滞连接用于有状态服务，尽可能让客户端总是向同一提供者发起调用，除非该提供者挂了，再连另一台。</td></tr></table></div>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>粘滞连接将自动开启延迟连接，以减少长连接数，参见：<a href="#UserGuide-zh-%E5%BB%B6%E8%BF%9F%E8%BF%9E%E6%8E%A5">延迟连接</a> (<a href="Lazy+Connection-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Lazy+Connection-zh" title="Lazy Connection-zh">+</a>)</td></tr></table></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”dubbo” sticky=”true” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E4%BB%A4%E7%89%8C%E9%AA%8C%E8%AF%81"></a>令牌验证</h3><br><p>(<a href="Token+Verify-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Token+Verify-zh" title="Token Verify-zh">+</a>) (<a href="#UserGuide-zh-%E4%BB%A4%E7%89%8C%E9%AA%8C%E8%AF%81">#</a>)</p><br><br><p><span class="image-wrap" style=""><img src="dubbo-token.jpg-version=1&modificationDate=1326472608000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6950705/dubbo-token.jpg?version=1&modificationDate=1326472608000" style="border: 0px solid black"></span></p><br><br><br><ul><br>    <li>防止消费者绕过注册中心访问提供者</li><br>    <li>在注册中心控制权限，以决定要不要下发令牌给消费者</li><br>    <li>注册中心可灵活改变授权方式，而不需修改或升级提供者</li><br></ul><br><br><br><p>可以全局设置开启令牌验证：</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;!–随机token令牌，使用UUID生成–&gt;<br>&lt;dubbo:provider interface=”com.foo.BarService” token=”true” /&gt;]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;!–固定token令牌，相当于密码–&gt;<br>&lt;dubbo:provider interface=”com.foo.BarService” token=”123456” /&gt;]]&gt;</script><br></div></div>


<p>也可在服务级别设置：</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;!–随机token令牌，使用UUID生成–&gt;<br>&lt;dubbo:service interface=”com.foo.BarService” token=”true” /&gt;]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;!–固定token令牌，相当于密码–&gt;<br>&lt;dubbo:service interface=”com.foo.BarService” token=”123456” /&gt;]]&gt;</script><br></div></div>


<p>还可在协议级别设置：</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;!–随机token令牌，使用UUID生成–&gt;<br>&lt;dubbo:protocol name=”dubbo” token=”true” /&gt;]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;!–固定token令牌，相当于密码–&gt;<br>&lt;dubbo:protocol name=”dubbo” token=”123456” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99"></a>路由规则</h3><br><p>(<a href="Router+Rule-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Router+Rule-zh" title="Router Rule-zh">+</a>) (<a href="#UserGuide-zh-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0">#</a>)</p><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.2.0以上版本支持</td></tr></table></div>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>路由规则扩展点：<a href="Developer+Guide-zh.htm#DeveloperGuide-zh-%E8%B7%AF%E7%94%B1%E6%89%A9%E5%B1%95" tppabs="http://dubbo.io/wiki/display/dubbo/Developer+Guide-zh#DeveloperGuide-zh-%E8%B7%AF%E7%94%B1%E6%89%A9%E5%B1%95">路由扩展</a></td></tr></table></div>

<p>向注册中心写入路由规则：(通常由监控中心或治理中心的页面完成)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[RegistryFactory registryFactory = ExtensionLoader.getExtensionLoader(RegistryFactory.class).getAdaptiveExtension();<br>Registry registry = registryFactory.getRegistry(URL.valueOf(“zookeeper://10.20.153.10:2181”));<br>registry.register(URL.valueOf(“condition://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule=” + URL.encode(“<a href="http://dubbo.io/wiki/display/dubbo/host">http://dubbo.io/wiki/display/dubbo/host</a> = 10.20.153.10 =&gt; host = 10.20.153.11”) + “));]]&gt;</script><br></div></div><br><br><p>其中：</p><br><ul><br>    <li>condition://<br>    <ul><br>        <li>表示路由规则的类型，支持<a href="#UserGuide-zh-%E6%9D%A1%E4%BB%B6%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99">条件路由规则</a>和<a href="#UserGuide-zh-%E8%84%9A%E6%9C%AC%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99">脚本路由规则</a>，可扩展，必填。</li><br>    </ul><br>    </li><br>    <li>0.0.0.0<br>    <ul><br>        <li>表示对所有IP地址生效，如果只想对某个IP的生效，请填入具体IP，必填。</li><br>    </ul><br>    </li><br>    <li>com.foo.BarService<br>    <ul><br>        <li>表示只对指定服务生效，必填。</li><br>    </ul><br>    </li><br>    <li>category=routers<br>    <ul><br>        <li>表示该数据为动态配置类型，必填。</li><br>    </ul><br>    </li><br>    <li>dynamic=false<br>    <ul><br>        <li>表示该数据为持久数据，当注册方退出时，数据依然保存在注册中心，必填。</li><br>    </ul><br>    </li><br>    <li>enabled=true<br>    <ul><br>        <li>覆盖规则是否生效，可不填，缺省生效。</li><br>    </ul><br>    </li><br>    <li>force=false<br>    <ul><br>        <li>当路由结果为空时，是否强制执行，如果不强制执行，路由结果为空的路由规则将自动失效，可不填，缺省为flase。</li><br>    </ul><br>    </li><br>    <li>runtime=false<br>    <ul><br>        <li>是否在每次调用时执行路由规则，否则只在提供者地址列表变更时预先执行并缓存结果，调用时直接从缓存中获取路由结果。</li><br>        <li>如果用了参数路由，必须设为true，需要注意设置会影响调用的性能，可不填，缺省为flase。</li><br>    </ul><br>    </li><br>    <li>priority=1<br>    <ul><br>        <li>路由规则的优先级，用于排序，优先级越大越靠前执行，可不填，缺省为0。</li><br>    </ul><br>    </li><br>    <li>rule=URL.encode(“host = 10.20.153.10 =&gt; host = 10.20.153.11”)<br>    <ul><br>        <li>表示路由规则的内容，必填。</li><br>    </ul><br>    </li><br></ul><br><br><br><h4><a name="UserGuide-zh-%E6%9D%A1%E4%BB%B6%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99"></a>条件路由规则</h4><br><p>(<a href="#UserGuide-zh-%E6%9D%A1%E4%BB%B6%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99">#</a>)</p>

<p>基于条件表达式的路由规则，如：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[host = 10.20.153.10 =&gt; host = 10.20.153.11]]&gt;</script><br></div></div><br><br><p>规则：</p><br><ul><br>    <li>“=&gt;”之前的为消费者匹配条件，所有参数和消费者的URL进行对比，当消费者满足匹配条件时，对该消费者执行后面的过滤规则。</li><br>    <li>“=&gt;”之后为提供者地址列表的过滤条件，所有参数和提供者的URL进行对比，消费者最终只拿到过滤后的地址列表。</li><br>    <li>如果匹配条件为空，表示对所有消费方应用，如：=&gt; host != 10.20.153.11</li><br>    <li>如果过滤条件为空，表示禁止访问，如：host = 10.20.153.10 =&gt;</li><br></ul><br><br><br><p>表达式：</p><br><ul><br>    <li>参数支持：<br>    <ul><br>        <li>服务调用信息，如：method, <del>argument</del> 等 <del>(暂不支持参数路由)</del></li><br>        <li>URL本身的字段，如：protocol, host, port 等</li><br>        <li>以及URL上的所有参数，如：application, organization 等</li><br>    </ul><br>    </li><br>    <li>条件支持：<br>    <ul><br>        <li>等号”=”表示”匹配”，如：host = 10.20.153.10</li><br>        <li>不等号”!=”表示”不匹配”，如：host != 10.20.153.10</li><br>    </ul><br>    </li><br>    <li>值支持：<br>    <ul><br>        <li>以逗号”,”分隔多个值，如：host != 10.20.153.10,10.20.153.11</li><br>        <li>以星号”&#42;”结尾，表示通配，如：host != 10.20.*</li><br>        <li>以美元符”$”开头，表示引用消费者参数，如：host = $host</li><br>    </ul><br>    </li><br></ul><br><br><br><p>示例：</p>

<p>1. 排除预发布机：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[=&gt; host != 172.22.3.91]]&gt;</script><br></div></div><br><br><p>2. 白名单：(注意：一个服务只能有一条白名单规则，否则两条规则交叉，就都被筛选掉了)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[host != 10.20.153.10,10.20.153.11 =&gt;]]&gt;</script><br></div></div><br><br><p>3. 黑名单：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[host = 10.20.153.10,10.20.153.11 =&gt;]]&gt;</script><br></div></div><br><br><p>4. 服务寄宿在应用上，只暴露一部分的机器，防止整个集群挂掉：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[=&gt; host = 172.22.3.1<em>,172.22.3.2</em>]]&gt;</script><br></div></div><br><br><p>5. 为重要应用提供额外的机器：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[application != kylin =&gt; host != 172.22.3.95,172.22.3.96]]&gt;</script><br></div></div><br><br><p>6. 读写分离：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[method = find<em>,list</em>,get<em>,is</em> =&gt; host = 172.22.3.94,172.22.3.95,172.22.3.96]]&gt;</script><br></div></div><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[method != find<em>,list</em>,get<em>,is</em> =&gt; host = 172.22.3.97,172.22.3.98]]&gt;</script><br></div></div><br><br><p>7. 前后台分离：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[application = bops =&gt; host = 172.22.3.91,172.22.3.92,172.22.3.93]]&gt;</script><br></div></div><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[application != bops =&gt; host = 172.22.3.94,172.22.3.95,172.22.3.96]]&gt;</script><br></div></div><br><br><p>8. 隔离不同机房网段：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[host != 172.22.3.<em> =&gt; host != 172.22.3.</em>]]&gt;</script><br></div></div><br><br><p>9. 提供者与消费者部署在同集群内，本机只访问本机的服务：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[=&gt; host = $host]]&gt;</script><br></div></div><br><br><h4><a name="UserGuide-zh-%E8%84%9A%E6%9C%AC%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99"></a>脚本路由规则</h4><br><p>(<a href="#UserGuide-zh-%E8%84%9A%E6%9C%AC%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>支持<a href="javascript:if(confirm(%27http://java.sun.com/developer/technicalArticles/J2SE/Desktop/scripting  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://java.sun.com/developer/technicalArticles/J2SE/Desktop/scripting%27" tppabs="http://java.sun.com/developer/technicalArticles/J2SE/Desktop/scripting" class="external-link" rel="external" target="_blank">JDK脚本引擎</a>的所有脚本，比如：javascript,jruby,groovy等，通过type=javascript参数设置脚本类型，缺省为javascript。</td></tr></table></div>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>脚本没有沙箱约束，可执行任意代码，存在后门风险</td></tr></table></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[“script://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule=” + URL.encode(“function route(invokers) { … } (invokers)”)]]&gt;</script><br></div></div>

<p>基于脚本引擎的路由规则，如：</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: javascript; gutter: false">&lt;![CDATA[function route(invokers) {<br>    var result = new java.util.ArrayList(invokers.size());<br>    for (i = 0; i &lt; invokers.size(); i ++) {<br>        if (“<a href="http://dubbo.io/wiki/display/dubbo/10.20.153.10&quot;.equals(invokers.get(i).getUrl().getHost(">http://dubbo.io/wiki/display/dubbo/10.20.153.10&quot;.equals(invokers.get(i).getUrl().getHost(</a>))) {<br>            result.add(invokers.get(i));<br>        }<br>    }<br>    return result;<br>} (invokers); // 表示立即执行方法]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E9%85%8D%E7%BD%AE%E8%A7%84%E5%88%99"></a>配置规则</h3><br><p>(<a href="Configurator+Rule-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Configurator+Rule-zh" title="Configurator Rule-zh">+</a>) (<a href="#UserGuide-zh-%E9%85%8D%E7%BD%AE%E8%A7%84%E5%88%99">#</a>)</p><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.2.0以上版本支持</td></tr></table></div>

<p>向注册中心写入动态配置覆盖规则：(通常由监控中心或治理中心的页面完成)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[RegistryFactory registryFactory = ExtensionLoader.getExtensionLoader(RegistryFactory.class).getAdaptiveExtension();<br>Registry registry = registryFactory.getRegistry(URL.valueOf(“zookeeper://10.20.153.10:2181”));<br>registry.register(URL.valueOf(“override://0.0.0.0/com.foo.BarService?category=configurators&amp;dynamic=false&amp;application=foo&amp;timeout=1000”));]]&gt;</script><br></div></div><br><br><p>其中：</p><br><ul><br>    <li>override://<br>    <ul><br>        <li>表示数据采用覆盖方式，支持override和absent，可扩展，必填。</li><br>    </ul><br>    </li><br>    <li>0.0.0.0<br>    <ul><br>        <li>表示对所有IP地址生效，如果只想覆盖某个IP的数据，请填入具体IP，必填。</li><br>    </ul><br>    </li><br>    <li>com.foo.BarService<br>    <ul><br>        <li>表示只对指定服务生效，必填。</li><br>    </ul><br>    </li><br>    <li>category=configurators<br>    <ul><br>        <li>表示该数据为动态配置类型，必填。</li><br>    </ul><br>    </li><br>    <li>dynamic=false<br>    <ul><br>        <li>表示该数据为持久数据，当注册方退出时，数据依然保存在注册中心，必填。</li><br>    </ul><br>    </li><br>    <li>enabled=true<br>    <ul><br>        <li>覆盖规则是否生效，可不填，缺省生效。</li><br>    </ul><br>    </li><br>    <li>application=foo<br>    <ul><br>        <li>表示只对指定应用生效，可不填，表示对所有应用生效。</li><br>    </ul><br>    </li><br>    <li>timeout=1000<br>    <ul><br>        <li>表示将满足以上条件的timeout参数的值覆盖为1000。</li><br>        <li>如果想覆盖其它参数，直接加在override的URL参数上。</li><br>    </ul><br>    </li><br></ul><br><br><br><p>示例：</p>

<p>1. 禁用提供者：(通常用于临时踢除某台提供者机器，相似的，禁止消费者访问请使用<a href="User+Guide-zh.htm#UserGuide-zh-%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99" tppabs="http://dubbo.io/wiki/display/dubbo/User+Guide-zh#UserGuide-zh-%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99">路由规则</a>)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false"><a href="![CDATA[override://10.20.153.10/com.foo.BarService?category=configurators&amp;dynamic=false&amp;disbaled=true]]">![CDATA[override://10.20.153.10/com.foo.BarService?category=configurators&amp;dynamic=false&amp;disbaled=true]]</a></script><br></div></div><br><br><p>2. 调整权重：(通常用于容量评估，缺省权重为100)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false"><a href="![CDATA[override://10.20.153.10/com.foo.BarService?category=configurators&amp;dynamic=false&amp;weight=200]]">![CDATA[override://10.20.153.10/com.foo.BarService?category=configurators&amp;dynamic=false&amp;weight=200]]</a></script><br></div></div><br><br><p>3. 调整负载均衡策略：(缺省负载均衡策略为random)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false"><a href="![CDATA[override://10.20.153.10/com.foo.BarService?category=configurators&amp;dynamic=false&amp;loadbalance=leastactive]]">![CDATA[override://10.20.153.10/com.foo.BarService?category=configurators&amp;dynamic=false&amp;loadbalance=leastactive]]</a></script><br></div></div><br><br><p>4. 服务降级：(通常用于临时屏蔽某个出错的非关键服务)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false"><a href="![CDATA[override://0.0.0.0/com.foo.BarService?category=configurators&amp;dynamic=false&amp;application=foo&amp;mock=force:return+null]]">![CDATA[override://0.0.0.0/com.foo.BarService?category=configurators&amp;dynamic=false&amp;application=foo&amp;mock=force:return+null]]</a></script><br></div></div><br><h3><a name="UserGuide-zh-%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7"></a>服务降级</h3><br><p>(<a href="Service+Degradation-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Service+Degradation-zh" title="Service Degradation-zh">+</a>) (<a href="#UserGuide-zh-%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7">#</a>)</p>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.2.0以上版本支持</td></tr></table></div>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>参见：<a href="#UserGuide-zh-%E9%85%8D%E7%BD%AE%E8%A7%84%E5%88%99">配置规则</a></td></tr></table></div>

<p>向注册中心写入动态配置覆盖规则：(通过由监控中心或治理中心的页面完成)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[RegistryFactory registryFactory = ExtensionLoader.getExtensionLoader(RegistryFactory.class).getAdaptiveExtension();<br>Registry registry = registryFactory.getRegistry(URL.valueOf(“zookeeper://10.20.153.10:2181”));<br>registry.register(URL.valueOf(“override://0.0.0.0/com.foo.BarService?category=configurators&amp;dynamic=false&amp;application=foo&amp;mock=force:return+null”));]]&gt;</script><br></div></div><br><br><p>其中：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[mock=force:return+null]]&gt;</script><br></div></div><br><ul><br>    <li>表示消费方对该服务的方法调用都直接返回null值，不发起远程调用。</li><br>    <li>屏蔽不重要服务不可用时对调用方的影响。</li><br></ul><br><br><br><p>还可以改为：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[mock=fail:return+null]]&gt;</script><br></div></div><br><ul><br>    <li>表示消费方对该服务的方法调用在失败后，再返回null值，不抛异常。</li><br>    <li>容忍不重要服务不稳定时对调用方的影响。</li><br></ul><br><br><h3><a name="UserGuide-zh-%E4%BC%98%E9%9B%85%E5%81%9C%E6%9C%BA"></a>优雅停机</h3><br><p>(<a href="Graceful+Shutdown-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Graceful+Shutdown-zh" title="Graceful Shutdown-zh">+</a>) (<a href="#UserGuide-zh-%E4%BC%98%E9%9B%85%E5%81%9C%E6%9C%BA">#</a>)</p>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Dubbo是通过JDK的ShutdownHook来完成优雅停机的，所以如果用户使用”kill -9 PID”等强制关闭指令，是不会执行优雅停机的，只有通过”kill PID”时，才会执行。</td></tr></table></div>

<p>原理：</p><br><ul><br>    <li>服务提供方<br>    <ul><br>        <li>停止时，先标记为不接收新请求，新请求过来时直接报错，让客户端重试其它机器。</li><br>        <li>然后，检测线程池中的线程是否正在运行，如果有，等待所有线程执行完成，除非超时，则强制关闭。</li><br>    </ul><br>    </li><br>    <li>服务消费方<br>    <ul><br>        <li>停止时，不再发起新的调用请求，所有新的调用在客户端即报错。</li><br>        <li>然后，检测有没有请求的响应还没有返回，等待响应返回，除非超时，则强制关闭。</li><br>    </ul><br>    </li><br></ul><br><br><br><p>设置优雅停机超时时间，缺省超时时间是<font color="brown">10秒</font>：(超时则强制关闭)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:application …&gt;<br>    &lt;dubbo:parameter key=”shutdown.timeout” value=”60000” /&gt; &lt;!– 单位毫秒 –&gt;<br>&lt;/dubbo:application&gt;]]&gt;</script><br></div></div><br><br><p>如果ShutdownHook不能生效，可以自行调用：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[ProtocolConfig.destroyAll();]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E4%B8%BB%E6%9C%BA%E7%BB%91%E5%AE%9A"></a>主机绑定</h3><br><p>(<a href="Host+Binding-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Host+Binding-zh" title="Host Binding-zh">+</a>) (<a href="#UserGuide-zh-%E4%B8%BB%E6%9C%BA%E7%BB%91%E5%AE%9A">#</a>)</p>


<p>缺省主机IP查找顺序：</p><br><ul><br>    <li>通过LocalHost.getLocalHost()获取本机地址。</li><br>    <li>如果是127.*等loopback地址，则扫描各网卡，获取网卡IP。</li><br></ul><br><br><br><p>注册的地址如果获取不正确，比如需要注册公网地址，可以：<br><br>1. 可以在/etc/hosts中加入：机器名 公网IP，比如：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[test1 205.182.23.201]]&gt;</script><br></div></div><br><p>2. 在dubbo.xml中加入主机地址的配置：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol host=”<a href="http://dubbo.io/wiki/display/dubbo/205.182.23.201&quot;&gt;]]&gt;">http://dubbo.io/wiki/display/dubbo/205.182.23.201&quot;&gt;]]&gt;</a></script><br></div></div><br><p>3. 或在dubbo.properties中加入主机地址的配置：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[dubbo.protocol.host=205.182.23.201]]&gt;</script><br></div></div><br><br><p>缺省主机端口与协议相关：</p><br><ul><br>    <li>dubbo: 20880</li><br>    <li>rmi: 1099</li><br>    <li>http: 80</li><br>    <li>hessian: 80</li><br>    <li>webservice: 80</li><br>    <li>memcached: 11211</li><br>    <li>redis: 6379</li><br></ul><br><br><br><p>主机端口配置：</p>

<p>1. 在dubbo.xml中加入主机地址的配置：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”dubbo” port=”20880”&gt;]]&gt;</script><br></div></div><br><p>3. 或在dubbo.properties中加入主机地址的配置：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[dubbo.protocol.dubbo.port=20880]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E6%97%A5%E5%BF%97%E9%80%82%E9%85%8D"></a>日志适配</h3><br><p>(<a href="Logger+Adpater-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Logger+Adpater-zh" title="Logger Adpater-zh">+</a>) (<a href="#UserGuide-zh-%E6%97%A5%E5%BF%97%E9%80%82%E9%85%8D">#</a>)</p>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.2.1以上版本支持</td></tr></table></div>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>扩展点：<a href="Developer+Guide-zh.htm#DeveloperGuide-zh-%E6%97%A5%E5%BF%97%E9%80%82%E9%85%8D%E6%89%A9%E5%B1%95" tppabs="http://dubbo.io/wiki/display/dubbo/Developer+Guide-zh#DeveloperGuide-zh-%E6%97%A5%E5%BF%97%E9%80%82%E9%85%8D%E6%89%A9%E5%B1%95">日志适配扩展</a></td></tr></table></div>

<p>缺省自动查找：</p><br><ul><br>    <li>log4j</li><br>    <li>slf4j</li><br>    <li>jcl</li><br>    <li>jdk</li><br></ul><br><br><br><p>可以通过以下方式配置日志输出策略：</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[java -Ddubbo.application.logger=log4j]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>dubbo.properties</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[dubbo.application.logger=log4j]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>dubbo.xml</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[&lt;dubbo:application logger=”log4j” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97"></a>访问日志</h3><br><p>(<a href="Access+Log-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Access+Log-zh" title="Access Log-zh">+</a>) (<a href="#UserGuide-zh-%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>如果你想记录每一次请求信息，可开启访问日志，类似于apache的访问日志。</td></tr></table></div>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>此日志量比较大，请注意磁盘容量。</td></tr></table></div>

<p>将访问日志输出到当前应用的log4j日志：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol accesslog=”true” /&gt;]]&gt;</script><br></div></div><br><br><p>将访问日志输出到指定文件：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol accesslog=”<a href="http://dubbo.io/wiki/display/dubbo/foo/bar.log">http://dubbo.io/wiki/display/dubbo/foo/bar.log</a>“ /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8"></a>服务容器</h3><br><p>(<a href="Service+Container-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Service+Container-zh" title="Service Container-zh">+</a>) (<a href="#UserGuide-zh-%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>服务容器是一个standalone的启动程序，因为后台服务不需要Tomcat或JBoss等Web容器的功能，如果硬要用Web容器去加载服务提供方，增加复杂性，也浪费资源。</td></tr></table></div>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>服务容器只是一个简单的Main方法，并加载一个简单的Spring容器，用于暴露服务。</td></tr></table></div>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>服务容器的加载内容可以扩展，内置了spring, jetty, log4j等加载，可通过Container扩展点进行扩展，参见：<a href="Developer+Guide.htm#DeveloperGuide-Container" tppabs="http://dubbo.io/wiki/display/dubbo/Developer+Guide#DeveloperGuide-Container">Container</a></td></tr></table></div>

<h6><a name="UserGuide-zh-SpringContainer"></a>Spring Container</h6>

<ul><br>    <li>自动加载META-INF/spring目录下的所有Spring配置。</li><br>    <li>配置：(配在java命令-D参数或者dubbo.properties中)<br>    <ul><br>        <li>dubbo.spring.config=classpath<em>:META-INF/spring/</em>.xml  —-配置spring配置加载位置</li><br>    </ul><br>    </li><br></ul>


<h6><a name="UserGuide-zh-JettyContainer"></a>Jetty Container</h6>

<ul><br>    <li>启动一个内嵌Jetty，用于汇报状态。</li><br>    <li>配置：(配在java命令-D参数或者dubbo.properties中)<br>    <ul><br>        <li>dubbo.jetty.port=8080                   —-配置jetty启动端口</li><br>        <li>dubbo.jetty.directory=/foo/bar          —-配置可通过jetty直接访问的目录，用于存放静态文件</li><br>        <li>dubbo.jetty.page=log,status,system      —-配置显示的页面，缺省加载所有页面</li><br>    </ul><br>    </li><br></ul>


<h6><a name="UserGuide-zh-Log4jContainer"></a>Log4j Container</h6>

<ul><br>    <li>自动配置log4j的配置，在多进程启动时，自动给日志文件按进程分目录。</li><br>    <li>配置：(配在java命令-D参数或者dubbo.properties中)<br>    <ul><br>        <li>dubbo.log4j.file=/foo/bar.log       —-配置日志文件路径</li><br>        <li>dubbo.log4j.level=WARN              —-配置日志级别</li><br>        <li>dubbo.log4j.subdirectory=20880      —-配置日志子目录，用于多进程启动，避免冲突</li><br>    </ul><br>    </li><br></ul>


<p><b>容器启动</b></p>

<p>如：(缺省只加载spring)</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[java com.alibaba.dubbo.container.Main]]&gt;</script><br></div></div>

<p>或：(通过main函数参数传入要加载的容器)</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[java com.alibaba.dubbo.container.Main spring jetty log4j]]&gt;</script><br></div></div>

<p>或：(通过JVM启动参数传入要加载的容器)</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[java com.alibaba.dubbo.container.Main -Ddubbo.container=spring,jetty,log4j]]&gt;</script><br></div></div>

<p>或：(通过classpath下的dubbo.properties配置传入要加载的容器)</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>dubbo.properties</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[dubbo.container=spring,jetty,log4j]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-ReferenceConfig%E7%BC%93%E5%AD%98"></a>Reference Config缓存</h3><br><p>(<a href="Reference+Config+Cache-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Reference+Config+Cache-zh" title="Reference Config Cache-zh">+</a>) (<a href="#UserGuide-zh-ReferenceConfig%E7%BC%93%E5%AD%98">#</a>)</p><br><br><p>ReferenceConfig实例很重，封装了与注册中心的连接以及与提供者的连接，需要缓存，否则重复生成ReferenceConfig可能造成性能问题并且会有内存和连接泄漏。API方式编程时，容易忽略此问题。</p><br><br><p>Dubbo <font color="brown">2.4.0+</font>版本，提供了简单的工具类ReferenceConfigCache用于缓存ReferenceConfig实例。</p><br><br><p>使用方式如下：</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[ReferenceConfig&lt;XxxService&gt; reference = new ReferenceConfig&lt;XxxService&gt;();<br>reference.setInterface(XxxService.class);<br>reference.setVersion(“1.0.0”);<br>……<br><br><br>ReferenceConfigCache cache = ReferenceConfigCache.getCache();<br>XxxService xxxService = cache.get(reference); // cache.get方法中会Cache Reference对象，并且调用ReferenceConfig.get方法启动ReferenceConfig<br>// 注意！ Cache会持有ReferenceConfig，不要在外部再调用ReferenceConfig的destroy方法，导致Cache内的ReferenceConfig失效！<br><br>// 使用xxxService对象<br>xxxService.sayHello();]]&gt;</script><br></div></div>

<p>消除Cache中的ReferenceConfig，销毁ReferenceConfig并释放对应的资源。</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[ReferenceConfigCache cache = ReferenceConfigCache.getCache();<br>cache.destroy(reference);]]&gt;</script><br></div></div>

<p>缺省ReferenceConfigCache把相同服务Group、接口、版本的ReferenceConfig认为是相同，缓存一份。即以服务Group、接口、版本为缓存的Key。</p>

<p>可以修改这个策略，在ReferenceConfigCache.getCache时，传一个KeyGenerator。详见ReferenceConfigCache类的方法。</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[KeyGenerator keyGenerator = new …<br><br>ReferenceConfigCache cache = ReferenceConfigCache.getCache(keyGenerator );]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1"></a>分布式事务</h3><br><p>(<a href="Distributed+Transaction-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Distributed+Transaction-zh" title="Distributed Transaction-zh">+</a>) (<a href="#UserGuide-zh-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>基于JTA/XA规范实现。</td></tr></table></div>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>暂未实现。</td></tr></table></div>

<p>两阶段提交：</p>

<p><span class="image-wrap" style=""><img src="jta-xa.jpg-version=1&modificationDate=1333185059000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6950008/jta-xa.jpg?version=1&modificationDate=1333185059000" style="border: 0px solid black"></span></p><br><h2><a name="UserGuide-zh-API%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C"></a>API参考手册</h2><br><p>(<a href="API+Reference-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/API+Reference-zh" title="API Reference-zh">+</a>) (<a href="#UserGuide-zh-API%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Dubbo的常规功能，都保持零侵入，但有些功能不得不用API侵入才能实现。</td></tr></table></div>

<div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Dubbo中除这里声明以外的接口或类，都是内部接口或扩展接口，普通用户请不要直接依赖，否则升级版本可能出现不兼容。</td></tr></table></div>

<p>API汇总如下：</p>

<h3><a name="UserGuide-zh-%E9%85%8D%E7%BD%AEAPI"></a>配置API</h3><br><ul><br>    <li>com.alibaba.dubbo.config.ServiceConfig</li><br>    <li>com.alibaba.dubbo.config.ReferenceConfig</li><br>    <li>com.alibaba.dubbo.config.ProtocolConfig</li><br>    <li>com.alibaba.dubbo.config.RegistryConfig</li><br>    <li>com.alibaba.dubbo.config.MonitorConfig</li><br>    <li>com.alibaba.dubbo.config.ApplicationConfig</li><br>    <li>com.alibaba.dubbo.config.ModuleConfig</li><br>    <li>com.alibaba.dubbo.config.ProviderConfig</li><br>    <li>com.alibaba.dubbo.config.ConsumerConfig</li><br>    <li>com.alibaba.dubbo.config.MethodConfig</li><br>    <li>com.alibaba.dubbo.config.ArgumentConfig<br>    <ul><br>        <li>参见：<a href="#UserGuide-zh-API%E9%85%8D%E7%BD%AE">API配置</a></li><br>    </ul><br>    </li><br></ul><br><br><br><h3><a name="UserGuide-zh-%E6%B3%A8%E8%A7%A3API"></a>注解API</h3><br><ul><br>    <li>com.alibaba.dubbo.config.annotation.Service</li><br>    <li>com.alibaba.dubbo.config.annotation.Reference<br>    <ul><br>        <li>参见：<a href="#UserGuide-zh-%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE">注解配置</a></li><br>    </ul><br>    </li><br></ul><br><br><br><h3><a name="UserGuide-zh-%E6%A8%A1%E5%9E%8BAPI"></a>模型API</h3><br><ul><br>    <li>com.alibaba.dubbo.common.URL</li><br>    <li>com.alibaba.dubbo.rpc.RpcException</li><br></ul><br><br><br><h3><a name="UserGuide-zh-%E4%B8%8A%E4%B8%8B%E6%96%87API"></a>上下文API</h3><br><ul><br>    <li>com.alibaba.dubbo.rpc.RpcContext<br>    <ul><br>        <li>参见：<a href="#UserGuide-zh-%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF">上下文信息</a> &amp; <a href="#UserGuide-zh-%E5%AF%B9%E6%96%B9%E5%9C%B0%E5%9D%80">对方地址</a> &amp; <a href="#UserGuide-zh-%E9%9A%90%E5%BC%8F%E4%BC%A0%E5%8F%82">隐式传参</a> &amp; <a href="#UserGuide-zh-%E5%BC%82%E6%AD%A5%E8%B0%83%E7%94%A8">异步调用</a></li><br>    </ul><br>    </li><br></ul><br><br><br><h3><a name="UserGuide-zh-%E6%9C%8D%E5%8A%A1API"></a>服务API</h3><br><ul><br>    <li>com.alibaba.dubbo.rpc.service.GenericService</li><br>    <li>com.alibaba.dubbo.rpc.service.GenericException<br>    <ul><br>        <li>参见：<a href="#UserGuide-zh-%E6%B3%9B%E5%8C%96%E5%BC%95%E7%94%A8">泛化引用</a> &amp; <a href="#UserGuide-zh-%E6%B3%9B%E5%8C%96%E5%AE%9E%E7%8E%B0">泛化实现</a></li><br>    </ul><br>    </li><br>    <li>com.alibaba.dubbo.rpc.service.EchoService<br>    <ul><br>        <li>参见：<a href="#UserGuide-zh-%E5%9B%9E%E5%A3%B0%E6%B5%8B%E8%AF%95">回声测试</a></li><br>    </ul><br>    </li><br></ul><br><br><h2><a name="UserGuide-zh-%E9%85%8D%E7%BD%AE%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C"></a>配置参考手册 </h2><br><br><p>(<a href="Configuration+Reference-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Configuration+Reference-zh" title="Configuration Reference-zh">+</a>) (<a href="#UserGuide-zh-%E9%85%8D%E7%BD%AE%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">#</a>) </p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>这里以<a href="#UserGuide-zh-Xml%E9%85%8D%E7%BD%AE">Xml配置</a>为准，列举所有配置项，其它配置方式，请参见相应转换关系：<a href="#UserGuide-zh-%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE">属性配置</a>，<a href="#UserGuide-zh-%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE">注解配置</a>，<a href="#UserGuide-zh-API%E9%85%8D%E7%BD%AE">API配置</a></td></tr></table></div><br><br><p><font color="red">注意：只有group，interface，version是服务的匹配条件，三者决定是不是同一个服务，其它配置项均为调优和治理参数。</font></p><br><br><p>所有配置项分为三大类，参见下表中的”作用”一列。</p><br><ul><br>    <li>服务发现：表示该配置项用于服务的注册与发现，目的是让消费方找到提供方。</li><br>    <li>服务治理：表示该配置项用于治理服务间的关系，或为开发测试提供便利条件。</li><br>    <li>性能调优：表示该配置项用于调优性能，不同的选项对性能会产生影响。</li><br></ul><br><br><br><p>所有配置最终都将转换为URL表示，并由服务提供方生成，经注册中心传递给消费方，各属性对应URL的参数，参见配置项一览表中的”对应URL参数”列。<br><br>URL格式：</p><br><div class="panel" style="border-width: 1px;"><div class="panelContent"><br><p>protocol://username:password@host:port/path?key=value&amp;key=value</p><br></div></div><br><br><p>Schema: <a href="javascript:if(confirm(%27http://code.alibabatech.com/schema/dubbo/dubbo.xsd  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://code.alibabatech.com/schema/dubbo/dubbo.xsd%27" tppabs="http://code.alibabatech.com/schema/dubbo/dubbo.xsd" class="external-link" rel="external" target="_blank">http://code.alibabatech.com/schema/dubbo/dubbo.xsd</a></p><br><br><h3><a name="UserGuide-zh-%3Cdubbo%3Aservice%2F%3E"></a>&lt;dubbo:service/&gt;</h3>

<p>(<a href="Service+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Service+Config-zh" title="Service Config-zh">+</a>) (<a href="#UserGuide-zh-%253Cdubbo%253Aservice%252F%253E">&#35;</a>)</p>

<p>服务提供者暴露服务配置：<br><br>配置类：com.alibaba.dubbo.config.ServiceConfig</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> 标签 </th><br><th class="confluenceTh"> 属性 </th><br><th class="confluenceTh"> 对应URL参数 </th><br><th class="confluenceTh"> 类型 </th><br><th class="confluenceTh"> 是否必填 </th><br><th class="confluenceTh"> 缺省值 </th><br><th class="confluenceTh"> 作用 </th><br><th class="confluenceTh"> 描述 </th><br><th class="confluenceTh"> 兼容性 </th><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> interface </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> class </td><br><td class="confluenceTd"> <b>必填</b> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 服务接口名 </td><br><td class="confluenceTd"> 1.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> ref </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> object </td><br><td class="confluenceTd"> <b>必填</b> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 服务对象实现引用 </td><br><td class="confluenceTd"> 1.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> version </td><br><td class="confluenceTd"> version </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0.0.0 </td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 服务版本，建议使用两位数字版本，如：1.0，通常在接口不兼容时版本号才需要升级 </td><br><td class="confluenceTd"> 1.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> group </td><br><td class="confluenceTd"> group </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 服务分组，当一个接口有多个实现，可以用分组区分 </td><br><td class="confluenceTd"> 1.0.7以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> path </td><br><td class="confluenceTd"> &lt;path&gt; </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省为接口名 </td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 服务路径 (注意：1.0不支持自定义路径，总是使用接口名，如果有1.0调2.0，配置服务路径可能不兼容) </td><br><td class="confluenceTd"> 1.0.12以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> delay </td><br><td class="confluenceTd"> delay </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 延迟注册服务时间(毫秒) ，设为-1时，表示延迟到Spring容器初始化完成时暴露服务 </td><br><td class="confluenceTd"> 1.0.14以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> timeout </td><br><td class="confluenceTd"> timeout </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 1000 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 远程服务调用超时时间(毫秒) </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> retries </td><br><td class="confluenceTd"> retries </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 2 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 远程服务调用重试次数，不包括第一次调用，不需要重试请设为0 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> connections </td><br><td class="confluenceTd"> connections </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 100 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 对每个提供者的最大连接数，rmi、http、hessian等短连接协议表示限制连接数，dubbo等长连接协表示建立的长连接个数 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> loadbalance </td><br><td class="confluenceTd"> loadbalance </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> random </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 负载均衡策略，可选值：random,roundrobin,leastactive，分别表示：随机，轮循，最少活跃调用 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> async </td><br><td class="confluenceTd"> async </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 是否缺省异步执行，不可靠异步，只是忽略返回值，不阻塞执行线程 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> stub </td><br><td class="confluenceTd"> stub </td><br><td class="confluenceTd"> class/boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 设为true，表示使用缺省代理类名，即：接口名 + Local后缀，服务接口客户端本地代理类名，用于在客户端执行本地逻辑，如本地缓存等，该本地代理类的构造函数必须允许传入远程代理对象，构造函数如：public XxxServiceLocal(XxxService xxxService) </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> mock </td><br><td class="confluenceTd"> mock </td><br><td class="confluenceTd"> class/boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 设为true，表示使用缺省Mock类名，即：接口名 + Mock后缀，服务接口调用失败Mock实现类，该Mock类必须有一个无参构造函数，与Local的区别在于，Local总是被执行，而Mock只在出现非业务异常(比如超时，网络异常等)时执行，Local在远程调用之前执行，Mock在远程调用后执行。 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> token </td><br><td class="confluenceTd"> token </td><br><td class="confluenceTd"> string/boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 令牌验证，为空表示不开启，如果为true，表示随机生成动态令牌，否则使用静态令牌，令牌的作用是防止消费者绕过注册中心直接访问，保证注册中心的授权功能有效，如果使用点对点调用，需关闭令牌功能 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> registry </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省向所有registry注册 </td><br><td class="confluenceTd"> 配置关联 </td><br><td class="confluenceTd"> 向指定注册中心注册，在多个注册中心时使用，值为&lt;dubbo:registry&gt;的id属性，多个注册中心ID用逗号分隔，如果不想将该服务注册到任何registry，可将值设为N/A </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> provider </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺使用第一个provider配置 </td><br><td class="confluenceTd"> 配置关联 </td><br><td class="confluenceTd"> 指定provider，值为&lt;dubbo:provider&gt;的id属性 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> deprecated </td><br><td class="confluenceTd"> deprecated </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务是否过时，如果设为true，消费方引用时将打印服务过时警告error日志 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> dynamic </td><br><td class="confluenceTd"> dynamic </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> true </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务是否动态注册，如果设为false，注册后将显示后disable状态，需人工启用，并且服务提供者停止时，也不会自动取消册，需人工禁用。 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> accesslog </td><br><td class="confluenceTd"> accesslog </td><br><td class="confluenceTd"> string/boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 设为true，将向logger中输出访问日志，也可填写访问日志文件路径，直接把访问日志输出到指定文件 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> owner </td><br><td class="confluenceTd"> owner </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务负责人，用于服务治理，请填写负责人公司邮箱前缀 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> document </td><br><td class="confluenceTd"> document </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务文档URL </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> weight </td><br><td class="confluenceTd"> weight </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务权重 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> executes </td><br><td class="confluenceTd"> executes </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务提供者每服务每方法最大可并行执行请求数 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> actives </td><br><td class="confluenceTd"> actives </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 每服务消费者每服务每方法最大并发调用数 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> proxy </td><br><td class="confluenceTd"> proxy </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> javassist </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 生成动态代理方式，可选：jdk/javassist </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> cluster </td><br><td class="confluenceTd"> cluster </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> failover </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 集群方式，可选：failover/failfast/failsafe/failback/forking </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> filter </td><br><td class="confluenceTd"> service.filter </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> default </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务提供方远程调用过程拦截器名称，多个名称用逗号分隔 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> listener </td><br><td class="confluenceTd"> exporter.listener </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> default </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务提供方导出服务监听器名称，多个名称用逗号分隔 </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> protocol </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 配置关联 </td><br><td class="confluenceTd"> 使用指定的协议暴露服务，在多协议时使用，值为&lt;dubbo:protocol&gt;的id属性，多个协议ID用逗号分隔 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> layer </td><br><td class="confluenceTd"> layer </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务提供者所在的分层。如：biz、dao、intl:web、china:acton。 </td><br><td class="confluenceTd"> 2.0.7以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> register </td><br><td class="confluenceTd"> register </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> true </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 该协议的服务是否注册到注册中心 </td><br><td class="confluenceTd"> 2.0.8以上版本 </td><br></tr><br></tbody></table><br></div><br><br><h3><a name="UserGuide-zh-%3Cdubbo%3Areference%2F%3E"></a>&lt;dubbo:reference/&gt;</h3><br><p>(<a href="Reference+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Reference+Config-zh" title="Reference Config-zh">+</a>) (<a href="#UserGuide-zh-%253Cdubbo%253Areference%252F%253E">#</a>)</p>

<p>服务消费者引用服务配置：<br><br>配置类：com.alibaba.dubbo.config.ReferenceConfig</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> 标签 </th><br><th class="confluenceTh"> 属性 </th><br><th class="confluenceTh"> 对应URL参数 </th><br><th class="confluenceTh"> 类型 </th><br><th class="confluenceTh"> 是否必填 </th><br><th class="confluenceTh"> 缺省值 </th><br><th class="confluenceTh"> 作用 </th><br><th class="confluenceTh"> 描述 </th><br><th class="confluenceTh"> 兼容性 </th><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> id </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> <b>必填</b> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 配置关联 </td><br><td class="confluenceTd"> 服务引用BeanId </td><br><td class="confluenceTd"> 1.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> interface </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> class </td><br><td class="confluenceTd"> <b>必填</b> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 服务接口名 </td><br><td class="confluenceTd"> 1.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> version </td><br><td class="confluenceTd"> version </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 服务版本，与服务提供者的版本一致 </td><br><td class="confluenceTd"> 1.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> group </td><br><td class="confluenceTd"> group </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 服务分组，当一个接口有多个实现，可以用分组区分，必需和服务提供方一致 </td><br><td class="confluenceTd"> 1.0.7以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> timeout </td><br><td class="confluenceTd"> timeout </td><br><td class="confluenceTd"> long </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省使用&lt;dubbo:consumer&gt;的timeout </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务方法调用超时时间(毫秒) </td><br><td class="confluenceTd"> 1.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> retries </td><br><td class="confluenceTd"> retries </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省使用&lt;dubbo:consumer&gt;的retries </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 远程服务调用重试次数，不包括第一次调用，不需要重试请设为0 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> connections </td><br><td class="confluenceTd"> connections </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省使用&lt;dubbo:consumer&gt;的connections </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 对每个提供者的最大连接数，rmi、http、hessian等短连接协议表示限制连接数，dubbo等长连接协表示建立的长连接个数 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> loadbalance </td><br><td class="confluenceTd"> loadbalance </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省使用&lt;dubbo:consumer&gt;的loadbalance </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 负载均衡策略，可选值：random,roundrobin,leastactive，分别表示：随机，轮循，最少活跃调用 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> async </td><br><td class="confluenceTd"> async </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省使用&lt;dubbo:consumer&gt;的async </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 是否异步执行，不可靠异步，只是忽略返回值，不阻塞执行线程 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> generic </td><br><td class="confluenceTd"> generic </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省使用&lt;dubbo:consumer&gt;的generic </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 是否缺省泛化接口，如果为泛化接口，将返回GenericService </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> check </td><br><td class="confluenceTd"> check </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省使用&lt;dubbo:consumer&gt;的check </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 启动时检查提供者是否存在，true报错，false忽略 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> url </td><br><td class="confluenceTd"> &lt;url&gt; </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 点对点直连服务提供者地址，<font color="red">将绕过注册中心</font> </td><br><td class="confluenceTd"> 1.0.6以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> stub </td><br><td class="confluenceTd"> stub </td><br><td class="confluenceTd"> class/boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务接口客户端本地代理类名，用于在客户端执行本地逻辑，如本地缓存等，该本地代理类的构造函数必须允许传入远程代理对象，构造函数如：public XxxServiceLocal(XxxService xxxService) </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> mock </td><br><td class="confluenceTd"> mock </td><br><td class="confluenceTd"> class/boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务接口调用失败Mock实现类名，该Mock类必须有一个无参构造函数，与Local的区别在于，Local总是被执行，而Mock只在出现非业务异常(比如超时，网络异常等)时执行，Local在远程调用之前执行，Mock在远程调用后执行。 </td><br><td class="confluenceTd"> Dubbo1.0.13及其以上版本支持 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> cache </td><br><td class="confluenceTd"> cache </td><br><td class="confluenceTd"> string/boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 以调用参数为key，缓存返回结果，可选：lru, threadlocal, jcache等 </td><br><td class="confluenceTd"> Dubbo2.1.0及其以上版本支持 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> validation </td><br><td class="confluenceTd"> validation </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 是否启用JSR303标准注解验证，如果启用，将对方法参数上的注解进行校验 </td><br><td class="confluenceTd"> Dubbo2.1.0及其以上版本支持 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> proxy </td><br><td class="confluenceTd"> proxy </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> javassist </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 选择动态代理实现策略，可选：javassist, jdk </td><br><td class="confluenceTd"> 2.0.2以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> client </td><br><td class="confluenceTd"> client </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 客户端传输类型设置，如Dubbo协议的netty或mina。 </td><br><td class="confluenceTd"> Dubbo2.0.0以上版本支持 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> registry </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省将从所有注册中心获服务列表后合并结果 </td><br><td class="confluenceTd"> 配置关联 </td><br><td class="confluenceTd"> 从指定注册中心注册获取服务列表，在多个注册中心时使用，值为&lt;dubbo:registry&gt;的id属性，多个注册中心ID用逗号分隔 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> owner </td><br><td class="confluenceTd"> owner </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 调用服务负责人，用于服务治理，请填写负责人公司邮箱前缀 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> actives </td><br><td class="confluenceTd"> actives </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 每服务消费者每服务每方法最大并发调用数 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> cluster </td><br><td class="confluenceTd"> cluster </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> failover </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 集群方式，可选：failover/failfast/failsafe/failback/forking </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> filter </td><br><td class="confluenceTd"> reference.filter </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> default </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务消费方远程调用过程拦截器名称，多个名称用逗号分隔 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> listener </td><br><td class="confluenceTd"> invoker.listener </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> default </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务消费方引用服务监听器名称，多个名称用逗号分隔 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> layer </td><br><td class="confluenceTd"> layer </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务调用者所在的分层。如：biz、dao、intl:web、china:acton。 </td><br><td class="confluenceTd"> 2.0.7以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> init </td><br><td class="confluenceTd"> init </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 是否在afterPropertiesSet()时饥饿初始化引用，否则等到有人注入或引用该实例时再初始化。 </td><br><td class="confluenceTd"> 2.0.10以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:reference&gt; </td><br><td class="confluenceTd"> protocol </td><br><td class="confluenceTd"> protocol </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服力治理 </td><br><td class="confluenceTd"> 只调用指定协议的服务提供方，其它协议忽略。 </td><br><td class="confluenceTd"> 2.2.0以上版本 </td><br></tr><br></tbody></table><br></div><br><br><h3><a name="UserGuide-zh-%3Cdubbo%3Aprotocol%2F%3E"></a>&lt;dubbo:protocol/&gt;</h3><br><br><p>(<a href="Protocol+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Protocol+Config-zh" title="Protocol Config-zh">+</a>) (<a href="#UserGuide-zh-%253Cdubbo%253Aprotocol%252F%253E">&#35;</a>)</p>

<p>服务提供者协议配置：<br><br>配置类：com.alibaba.dubbo.config.ProtocolConfig<br><br>说明：如果需要支持多协议，可以声明多个&lt;dubbo:protocol&gt;标签，并在&lt;dubbo:service&gt;中通过protocol属性指定使用的协议。</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> 标签 </th><br><th class="confluenceTh"> 属性 </th><br><th class="confluenceTh"> 对应URL参数 </th><br><th class="confluenceTh"> 类型 </th><br><th class="confluenceTh"> 是否必填 </th><br><th class="confluenceTh"> 缺省值 </th><br><th class="confluenceTh"> 作用 </th><br><th class="confluenceTh"> 描述 </th><br><th class="confluenceTh"> 兼容性 </th><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> id </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo </td><br><td class="confluenceTd"> 配置关联 </td><br><td class="confluenceTd"> 协议BeanId，可以在&lt;dubbo:service protocol=””&gt;中引用此ID，如果ID不填，缺省和name属性值一样，重复则在name后加序号。 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> name </td><br><td class="confluenceTd"> &lt;protocol&gt; </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> <b>必填</b> </td><br><td class="confluenceTd"> dubbo </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 协议名称 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> port </td><br><td class="confluenceTd"> &lt;port&gt; </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo协议缺省端口为20880，rmi协议缺省端口为1099，http和hessian协议缺省端口为80 <br class="atl-forced-newline"><br> 如果配置为<b>-1</b> 或者 <b>没有</b>配置port，则会分配一个没有被占用的端口。Dubbo <font color="brown">2.4.0+</font>，分配的端口在协议缺省端口的基础上增长，确保端口段可控。 </td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 服务端口 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> host </td><br><td class="confluenceTd"> &lt;host&gt; </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 自动查找本机IP </td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> &#45;服务主机名，多网卡选择或指定VIP及域名时使用，为空则自动查找本机IP，&#45;<font color="red">建议不要配置，让Dubbo自动获取本机IP</font> </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> threadpool </td><br><td class="confluenceTd"> threadpool </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> fixed </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 线程池类型，可选：fixed/cached </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> threads </td><br><td class="confluenceTd"> threads </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 100 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务线程池大小(固定大小) </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> iothreads </td><br><td class="confluenceTd"> threads </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> cpu个数+1 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> io线程池大小(固定大小) </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> accepts </td><br><td class="confluenceTd"> accepts </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务提供方最大可接受连接数 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> payload </td><br><td class="confluenceTd"> payload </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 88388608(=8M) </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 请求及响应数据包大小限制，单位：字节 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> codec </td><br><td class="confluenceTd"> codec </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 协议编码方式 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> serialization </td><br><td class="confluenceTd"> serialization </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo协议缺省为hessian2，rmi协议缺省为java，http协议缺省为json </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 协议序列化方式，当协议支持多种序列化方式时使用，比如：dubbo协议的dubbo,hessian2,java,compactedjava，以及http协议的json等 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> accesslog </td><br><td class="confluenceTd"> accesslog </td><br><td class="confluenceTd"> string/boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 设为true，将向logger中输出访问日志，也可填写访问日志文件路径，直接把访问日志输出到指定文件 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> path </td><br><td class="confluenceTd"> &lt;path&gt; </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 提供者上下文路径，为服务path的前缀 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> transporter </td><br><td class="confluenceTd"> transporter </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo协议缺省为netty </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 协议的服务端和客户端实现类型，比如：dubbo协议的mina,netty等，可以分拆为server和client配置 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> server </td><br><td class="confluenceTd"> server </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo协议缺省为netty，http协议缺省为servlet </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 协议的服务器端实现类型，比如：dubbo协议的mina,netty等，http协议的jetty,servlet等 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> client </td><br><td class="confluenceTd"> client </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo协议缺省为netty </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 协议的客户端实现类型，比如：dubbo协议的mina,netty等 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> dispatcher </td><br><td class="confluenceTd"> dispatcher </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo协议缺省为all </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 协议的消息派发方式，用于指定线程模型，比如：dubbo协议的all, direct, message, execution, connection等 </td><br><td class="confluenceTd"> 2.1.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> queues </td><br><td class="confluenceTd"> queues </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 线程池队列大小，当线程池满时，排队等待执行的队列大小，建议不要设置，当线程程池时应立即失败，重试其它服务提供机器，而不是排队，除非有特殊需求。 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> charset </td><br><td class="confluenceTd"> charset </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> UTF-8 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 序列化编码 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> buffer </td><br><td class="confluenceTd"> buffer </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 8192 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 网络读写缓冲区大小 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> heartbeat </td><br><td class="confluenceTd"> heartbeat </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 心跳间隔，对于长连接，当物理层断开时，比如拔网线，TCP的FIN消息来不及发送，对方收不到断开事件，此时需要心跳来帮助检查连接是否已断开 </td><br><td class="confluenceTd"> 2.0.10以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> telnet </td><br><td class="confluenceTd"> telnet </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 所支持的telnet命令，多个命令用逗号分隔 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> register </td><br><td class="confluenceTd"> register </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> true </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 该协议的服务是否注册到注册中心 </td><br><td class="confluenceTd"> 2.0.8以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:protocol&gt; </td><br><td class="confluenceTd"> contextpath </td><br><td class="confluenceTd"> contextpath </td><br><td class="confluenceTd"> String </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省为空串 </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 2.0.6以上版本 </td><br></tr><br></tbody></table><br></div><br><br><h3><a name="UserGuide-zh-%3Cdubbo%3Aregistry%2F%3E"></a>&lt;dubbo:registry/&gt;</h3><br><p>(<a href="Registry+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Registry+Config-zh" title="Registry Config-zh">+</a>) (<a href="#UserGuide-zh-%253Cdubbo%253Aregistry%252F%253E">#</a>)</p>

<p>注册中心配置：<br><br>配置类：com.alibaba.dubbo.config.RegistryConfig<br><br>说明：如果有多个不同的注册中心，可以声明多个&lt;dubbo:registry&gt;标签，并在&lt;dubbo:service&gt;或&lt;dubbo:reference&gt;的registry属性指定使用的注册中心。</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> 标签 </th><br><th class="confluenceTh"> 属性 </th><br><th class="confluenceTh"> 对应URL参数 </th><br><th class="confluenceTh"> 类型 </th><br><th class="confluenceTh"> 是否必填 </th><br><th class="confluenceTh"> 缺省值 </th><br><th class="confluenceTh"> 作用 </th><br><th class="confluenceTh"> 描述 </th><br><th class="confluenceTh"> 兼容性 </th><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> id </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 配置关联 </td><br><td class="confluenceTd"> 注册中心引用BeanId，可以在&lt;dubbo:service registry=””&gt;或&lt;dubbo:reference registry=””&gt;中引用此ID </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> address </td><br><td class="confluenceTd"> &lt;host:port&gt; </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> <b>必填</b> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 注册中心服务器地址，如果地址没有端口缺省为9090，同一集群内的多个地址用逗号分隔，如：ip:port,ip:port，不同集群的注册中心，请配置多个&lt;dubbo:registry&gt;标签 </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> protocol </td><br><td class="confluenceTd"> &lt;protocol&gt; </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo </td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 注同中心地址协议，支持dubbo, http, local三种协议，分别表示，dubbo地址，http地址，本地注册中心 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> port </td><br><td class="confluenceTd"> &lt;port&gt; </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 9090 </td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 注册中心缺省端口，当address没有带端口时使用此端口做为缺省值 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> username </td><br><td class="confluenceTd"> &lt;username&gt; </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 登录注册中心用户名，如果注册中心不需要验证可不填 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> password </td><br><td class="confluenceTd"> &lt;password&gt; </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 登录注册中心密码，如果注册中心不需要验证可不填 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> transport </td><br><td class="confluenceTd"> registry.transporter </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> netty </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 网络传输方式，可选mina,netty </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> timeout </td><br><td class="confluenceTd"> registry.timeout </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 5000 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 注册中心请求超时时间(毫秒) </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> session </td><br><td class="confluenceTd"> registry.session </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 60000 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 注册中心会话超时时间(毫秒)，用于检测提供者非正常断线后的脏数据，比如用心跳检测的实现，此时间就是心跳间隔，不同注册中心实现不一样。 </td><br><td class="confluenceTd"> 2.1.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> file </td><br><td class="confluenceTd"> registry.file </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 使用文件缓存注册中心地址列表及服务提供者列表，应用重启时将基于此文件恢复，<font color="#ff0000">注意：两个注册中心不能使用同一文件存储</font> </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> wait </td><br><td class="confluenceTd"> registry.wait </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 停止时等待通知完成时间(毫秒) </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> check </td><br><td class="confluenceTd"> check </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> true </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 注册中心不存在时，是否报错 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> register </td><br><td class="confluenceTd"> register </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> true </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 是否向此注册中心注册服务，如果设为false，将只订阅，不注册 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> subscribe </td><br><td class="confluenceTd"> subscribe </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> true </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 是否向此注册中心订阅服务，如果设为false，将只注册，不订阅 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:registry&gt; </td><br><td class="confluenceTd"> dynamic </td><br><td class="confluenceTd"> dynamic </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> true </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务是否动态注册，如果设为false，注册后将显示后disable状态，需人工启用，并且服务提供者停止时，也不会自动取消册，需人工禁用。 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br></tbody></table><br></div><br><br><h3><a name="UserGuide-zh-%3Cdubbo%3Amonitor%2F%3E"></a>&lt;dubbo:monitor/&gt;</h3><br><p>(<a href="Monitor+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Monitor+Config-zh" title="Monitor Config-zh">+</a>) (<a href="#UserGuide-zh-%253Cdubbo%253Amonitor%252F%253E">#</a>)</p>

<p>监控中心配置：<br><br>配置类：com.alibaba.dubbo.config.MonitorConfig</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> 标签 </th><br><th class="confluenceTh"> 属性 </th><br><th class="confluenceTh"> 对应URL参数 </th><br><th class="confluenceTh"> 类型 </th><br><th class="confluenceTh"> 是否必填 </th><br><th class="confluenceTh"> 缺省值 </th><br><th class="confluenceTh"> 作用 </th><br><th class="confluenceTh"> 描述 </th><br><th class="confluenceTh"> 兼容性 </th><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:monitor&gt; </td><br><td class="confluenceTd"> protocol </td><br><td class="confluenceTd"> protocol </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 监控中心协议，如果为protocol=”registry”，表示从注册中心发现监控中心地址，否则直连监控中心。 </td><br><td class="confluenceTd"> 2.0.9以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:monitor&gt; </td><br><td class="confluenceTd"> address </td><br><td class="confluenceTd"> &lt;url&gt; </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> N/A </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 直连监控中心服务器地址，address=”10.20.130.230:12080” </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br></tbody></table><br></div><br><br><h3><a name="UserGuide-zh-%3Cdubbo%3Aapplication%2F%3E"></a>&lt;dubbo:application/&gt;</h3><br><p>(<a href="Application+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Application+Config-zh" title="Application Config-zh">+</a>) (<a href="#UserGuide-zh-%253Cdubbo%253Aapplication%252F%253E">#</a>)</p>

<p>应用信息配置：<br><br>配置类：com.alibaba.dubbo.config.ApplicationConfig</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> 标签 </th><br><th class="confluenceTh"> 属性 </th><br><th class="confluenceTh"> 对应URL参数 </th><br><th class="confluenceTh"> 类型 </th><br><th class="confluenceTh"> 是否必填 </th><br><th class="confluenceTh"> 缺省值 </th><br><th class="confluenceTh"> 作用 </th><br><th class="confluenceTh"> 描述 </th><br><th class="confluenceTh"> 兼容性 </th><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:application&gt; </td><br><td class="confluenceTd"> name </td><br><td class="confluenceTd"> application </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> <b>必填</b> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 当前应用名称，用于注册中心计算应用间依赖关系，<font color="red">注意：消费者和提供者应用名不要一样，此参数不是匹配条件</font>，你当前项目叫什么名字就填什么，和提供者消费者角色无关，比如：kylin应用调用了morgan应用的服务，则kylin项目配成kylin，morgan项目配成morgan，可能kylin也提供其它服务给别人使用，但kylin项目永远配成kylin，这样注册中心将显示kylin依赖于morgan </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:application&gt; </td><br><td class="confluenceTd"> version </td><br><td class="confluenceTd"> application.version </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 当前应用的版本 </td><br><td class="confluenceTd"> 2.2.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:application&gt; </td><br><td class="confluenceTd"> owner </td><br><td class="confluenceTd"> owner </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 应用负责人，用于服务治理，请填写负责人公司邮箱前缀 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:application&gt; </td><br><td class="confluenceTd"> organization </td><br><td class="confluenceTd"> organization </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 组织名称(BU或部门)，用于注册中心区分服务来源，<font color="#009900">此配置项建议不要使用autoconfig，直接写死在配置中，比如china,intl,itu,crm,asc,dw,aliexpress等</font> </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:application&gt; </td><br><td class="confluenceTd"> architecture <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> architecture <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 用于服务分层对应的架构。如，intl、china。不同的架构使用不同的分层。 </td><br><td class="confluenceTd"> 2.0.7以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:application&gt; </td><br><td class="confluenceTd"> environment </td><br><td class="confluenceTd"> environment </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 应用环境，如：develop/test/product，不同环境使用不同的缺省值，以及作为只用于开发测试功能的限制条件 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:application&gt; </td><br><td class="confluenceTd"> compiler </td><br><td class="confluenceTd"> compiler </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> javassist </td><br><td class="confluenceTd"> 性能优化 </td><br><td class="confluenceTd"> Java字节码编译器，用于动态类的生成，可选：jdk或javassist </td><br><td class="confluenceTd"> 2.1.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:application&gt; </td><br><td class="confluenceTd"> logger </td><br><td class="confluenceTd"> logger </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> slf4j </td><br><td class="confluenceTd"> 性能优化 </td><br><td class="confluenceTd"> 日志输出方式，可选：slf4j,jcl,log4j,jdk </td><br><td class="confluenceTd"> 2.2.0以上版本 </td><br></tr><br></tbody></table><br></div><br><br><h3><a name="UserGuide-zh-%3Cdubbo%3Amodule%2F%3E"></a>&lt;dubbo:module/&gt;</h3><br><p>(<a href="Module+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Module+Config-zh" title="Module Config-zh">+</a>) (<a href="#UserGuide-zh-%253Cdubbo%253Amodule%252F%253E">#</a>)</p>

<p>模块信息配置：<br><br>配置类：com.alibaba.dubbo.config.ModuleConfig</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> 标签 </th><br><th class="confluenceTh"> 属性 </th><br><th class="confluenceTh"> 对应URL参数 </th><br><th class="confluenceTh"> 类型 </th><br><th class="confluenceTh"> 是否必填 </th><br><th class="confluenceTh"> 缺省值 </th><br><th class="confluenceTh"> 作用 </th><br><th class="confluenceTh"> 描述 </th><br><th class="confluenceTh"> 兼容性 </th><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:module&gt; </td><br><td class="confluenceTd"> name </td><br><td class="confluenceTd"> module </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> <b>必填</b> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 当前模块名称，用于注册中心计算模块间依赖关系 </td><br><td class="confluenceTd"> 2.2.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:module&gt; </td><br><td class="confluenceTd"> version </td><br><td class="confluenceTd"> module.version </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 当前模块的版本 </td><br><td class="confluenceTd"> 2.2.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:module&gt; </td><br><td class="confluenceTd"> owner </td><br><td class="confluenceTd"> owner </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 模块负责人，用于服务治理，请填写负责人公司邮箱前缀 </td><br><td class="confluenceTd"> 2.2.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:module&gt; </td><br><td class="confluenceTd"> organization </td><br><td class="confluenceTd"> organization </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 组织名称(BU或部门)，用于注册中心区分服务来源，<font color="#009900">此配置项建议不要使用autoconfig，直接写死在配置中，比如china,intl,itu,crm,asc,dw,aliexpress等</font> </td><br><td class="confluenceTd"> 2.2.0以上版本 </td><br></tr><br></tbody></table><br></div><br><br><h3><a name="UserGuide-zh-%3Cdubbo%3Aprovider%2F%3E"></a>&lt;dubbo:provider/&gt;</h3><br><p>(<a href="Provider+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Provider+Config-zh" title="Provider Config-zh">+</a>) (<a href="#UserGuide-zh-%253Cdubbo%253Aprovider%252F%253E">#</a>)</p>

<p>服务提供者缺省值配置：<br><br>配置类：com.alibaba.dubbo.config.ProviderConfig<br><br>说明：该标签为&lt;dubbo:service&gt;和&lt;dubbo:protocol&gt;标签的缺省值设置。</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> 标签 </th><br><th class="confluenceTh"> 属性 </th><br><th class="confluenceTh"> 对应URL参数 </th><br><th class="confluenceTh"> 类型 </th><br><th class="confluenceTh"> 是否必填 </th><br><th class="confluenceTh"> 缺省值 </th><br><th class="confluenceTh"> 作用 </th><br><th class="confluenceTh"> 描述 </th><br><th class="confluenceTh"> 兼容性 </th><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> id </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo </td><br><td class="confluenceTd"> 配置关联 </td><br><td class="confluenceTd"> 协议BeanId，可以在&lt;dubbo:service proivder=””&gt;中引用此ID </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> protocol </td><br><td class="confluenceTd"> &lt;protocol&gt; </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 协议名称 </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&ggt; </td><br><td class="confluenceTd"> host </td><br><td class="confluenceTd"> &lt;host&gt; </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 自动查找本机IP </td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 服务主机名，多网卡选择或指定VIP及域名时使用，为空则自动查找本机IP，<font color="red">建议不要配置，让Dubbo自动获取本机IP</font> </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> threads </td><br><td class="confluenceTd"> threads </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 100 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务线程池大小(固定大小) </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> payload </td><br><td class="confluenceTd"> payload </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 88388608(=8M) </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 请求及响应数据包大小限制，单位：字节 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> path </td><br><td class="confluenceTd"> &lt;path&gt; </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 提供者上下文路径，为服务path的前缀 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> server </td><br><td class="confluenceTd"> server </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo协议缺省为netty，http协议缺省为servlet </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 协议的服务器端实现类型，比如：dubbo协议的mina,netty等，http协议的jetty,servlet等 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> client </td><br><td class="confluenceTd"> client </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo协议缺省为netty </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 协议的客户端实现类型，比如：dubbo协议的mina,netty等 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> codec </td><br><td class="confluenceTd"> codec </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 协议编码方式 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> serialization </td><br><td class="confluenceTd"> serialization </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> dubbo协议缺省为hessian2，rmi协议缺省为java，http协议缺省为json </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 协议序列化方式，当协议支持多种序列化方式时使用，比如：dubbo协议的dubbo,hessian2,java,compactedjava，以及http协议的json,xml等 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> default </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 配置关联 </td><br><td class="confluenceTd"> 是否为缺省协议，用于多协议 </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> filter </td><br><td class="confluenceTd"> service.filter </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务提供方远程调用过程拦截器名称，多个名称用逗号分隔 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> listener </td><br><td class="confluenceTd"> exporter.listener </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务提供方导出服务监听器名称，多个名称用逗号分隔 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> threadpool </td><br><td class="confluenceTd"> threadpool </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> fixed </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 线程池类型，可选：fixed/cached </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> accepts </td><br><td class="confluenceTd"> accepts </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务提供者最大可接受连接数 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> version </td><br><td class="confluenceTd"> version </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0.0.0 </td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 服务版本，建议使用两位数字版本，如：1.0，通常在接口不兼容时版本号才需要升级 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> group </td><br><td class="confluenceTd"> group </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> &nbsp; </td><br><td class="confluenceTd"> 服务发现 </td><br><td class="confluenceTd"> 服务分组，当一个接口有多个实现，可以用分组区分 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> delay </td><br><td class="confluenceTd"> delay </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 延迟注册服务时间(毫秒)&#45; ，设为-1时，表示延迟到Spring容器初始化完成时暴露服务 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> timeout </td><br><td class="confluenceTd"> default.timeout </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 1000 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 远程服务调用超时时间(毫秒) </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> retries </td><br><td class="confluenceTd"> default.retries </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 2 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 远程服务调用重试次数，不包括第一次调用，不需要重试请设为0 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> connections </td><br><td class="confluenceTd"> default.connections </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 对每个提供者的最大连接数，rmi、http、hessian等短连接协议表示限制连接数，dubbo等长连接协表示建立的长连接个数 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> loadbalance </td><br><td class="confluenceTd"> default.loadbalance </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> random </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 负载均衡策略，可选值：random,roundrobin,leastactive，分别表示：随机，轮循，最少活跃调用 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> async </td><br><td class="confluenceTd"> default.async </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 是否缺省异步执行，不可靠异步，只是忽略返回值，不阻塞执行线程 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> stub </td><br><td class="confluenceTd"> stub </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 设为true，表示使用缺省代理类名，即：接口名 + Local后缀。 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> mock </td><br><td class="confluenceTd"> mock </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 设为true，表示使用缺省Mock类名，即：接口名 + Mock后缀。 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> token </td><br><td class="confluenceTd"> token </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 令牌验证，为空表示不开启，如果为true，表示随机生成动态令牌 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> registry </td><br><td class="confluenceTd"> registry </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省向所有registry注册 </td><br><td class="confluenceTd"> 配置关联 </td><br><td class="confluenceTd"> 向指定注册中心注册，在多个注册中心时使用，值为&lt;dubbo:registry&gt;的id属性，多个注册中心ID用逗号分隔，如果不想将该服务注册到任何registry，可将值设为N/A </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> dynamic </td><br><td class="confluenceTd"> dynamic </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> true </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务是否动态注册，如果设为false，注册后将显示后disable状态，需人工启用，并且服务提供者停止时，也不会自动取消册，需人工禁用。 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> accesslog </td><br><td class="confluenceTd"> accesslog </td><br><td class="confluenceTd"> string/boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 设为true，将向logger中输出访问日志，也可填写访问日志文件路径，直接把访问日志输出到指定文件 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> owner </td><br><td class="confluenceTd"> owner </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务负责人，用于服务治理，请填写负责人公司邮箱前缀 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> document </td><br><td class="confluenceTd"> document </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务文档URL </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> weight </td><br><td class="confluenceTd"> weight </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务权重 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> executes </td><br><td class="confluenceTd"> executes </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务提供者每服务每方法最大可并行执行请求数 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> actives </td><br><td class="confluenceTd"> default.actives </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 每服务消费者每服务每方法最大并发调用数 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> proxy </td><br><td class="confluenceTd"> proxy </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> javassist </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 生成动态代理方式，可选：jdk/javassist </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> cluster </td><br><td class="confluenceTd"> default.cluster </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> failover </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 集群方式，可选：failover/failfast/failsafe/failback/forking </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> deprecated </td><br><td class="confluenceTd"> deprecated </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务是否过时，如果设为true，消费方引用时将打印服务过时警告error日志 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> queues </td><br><td class="confluenceTd"> queues </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 线程池队列大小，当线程池满时，排队等待执行的队列大小，建议不要设置，当线程程池时应立即失败，重试其它服务提供机器，而不是排队，除非有特殊需求。 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> charset </td><br><td class="confluenceTd"> charset </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> UTF-8 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 序列化编码 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> buffer </td><br><td class="confluenceTd"> buffer </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 8192 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 网络读写缓冲区大小 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> iothreads </td><br><td class="confluenceTd"> iothreads </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> CPU + 1 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> IO线程池，接收网络读写中断，以及序列化和反序列化，不处理业务，业务线程池参见threads配置，此线程池和CPU相关，不建议配置。 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> telnet </td><br><td class="confluenceTd"> telnet </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 所支持的telnet命令，多个命令用逗号分隔 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:service&gt; </td><br><td class="confluenceTd"> contextpath </td><br><td class="confluenceTd"> contextpath </td><br><td class="confluenceTd"> String </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省为空串 </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 2.0.6以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:provider&gt; </td><br><td class="confluenceTd"> layer </td><br><td class="confluenceTd"> layer </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务提供者所在的分层。如：biz、dao、intl:web、china:acton。 </td><br><td class="confluenceTd"> 2.0.7以上版本 </td><br></tr><br></tbody></table><br></div><br><br><h3><a name="UserGuide-zh-%3Cdubbo%3Aconsumer%2F%3E"></a>&lt;dubbo:consumer/&gt;</h3><br><p>(<a href="Consumer+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Consumer+Config-zh" title="Consumer Config-zh">+</a>) (<a href="#UserGuide-zh-%253Cdubbo%253Aconsumer%252F%253E">#</a>)</p>

<p>服务消费者缺省值配置：<br><br>配置类：com.alibaba.dubbo.config.ConsumerConfig<br><br>说明：该标签为&lt;dubbo:reference&gt;标签的缺省值设置。</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> 标签 </th><br><th class="confluenceTh"> 属性 </th><br><th class="confluenceTh"> 对应URL参数 </th><br><th class="confluenceTh"> 类型 </th><br><th class="confluenceTh"> 是否必填 </th><br><th class="confluenceTh"> 缺省值 </th><br><th class="confluenceTh"> 作用 </th><br><th class="confluenceTh"> 描述 </th><br><th class="confluenceTh"> 兼容性 </th><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> timeout </td><br><td class="confluenceTd"> default.timeout </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 1000 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 远程服务调用超时时间(毫秒) </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> retries </td><br><td class="confluenceTd"> default.retries </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 2 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 远程服务调用重试次数，不包括第一次调用，不需要重试请设为0 </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> loadbalance </td><br><td class="confluenceTd"> default.loadbalance </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> random </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 负载均衡策略，可选值：random,roundrobin,leastactive，分别表示：随机，轮循，最少活跃调用 </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> async </td><br><td class="confluenceTd"> default.async </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 是否缺省异步执行，不可靠异步，只是忽略返回值，不阻塞执行线程 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> connections </td><br><td class="confluenceTd"> default.connections </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 100 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 每个服务对每个提供者的最大连接数，rmi、http、hessian等短连接协议支持此配置，dubbo协议长连接不支持此配置 </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> generic </td><br><td class="confluenceTd"> generic </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 是否缺省泛化接口，如果为泛化接口，将返回GenericService </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> check </td><br><td class="confluenceTd"> check </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> true </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 启动时检查提供者是否存在，true报错，false忽略 </td><br><td class="confluenceTd"> 1.0.16以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> proxy </td><br><td class="confluenceTd"> proxy </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> javassist </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 生成动态代理方式，可选：jdk/javassist </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> owner </td><br><td class="confluenceTd"> owner </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 调用服务负责人，用于服务治理，请填写负责人公司邮箱前缀 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> actives </td><br><td class="confluenceTd"> default.actives </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 每服务消费者每服务每方法最大并发调用数 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> cluster </td><br><td class="confluenceTd"> default.cluster </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> failover </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 集群方式，可选：failover/failfast/failsafe/failback/forking </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> filter </td><br><td class="confluenceTd"> reference.filter </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> &nbsp; </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务消费方远程调用过程拦截器名称，多个名称用逗号分隔 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> listener </td><br><td class="confluenceTd"> invoker.listener </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 服务消费方引用服务监听器名称，多个名称用逗号分隔 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> registry </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省向所有registry注册 </td><br><td class="confluenceTd"> 配置关联 </td><br><td class="confluenceTd"> 向指定注册中心注册，在多个注册中心时使用，值为&lt;dubbo:registry&gt;的id属性，多个注册中心ID用逗号分隔，如果不想将该服务注册到任何registry，可将值设为N/A </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> layer </td><br><td class="confluenceTd"> layer </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务调用者所在的分层。如：biz、dao、intl:web、china:acton。 </td><br><td class="confluenceTd"> 2.0.7以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> init </td><br><td class="confluenceTd"> init </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 是否在afterPropertiesSet()时饥饿初始化引用，否则等到有人注入或引用该实例时再初始化。 </td><br><td class="confluenceTd"> 2.0.10以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> cache </td><br><td class="confluenceTd"> cache </td><br><td class="confluenceTd"> string/boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 以调用参数为key，缓存返回结果，可选：lru, threadlocal, jcache等 </td><br><td class="confluenceTd"> Dubbo2.1.0及其以上版本支持 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:consumer&gt; </td><br><td class="confluenceTd"> validation </td><br><td class="confluenceTd"> validation </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 是否启用JSR303标准注解验证，如果启用，将对方法参数上的注解进行校验 </td><br><td class="confluenceTd"> Dubbo2.1.0及其以上版本支持 </td><br></tr><br></tbody></table><br></div><br><br><h3><a name="UserGuide-zh-%3Cdubbo%3Amethod%2F%3E"></a>&lt;dubbo:method/&gt;</h3><br><p>(<a href="Method+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Method+Config-zh" title="Method Config-zh">+</a>) (<a href="#UserGuide-zh-%253Cdubbo%253Amethod%252F%253E">#</a>)</p>

<p>方法级配置：<br><br>配置类：com.alibaba.dubbo.config.MethodConfig<br><br>说明：该标签为&lt;dubbo:service&gt;或&lt;dubbo:reference&gt;的子标签，用于控制到方法级，</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> 标签 </th><br><th class="confluenceTh"> 属性 </th><br><th class="confluenceTh"> 对应URL参数 </th><br><th class="confluenceTh"> 类型 </th><br><th class="confluenceTh"> 是否必填 </th><br><th class="confluenceTh"> 缺省值 </th><br><th class="confluenceTh"> 作用 </th><br><th class="confluenceTh"> 描述 </th><br><th class="confluenceTh"> 兼容性 </th><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> name </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> <b>必填</b> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 标识 </td><br><td class="confluenceTd"> 方法名 </td><br><td class="confluenceTd"> 1.0.8以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> timeout </td><br><td class="confluenceTd"> &lt;metodName&gt;.timeout </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省为的timeout </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 方法调用超时时间(毫秒) </td><br><td class="confluenceTd"> 1.0.8以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> retries </td><br><td class="confluenceTd"> &lt;metodName&gt;.retries </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省为&lt;dubbo:reference&gt;的retries </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 远程服务调用重试次数，不包括第一次调用，不需要重试请设为0 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> loadbalance </td><br><td class="confluenceTd"> &lt;metodName&gt;.loadbalance </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省为的loadbalance </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 负载均衡策略，可选值：random,roundrobin,leastactive，分别表示：随机，轮循，最少活跃调用 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> async </td><br><td class="confluenceTd"> &lt;metodName&gt;.async </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 缺省为&lt;dubbo:reference&gt;的async </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 是否异步执行，不可靠异步，只是忽略返回值，不阻塞执行线程 </td><br><td class="confluenceTd"> 1.0.9以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> sent </td><br><td class="confluenceTd"> &lt;methodName&gt;.sent </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> true </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 异步调用时，标记sent=true时，表示网络已发出数据 </td><br><td class="confluenceTd"> 2.0.6以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> actives </td><br><td class="confluenceTd"> &lt;metodName&gt;.actives </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 每服务消费者最大并发调用限制 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> executes </td><br><td class="confluenceTd"> &lt;metodName&gt;.executes </td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> 0 </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 每服务每方法最大使用线程数限制&#45; &#45;，此属性只在&lt;dubbo:method&gt;作为&lt;dubbo:service&gt;子标签时有效 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> deprecated </td><br><td class="confluenceTd"> &lt;methodName&gt;.deprecated </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 服务方法是否过时，此属性只在&lt;dubbo:method&gt;作为&lt;dubbo:service&gt;子标签时有效 </td><br><td class="confluenceTd"> 2.0.5以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> sticky </td><br><td class="confluenceTd"> &lt;methodName&gt;.sticky </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> false </td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 设置true 该接口上的所有方法使用同一个provider.如果需要更复杂的规则，请使用用路由 </td><br><td class="confluenceTd"> 2.0.6以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> return </td><br><td class="confluenceTd"> &lt;methodName&gt;.return </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd"> true </td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 方法调用是否需要返回值,async设置为true时才生效，如果设置为true，则返回future，或回调onreturn等方法，如果设置为false，则请求发送成功后直接返回Null </td><br><td class="confluenceTd"> 2.0.6以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> oninvoke </td><br><td class="confluenceTd"> attribute属性，不在URL中体现 </td><br><td class="confluenceTd"> String </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 方法执行前拦截 </td><br><td class="confluenceTd"> 2.0.6以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> onreturn </td><br><td class="confluenceTd"> attribute属性，不在URL中体现 </td><br><td class="confluenceTd"> String </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 方法执行返回后拦截 </td><br><td class="confluenceTd"> 2.0.6以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> onthrow </td><br><td class="confluenceTd"> attribute属性，不在URL中体现 </td><br><td class="confluenceTd"> String </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 性能调优 </td><br><td class="confluenceTd"> 方法执行有异常拦截 </td><br><td class="confluenceTd"> 2.0.6以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> cache </td><br><td class="confluenceTd"> &lt;methodName&gt;.cache </td><br><td class="confluenceTd"> string/boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 以调用参数为key，缓存返回结果，可选：lru, threadlocal, jcache等 </td><br><td class="confluenceTd"> Dubbo2.1.0及其以上版本支持 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:method&gt; </td><br><td class="confluenceTd"> validation </td><br><td class="confluenceTd"> &lt;methodName&gt;.validation </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 是否启用JSR303标准注解验证，如果启用，将对方法参数上的注解进行校验 </td><br><td class="confluenceTd"> Dubbo2.1.0及其以上版本支持 </td><br></tr><br></tbody></table><br></div><br><br><p>比如：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.xxx.XxxService”&gt;<br>    &lt;dubbo:method name=”findXxx” timeout=”3000” retries=”2” /&gt;<br>&lt;/dubbo:reference&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-%3Cdubbo%3Aargument%2F%3E"></a>&lt;dubbo:argument/&gt;</h3><br><p>(<a href="Argument+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Argument+Config-zh" title="Argument Config-zh">+</a>) (<a href="#UserGuide-zh-%253Cdubbo%253Aargumentn%252F%253E">#</a>)</p>

<p>方法参数配置：<br><br>配置类：com.alibaba.dubbo.config.ArgumentConfig<br><br>说明：该标签为&lt;dubbo:method&gt;的子标签，用于方法参数的特征描述，比如：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:method name=”findXxx” timeout=”3000” retries=”2”&gt;<br>    &lt;dubbo:argument index=”0” callback=”true” /&gt;<br>&lt;dubbo:method&gt;]]&gt;</script><br></div></div><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> 标签 </th><br><th class="confluenceTh"> 属性 </th><br><th class="confluenceTh"> 对应URL参数 </th><br><th class="confluenceTh"> 类型 </th><br><th class="confluenceTh"> 是否必填 </th><br><th class="confluenceTh"> 缺省值 </th><br><th class="confluenceTh"> 作用 </th><br><th class="confluenceTh"> 描述 </th><br><th class="confluenceTh"> 兼容性 </th><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:argument&gt; </td><br><td class="confluenceTd"> index </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> int </td><br><td class="confluenceTd"> <b>必填</b> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 标识 </td><br><td class="confluenceTd"> 方法名 </td><br><td class="confluenceTd"> 2.0.6以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:argument&gt; </td><br><td class="confluenceTd"> type </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> String </td><br><td class="confluenceTd"> 与index二选一 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 标识 </td><br><td class="confluenceTd"> 通过参数类型查找参数的index </td><br><td class="confluenceTd"> 2.0.6以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:argument&gt; </td><br><td class="confluenceTd"> callback </td><br><td class="confluenceTd"> &lt;metodName&gt;&lt;index&gt;.retries </td><br><td class="confluenceTd"> boolean </td><br><td class="confluenceTd"> 可选 </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 参数是否为callback接口，如果为callback，服务提供方将生成反向代理，可以从服务提供方反向调用消费方，通常用于事件推送. </td><br><td class="confluenceTd"> 2.0.6以上版本 </td><br></tr><br></tbody></table><br></div><br><br><h3><a name="UserGuide-zh-%3Cdubbo%3Aparameter%2F%3E"></a>&lt;dubbo:parameter/&gt;</h3><br><p>(<a href="Parameter+Config-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Parameter+Config-zh" title="Parameter Config-zh">+</a>) (<a href="#UserGuide-zh-%253Cdubbo%253Aparameter%252F%253E">#</a>)</p>

<p>选项参数配置：<br><br>配置类：java.util.Map<br><br>说明：该标签为&lt;dubbo:protocol&gt;或&lt;dubbo:service&gt;或&lt;dubbo:provider&gt;或&lt;dubbo:reference&gt;或&lt;dubbo:consumer&gt;的子标签，用于配置自定义参数，该配置项将作为扩展点设置自定义参数使用。</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> 标签 </th><br><th class="confluenceTh"> 属性 </th><br><th class="confluenceTh"> 对应URL参数 </th><br><th class="confluenceTh"> 类型 </th><br><th class="confluenceTh"> 是否必填 </th><br><th class="confluenceTh"> 缺省值 </th><br><th class="confluenceTh"> 作用 </th><br><th class="confluenceTh"> 描述 </th><br><th class="confluenceTh"> 兼容性 </th><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:parameter&gt; </td><br><td class="confluenceTd"> key </td><br><td class="confluenceTd"> key </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> <b>必填</b> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 路由参数键 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br><tr><br><td class="confluenceTd"> &lt;dubbo:parameter&gt; </td><br><td class="confluenceTd"> value </td><br><td class="confluenceTd"> value </td><br><td class="confluenceTd"> string </td><br><td class="confluenceTd"> <b>必填</b> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> 服务治理 </td><br><td class="confluenceTd"> 路由参数值 </td><br><td class="confluenceTd"> 2.0.0以上版本 </td><br></tr><br></tbody></table><br></div><br><br><p>比如：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”napoli”&gt;<br>    &lt;dubbo:parameter key=”<a href="http://dubbo.io/wiki/display/dubbo/napoli.queue.name">http://dubbo.io/wiki/display/dubbo/napoli.queue.name</a>“ value=”xxx” /&gt;<br>&lt;/dubbo:protocol&gt;]]&gt;</script><br></div></div><br><p>也可以：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”jms” p:queue=”xxx” /&gt;]]&gt;</script><br></div></div><br><p>详细参见：<a href="User+Guide-zh.htm#UserGuide-zh-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0" tppabs="http://dubbo.io/wiki/display/dubbo/User+Guide-zh#UserGuide-zh-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0">自定义参数</a></p><br><h2><a name="UserGuide-zh-%E5%8D%8F%E8%AE%AE%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C"></a>协议参考手册</h2><br><p>(<a href="Protocol+Reference-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Protocol+Reference-zh" title="Protocol Reference-zh">+</a>) (<a href="#UserGuide-zh-%E5%8D%8F%E8%AE%AE%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">#</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>推荐使用Dubbo协议</td></tr></table></div>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>性能测试报告</b><br>各协议的性能情况，请参见：<a href="#UserGuide-zh-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A">性能测试报告</a> (<a href="Performance+Test+Report-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Performance+Test+Report-zh" title="Performance Test Report-zh">+</a>)</td></tr></table></div>

<h3><a name="UserGuide-zh-dubbo%3A%2F%2F"></a>dubbo://</h3><br><p>(<a href="Dubbo+Protocol-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Dubbo+Protocol-zh" title="Dubbo Protocol-zh">+</a>) (<a href="#UserGuide-zh-dubbo%253A%252F%252F">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Dubbo缺省协议采用单一长连接和NIO异步通讯，适合于小数据量大并发的服务调用，以及服务消费者机器数远大于服务提供者机器数的情况。</td></tr></table></div><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Dubbo缺省协议不适合传送大数据量的服务，比如传文件，传视频等，除非请求量很低。</td></tr></table></div><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”dubbo” port=”20880” /&gt;]]&gt;</script><br></div></div><br><br><p>Set default protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:provider protocol=”dubbo” /&gt;]]&gt;</script><br></div></div><br><br><p>Set service protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service protocol=”dubbo” /&gt;]]&gt;</script><br></div></div><br><br><p>Multi port:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol id=”dubbo1” name=”dubbo” port=”20880” /&gt;<br>&lt;dubbo:protocol id=”dubbo2” name=”dubbo” port=”20881” /&gt;]]&gt;</script><br></div></div><br><br><p>Dubbo protocol options:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=“dubbo” port=“9090” server=“netty” client=“netty” codec=“dubbo” serialization=“hessian2” charset=“UTF-8” threadpool=“fixed” threads=“100” queues=“0” iothreads=“9” buffer=“8192” accepts=“1000” payload=“8388608” /&gt;]]&gt;</script><br></div></div><br><p><span class="image-wrap" style=""><img src="dubbo-protocol.jpg-version=1&modificationDate=1331068241000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6949458/dubbo-protocol.jpg?version=1&modificationDate=1331068241000" style="border: 0px solid black"></span></p><br><ul><br>    <li>Transporter<br>    <ul><br>        <li>mina, netty, grizzy</li><br>    </ul><br>    </li><br>    <li>Serialization<br>    <ul><br>        <li>dubbo, hessian2, java, json</li><br>    </ul><br>    </li><br>    <li>Dispatcher<br>    <ul><br>        <li>all, direct, message, execution, connection</li><br>    </ul><br>    </li><br>    <li>ThreadPool<br>    <ul><br>        <li>fixed, cached</li><br>    </ul><br>    </li><br></ul><br><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Dubbo协议缺省每服务每提供者每消费者使用单一长连接，如果数据量较大，可以使用多个连接。</td></tr></table></div><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”dubbo” connections=”2” /&gt;]]&gt;</script><br></div></div><br><br><ul><br>    <li>&lt;dubbo:service connections=”0”&gt;或&lt;dubbo:reference connections=”0”&gt;表示该服务使用JVM共享长连接。(缺省)</li><br>    <li>&lt;dubbo:service connections=”1”&gt;或&lt;dubbo:reference connections=”1”&gt;表示该服务使用独立长连接。</li><br>    <li>&lt;dubbo:service connections=”2”&gt;或&lt;dubbo:reference connections=”2”&gt;表示该服务使用独立两条长连接。</li><br></ul><br><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>为防止被大量连接撑挂，可在服务提供方限制大接收连接数，以实现服务提供方自我保护。</td></tr></table></div><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”dubbo” accepts=”1000” /&gt;]]&gt;</script><br></div></div><br><br><p>缺省协议，使用基于mina1.1.7+hessian3.2.1的tbremoting交互。</p><br><ul><br>    <li>连接个数：单连接</li><br>    <li>连接方式：长连接</li><br>    <li>传输协议：TCP</li><br>    <li>传输方式：NIO异步传输</li><br>    <li>序列化：Hessian二进制序列化</li><br>    <li>适用范围：传入传出参数数据包较小（建议小于100K），消费者比提供者个数多，单一消费者无法压满提供者，<font color="red">尽量不要用dubbo协议传输大文件或超大字符串</font>。</li><br>    <li>适用场景：常规远程服务方法调用</li><br></ul><br><br><br><p>为什么要消费者比提供者个数多：<br><br>因dubbo协议采用单一长连接，<br><br>假设网络为千兆网卡(1024Mbit=128MByte)，<br><br>根据测试经验数据每条连接最多只能压满7MByte(不同的环境可能不一样，供参考)，<br><br>理论上1个服务提供者需要20个服务消费者才能压满网卡。</p><br><br><p>为什么不能传大包：<br><br>因dubbo协议采用单一长连接，<br><br>如果每次请求的数据包大小为500KByte，假设网络为千兆网卡(1024Mbit=128MByte)，每条连接最大7MByte(不同的环境可能不一样，供参考)，<br><br>单个服务提供者的TPS(每秒处理事务数)最大为：128MByte / 500KByte = 262。<br><br>单个消费者调用单个服务提供者的TPS(每秒处理事务数)最大为：7MByte / 500KByte = 14。<br><br>如果能接受，可以考虑使用，否则网络将成为瓶颈。</p><br><br><p>为什么采用异步单一长连接：<br><br>因为服务的现状大都是服务提供者少，通常只有几台机器，<br><br>而服务的消费者多，可能整个网站都在访问该服务，<br><br>比如Morgan的提供者只有6台提供者，却有上百台消费者，每天有1.5亿次调用，<br><br>如果采用常规的hessian服务，服务提供者很容易就被压跨，<br><br>通过单一连接，保证单一消费者不会压死提供者，<br><br>长连接，减少连接握手验证等，<br><br>并使用异步IO，复用线程池，防止C10K问题。</p><br><br><p>(1) 约束：</p><br><ul><br>    <li>参数及返回值需实现Serializable接口</li><br>    <li>参数及返回值不能自定义实现List, Map, Number, Date, Calendar等接口，只能用JDK自带的实现，因为hessian会做特殊处理，自定义实现类中的属性值都会丢失。()</li><br>    <li>Hessian序列化，只传成员属性值和值的类型，不传方法或静态变量，兼容情况：(由吴亚军提供)<br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><th class="confluenceTh"> 数据通讯 </th><br><th class="confluenceTh"> 情况 </th><br><th class="confluenceTh"> 结果 </th><br></tr><br><tr><br><td class="confluenceTd"> A-&gt;B </td><br><td class="confluenceTd"> 类A多一种 属性（或者说类B少一种 属性） </td><br><td class="confluenceTd"> 不抛异常，A多的那 个属性的值，B没有， 其他正常 </td><br></tr><br><tr><br><td class="confluenceTd"> A-&gt;B </td><br><td class="confluenceTd"> 枚举A多一种 枚举（或者说B少一种 枚举），A使用多 出来的枚举进行传输 </td><br><td class="confluenceTd"> 抛异常 </td><br></tr><br><tr><br><td class="confluenceTd"> A-&gt;B </td><br><td class="confluenceTd"> 枚举A多一种 枚举（或者说B少一种 枚举），A不使用 多出来的枚举进行传输 </td><br><td class="confluenceTd"> 不抛异常，B正常接 收数据 </td><br></tr><br><tr><br><td class="confluenceTd"> A-&gt;B </td><br><td class="confluenceTd"> A和B的属性 名相同，但类型不相同 </td><br><td class="confluenceTd"> 抛异常 </td><br></tr><br><tr><br><td class="confluenceTd"> A-&gt;B </td><br><td class="confluenceTd"> serialId 不相同 </td><br><td class="confluenceTd"> 正常传输 </td><br></tr><br></tbody></table><br></div><br><br><p>总结：会抛异常的情况：枚 举值一边多一种，一边少一种，正好使用了差别的那种，或者属性名相同，类型不同</p></li><br></ul><br><br><br><p>接口增加方法，对客户端无影响，如果该方法不是客户端需要的，客户端不需要重新部署；<br><br>输入参数和结果集中增加属性，对客户端无影响，如果客户端并不需要新属性，不用重新<br><br>部署；<br><br>输入参数和结果集属性名变化，对客户端序列化无影响，但是如果客户端不重新部署，不管输入还是输出，属性名变化的属性值是获取不到的。<br><br>总结：服务器端和客户端对领域对象并不需要完全一致，而是按照最大匹配原则。</p><br><br><p>(2) 配置：<br><br>dubbo.properties：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[dubbo.service.protocol=dubbo]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-rmi%3A%2F%2F"></a>rmi://</h3><br><p>(<a href="Rmi+Protocol-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Rmi+Protocol-zh" title="Rmi Protocol-zh">+</a>) (<a href="#UserGuide-zh-rmi%253A%252F%252F">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>RMI协议采用JDK标准的java.rmi.<em>实现，采用阻塞式短连接和JDK标准序列化方式。</em></td></tr></table></div><br><br><div class="panelMacro"><table class="warningMacro"><colgroup><col width="24"><col></colgroup><br>    <tr><br>        <td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><br>        <td>如果正在使用RMI提供服务给外部访问（公司内网环境应该不会有攻击风险），同时应用里依赖了老的common-collections包（dubbo不会依赖这个包，请排查自己的应用有没有使用）的情况下，存在反序列化安全风险。<br><br>            请检查应用：<br><br>            将commons-collections3 请升级到3.2.2版本：<a href="https://commons.apache.org/proper/commons-collections/release_3_2_2.html" target="_blank" rel="external">https://commons.apache.org/proper/commons-collections/release_3_2_2.html</a><br><br>            将commons-collections4 请升级到4.1版本：<a href="https://commons.apache.org/proper/commons-collections/release_4_1.html" target="_blank" rel="external">https://commons.apache.org/proper/commons-collections/release_4_1.html</a><br><br>            新版本的commons-collections解决了该问题<br><br>        </td><br>    </tr><br></table></div><br><br><ul><br>    <li>如果服务接口继承了java.rmi.Remote接口，可以和原生RMI互操作，即：<br>    <ul><br>        <li>提供者用Dubbo的RMI协议暴露服务，消费者直接用标准RMI接口调用，</li><br>        <li>或者提供方用标准RMI暴露服务，消费方用Dubbo的RMI协议调用。</li><br>    </ul><br>    </li><br>    <li>如果服务接口<font color="red">没有</font>继承java.rmi.Remote接口，<br>    <ul><br>        <li>缺省Dubbo将自动生成一个com.xxx.XxxService$Remote的接口，并继承java.rmi.Remote接口，并以此接口暴露服务，</li><br>        <li>但如果设置了&lt;dubbo:protocol name=”rmi” codec=”spring” /&gt;，将不生成$Remote接口，而使用Spring的RmiInvocationHandler接口暴露服务，和Spring兼容。</li><br>    </ul><br>    </li><br></ul><br><br><br><p>Define rmi protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”rmi” port=”1099” /&gt;]]&gt;</script><br></div></div><br><br><p>Set default protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:provider protocol=”rmi” /&gt;]]&gt;</script><br></div></div><br><br><p>Set service protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service protocol=”rmi” /&gt;]]&gt;</script><br></div></div><br><br><p>Multi port:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol id=”rmi1” name=”rmi” port=”1099” /&gt;<br>&lt;dubbo:protocol id=”rmi2” name=”rmi” port=”2099” /&gt;<br><br>&lt;dubbo:service protocol=”rmi1” /&gt;]]&gt;</script><br></div></div><br><br><p>Spring compatible:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”rmi” codec=”spring” /&gt;]]&gt;</script><br></div></div><br><br><p>Java标准的远程调用协议。</p><br><ul><br>    <li>连接个数：多连接</li><br>    <li>连接方式：短连接</li><br>    <li>传输协议：TCP</li><br>    <li>传输方式：同步传输</li><br>    <li>序列化：Java标准二进制序列化</li><br>    <li>适用范围：传入传出参数数据包大小混合，消费者与提供者个数差不多，可传文件。</li><br>    <li>适用场景：常规远程服务方法调用，与原生RMI服务互操作</li><br></ul><br><br><br><p>(1) 约束：</p><br><ul><br>    <li>参数及返回值需实现Serializable接口</li><br>    <li>dubbo配置中的超时时间对rmi无效，需使用java启动参数设置：-Dsun.rmi.transport.tcp.responseTimeout=3000，参见下面的RMI配置。</li><br></ul><br><br><br><p>(2) 配置：<br><br>dubbo.properties：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[dubbo.service.protocol=rmi]]&gt;</script><br></div></div><br><br><p>(3) RMI配置：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[java -Dsun.rmi.transport.tcp.responseTimeout=3000]]&gt;</script><br></div></div><br><p>更多RMI优化参数请查看：<br><br><a href="javascript:if(confirm(%27http://download.oracle.com/docs/cd/E17409_01/javase/6/docs/technotes/guides/rmi/sunrmiproperties.html  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://download.oracle.com/docs/cd/E17409_01/javase/6/docs/technotes/guides/rmi/sunrmiproperties.html%27" tppabs="http://download.oracle.com/docs/cd/E17409_01/javase/6/docs/technotes/guides/rmi/sunrmiproperties.html" class="external-link" rel="external" target="_blank">http://download.oracle.com/docs/cd/E17409_01/javase/6/docs/technotes/guides/rmi/sunrmiproperties.html</a></p><br><h3><a name="UserGuide-zh-hessian%3A%2F%2F"></a>hessian://</h3><br><p>(<a href="Hessian+Protocol-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Hessian+Protocol-zh" title="Hessian Protocol-zh">+</a>) (<a href="#UserGuide-zh-hessian%253A%252F%252F">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Hessian协议用于集成Hessian的服务，Hessian底层采用Http通讯，采用Servlet暴露服务，Dubbo缺省内嵌Jetty作为服务器实现。</td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Hessian是Caucho开源的一个RPC框架：<a href="javascript:if(confirm(%27http://hessian.caucho.com/  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://hessian.caucho.com/%27" tppabs="http://hessian.caucho.com/" class="external-link" rel="external" target="_blank">http://hessian.caucho.com</a>，其通讯效率高于WebService和Java自带的序列化。</td></tr></table></div><br><br><p>依赖：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dependency&gt;<br>    &lt;groupId&gt;com.caucho&lt;/groupId&gt;<br>    &lt;artifactId&gt;hessian&lt;/artifactId&gt;<br>    &lt;version&gt;4.0.7&lt;/version&gt;<br>&lt;/dependency&gt;]]&gt;</script><br></div></div><br><br><p>可以和原生Hessian服务互操作，即：</p><br><ul><br>    <li>提供者用Dubbo的Hessian协议暴露服务，消费者直接用标准Hessian接口调用，</li><br>    <li>或者提供方用标准Hessian暴露服务，消费方用Dubbo的Hessian协议调用。</li><br></ul><br><br><br><p>基于Hessian的远程调用协议。</p><br><ul><br>    <li>连接个数：多连接</li><br>    <li>连接方式：短连接</li><br>    <li>传输协议：HTTP</li><br>    <li>传输方式：同步传输</li><br>    <li>序列化：Hessian二进制序列化</li><br>    <li>适用范围：传入传出参数数据包较大，提供者比消费者个数多，提供者压力较大，可传文件。</li><br>    <li>适用场景：页面传输，文件传输，或与原生hessian服务互操作</li><br></ul><br><br><br><p>(1) 约束：</p><br><ul><br>    <li>参数及返回值需实现Serializable接口</li><br>    <li>参数及返回值不能自定义实现List, Map, Number, Date, Calendar等接口，只能用JDK自带的实现，因为hessian会做特殊处理，自定义实现类中的属性值都会丢失。</li><br></ul><br><br><br><p>(2) 配置：<br><br>Define hessian protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”hessian” port=”8080” server=”jetty” /&gt;]]&gt;</script><br></div></div><br><br><p>Set default protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:provider protocol=”hessian” /&gt;]]&gt;</script><br></div></div><br><br><p>Set service protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service protocol=”hessian” /&gt;]]&gt;</script><br></div></div><br><br><p>Multi port:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol id=”hessian1” name=”hessian” port=”8080” /&gt;<br>&lt;dubbo:protocol id=”hessian2” name=”hessian” port=”8081” /&gt;]]&gt;</script><br></div></div><br><br><p>Directly provider:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”helloService” interface=”HelloWorld” url=”hessian://10.20.153.10:8080/helloWorld” /&gt;]]&gt;</script><br></div></div><br><br><h4><a name="UserGuide-zh-JettyServer%3A%28default%29"></a>h4. Jetty Server: (default)</h4><br><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol … server=”jetty” /&gt;]]&gt;</script><br></div></div><br><br><h4><a name="UserGuide-zh-ServletBridgeServer%3A%28%29"></a>h4. Servlet Bridge Server: (<font color="brown">recommend</font>)</h4><br><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol … server=”servlet” /&gt;]]&gt;</script><br></div></div><br><p>web.xml：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;servlet&gt;<br>         &lt;servlet-name&gt;dubbo&lt;/servlet-name&gt;<br>         &lt;servlet-class&gt;com.alibaba.dubbo.remoting.http.servlet.DispatcherServlet&lt;/servlet-class&gt;<br>         &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;<br>&lt;/servlet&gt;<br>&lt;servlet-mapping&gt;<br>         &lt;servlet-name&gt;dubbo&lt;/servlet-name&gt;<br>         &lt;url-pattern&gt;/</em>&lt;/url-pattern&gt;<br>&lt;/servlet-mapping&gt;]]&gt;</script><br></div></div><br><br><p>注意，如果使用servlet派发请求：</p><br><ul><br>    <li>协议的端口&lt;dubbo:protocol port=”8080” /&gt;必须与servlet容器的端口相同，</li><br>    <li>协议的上下文路径&lt;dubbo:protocol contextpath=”foo” /&gt;必须与servlet应用的上下文路径相同。</li><br></ul><br><br><h3><a name="UserGuide-zh-http%3A%2F%2F"></a>http://</h3><br><p>(<a href="Http+Protocol-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Http+Protocol-zh" title="Http Protocol-zh">+</a>) (<a href="#UserGuide-zh-http%253A%252F%252F">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>采用Spring的HttpInvoker实现</td></tr></table></div><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.3.0以上版本支持</td></tr></table></div><br><br><p>基于http表单的远程调用协议。参见：<span class="error">&#91;HTTP协议使用说明&#93;</span></p><br><ul><br>    <li>连接个数：多连接</li><br>    <li>连接方式：短连接</li><br>    <li>传输协议：HTTP</li><br>    <li>传输方式：同步传输</li><br>    <li>序列化：表单序列化</li><br>    <li>适用范围：传入传出参数数据包大小混合，提供者比消费者个数多，可用浏览器查看，可用表单或URL传入参数，暂不支持传文件。</li><br>    <li>适用场景：需同时给应用程序和浏览器JS使用的服务。</li><br></ul><br><br><br><p>(1) 约束：</p><br><ul><br>    <li>参数及返回值需符合Bean规范</li><br></ul><br><br><br><p>(2) 配置：<br><br>dubbo.xml：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”http” port=”8080” /&gt;]]&gt;</script><br></div></div><br><br><h4><a name="UserGuide-zh-JettyServer%3A%28default%29"></a>h4. Jetty Server: (default)</h4><br><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol … server=”jetty” /&gt;]]&gt;</script><br></div></div><br><br><h4><a name="UserGuide-zh-ServletBridgeServer%3A%28%29"></a>h4. Servlet Bridge Server: (<font color="brown">recommend</font>)</h4><br><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol … server=”servlet” /&gt;]]&gt;</script><br></div></div><br><p>web.xml：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;servlet&gt;<br>         &lt;servlet-name&gt;dubbo&lt;/servlet-name&gt;<br>         &lt;servlet-class&gt;com.alibaba.dubbo.remoting.http.servlet.DispatcherServlet&lt;/servlet-class&gt;<br>         &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;<br>&lt;/servlet&gt;<br>&lt;servlet-mapping&gt;<br>         &lt;servlet-name&gt;dubbo&lt;/servlet-name&gt;<br>         &lt;url-pattern&gt;/<em>&lt;/url-pattern&gt;<br>&lt;/servlet-mapping&gt;]]&gt;</script><br></div></div><br><br><p>注意，如果使用servlet派发请求：</p><br><ul><br>    <li>协议的端口&lt;dubbo:protocol port=”8080” /&gt;必须与servlet容器的端口相同，</li><br>    <li>协议的上下文路径&lt;dubbo:protocol contextpath=”foo” /&gt;必须与servlet应用的上下文路径相同。</li><br></ul><br><br><h3><a name="UserGuide-zh-webservice%3A%2F%2F"></a>webservice://</h3><br><p>(<a href="WebService+Protocol.htm" tppabs="http://dubbo.io/wiki/display/dubbo/WebService+Protocol" title="WebService Protocol">+</a>) (<a href="#UserGuide-zh-webservice%253A%252F%252F">#</a>)</p><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.3.0以上版本支持。</td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>基于CXF的<a href="javascript:if(confirm(%27http://search.maven.org/  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22cxf-rt-frontend-simple%22%27" tppabs="http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22cxf-rt-frontend-simple%22" class="external-link" rel="external" target="_blank">frontend-simple</a>和<a href="javascript:if(confirm(%27http://search.maven.org/  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22cxf-rt-transports-http%22%27" tppabs="http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22cxf-rt-transports-http%22" class="external-link" rel="external" target="_blank">transports-http</a>实现。</td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>CXF是Apache开源的一个RPC框架：<a href="javascript:if(confirm(%27http://cxf.apache.org/  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://cxf.apache.org/%27" tppabs="http://cxf.apache.org/" class="external-link" rel="external" target="_blank">http://cxf.apache.org</a>，由Xfire和Celtix合并而来 。</td></tr></table></div><br><br><p>依赖：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dependency&gt;<br>    &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;<br>    &lt;artifactId&gt;cxf-rt-frontend-simple&lt;/artifactId&gt;<br>    &lt;version&gt;2.6.1&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;<br>    &lt;artifactId&gt;cxf-rt-transports-http&lt;/artifactId&gt;<br>    &lt;version&gt;2.6.1&lt;/version&gt;<br>&lt;/dependency&gt;]]&gt;</script><br></div></div><br><br><p>可以和原生WebService服务互操作，即：</p><br><ul><br>    <li>提供者用Dubbo的WebService协议暴露服务，消费者直接用标准WebService接口调用，</li><br>    <li>或者提供方用标准WebService暴露服务，消费方用Dubbo的WebService协议调用。</li><br></ul><br><br><br><p>基于WebService的远程调用协议。</p><br><ul><br>    <li>连接个数：多连接</li><br>    <li>连接方式：短连接</li><br>    <li>传输协议：HTTP</li><br>    <li>传输方式：同步传输</li><br>    <li>序列化：SOAP文本序列化</li><br>    <li>适用场景：系统集成，跨语言调用。</li><br></ul><br><br><br><p>(1) 约束：</p><br><ul><br>    <li>参数及返回值需实现Serializable接口</li><br>    <li>参数尽量使用基本类型和POJO。</li><br></ul><br><br><br><p>(2) 配置：<br><br>Define hessian protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”webservice” port=”8080” server=”jetty” /&gt;]]&gt;</script><br></div></div><br><br><p>Set default protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:provider protocol=”webservice” /&gt;]]&gt;</script><br></div></div><br><br><p>Set service protocol:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service protocol=”webservice” /&gt;]]&gt;</script><br></div></div><br><br><p>Multi port:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol id=”webservice1” name=”webservice” port=”8080” /&gt;<br>&lt;dubbo:protocol id=”webservice2” name=”webservice” port=”8081” /&gt;]]&gt;</script><br></div></div><br><br><p>Directly provider:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”helloService” interface=”HelloWorld” url=”webservice://10.20.153.10:8080/com.foo.HelloWorld” /&gt;]]&gt;</script><br></div></div><br><br><p>WSDL:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: text; gutter: false"><a href="![CDATA[http://10.20.153.10:8080/com.foo.HelloWorld?wsdl]]">![CDATA[http://10.20.153.10:8080/com.foo.HelloWorld?wsdl]]</a></script><br></div></div><br><br><h4><a name="UserGuide-zh-JettyServer%3A%28default%29"></a>h4. Jetty Server: (default)</h4><br><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol … server=”jetty” /&gt;]]&gt;</script><br></div></div><br><br><h4><a name="UserGuide-zh-ServletBridgeServer%3A%28%29"></a>h4. Servlet Bridge Server: (<font color="brown">recommend</font>)</h4><br><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol … server=”servlet” /&gt;]]&gt;</script><br></div></div><br><p>web.xml：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;servlet&gt;<br>         &lt;servlet-name&gt;dubbo&lt;/servlet-name&gt;<br>         &lt;servlet-class&gt;com.alibaba.dubbo.remoting.http.servlet.DispatcherServlet&lt;/servlet-class&gt;<br>         &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;<br>&lt;/servlet&gt;<br>&lt;servlet-mapping&gt;<br>         &lt;servlet-name&gt;dubbo&lt;/servlet-name&gt;<br>         &lt;url-pattern&gt;/</em>&lt;/url-pattern&gt;<br>&lt;/servlet-mapping&gt;]]&gt;</script><br></div></div><br><br><p>注意，如果使用servlet派发请求：</p><br><ul><br>    <li>协议的端口&lt;dubbo:protocol port=”8080” /&gt;必须与servlet容器的端口相同，</li><br>    <li>协议的上下文路径&lt;dubbo:protocol contextpath=”foo” /&gt;必须与servlet应用的上下文路径相同。</li><br></ul><br><br><h3><a name="UserGuide-zh-thrift%3A%2F%2F"></a>thrift://</h3><br><p>(<a href="Thrift+Protocol.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Thrift+Protocol" title="Thrift Protocol">+</a>) (<a href="#UserGuide-zh-thrift%253A%252F%252F">#</a>)</p><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.3.0以上版本支持。</td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Thrift说明</b><br>Thrift是Facebook捐给Apache的一个RPC框架，参见：<a href="javascript:if(confirm(%27http://thrift.apache.org/  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://thrift.apache.org/%27" tppabs="http://thrift.apache.org/" class="external-link" rel="external" target="_blank">http://thrift.apache.org</a></td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>dubbo thrift协议</b><br>当前 dubbo 支持的 thrift 协议是对 thrift 原生协议的扩展，在原生协议的基础上添加了一些额外的头信息，比如service name，magic number等。使用dubbo thrift协议同样需要使用thrift的idl compiler编译生成相应的java代码，后续版本中会在这方面做一些增强。</td></tr></table></div><br><br><p>示例：<a href="javascript:if(confirm(%27https://github.com/alibaba/dubbo/tree/master/dubbo-rpc/dubbo-rpc-thrift/src/test/java/com/alibaba/dubbo/rpc/protocol/thrift/examples  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27https://github.com/alibaba/dubbo/tree/master/dubbo-rpc/dubbo-rpc-thrift/src/test/java/com/alibaba/dubbo/rpc/protocol/thrift/examples%27" tppabs="https://github.com/alibaba/dubbo/tree/master/dubbo-rpc/dubbo-rpc-thrift/src/test/java/com/alibaba/dubbo/rpc/protocol/thrift/examples" class="external-link" rel="external" target="_blank">https://github.com/alibaba/dubbo/tree/master/dubbo-rpc/dubbo-rpc-thrift/src/test/java/com/alibaba/dubbo/rpc/protocol/thrift/examples</a></p><br><br><p>依赖：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dependency&gt;<br>    &lt;groupId&gt;org.apache.thrift&lt;/groupId&gt;<br>    &lt;artifactId&gt;libthrift&lt;/artifactId&gt;<br>    &lt;version&gt;0.8.0&lt;/version&gt;<br>&lt;/dependency&gt;]]&gt;</script><br></div></div><br><br><p>所有服务共用一个端口：(与原生Thrift不兼容)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”thrift” port=”3030” /&gt;]]&gt;</script><br></div></div><br><br><p>Thrift<font color="red">不支持</font>数据类型：</p><br><ul><br>    <li>null值 (不能在协议中传递null值)</li><br></ul><br><br><h3><a name="UserGuide-zh-memcached%3A%2F%2F"></a>memcached://</h3><br><p>(<a href="Memcached+Protocol.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Memcached+Protocol" title="Memcached Protocol">+</a>) (<a href="#UserGuide-zh-memcached%253A%252F%252F">#</a>)</p><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.3.0以上版本支持。</td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Memcached说明</b><br>Memcached是一个高效的KV缓存服务器，参见：<a href="javascript:if(confirm(%27http://memcached.org/  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://memcached.org/%27" tppabs="http://memcached.org/" class="external-link" rel="external" target="_blank">http://memcached.org/</a></td></tr></table></div><br><br><p>可以通过脚本或监控中心手工填写表单注册memcached服务的地址：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[RegistryFactory registryFactory = ExtensionLoader.getExtensionLoader(RegistryFactory.class).getAdaptiveExtension();<br>Registry registry = registryFactory.getRegistry(URL.valueOf(“zookeeper://10.20.153.10:2181”));<br>registry.register(URL.valueOf(“memcached://10.20.153.11/com.foo.BarService?category=providers&amp;dynamic=false&amp;application=foo&amp;group=member&amp;loadbalance=consistenthash”));]]&gt;</script><br></div></div><br><br><p>然后在客户端使用时，不需要感知Memcached的地址：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”cache” interface=”<a href="http://dubbo.io/wiki/display/dubbo/java.util.Map">http://dubbo.io/wiki/display/dubbo/java.util.Map</a>“ group=”member” /&gt;]]&gt;</script><br></div></div><br><br><p>或者，点对点直连：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”cache” interface=”<a href="http://dubbo.io/wiki/display/dubbo/java.util.Map">http://dubbo.io/wiki/display/dubbo/java.util.Map</a>“ url=”memcached://10.20.153.10:11211” /&gt;]]&gt;</script><br></div></div><br><br><p>也可以使用自定义接口：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”cache” interface=”com.foo.CacheService” url=”memcached://10.20.153.10:11211” /&gt;]]&gt;</script><br></div></div><br><p>方法名建议和memcached的标准方法名相同，即：get(key), set(key, value), delete(key)。</p><br><br><p>如果方法名和memcached的标准方法名不相同，则需要配置映射关系：(其中”p:xxx”为spring的标准p标签)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”cache” interface=”com.foo.CacheService” url=”memcached://10.20.153.10:11211” p:set=”putFoo” p:get=”getFoo” p:delete=”removeFoo” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-redis%3A%2F%2F"></a>redis://</h3><br><p>(<a href="Redis+Protocol.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Redis+Protocol" title="Redis Protocol">+</a>) (<a href="#UserGuide-zh-redis%253A%252F%252F">#</a>)</p><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>2.3.0以上版本支持。</td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Redis说明</b><br>Redis是一个高效的KV存储服务器，参见：<a href="javascript:if(confirm(%27http://redis.io/  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://redis.io/%27" tppabs="http://redis.io/" class="external-link" rel="external" target="_blank">http://redis.io</a></td></tr></table></div><br><br><p>可以通过脚本或监控中心手工填写表单注册redis服务的地址：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[RegistryFactory registryFactory = ExtensionLoader.getExtensionLoader(RegistryFactory.class).getAdaptiveExtension();<br>Registry registry = registryFactory.getRegistry(URL.valueOf(“zookeeper://10.20.153.10:2181”));<br>registry.register(URL.valueOf(“redis://10.20.153.11/com.foo.BarService?category=providers&amp;dynamic=false&amp;application=foo&amp;group=member&amp;loadbalance=consistenthash”));]]&gt;</script><br></div></div><br><br><p>然后在客户端使用时，不需要感知Redis的地址：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”store” interface=”<a href="http://dubbo.io/wiki/display/dubbo/java.util.Map">http://dubbo.io/wiki/display/dubbo/java.util.Map</a>“ group=”member” /&gt;]]&gt;</script><br></div></div><br><br><p>或者，点对点直连：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”store” interface=”<a href="http://dubbo.io/wiki/display/dubbo/java.util.Map">http://dubbo.io/wiki/display/dubbo/java.util.Map</a>“ url=”redis://10.20.153.10:6379” /&gt;]]&gt;</script><br></div></div><br><br><p>也可以使用自定义接口：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”store” interface=”com.foo.StoreService” url=”redis://10.20.153.10:6379” /&gt;]]&gt;</script><br></div></div><br><p>方法名建议和redis的标准方法名相同，即：get(key), set(key, value), delete(key)。</p><br><br><p>如果方法名和redis的标准方法名不相同，则需要配置映射关系：(其中”p:xxx”为spring的标准p标签)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference id=”cache” interface=”com.foo.CacheService” url=”memcached://10.20.153.10:11211” p:set=”putFoo” p:get=”getFoo” p:delete=”removeFoo” /&gt;]]&gt;</script><br></div></div><br><h2><a name="UserGuide-zh-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C"></a>注册中心参考手册</h2><br><p>(<a href="Registry+Reference-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Registry+Reference-zh" title="Registry Reference-zh">+</a>) (<a href="#UserGuide-zh-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>推荐使用Zookeeper注册中心</td></tr></table></div><br><br><h3><a name="UserGuide-zh-Multicast%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"></a>Multicast注册中心</h3><br><p>(<a href="Multicast+Registry-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Multicast+Registry-zh" title="Multicast Registry-zh">+</a>) (<a href="#UserGuide-zh-Multicast%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>不需要启动任何中心节点，只要广播地址一样，就可以互相发现</td></tr></table></div><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>组播受网络结构限制，只适合小规模应用或开发阶段使用。</td></tr></table></div><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>组播地址段: 224.0.0.0 - 239.255.255.255</td></tr></table></div><br><br><p><span class="image-wrap" style=""><img src="multicast.jpg-version=1&modificationDate=1320417810000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6949468/multicast.jpg?version=1&modificationDate=1320417810000" style="border: 0px solid black"></span></p><br><ol><br>    <li>提供方启动时广播自己的地址。</li><br>    <li>消费方启动时广播订阅请求。</li><br>    <li>提供方收到订阅请求时，单播自己的地址给订阅者，如果设置了unicast=false，则广播给订阅者。</li><br>    <li>消费方收到提供方地址时，连接该地址进行RPC调用。</li><br></ol><br><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry address=”multicast://224.5.6.7:1234” /&gt;]]&gt;</script><br></div></div><br><br><p>Or:</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry protocol=”multicast” address=”224.5.6.7:1234” /&gt;]]&gt;</script><br></div></div><br><br><p>为了减少广播量，Dubbo缺省使用单播发送提供者地址信息给消费者，<br><br>如果一个机器上同时启了多个消费者进程，消费者需声明unicast=false，否则只会有一个消费者能收到消息：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry address=”multicast://224.5.6.7:1234?unicast=false” /&gt;]]&gt;</script><br></div></div><br><br><p>Or:</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry protocol=”multicast” address=”224.5.6.7:1234”&gt;<br>    &lt;dubbo:parameter key=”unicast” value=”false” /&gt;<br>&lt;/dubbo:registry&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-Zookeeper%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"></a>Zookeeper注册中心</h3><br><p>(<a href="Zookeeper+Registry-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Zookeeper+Registry-zh" title="Zookeeper Registry-zh">+</a>) (<a href="#UserGuide-zh-Zookeeper%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>建议使用dubbo-2.3.3以上版本的zookeeper注册中心客户端</td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Zookeeper说明</b><br>Zookeeper是Apacahe Hadoop的子项目，是一个树型的目录服务，支持变更推送，适合作为Dubbo服务的注册中心，工业强度较高，可用于生产环境，并推荐使用，参见：<a href="javascript:if(confirm(%27http://zookeeper.apache.org/  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://zookeeper.apache.org/%27" tppabs="http://zookeeper.apache.org/" class="external-link" rel="external" target="_blank">http://zookeeper.apache.org</a></td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Zookeeper安装</b><br>安装方式参见: <a href="Administrator+Guide.htm#AdministratorGuide-ZookeeperRegistryInstallation" tppabs="http://dubbo.io/wiki/display/dubbo/Administrator+Guide#AdministratorGuide-ZookeeperRegistryInstallation">Zookeeper安装手册</a>，只需搭一个原生的Zookeeper服务器，并将<a href="#UserGuide-zh-QuickStart">Quick Start</a>中Provider和Consumer里的conf/dubbo.properties中的dubbo.registry.addrss的值改为zookeeper://127.0.0.1:2181即可使用</td></tr></table></div><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>可靠性声明</b><br>阿里内部并没有采用Zookeeper做为注册中心，而是使用自己实现的基于数据库的注册中心，即：Zookeeper注册中心并没有在阿里内部长时间运行的可靠性保障，此Zookeeper桥接实现只为开源版本提供，其可靠性依赖于Zookeeper本身的可靠性。</td></tr></table></div><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>兼容性声明</b><br>因2.0.8最初设计的zookeeper存储结构不能扩充不同类型的数据，2.0.9版本做了调整，所以不兼容，需全部改用2.0.9版本才行，以后的版本会保持兼容2.0.9。<br><br>2.2.0版本改为基于zkclient实现，需增加zkclient的依赖包，2.3.0版本增加了基于curator的实现，作为可选实现策略。</td></tr></table></div><br><br><p><span class="image-wrap" style=""><img src="zookeeper.jpg-version=1&modificationDate=1323255359000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6949466/zookeeper.jpg?version=1&modificationDate=1323255359000" style="border: 0px solid black"></span></p><br><br><p>流程说明：</p><br><ul><br>    <li>服务提供者启动时<br>    <ul><br>        <li>向/dubbo/com.foo.BarService/providers目录下写入自己的URL地址。</li><br>    </ul><br>    </li><br>    <li>服务消费者启动时<br>    <ul><br>        <li>订阅/dubbo/com.foo.BarService/providers目录下的提供者URL地址。</li><br>        <li>并向/dubbo/com.foo.BarService/consumers目录下写入自己的URL地址。</li><br>    </ul><br>    </li><br>    <li>监控中心启动时<br>    <ul><br>        <li>订阅/dubbo/com.foo.BarService目录下的所有提供者和消费者URL地址。</li><br>    </ul><br>    </li><br></ul><br><br><br><p>支持以下功能：</p><br><ul><br>    <li>当提供者出现断电等异常停机时，注册中心能自动删除提供者信息。</li><br>    <li>当注册中心重启时，能自动恢复注册数据，以及订阅请求。</li><br>    <li>当会话过期时，能自动恢复注册数据，以及订阅请求。</li><br>    <li>当设置&lt;dubbo:registry check=”false” /&gt;时，记录失败注册和订阅请求，后台定时重试。</li><br>    <li>可通过&lt;dubbo:registry username=”admin” password=”1234” /&gt;设置zookeeper登录信息。</li><br>    <li>可通过&lt;dubbo:registry group=”dubbo” /&gt;设置zookeeper的根节点，不设置将使用无根树。</li><br>    <li>支持&#42;号通配符&lt;dubbo:reference group=”&#42;” version=”&#42;” /&gt;，可订阅服务的所有分组和所有版本的提供者。</li><br></ul><br><br><br><p>在provider和consumer中增加zookeeper客户端jar包依赖：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dependency&gt;<br>    &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;<br>    &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;<br>    &lt;version&gt;3.3.3&lt;/version&gt;<br>&lt;/dependency&gt;]]&gt;</script><br></div></div><br><p>或直接下载：<a href="javascript:if(confirm(%27http://repo1.maven.org/maven2/org/apache/zookeeper/zookeeper  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://repo1.maven.org/maven2/org/apache/zookeeper/zookeeper%27" tppabs="http://repo1.maven.org/maven2/org/apache/zookeeper/zookeeper" class="external-link" rel="external" target="_blank">http://repo1.maven.org/maven2/org/apache/zookeeper/zookeeper</a></p><br><br><p>支持zkclient和curator两种Zookeeper客户端实现：</p><br><br><h4><a name="UserGuide-zh-ZKClientZookeeperRegistry"></a>ZKClient Zookeeper Registry</h4><br><br><p>从2.2.0版本开始缺省为zkclient实现，以提升zookeeper客户端的健状性。</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>ZKClient是Datameer开源的一个Zookeeper客户端实现，开源比较早，参见：<a href="javascript:if(confirm(%27https://github.com/sgroschupf/zkclient  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27https://github.com/sgroschupf/zkclient%27" tppabs="https://github.com/sgroschupf/zkclient" class="external-link" rel="external" target="_blank">https://github.com/sgroschupf/zkclient</a></td></tr></table></div><br><br><p>缺省配置：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry … client=”zkclient” /&gt;]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[dubbo.registry.client=zkclient]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false"><a href="![CDATA[zookeeper://10.20.153.10:2181?client=zkclient]]">![CDATA[zookeeper://10.20.153.10:2181?client=zkclient]]</a></script><br></div></div><br><br><p>需依赖：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dependency&gt;<br>    &lt;groupId&gt;com.github.sgroschupf&lt;/groupId&gt;<br>    &lt;artifactId&gt;zkclient&lt;/artifactId&gt;<br>    &lt;version&gt;0.1&lt;/version&gt;<br>&lt;/dependency&gt;]]&gt;</script><br></div></div><br><p>或直接下载：<a href="javascript:if(confirm(%27http://repo1.maven.org/maven2/com/github/sgroschupf/zkclient  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://repo1.maven.org/maven2/com/github/sgroschupf/zkclient%27" tppabs="http://repo1.maven.org/maven2/com/github/sgroschupf/zkclient" class="external-link" rel="external" target="_blank">http://repo1.maven.org/maven2/com/github/sgroschupf/zkclient</a></p><br><br><h4><a name="UserGuide-zh-CuratorZookeeperRegistry"></a>Curator Zookeeper Registry</h4><br><br><p>从2.3.0版本开始支持可选curator实现。</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Curator是Netflix开源的一个Zookeeper客户端实现，比较活跃，参见：<a href="javascript:if(confirm(%27https://github.com/Netflix/curator  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27https://github.com/Netflix/curator%27" tppabs="https://github.com/Netflix/curator" class="external-link" rel="external" target="_blank">https://github.com/Netflix/curator</a></td></tr></table></div><br><br><p>如果需要改为curator实现，请配置：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry … client=”curator” /&gt;]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[dubbo.registry.client=curator]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false"><a href="![CDATA[zookeeper://10.20.153.10:2181?client=curator]]">![CDATA[zookeeper://10.20.153.10:2181?client=curator]]</a></script><br></div></div><br><br><p>需依赖：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dependency&gt;<br>    &lt;groupId&gt;com.netflix.curator&lt;/groupId&gt;<br>    &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;<br>    &lt;version&gt;1.1.10&lt;/version&gt;<br>&lt;/dependency&gt;]]&gt;</script><br></div></div><br><p>或直接下载：<a href="javascript:if(confirm(%27http://repo1.maven.org/maven2/com/netflix/curator/curator-framework  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://repo1.maven.org/maven2/com/netflix/curator/curator-framework%27" tppabs="http://repo1.maven.org/maven2/com/netflix/curator/curator-framework" class="external-link" rel="external" target="_blank">http://repo1.maven.org/maven2/com/netflix/curator/curator-framework</a></p><br><br><p>Zookeeper单机配置:</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry address=”zookeeper://10.20.153.10:2181” /&gt;]]&gt;</script><br></div></div><br><br><p>Or:</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry protocol=”zookeeper” address=”10.20.153.10:2181” /&gt;]]&gt;</script><br></div></div><br><br><p>Zookeeper集群配置:</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry address=”zookeeper://10.20.153.10:2181?backup=10.20.153.11:2181,10.20.153.12:2181” /&gt;]]&gt;</script><br></div></div><br><br><p>Or:</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry protocol=”zookeeper” address=”10.20.153.10:2181,10.20.153.11:2181,10.20.153.12:2181” /&gt;]]&gt;</script><br></div></div><br><br><p>同一Zookeeper，分成多组注册中心:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry id=”chinaRegistry” protocol=”zookeeper” address=”10.20.153.10:2181” group=”china” /&gt;<br>&lt;dubbo:registry id=”intlRegistry” protocol=”zookeeper” address=”10.20.153.10:2181” group=”intl” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-Redis%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"></a>Redis注册中心</h3><br><p>(<a href="Redis+Registry-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Redis+Registry-zh" title="Redis Registry-zh">+</a>) (<a href="#UserGuide-zh-Redis%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Redis说明</b><br>Redis是一个高效的KV存储服务器，参见：<a href="javascript:if(confirm(%27http://redis.io/  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://redis.io/%27" tppabs="http://redis.io/" class="external-link" rel="external" target="_blank">http://redis.io</a></td></tr></table></div><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Redis安装</b><br>安装方式参见: <a href="Administrator+Guide.htm#AdministratorGuide-RedisRegistryInstallation" tppabs="http://dubbo.io/wiki/display/dubbo/Administrator+Guide#AdministratorGuide-RedisRegistryInstallation">Redis安装手册</a>，只需搭一个原生的Redis服务器，并将<a href="#UserGuide-zh-QuickStart">Quick Start</a>中Provider和Consumer里的conf/dubbo.properties中的dubbo.registry.addrss的值改为redis://127.0.0.1:6379即可使用</td></tr></table></div><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Redis过期数据</b><br>通过心跳的方式检测脏数据，服务器时间必须相同，并且对服务器有一定压力。</td></tr></table></div><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>可靠性声明</b><br>阿里内部并没有采用Redis做为注册中心，而是使用自己实现的基于数据库的注册中心，即：Redis注册中心并没有在阿里内部长时间运行的可靠性保障，此Redis桥接实现只为开源版本提供，其可靠性依赖于Redis本身的可靠性。</td></tr></table></div><br><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>从2.1.0版本开始支持</td></tr></table></div><br><br><p><span class="image-wrap" style=""><img src="dubbo-redis-registry.jpg-version=1&modificationDate=1331396413000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/7668007/dubbo-redis-registry.jpg?version=1&modificationDate=1331396413000" style="border: 0px solid black"></span></p><br><br><p>数据结构：</p><br><ul><br>    <li>使用Redis的Key/Map结构存储数据。<br>    <ul><br>        <li>主Key为服务名和类型。</li><br>        <li>Map中的Key为URL地址。</li><br>        <li>Map中的Value为过期时间，用于判断脏数据，脏数据由监控中心删除。<font color="red">(注意：服务器时间必需同步，否则过期检测会不准确)</font></li><br>    </ul><br>    </li><br>    <li>使用Redis的Publish/Subscribe事件通知数据变更。<br>    <ul><br>        <li>通过事件的值区分事件类型：register, unregister, subscribe, unsubscribe。</li><br>        <li>普通消费者直接订阅指定服务提供者的Key，只会收到指定服务的register, unregister事件。</li><br>        <li>监控中心通过psubscribe功能订阅/dubbo/<em>，会收到所有服务的所有变更事件。</em></li><br>    </ul><br>    </li><br></ul><br><br><br><p>调用过程：</p><br><ol><br>    <li>服务提供方启动时，向Key:/dubbo/com.foo.BarService/providers下，添加当前提供者的地址。</li><br>    <li>并向Channel:/dubbo/com.foo.BarService/providers发送register事件。</li><br>    <li>服务消费方启动时，从Channel:/dubbo/com.foo.BarService/providers订阅register和unregister事件。</li><br>    <li>并向Key:/dubbo/com.foo.BarService/providers下，添加当前消费者的地址。</li><br>    <li>服务消费方收到register和unregister事件后，从Key:/dubbo/com.foo.BarService/providers下获取提供者地址列表。</li><br>    <li>服务监控中心启动时，从Channel:/dubbo/订阅register和unregister，以及subscribe和unsubsribe事件。</li><br>    <li>服务监控中心收到register和unregister事件后，从Key:/dubbo/com.foo.BarService/providers下获取提供者地址列表。</li><br>    <li>服务监控中心收到subscribe和unsubsribe事件后，从Key:/dubbo/com.foo.BarService/consumers下获取消费者地址列表。</li><br></ol><br><br><br><p>选项：</p><br><ul><br>    <li>可通过&lt;dubbo:registry group=”dubbo” /&gt;设置redis中key的前缀，缺省为dubbo。</li><br>    <li>可通过&lt;dubbo:registry cluster=”replicate” /&gt;设置redis集群策略，缺省为failover。<br>    <ul><br>        <li>failover: 只写入和读取任意一台，失败时重试另一台，需要服务器端自行配置数据同步。</li><br>        <li>replicate: 在客户端同时写入所有服务器，只读取单台，服务器端不需要同步，注册中心集群增大，性能压力也会更大。</li><br>    </ul><br>    </li><br></ul><br><br><br><p>Config redis registry:</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry address=”redis://10.20.153.10:6379” /&gt;]]&gt;</script><br></div></div><br><br><p>Or:</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry address=”redis://10.20.153.10:6379?backup=10.20.153.11:6379,10.20.153.12:6379” /&gt;]]&gt;</script><br></div></div><br><br><p>Or:</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry protocol=”redis” address=”10.20.153.10:6379” /&gt;]]&gt;</script><br></div></div><br><br><p>Or:</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry protocol=”redis” address=”10.20.153.10:6379,10.20.153.11:6379,10.20.153.12:6379” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-Simple%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"></a>Simple注册中心</h3>

<p>(<a href="Simple+Registry-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Simple+Registry-zh" title="Simple Registry-zh">+</a>) (<a href="#UserGuide-zh-Simple%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">&#35;</a>)</p>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Dogfooding</b><br>注册中心本身就是一个普通的Dubbo服务，可以减少第三方依赖，使整体通讯方式一致。</td></tr></table></div><br><div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="warning-3.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>适用性说明</b><br>此SimpleRegistryService只是简单实现，不支持集群，可作为自定义注册中心的参考，但不适合直接用于生产环境。</td></tr></table></div>

<p>Export simple registry service:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;<br>&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>“<br>    xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>“<br>    xmlns:dubbo=”<a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>“<br>    xsi:schemaLocation=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans-2.5.xsdhttp://code.alibabatech.com/schema/dubbo">http://www.springframework.org/schema/beans/spring-beans-2.5.xsdhttp://code.alibabatech.com/schema/dubbo</a> <a href="http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt">http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt</a>;<br><br>    &lt;!– 当前应用信息配置 –&gt;<br>    &lt;dubbo:application name=”simple-registry” /&gt;<br><br>    &lt;!– 暴露服务协议配置 –&gt;<br>    &lt;dubbo:protocol port=”9090” /&gt;<br><br>    &lt;!– 暴露服务配置 –&gt;<br>    &lt;dubbo:service interface=”com.alibaba.dubbo.registry.RegistryService” ref=”registryService” registry=”N/A” ondisconnect=”disconnect” callbacks=”1000”&gt;<br>        &lt;dubbo:method name=”subscribe”&gt;&lt;dubbo:argument index=”1” callback=”true” /&gt;&lt;/dubbo:method&gt;<br>        &lt;dubbo:method name=”unsubscribe”&gt;&lt;dubbo:argument index=”1” callback=”false” /&gt;&lt;/dubbo:method&gt;<br>    &lt;/dubbo:service&gt;<br><br>    &lt;!– 简单注册中心实现，可自行扩展实现集群和状态同步 –&gt;<br>    &lt;bean id=”registryService” class=”com.alibaba.dubbo.registry.simple.SimpleRegistryService” /&gt;<br><br>&lt;/beans&gt;]]&gt;</script><br></div></div><br><br><p>Reference the simple registry service:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry address=”127.0.0.1:9090” /&gt;]]&gt;</script><br></div></div><br><br><p>Or:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.alibaba.dubbo.registry.RegistryService” group=”simple” version=”1.0.0” … &gt;]]&gt;</script><br></div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry address=”127.0.0.1:9090” group=”simple” version=”1.0.0” /&gt;]]&gt;</script><br></div></div><br><h3><a name="UserGuide-zh-Simple%E7%9B%91%E6%8E%A7%E4%B8%AD%E5%BF%83"></a>Simple监控中心</h3><br><p>(<a href="Simple+Monitor-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Simple+Monitor-zh" title="Simple Monitor-zh">+</a>) (<a href="#UserGuide-zh-Simple%E7%9B%91%E6%8E%A7%E4%B8%AD%E5%BF%83">#</a>)</p><br><br><div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>监控中心也是一个标准的Dubbo服务，可以通过注册中心发现，也可以直连。</td></tr></table></div>

<div class="panelMacro"><table class="tipMacro"><colgroup><col width="24"><col></colgroup><tr><td valign="top"><img src="check.gif" tppabs="http://dubbo.io/wiki/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><a href="Administrator+Guide-zh.htm#AdministratorGuide-zh-%E7%AE%80%E6%98%93%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AE%89%E8%A3%85" tppabs="http://dubbo.io/wiki/display/dubbo/Administrator+Guide-zh#AdministratorGuide-zh-%E7%AE%80%E6%98%93%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AE%89%E8%A3%85">简易注册中心安装</a></td></tr></table></div>

<p>1.1 暴露一个简单监控中心服务到注册中心: (如果是用安装包，不需要自己写这个配置，如果是自己实现监控中心，则需要)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>“<br>    xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>“<br>    xmlns:dubbo=”<a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>“<br>    xsi:schemaLocation=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans-2.5.xsdhttp://code.alibabatech.com/schema/dubbo">http://www.springframework.org/schema/beans/spring-beans-2.5.xsdhttp://code.alibabatech.com/schema/dubbo</a> <a href="http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt">http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt</a>;<br><br>    &lt;!– 当前应用信息配置 –&gt;<br>    &lt;dubbo:application name=”simple-monitor” /&gt;<br><br>    &lt;!– 连接注册中心配置 –&gt;<br>    &lt;dubbo:registry address=”127.0.0.1:9090” /&gt;<br><br>    &lt;!– 暴露服务协议配置 –&gt;<br>    &lt;dubbo:protocol port=”7070” /&gt;<br><br>    &lt;!– 暴露服务配置 –&gt;<br>    &lt;dubbo:service interface=”com.alibaba.dubbo.monitor.MonitorService” ref=”monitorService” /&gt;<br><br>    &lt;bean id=”monitorService” class=”com.alibaba.dubbo.monitor.simple.SimpleMonitorService” /&gt;<br><br>&lt;/beans&gt;]]&gt;</script><br></div></div><br><br><p>1.2 通过注册中心发现监控中心服务:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:monitor protocol=”registry” /&gt;]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>dubbo.properties</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[dubbo.monitor.protocol=registry]]&gt;</script><br></div></div><br><br><p>2.1 暴露一个简单监控中心服务，但不注册到注册中心: (如果是用安装包，不需要自己写这个配置，如果是自己实现监控中心，则需要)</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;beans xmlns=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>“<br>    xmlns:xsi=”<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>“<br>    xmlns:dubbo=”<a href="http://code.alibabatech.com/schema/dubbo">http://code.alibabatech.com/schema/dubbo</a>“<br>    xsi:schemaLocation=”<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans-2.5.xsdhttp://code.alibabatech.com/schema/dubbo">http://www.springframework.org/schema/beans/spring-beans-2.5.xsdhttp://code.alibabatech.com/schema/dubbo</a> <a href="http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt">http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&amp;gt</a>;<br><br>    &lt;!– 当前应用信息配置 –&gt;<br>    &lt;dubbo:application name=”simple-monitor” /&gt;<br><br>    &lt;!– 暴露服务协议配置 –&gt;<br>    &lt;dubbo:protocol port=”7070” /&gt;<br><br>    &lt;!– 暴露服务配置 –&gt;<br>    &lt;dubbo:service interface=”com.alibaba.dubbo.monitor.MonitorService” ref=”monitorService” registry=”N/A” /&gt;<br><br>    &lt;bean id=”monitorService” class=”com.alibaba.dubbo.monitor.simple.SimpleMonitorService” /&gt;<br><br>&lt;/beans&gt;]]&gt;</script><br></div></div><br><br><p>2.2 直连监控中心服务:</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:monitor address=”dubbo://127.0.0.1:7070/com.alibaba.dubbo.monitor.MonitorService” /&gt;]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:monitor address=”127.0.0.1:7070” /&gt;]]&gt;</script><br></div></div><br><p>或：</p><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>dubbo.properties</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[dubbo.monitor.address=127.0.0.1:7070]]&gt;</script><br></div></div><br><br><br><h2><a name="UserGuide-zh-Telnet%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C"></a>Telnet命令参考手册</h2><br><p>(<a href="Telnet+Command+Reference-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Telnet+Command+Reference-zh" title="Telnet Command Reference-zh">+</a>) (<a href="#UserGuide-zh-Telnet%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">#</a>)</p>

<p>Dubbo2.0.5以上版本服务提供端口支持telnet命令，<br><br>使用如：</p><br><div class="panel" style="background-color: black;border-width: 1px;"><div class="panelContent" style="background-color: black;"><br><p><font color="white">telnet localhost 20880</font></p><br></div></div><br><p>或者：</p><br><div class="panel" style="background-color: black;border-width: 1px;"><div class="panelContent" style="background-color: black;"><br><p><font color="white">echo status | nc -i 1 localhost 20880</font></p><br></div></div><br><br><p>telnet命令可以扩展，参见：<a href="javascript:if(confirm(%27http://b2b-doc.alibaba-inc.com/display/RC/Dubbo_SPI_Reference  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://b2b-doc.alibaba-inc.com/display/RC/Dubbo_SPI_Reference%27" tppabs="http://b2b-doc.alibaba-inc.com/display/RC/Dubbo_SPI_Reference" class="external-link" rel="external" target="_blank">扩展参考手册</a>第6条。<br><br>status命令所检查的资源也可以扩展，参见：<a href="javascript:if(confirm(%27http://b2b-doc.alibaba-inc.com/display/RC/Dubbo_SPI_Reference  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://b2b-doc.alibaba-inc.com/display/RC/Dubbo_SPI_Reference%27" tppabs="http://b2b-doc.alibaba-inc.com/display/RC/Dubbo_SPI_Reference" class="external-link" rel="external" target="_blank">扩展参考手册</a>第5条。</p>

<h3><a name="UserGuide-zh-ls"></a>ls</h3><br><p>(list services and methods)</p><br><br><p>ls</p><br><br><p>显示服务列表。</p><br><br><p>ls -l </p><br><br><p>显示服务详细信息列表。</p><br><br><p>ls XxxService</p><br><br><p>显示服务的方法列表。</p><br><br><p>ls -l XxxService</p><br><br><p>显示服务的方法详细信息列表。</p><br><br><h3><a name="UserGuide-zh-ps"></a>ps</h3><br><p>(print server ports and connections)</p><br><br><p>ps</p><br><br><p>显示服务端口列表。</p><br><br><p>ps -l </p><br><br><p>显示服务地址列表。</p><br><br><p>ps 20880</p><br><br><p>显示端口上的连接信息。</p><br><br><p>ps -l 20880</p><br><br><p>显示端口上的连接详细信息。</p><br><br><h3><a name="UserGuide-zh-cd"></a>cd</h3><br><p>(change default service)</p><br><br><p>cd XxxService</p><br><br><p>改变缺省服务，当设置了缺省服务，凡是需要输入服务名作为参数的命令，都可以省略服务参数。</p><br><br><p>cd /</p><br><br><p>取消缺省服务。</p><br><br><h3><a name="UserGuide-zh-pwd"></a>pwd</h3><br><p>(print working default service)</p><br><br><p>pwd</p><br><br><p>显示当前缺省服务。</p><br><br><h3><a name="UserGuide-zh-trace"></a>trace</h3>

<p>trace XxxService</p>

<p>跟踪1次服务任意方法的调用情况。</p>

<p>trace XxxService 10</p>

<p>跟踪10次服务任意方法的调用情况。</p>

<p>trace XxxService xxxMethod</p>

<p>跟踪1次服务方法的调用情况</p>

<p>trace XxxService xxxMethod 10</p>

<p>跟踪10次服务方法的调用情况。</p>

<h3><a name="UserGuide-zh-count"></a>count</h3>

<p>count XxxService</p>

<p>统计1次服务任意方法的调用情况。</p>

<p>count XxxService 10</p>

<p>统计10次服务任意方法的调用情况。</p>

<p>count XxxService xxxMethod</p>

<p>统计1次服务方法的调用情况。</p>

<p>count XxxService xxxMethod 10</p>

<p>统计10次服务方法的调用情况。</p>

<h3><a name="UserGuide-zh-invoke"></a>invoke</h3>

<p>invoke XxxService.xxxMethod({“prop”: “value”})</p>

<p>调用服务的方法。</p>

<p>invoke xxxMethod({“prop”: “value”})</p>

<p>调用服务的方法(自动查找包含此方法的服务)。</p>

<h3><a name="UserGuide-zh-status"></a>status </h3>

<p>status</p>

<p>显示汇总状态，该状态将汇总所有资源的状态，当全部OK时则显示OK，只要有一个ERROR则显示ERROR，只要有一个WARN则显示WARN。</p>

<p>status -l</p>

<p>显示状态列表。</p>

<h3><a name="UserGuide-zh-log"></a>log</h3><br><p><em>2.0.6以上版本支持</em></p><br><br><p>log debug <br><br>修改dubbo logger的日志级别</p><br><br><p>log 100<br><br>查看file logger的最后100字符的日志</p><br><br><h3><a name="UserGuide-zh-help"></a>help</h3>

<p>help</p>

<p>显示telnet命帮助信息。</p>

<p>help xxx</p>

<p>显示xxx命令的详细帮助信息。</p>

<h3><a name="UserGuide-zh-clear"></a>clear</h3>

<p>clear</p>

<p>清除屏幕上的内容。</p>

<p>clear 100</p>

<p>清除屏幕上的指定行数的内容。</p>

<h3><a name="UserGuide-zh-exit"></a>exit</h3>

<p>exit</p>

<p>退出当前telnet命令行。</p><br><h2><a name="UserGuide-zh-Maven%E6%8F%92%E4%BB%B6%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C"></a>Maven插件参考手册</h2><br><p>(<a href="Maven+Plugin+Reference-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Maven+Plugin+Reference-zh" title="Maven Plugin Reference-zh">+</a>) (<a href="#UserGuide-zh-Maven%E6%8F%92%E4%BB%B6%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C">#</a>)</p>

<h3><a name="UserGuide-zh-mvndubbo%3Aregistry"></a>mvn dubbo:registry</h3>

<p>mvn dubbo:registry<br><br>以缺省的9090端口启动一个简易注册中心</p>

<p>mvn dubbo:registry &#45;Dport=9099<br><br>以指定的9099端口启动一个简易注册中心</p>

<h3><a name="UserGuide-zh-mvndubbo%3Acreate"></a>mvn dubbo:create</h3><br><p><font color="red">(尚未发布)</font></p><br><br><p>mvn dubbo:create<br><br>生成demo服务提供者应用</p><br><br><p>mvn dubbo:create &#45;Dapplication=xxx &#45;Dpackage=com.alibaba.xxx &#45;Dservice=XxxService,YyyService &#45;Dversion=1.0.0<br><br>生成指定接口和版本的服务提供者应用</p><br><h2><a name="UserGuide-zh-%E6%9C%8D%E5%8A%A1%E5%8C%96%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"></a>服务化最佳实践</h2><br><br><p>(<a href="Service+Best+Practices-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Service+Best+Practices-zh" title="Service Best Practices-zh">+</a>) (<a href="#UserGuide-zh-%E6%9C%8D%E5%8A%A1%E5%8C%96%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">&#35;</a>)</p><br><br><h3><a name="UserGuide-zh-%E5%88%86%E5%8C%85"></a>分包</h3>

<ul><br>    <li>建议将服务接口，服务模型，服务异常等均放在API包中，因为服务模型及异常也是API的一部分，<br><br>同时，这样做也符合分包原则：重用发布等价原则(REP)，共同重用原则(CRP)</li><br>    <li>如果需要，也可以考虑在API包中放置一份spring的引用配置，这样使用方，只需在Spring加载过程中引用此配置即可，<br><br>配置建议放在模块的包目录下，以免冲突，如：com/alibaba/china/xxx/dubbo-reference.xml</li><br></ul>


<h3><a name="UserGuide-zh-%E7%B2%92%E5%BA%A6"></a>粒度</h3>

<ul><br>    <li>服务接口尽可能大粒度，每个服务方法应代表一个功能，而不是某功能的一个步骤，否则将面临分布式事务问题，Dubbo暂未提供分布式事务支持。</li><br>    <li>服务接口建议以业务场景为单位划分，并对相近业务做抽象，防止接口数量爆炸</li><br>    <li>不建议使用过于抽象的通用接口，如：Map query(Map)，这样的接口没有明确语义，会给后期维护带来不便。</li><br></ul>


<h3><a name="UserGuide-zh-%E7%89%88%E6%9C%AC"></a>版本</h3>

<ul><br>    <li>每个接口都应定义版本号，为后续不兼容升级提供可能，如：&lt;dubbo:service interface=”com.xxx.XxxService” version=”1.0” /&gt;</li><br>    <li>建议使用两位版本号，因为第三位版本号通常表示兼容升级，只有不兼容时才需要变更服务版本。</li><br>    <li>当不兼容时，先升级一半提供者为新版本，再将消费者全部升为新版本，然后将剩下的一半提供者升为新版本。</li><br></ul>


<h3><a name="UserGuide-zh-%E5%85%BC%E5%AE%B9%E6%80%A7"></a>兼容性</h3>

<ul><br>    <li>服务接口增加方法，或服务模型增加字段，可向后兼容，删除方法或删除字段，将不兼容，枚举类型新增字段也不兼容，需通过变更版本号升级。</li><br>    <li>各协议的兼容性不同，参见： <a href="Protocol+Reference-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Protocol+Reference-zh" title="Protocol Reference-zh">服务协议</a></li><br></ul>


<h3><a name="UserGuide-zh-%E6%9E%9A%E4%B8%BE%E5%80%BC"></a>枚举值</h3>

<ul><br>    <li>如果是完备集，可以用Enum，比如：ENABLE, DISABLE。</li><br>    <li>如果是业务种类，以后明显会有类型增加，不建议用Enum，可以用String代替。</li><br>    <li>如果是在返回值中用了Enum，并新增了Enum值，建议先升级服务消费方，这样服务提供方不会返回新值。</li><br>    <li>如果是在传入参数中用了Enum，并新增了Enum值，建议先升级服务提供方，这样服务消费方不会传入新值。</li><br></ul>


<h3><a name="UserGuide-zh-%E5%BA%8F%E5%88%97%E5%8C%96"></a>序列化</h3>

<ul><br>    <li>服务参数及返回值建议使用POJO对象，即通过set,get方法表示属性的对象。</li><br>    <li>服务参数及返回值不建议使用接口，因为数据模型抽象的意义不大，并且序列化需要接口实现类的元信息，并不能起到隐藏实现的意图。</li><br>    <li>服务参数及返回值都必需是byValue的，而不能是byRef的，消费方和提供方的参数或返回值引用并不是同一个，只是值相同，Dubbo不支持引用远程对象。</li><br></ul>


<h3><a name="UserGuide-zh-%E5%BC%82%E5%B8%B8"></a>异常</h3>

<ul><br>    <li>建议使用异常汇报错误，而不是返回错误码，异常信息能携带更多信息，以及语义更友好，</li><br>    <li>如果担心性能问题，在必要时，可以通过override掉异常类的fillInStackTrace()方法为空方法，使其不拷贝栈信息，</li><br>    <li>查询方法不建议抛出checked异常，否则调用方在查询时将过多的try…catch，并且不能进行有效处理，</li><br>    <li>服务提供方不应将DAO或SQL等异常抛给消费方，应在服务实现中对消费方不关心的异常进行包装，否则可能出现消费方无法反序列化相应异常。</li><br></ul>


<h3><a name="UserGuide-zh-%E8%B0%83%E7%94%A8"></a>调用</h3>

<ul><br>    <li>不要只是因为是Dubbo调用，而把调用Try-Catch起来。Try-Catch应该加上合适的回滚边界上。</li><br>    <li>对于输入参数的校验逻辑在Provider端要有。如有性能上的考虑，服务实现者可以考虑在API包上加上服务Stub类来完成检验。</li><br></ul>

<h2><a name="UserGuide-zh-%E6%8E%A8%E8%8D%90%E7%94%A8%E6%B3%95"></a>推荐用法</h2><br><p>(<a href="Recommended+Usage-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Recommended+Usage-zh" title="Recommended Usage-zh">+</a>) (<a href="#UserGuide-zh-%E6%8E%A8%E8%8D%90%E7%94%A8%E6%B3%95">#</a>)</p><br><br><h4><a name="UserGuide-zh-%E5%9C%A8Provider%E4%B8%8A%E5%B0%BD%E9%87%8F%E5%A4%9A%E9%85%8D%E7%BD%AEConsumer%E7%AB%AF%E5%B1%9E%E6%80%A7"></a>在Provider上尽量多配置Consumer端属性</h4><br><br><p>原因如下：</p><br><ol><br>    <li>作服务的提供者，比服务使用方<font color="red">更清楚</font>服务性能参数，如调用的超时时间，合理的重试次数，等等</li><br>    <li>在Provider配置后，Consumer不配置则会使用Provider的配置值，即Provider配置可以作为Consumer的缺省值。<br><br>否则，Consumer会使用<font color="brown">Consumer端的全局设置</font>，这对于Provider<font color="red"><b>不可控的</b></font>，并且往往是<font color="red"><b>不合理的</b></font>。<br><br>PS: 配置的覆盖规则：1) 方法级配置别优于接口级别，即小Scope优先 2) Consumer端配置 优于 Provider配置 优于 全局配置，最后是Dubbo Hard Code的配置值（见配置文档）<br><br>配置的覆盖规则详见： <a href="#UserGuide-zh-ConfigurationReference">Dubbo配置参考手册</a></li><br></ol><br><br><br><br><p>Provider上尽量多配置Consumer端的属性，让Provider实现者一开始就思考Provider服务特点、服务质量的问题。</p><br><br><p>示例：</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.alibaba.hello.api.HelloService” version=”1.0.0” ref=”helloService”<br>    timeout=”300” retry=”2” loadbalance=”random” actives=”0”<br>/&gt;<br><br>&lt;dubbo:service interface=”com.alibaba.hello.api.WorldService” version=”1.0.0” ref=”helloService”<br>    timeout=”300” retry=”2” loadbalance=”random” actives=”0” &gt;<br>    &lt;dubbo:method name=”findAllPerson” timeout=”10000” retries=”9” loadbalance=”leastactive” actives=”5” /&gt;<br>&lt;dubbo:service/&gt;]]&gt;</script><br></div></div><br><p>在Provider可以配置的Consumer端属性有：</p><br><br><ol><br>    <li><b>timeout</b>，方法调用超时</li><br>    <li><b>retries</b>，失败重试次数，缺省是2（表示加上第一次调用，会调用3次）</li><br>    <li><b>loadbalance</b>，负载均衡算法（有多个Provider时，如何挑选Provider调用），缺省是随机（random）。<br><br>还可以有轮训(roundrobin)、最不活跃优先（leastactive，指从Consumer端并发调用最好的Provider，可以减少的反应慢的Provider的调用，因为反应更容易累积并发的调用）</li><br>    <li><b>actives</b>，消费者端，最大并发调用限制，即当Consumer对一个服务的并发调用到上限后，新调用会Wait直到超时。<br><br>在方法上配置（dubbo:method ）则并发限制针对方法，在接口上配置（dubbo:service），则并发限制针对服务。</li><br></ol><br><br><br><p>详细配置说明参见：<a href="#UserGuide-zh-ConfigurationReference">Dubbo配置参考手册</a>&nbsp;</p><br><br><h4><a name="UserGuide-zh-Provider%E4%B8%8A%E9%85%8D%E7%BD%AE%E5%90%88%E7%90%86%E7%9A%84Provider%E7%AB%AF%E5%B1%9E%E6%80%A7"></a>Provider上配置合理的Provider端属性</h4><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:protocol threads=”200” /&gt;<br><br>&lt;dubbo:service interface=”com.alibaba.hello.api.HelloService” version=”1.0.0” ref=”helloService”<br>    executes=”200” &gt;<br>    &lt;dubbo:method name=”findAllPerson” executes=”50” /&gt;<br>&lt;/dubbo:service&gt;]]&gt;</script><br></div></div><br><br><p>Provider上可以配置的Provider端属性有：</p><br><br><ol><br>    <li><b>threads</b>，服务线程池大小</li><br>    <li><b>executes</b>，一个服务提供者并行执行请求上限，即当Provider对一个服务的并发调用到上限后，新调用会Wait（Consumer可能到超时）。在方法上配置（dubbo:method ）则并发限制针对方法，在接口上配置（dubbo:service），则并发限制针对服务。</li><br></ol><br><br><br><h4><a name="UserGuide-zh-%E9%85%8D%E7%BD%AE%E4%B8%8A%E7%AE%A1%E7%90%86%E4%BF%A1%E6%81%AF"></a>配置上管理信息</h4><br><br><p>目前有<font color="red"><b>负责人</b></font>信息和<font color="red"><b>组织</b></font>信息（用于区分站点）。</p><br><br><p>有问题时便于的找到服务的负责人，至少写<b>两个人</b>以便备份。</p><br><br><p>负责人和组织的信息可以在注册中心的上看到。</p><br><br><p>示例：</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>应用配置负责人、组织</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:application owner=”ding.lid,william.liangf” organization=”intl” /&gt;]]&gt;</script><br></div></div><br><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>service配置负责人</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:service owner=”ding.lid,william.liangf” /&gt;]]&gt;</script><br></div></div><br><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>reference配置负责人</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:reference owner=”ding.lid,william.liangf” /&gt;]]&gt;</script><br></div></div><br><br><p>dubbo:service、dubbo:reference没有配置负责人，则使用dubbo:application设置的负责人。</p><br><br><h4><a name="UserGuide-zh-%E9%85%8D%E7%BD%AE%E4%B8%8ADubbo%E7%BC%93%E5%AD%98%E6%96%87%E4%BB%B6"></a>配置上Dubbo缓存文件</h4><br><br><p>配置方法如下：</p><br><br><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>提供者列表缓存文件</b></div><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: xml; gutter: false">&lt;![CDATA[&lt;dubbo:registry file=”${user.home}/output/dubbo.cache” /&gt;]]&gt;</script><br></div></div><br><br><p>注意：</p><br><br><ol><br>    <li>文件的路径，应用可以根据需要调整，保证这个文件<font color="red">不会</font>在发布过程中被清除。</li><br>    <li>如果有多个应用进程注意不要使用同一个文件，避免内容被<font color="red">覆盖</font>。</li><br></ol><br><br><br><p>这个文件会缓存：</p><br><br><ol><br>    <li>注册中心的列表</li><br>    <li>服务提供者列表</li><br></ol><br><br><br><p>有了这项配置后，当应用重启过程中，Dubbo注册中心不可用时则应用会从这个缓存文件读取服务提供者列表的信息，进一步保证应用可靠性。</p><br><br><h4><a name="UserGuide-zh-%E7%9B%91%E6%8E%A7%E9%85%8D%E7%BD%AE"></a>监控配置</h4><br><br><br><h5><a name="UserGuide-zh-1.%E4%BD%BF%E7%94%A8%E5%9B%BA%E5%AE%9A%E7%AB%AF%E5%8F%A3%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1%EF%BC%8C%E8%80%8C%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8%E9%9A%8F%E6%9C%BA%E7%AB%AF%E5%8F%A3"></a>1. 使用固定端口暴露服务，而不要使用随机端口</h5><br><br><p>这样在注册中心推送有延迟的情况下，消费者通过缓存列表也能调用到原地址，保证调用成功。</p><br><br><br><h5><a name="UserGuide-zh-3.%E4%BD%BF%E7%94%A8Dragoon%E7%9A%84http%E7%9B%91%E6%8E%A7%E9%A1%B9%E7%9B%91%E6%8E%A7%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E4%B8%8A%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9"></a>3. 使用Dragoon的http监控项监控注册中心上服务提供方</h5><br><br><p>Dragoon监控服务在注册中心上的状态：<a href="javascript:if(confirm(%27http://dubbo-reg1.hst.xyi.cn.alidc.net:8080/status/com.alibaba.morgan.member.MemberService:1.0.5  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://dubbo-reg1.hst.xyi.cn.alidc.net:8080/status/com.alibaba.morgan.member.MemberService:1.0.5%27" tppabs="http://dubbo-reg1.hst.xyi.cn.alidc.net:8080/status/com.alibaba.morgan.member.MemberService:1.0.5" class="external-link" rel="external" target="_blank">http://dubbo-reg1.hst.xyi.cn.alidc.net:8080/status/com.alibaba.morgan.member.MemberService:1.0.5</a>，确保注册中心上有该服务的存在。</p><br><br><h5><a name="UserGuide-zh-4.%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%EF%BC%8C%E4%BD%BF%E7%94%A8Dragoon%E7%9A%84telnet%E6%88%96shell%E7%9B%91%E6%8E%A7%E9%A1%B9"></a>4. 服务提供方，使用Dragoon的telnet或shell监控项</h5><br><br><p>监控服务提供者端口状态：echo status &#124; nc &#45;-i 1 20880 &#124; grep OK &#124; wc &#45;-l，其中的20880为服务端口</p><br><br><h5><a name="UserGuide-zh-5.%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E6%96%B9%EF%BC%8C%E9%80%9A%E8%BF%87%E5%B0%86%E6%9C%8D%E5%8A%A1%E5%BC%BA%E5%88%B6%E8%BD%AC%E5%9E%8B%E4%B8%BAEchoService%EF%BC%8C%E5%B9%B6%E8%B0%83%E7%94%A8%24echo%28%29%E6%B5%8B%E8%AF%95%E8%AF%A5%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%8F%90%E4%BE%9B%E8%80%85%E6%98%AF%E5%8F%AF%E7%94%A8"></a>5. 服务消费方，通过将服务强制转型为EchoService，并调用$echo()测试该服务的提供者是可用</h5><br><br><p>如 assertEqauls(“OK”, ((EchoService)memberService).$echo(“OK”));</p><br><br><br><h4><a name="UserGuide-zh-%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8dubbo.properties%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE%EF%BC%8C%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E5%AF%B9%E5%BA%94XML%E9%85%8D%E7%BD%AE"></a>不要使用dubbo.properties文件配置，推荐使用对应XML配置</h4><br><br><p>Dubbo2中所有的配置项都可以Spring配置中，并且可以针对单个服务配置。</p><br><br><p>&#35; 如完全不配置使用Dubbo缺省值，参见<a href="#UserGuide-zh-ConfigurationReference">Dubbo配置参考手册</a>中的说明。</p><br><br><p>在Dubbo1中需要在dubbo.properties文件中的配置项，Dubbo2中配置示例如下：</p><br><br><h5><a name="UserGuide-zh-1.%E5%BA%94%E7%94%A8%E5%90%8D%26nbsp%3B"></a>1. 应用名&nbsp;</h5><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[&lt;dubbo:application name=”myalibaba” &gt;]]&gt;</script><br></div></div><br><br><p>对应dubbo.properties中的Key名dubbo.application.name</p><br><br><h5><a name="UserGuide-zh-2.%26nbsp%3B%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%9C%B0%E5%9D%80"></a>2.&nbsp;注册中心地址</h5><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[&lt;dubbo:registry address=”11.22.33.44:9090” &gt;]]&gt;</script><br></div></div><br><br><p>对应dubbo.properties中的Key名dubbo.registry.address</p><br><br><h5><a name="UserGuide-zh-3.%E8%B0%83%E7%94%A8%E8%B6%85%E6%97%B6"></a>3. 调用超时</h5><br><br><p>可以在多个配置项设置超时，由上至下<font color="#ff0000"><b>覆盖</b></font>（即上面的优先），示例如下：</p><br><br><p>&#35; 其它的参数（retries、loadbalance、actives等）的覆盖策略也一样。</p><br><br><p>提供者端特定方法的配置</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.alibaba.xxx.XxxService” &gt;<br>    &lt;dubbo:method name=”findPerson” timeout=”1000” /&gt;<br>&lt;/dubbo:service&gt;]]&gt;</script><br></div></div><br><br><p>提供者端特定接口的配置</p><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[&lt;dubbo:service interface=”com.alibaba.xxx.XxxService” timeout=”200” /&gt;]]&gt;</script><br></div></div><br><br><p>&#35; timeout可以在多处设置，配置项及覆盖规则详见：&nbsp;<a href="#UserGuide-zh-ConfigurationReference">Dubbo配置参考手册</a></p><br><br><p>全局配置项值，对应dubbo.properties中的Key名dubbo.service.invoke.timeout</p><br><br><h5><a name="UserGuide-zh-5.%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85%E5%8D%8F%E8%AE%AE%E3%80%81%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%9B%91%E5%90%AC%E7%AB%AF%E5%8F%A3"></a>5. 服务提供者协议、服务的监听端口</h5><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[&lt;dubbo:protocol name=”dubbo” port=”20880” /&gt;]]&gt;</script><br></div></div><br><br><p>对应dubbo.properties中的Key名dubbo.service.protocol、dubbo.service.server.port</p><br><br><h5><a name="UserGuide-zh-4.%26nbsp%3B%E6%9C%8D%E5%8A%A1%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%A4%A7%E5%B0%8F"></a>4.&nbsp;服务线程池大小</h5><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[&lt;dubbo:protocol threads=”100” /&gt;]]&gt;</script><br></div></div><br><br><p>对应dubbo.properties中的Key名dubbo.service.max.thread.threads.size</p><br><br><h5><a name="UserGuide-zh-6.%E6%B6%88%E8%B4%B9%E8%80%85%E5%90%AF%E5%8A%A8%E6%97%B6%EF%BC%8C%E6%B2%A1%E6%9C%89%E6%8F%90%E4%BE%9B%E8%80%85%E6%98%AF%E5%90%A6%E6%8A%9B%E5%BC%82%E5%B8%B8FastFail"></a>6. 消费者启动时，没有提供者是否抛异常Fast-Fail</h5><br><br><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[&lt;dubbo:reference interface=”com.alibaba.xxx.XxxService” check=”false” /&gt;]]&gt;</script><br></div></div><br><br><br><p>对应dubbo.properties中的Key名alibaba.intl.commons.dubbo.service.allow.no.provider</p><br><h2><a name="UserGuide-zh-%E5%AE%B9%E9%87%8F%E8%A7%84%E5%88%92"></a>容量规划</h2><br><p>(<a href="Capacity+Estimated-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Capacity+Estimated-zh" title="Capacity Estimated-zh">+</a>) (<a href="#UserGuide-zh-%E5%AE%B9%E9%87%8F%E8%A7%84%E5%88%92">#</a>)</p><br><br><p>以下数据供参考：</p><br><br><h4><a name="UserGuide-zh-%E4%BD%BF%E7%94%A8Dubbo%E7%9A%84%E4%BC%9A%E5%91%98%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE"></a>使用Dubbo的会员服务项目</h4><br><br><ul><br>    <li>每天接收4亿次远程调用</li><br>    <li>使用12台网站标配机器提供服务(8核CPU,8G内存)</li><br>    <li>平均负载在1以下(对于8核CPU负载很低)</li><br>    <li>平均响应时间2.3到2.5毫秒，网络开销约占1.5到1.6毫秒(和数据包大小有关)</li><br></ul><br><br><br><h4><a name="UserGuide-zh-%E4%BD%BF%E7%94%A8Dubbo%E7%9A%84%E4%BA%A7%E5%93%81%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE"></a>使用Dubbo的产品授权服务项目</h4><br><br><ul><br>    <li>每天接收3亿次远程调用</li><br>    <li>使用8台网站标配机器提供服务(8核CPU,8G内存)</li><br>    <li>平均负载在1以下(对于8核CPU负载很低)</li><br>    <li>平均响应时间1.4到2.8毫秒，网络开销约占1.0到1.1毫秒(和数据包大小有关)</li><br></ul><br><br><h2><a name="UserGuide-zh-%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E5%8C%85"></a>基准测试工具包</h2><br><p>(<a href="Benchmark+Test+Toolkit-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Benchmark+Test+Toolkit-zh" title="Benchmark Test Toolkit-zh">+</a>) (<a href="#UserGuide-zh-%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E5%8C%85">#</a>)</p><br><br><h4><a name="UserGuide-zh-%E4%B8%8B%E8%BD%BDbenchmark%E5%8E%8B%E7%BC%A9%E5%8C%85%EF%BC%8C%E5%B9%B6%E8%A7%A3%E5%8E%8B"></a>下载benchmark压缩包，并解压</h4><br><p><a href="javascript:if(confirm(%27http://code.alibabatech.com/wiki/download/attachments/7669075/dubbo.benchmark-2.0.14.tar.gz  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://code.alibabatech.com/wiki/download/attachments/7669075/dubbo.benchmark-2.0.14.tar.gz%27" tppabs="http://code.alibabatech.com/wiki/download/attachments/7669075/dubbo.benchmark-2.0.14.tar.gz" class="external-link" rel="external" target="_blank">dubbo.benchmark-2.0.14.tar.gz</a></p><br><br><h4><a name="UserGuide-zh-%E9%98%85%E8%AF%BBReadMe.txt%EF%BC%88%E5%86%85%E5%AE%B9%E5%A6%82%E4%B8%8B%EF%BC%8C%E8%AF%B7%E4%BB%A5%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%86%85%E7%9A%84%E4%B8%BA%E5%87%86%EF%BC%89"></a>阅读ReadMe.txt（内容如下，请以压缩包内的为准）</h4><br><p>一、新建一个benchmark工程，如demo.benchmark<br><br>二、导入自己服务的接口api包和dubbo.benchmark.jar(解压dubbo.benchmark.tar.gz，在lib目录下)<br><br>三、新建一个类，实现AbstractClientRunnable<br><br>    a、实现父类的构造函数<br><br>    b、实现invoke方法，通过serviceFactory创建本地接口代理，并实现自己的业务逻辑，如下</p><br>        <div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><br><script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false">&lt;![CDATA[public Object invoke(ServiceFactory serviceFactory) {<br>        DemoService demoService = (DemoService) serviceFactory.get(DemoService.class);<br>        return demoService.sendRequest(“hello”);<br>    }]]&gt;</script><br></div></div><br><p>四、将自己的benchmark工程打成jar包,如demo.benchmark.jar<br><br>五、将demo.benchmark.jar 和服务的api包放到dubbo.benchmark/lib目录下<br><br>六、配置duubo.properties<br><br>七、运行run.bat(windows)或run.sh(linux)</p><br><br><p>如想测试dubbo的不同版本，直接替换lib下的dubbo的jar包即可。</p><br><h2><a name="UserGuide-zh-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A"></a>性能测试报告</h2><br><p>(<a href="Performance+Test+Report-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Performance+Test+Report-zh" title="Performance Test Report-zh">+</a>) (<a href="#UserGuide-zh-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A">#</a>)</p><br><br><h3><a name="UserGuide-zh-%E6%B5%8B%E8%AF%95%E8%AF%B4%E6%98%8E"></a>测试说明</h3><br><br><p>a、本次性能测试，测试了dubbo2.0所有支持的协议在不同大小和数据类型下的表现，并与dubbo1.0进行了对比。</p><br><br><p>b、整体性能相比1.0有了提升，平均提升10%，使用dubbo2.0新增的dubbo序列化还能获得10%~50%的性能提升，详见下面的性能数据。</p><br><br><p>c、稳定性测试中由于将底层通信框架从mina换成netty，old区对象的增长大大减少，50小时运行，增长不到200m，无fullgc。（可以确认为mina在高并发下的设计缺陷）</p><br><br><p>d、存在的问题：在50k数据的时候2.0性能不如1.0，怀疑可能是缓冲区设置的问题，下版本会进一步确认。<br><br class="atl-forced-newline"></p><br><br><h3><a name="UserGuide-zh-%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83"></a>测试环境</h3><br><br><h4><a name="UserGuide-zh-"></a><font color="#000000">2.1</font> <font color="#000000">硬件部署与参数调整</font></h4><br><br><p>主机/ip<br><br>硬件配置<br><br>操作系统及参数调整</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><td class="confluenceTd"> <font color="black">10.20.153.11</font> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> <font color="black">机型</font> </td><br><td class="confluenceTd"> <font color="black">Tecal&nbsp;BH620</font> </td><br></tr><br><tr><br><td class="confluenceTd"> <font color="black">CPU</font> </td><br><td class="confluenceTd"> <font color="black">model&nbsp;name :&nbsp;Intel(R)&nbsp;Xeon(R)&nbsp;CPU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbnbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E5520&nbsp;&nbsp;@&nbsp;2.27GHz cache&nbsp;size :&nbsp;8192&nbsp;KB processor_count&nbsp;:&nbsp;16</font> </td><br></tr><br><tr><br><td class="confluenceTd"> <font color="black">内存</font> </td><br><td class="confluenceTd"> <font color="black">Total&nbsp;System&nbsp;Memory:&nbsp;6G Hardware&nbsp;Memory&nbsp;Info:&nbsp; Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown</font> </td><br></tr><br><tr><br><td class="confluenceTd"> <font color="black">网络</font> </td><br><td class="confluenceTd"> <font color="black">Total&nbsp;System&nbsp;Memory:&nbsp;6G Hardware&nbsp;Memory&nbsp;Info:&nbsp; Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown</font> </td><br></tr><br><tr><br><td class="confluenceTd"> <font color="black">磁盘</font> </td><br><td class="confluenceTd"> <font color="black">/dev/sda:&nbsp;597.9&nbsp;GB,</font> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> <font color="black">2.6.18-128.el5xen&nbsp;x86_64</font> </td><br></tr><br><tr><br><td class="confluenceTd"> <font color="black">10.20.153.10</font> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> <font color="black">机型</font> </td><br><td class="confluenceTd"> <font color="black">Tecal&nbsp;BH620</font> </td><br></tr><br><tr><br><td class="confluenceTd"> <font color="black">CPU</font> </td><br><td class="confluenceTd"> <font color="black">model&nbsp;name :&nbsp;Intel(R)&nbsp;Xeon(R)&nbsp;CPU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E5520&nbsp;&nbsp;@&nbsp;2.27GHz cache&nbsp;size :&nbsp;8192&nbsp;KB processor_count&nbsp;:&nbsp;16</font> </td><br></tr><br><tr><br><td class="confluenceTd"> <font color="black">内存</font> </td><br><td class="confluenceTd"> <font color="black">Total&nbsp;System&nbsp;Memory:&nbsp;6G Hardware&nbsp;Memory&nbsp;Info:&nbsp; Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown Size:&nbsp;4096MB,&nbsp;1066MHz(0.9ns) Size:&nbsp;NoModule,&nbsp;Unknown</font> </td><br></tr><br><tr><br><td class="confluenceTd"> <font color="black">网络</font> </td><br><td class="confluenceTd"> <font color="black">eth0:&nbsp;Link&nbsp;is&nbsp;up&nbsp;at&nbsp;1000&nbsp;Mbps,&nbsp;full&nbsp;duplex.&nbsp;peth0:&nbsp;Link&nbsp;is&nbsp;up&nbsp;at&nbsp;1000&nbsp;Mbps,&nbsp;full&nbsp;duplex.</font> </td><br></tr><br><tr><br><td class="confluenceTd"> <font color="black">磁盘</font> </td><br><td class="confluenceTd"> <font color="black">/dev/sda:&nbsp;597.9&nbsp;GB,</font> </td><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> <font color="black">2.6.18-128.el5xen&nbsp;x86_64</font> </td><br></tr><br></tbody></table><br></div><br><br><p><br class="atl-forced-newline"></p><br><br><h4><a name="UserGuide-zh-"></a><font color="#000000">2.2</font> <font color="#000000">软件架构</font></h4><br><br><p>主机/ip<br><br>软件名称及版本<br><br>关键参数</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> <font color="black">java&nbsp;version&nbsp;”1.6.0_18” Java(TM)&nbsp;SE&nbsp;Runtime&nbsp;Environment&nbsp;(build&nbsp;1.6.0<em>18-b07) Java&nbsp;HotSpot(TM)&nbsp;64-Bit&nbsp;Server&nbsp;VM&nbsp;(build&nbsp;16.0-b13,&nbsp;mixed&nbsp;mode)</em></font> </td><br><td class="confluenceTd"> <font color="black">&#45;server&nbsp;-Xmx2g&nbsp;-Xms2g&nbsp;-Xmn256m&nbsp;-XX:PermSize=128m&nbsp;-Xss256k&nbsp;-XX:+DisableExplicitGC&nbsp;-XX:+UseConcMarkSweepGC&nbsp;-XX:+CMSParallelRemarkEnabled&nbsp;-XX:+UseCMSCompactAtFullCollection&nbsp;-XX:LargePageSizeInBytes=128m&nbsp;-XX:+UseFastAccessorMethods&nbsp;-XX:+UseCMSInitiatingOccupancyOnly&nbsp;-XX:CMSInitiatingOccupancyFraction=70</font> </td><br></tr><br><tr><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> <font color="black">jboss-4.0.5.GA</font> </td><br><td class="confluenceTd">&nbsp;</td><br></tr><br><tr><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> <font color="black">httpd-2.0.61</font> </td><br><td class="confluenceTd"> <font color="black">KeepAlive&nbsp;On MaxKeepAliveRequests&nbsp;100000 KeepAliveTimeout&nbsp;180 MaxRequestsPerChild&nbsp;1000000 &lt;IfModule&nbsp;worker.c&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StartServers&nbsp;5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxClients&nbsp;1024 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MinSpareThreads&nbsp;25 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxSpareThreads&nbsp;75 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadsPerChild&nbsp;64 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadLimit&nbsp;128 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerLimit&nbsp;16 &lt;/IfModule&gt;</font> </td><br></tr><br></tbody></table><br></div><br><br><p><br class="atl-forced-newline"></p><br><br><h3><a name="UserGuide-zh-%E6%B5%8B%E8%AF%95%E7%9B%AE%E7%9A%84"></a>测试目的</h3><br><br><p><br class="atl-forced-newline"></p><br><br><h4><a name="UserGuide-zh-"></a><font color="#000000">3.1</font> <font color="#000000">期望性能指标</font><font color="#000000">(</font><font color="#000000">量化</font><font color="#000000">)</font></h4><br><br><p>场景名称<br><br>对应指标名称<br><br>期望值范围<br><br>实际值<br><br>是否满足期望(是/否)</p><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><td class="confluenceTd"> 1k数据 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 响应时间 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 0.9ms <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 0.79ms <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 是 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> 1k数据 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> TPS <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 10000 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 11994 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 是 <br class="atl-forced-newline"> </td><br></tr><br></tbody></table><br></div><br><br><p><br class="atl-forced-newline"></p><br><br><h4><a name="UserGuide-zh-"></a><font color="#000000">3.2</font> <font color="#000000">期望运行状况</font><font color="#000000">(</font><font color="#000000">非量化，可选</font><font color="#000000">)</font></h4><br><br><p>2.0性能不低于1.0,2.0和1.0互调用的性能无明显下降。 除了50k string其余皆通过<br><br>JVM内存运行稳定，无OOM，堆内存中无不合理的大对象的占用。通过<br><br>CPU、内存、网络、磁盘、文件句柄占用平稳。通过<br><br>无频繁线程锁，线程数平稳。通过<br><br>业务线程负载均衡。通过<br><br>&nbsp;</p><br><br><h3><a name="UserGuide-zh-%E6%B5%8B%E8%AF%95%E8%84%9A%E6%9C%AC"></a>测试脚本</h3><br><br><p>1、性能测试场景（10并发）</p><br><br><p>a、传入1kString，不做任何处理，原样返回</p><br><br><p>b、传入50kString，不做任何处理，原样返回</p><br><br><p>c、传入200kString，不做任何处理，原样返回</p><br><br><p>d、传入1k pojo（嵌套的复杂person对象），不做任何处理，原样返回</p><br><br><p>上述场景在dubbo1.0\dubbo2.0(hessian2序列化)\dubbo2.0(dubbo序列化)\rmi\hessian3.2.0\http(json序列化)进行10分钟的性能测试。 主要考察序列化和网络IO的性能，因此服务端无任何业务逻辑。取10并发是考虑到http协议在高并发下对CPU的使用率较高可能会先打到瓶颈。<br><br class="atl-forced-newline"></p><br><br><p>2、并发场景（20并发）</p><br><br><p>传入1kString，在服务器段循环1w次，每次重新生成一个随机数然后进行拼装。</p><br><br><p>考察业务线程是否能够分配到每个CPU上。<br><br class="atl-forced-newline"></p><br><br><p>3、稳定性场景（20并发）</p><br><br><p>同时调用1个参数为String（5k）方法，1个参数为person对象的方法，1个参数为map（值为3个person）的方法，持续运行50小时。<br><br class="atl-forced-newline"></p><br><br><p>4、高压力场景（20并发）</p><br><br><p>在稳定性场景的基础上，将提供者和消费者布置成均为2台（一台机器2个实例），且String的参数从20byte到200k，每隔10分钟随机变换。<br><br class="atl-forced-newline"></p><br><br><h3><a name="UserGuide-zh-%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"></a>测试结果</h3><br><br><h4><a name="UserGuide-zh-"></a><font color="#000000">5.1</font> <font color="#000000">场景名称：</font><font color="#000000">pojo</font> <font color="#000000">场景</font></h4><br><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> TPS成功平均值 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 响应时间成功平均值(ms) <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo1 <br class="atl-forced-newline"><br>（hessian2序列化+mina） <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 10813.5 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 0.9 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo2 <br class="atl-forced-newline"><br>(hessian2序列化+netty) <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 11994 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 0.79 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo2 <br class="atl-forced-newline"><br>(dubbo序列化+netty) <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 13620 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 0.67 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> rmi <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 2461.79 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 4 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> hessian <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 2417.7 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 4.1 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> http（json序列化） <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 8179.08 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 1.15 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> 2.0和1.0默认 <br class="atl-forced-newline"><br>对比百分比 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 10.92 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> &#45;12.22 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo序列化相比hessian2序列化百分比 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 13.56 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> &#45;15.19 <br class="atl-forced-newline"> </td><br></tr><br></tbody></table><br></div><br><br><p><span class="image-wrap" style=""><img src="pojotps.png-version=1&modificationDate=1317388356000.png" tppabs="http://dubbo.io/wiki/download/attachments/6947356/pojotps.png?version=1&modificationDate=1317388356000" style="border: 0px solid black"></span> <span class="image-wrap" style=""><img src="pojores.png-version=1&modificationDate=1317388349000.png" tppabs="http://dubbo.io/wiki/download/attachments/6947356/pojores.png?version=1&modificationDate=1317388349000" style="border: 0px solid black"></span></p><br><br><h4><a name="UserGuide-zh-%5C"></a><font color="#000000">5.2</font> <font color="#000000">场景名称：</font><font color="#000000">1k string</font> <font color="#000000">场景</font><font color="#000000">&nbsp;</font> &#124;</h4><br><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><td class="confluenceTd"> 　 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> TPS成功平均值 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 响应时间成功平均值(ms) <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo1 <br class="atl-forced-newline"><br>（hessian2序列化+mina） <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 11940 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 0.8 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo2 <br class="atl-forced-newline"><br>(hessian2序列化+netty) <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 14402 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 0.64 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo2 <br class="atl-forced-newline"><br>(dubbo序列化+netty) <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 15096 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 0.6 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> rmi <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 11136.02 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 0.81 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> hessian <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 11426.83 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 0.79 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> http（json序列化） <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 8919.27 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 1.04 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> 2.0和1.0默认 <br class="atl-forced-newline"><br>对比百分比 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 20.62 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> &#45;20.00 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo序列化相比hessian2序列化百分比 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 4.82 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> &#45;6.25 <br class="atl-forced-newline"> </td><br></tr><br></tbody></table><br></div><br><br><p><span class="image-wrap" style=""><img src="1ktps.png-version=1&modificationDate=1317388345000.png" tppabs="http://dubbo.io/wiki/download/attachments/6947356/1ktps.png?version=1&modificationDate=1317388345000" style="border: 0px solid black"></span> <span class="image-wrap" style=""><img src="1kres.png-version=1&modificationDate=1317388329000.png" tppabs="http://dubbo.io/wiki/download/attachments/6947356/1kres.png?version=1&modificationDate=1317388329000" style="border: 0px solid black"></span></p><br><h4><a name="UserGuide-zh-%5C"></a><font color="#000000">5.3</font> <font color="#000000">场景名称：</font><font color="#000000">50k string</font><font color="#000000">场景</font><font color="#000000">&nbsp;</font> &#124;</h4><br><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><td class="confluenceTd"> 　 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> TPS成功平均值 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 响应时间成功平均值(ms) <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo1 <br class="atl-forced-newline"><br>（hessian2序列化+mina） <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 1962.7 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 5.1 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo2 <br class="atl-forced-newline"><br>(hessian2序列化+netty) <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 1293 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 5.03 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo2 <br class="atl-forced-newline"><br>(dubbo序列化+netty) <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 1966 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 7.68 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> rmi <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 3349.88 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 2.9 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> hessian <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 1925.33 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 5.13 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> http（json序列化） <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 3247.1 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 3 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> 2.0和1.0默认 <br class="atl-forced-newline"><br>对比百分比 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> &#45;34.12 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> &#45;1.37 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo序列化相比hessian2序列化百分比 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 52.05 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 52.68 <br class="atl-forced-newline"> </td><br></tr><br></tbody></table><br></div><br><br><p><span class="image-wrap" style=""><img src="50ktps.png-version=1&modificationDate=1317388345000.png" tppabs="http://dubbo.io/wiki/download/attachments/6947356/50ktps.png?version=1&modificationDate=1317388345000" style="border: 0px solid black"></span> <span class="image-wrap" style=""><img src="50kres.png-version=1&modificationDate=1317388345000.png" tppabs="http://dubbo.io/wiki/download/attachments/6947356/50kres.png?version=1&modificationDate=1317388345000" style="border: 0px solid black"></span></p><br><h4><a name="UserGuide-zh-%5C"></a><font color="#000000">5.4</font> <font color="#000000">场景名称：</font><font color="#000000">200k string</font> <font color="#000000">场景</font><font color="#000000">&nbsp;</font> &#124;</h4><br><br><div class="table-wrap"><br><table class="confluenceTable"><tbody><br><tr><br><td class="confluenceTd">&nbsp;</td><br><td class="confluenceTd"> TPS成功平均值 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 响应时间成功平均值(ms) <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo1 <br class="atl-forced-newline"><br>（hessian2序列化+mina） <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 324.2 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 30.8 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo2 <br class="atl-forced-newline"><br>(hessian2序列化+netty) <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 362.92 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 27.49 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo2 <br class="atl-forced-newline"><br>(dubbo序列化+netty) <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 569.5 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 17.51 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> rmi <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 1031.28 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 9.61 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> hessian <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 628.06 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 15.83 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> http（json序列化） <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 1011.97 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 9.79 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> 2.0和1.0默认 <br class="atl-forced-newline"><br>对比百分比 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 11.94 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> &#45;10.75 <br class="atl-forced-newline"> </td><br></tr><br><tr><br><td class="confluenceTd"> dubbo序列化相比hessian2序列化百分比 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> 56.92 <br class="atl-forced-newline"> </td><br><td class="confluenceTd"> &#45;36.30 <br class="atl-forced-newline"> </td><br></tr><br></tbody></table><br></div><br><br><p><span class="image-wrap" style=""><img src="200ktps.png-version=1&modificationDate=1317388345000.png" tppabs="http://dubbo.io/wiki/download/attachments/6947356/200ktps.png?version=1&modificationDate=1317388345000" style="border: 0px solid black"></span> <span class="image-wrap" style=""><img src="200kres.png-version=1&modificationDate=1317388345000.png" tppabs="http://dubbo.io/wiki/download/attachments/6947356/200kres.png?version=1&modificationDate=1317388345000" style="border: 0px solid black"></span></p><br><br><h3><a name="UserGuide-zh-%E6%B5%8B%E8%AF%95%E5%88%86%E6%9E%90"></a>测试分析</h3><br><br><p><br class="atl-forced-newline"></p><br><br><h4><a name="UserGuide-zh-"></a><font color="#000000">6.1</font> <font color="#000000">性能分析评估</font></h4><br><br><p>&nbsp; Dubbo2.0的性能测试结论为通过，从性能、内存占用和稳定性上都有了提高和改进。由其是内存管理由于将mina换成netty，大大减少了1.0版本在高并发大数据下的内存大锯齿。如下图：</p><br><br><h4><a name="UserGuide-zh-"></a><font color="#000000">6.2</font> <font color="#000000">性能对比分析</font><font color="#000000">(</font><font color="#000000">新旧环境、不同数据量级等</font><font color="#000000">)</font></h4><br><br><p>Dubbo2.0相比较Dubbo1.0（默认使用的都是hessian2序列化）性能均有提升（除了50k String），详见第五章的性能数据。</p><br><br><p>出于兼容性考虑默认的序列化方式和1.0保持一致使用hessian2，如对性能有更高要求可以使用dubbo序列化，由其是在处理复杂对象时，在大数据量下能获得50%的提升（但此时已不建议使用Dubbo协议）。</p><br><br><p>Dubbo的设计目的是为了满足高并发小数据量的rpc调用，在大数据量下的性能表现并不好，建议使用rmi或http协议。</p><br><br><h4><a name="UserGuide-zh-"></a><font color="#000000">6.3</font> <font color="#000000">测试局限性分析（可选）</font></h4><br><br><br><p><font color="#000000">本次性能测试考察的是</font><font color="#000000">dubbo</font><font color="#000000">本身的性能，实际使用过程中的性能有待应用来验证。</font></p><br><br><br><p><font color="#000000">由于</font><font color="#000000">dubbo</font><font color="#000000">本身的性能占用都在毫秒级，占的基数很小，</font>性能提升可能对应用整体的性能变化不大<font color="#000000">。</font></p><br><br><br><p><font color="#000000">由于邮件篇幅所限没有列出所有的监控图，如需获得可在大力神平台上查询。</font></p><br><h2><a name="UserGuide-zh-%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87%E6%8A%A5%E5%91%8A"></a>测试覆盖率报告</h2><br><p>(<a href="Code+Coverage+Report-zh.htm" tppabs="http://dubbo.io/wiki/display/dubbo/Code+Coverage+Report-zh" title="Code Coverage Report-zh">+</a>) (<a href="#UserGuide-zh-%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87%E6%8A%A5%E5%91%8A">#</a>)</p><br><br><p>统计于 2012-02-03 (2.0.12)</p><br><br><p><span class="image-wrap" style=""><img src="code-quality1.jpg-version=1&modificationDate=1328239751000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6947669/code-quality1.jpg?version=1&modificationDate=1328239751000" style="border: 0px solid black"></span><br><br><span class="image-wrap" style=""><img src="code-quality2.jpg-version=1&modificationDate=1328239559000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6947669/code-quality2.jpg?version=1&modificationDate=1328239559000" style="border: 0px solid black"></span><br><br><span class="image-wrap" style=""><img src="code-coverage.jpg-version=1&modificationDate=1328239005000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6947669/code-coverage.jpg?version=1&modificationDate=1328239005000" style="border: 0px solid black"></span><br><br><span class="image-wrap" style=""><img src="code-tendency.jpg-version=1&modificationDate=1328239564000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6947669/code-tendency.jpg?version=1&modificationDate=1328239564000" style="border: 0px solid black"></span><br><br><span class="image-wrap" style=""><img src="code-dependency.jpg-version=1&modificationDate=1328239550000.jpg" tppabs="http://dubbo.io/wiki/download/attachments/6947669/code-dependency.jpg?version=1&modificationDate=1328239550000" style="border: 0px solid black"></span></p><br>        <br><br>        <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="http://code.alibabatech.com/wiki/display/dubbo/User+Guide-zh"
    dc:identifier="http://code.alibabatech.com/wiki/display/dubbo/User+Guide-zh"
    dc:title="User Guide-zh"
    trackback:ping="http://code.alibabatech.com/wiki/rpc/trackback/6948813"/>
</rdf:RDF>
--><br><br><br><br><br><br><fieldset class="hidden parameters"><br>    <legend>Labels parameters</legend><br>    <input type="hidden" id="domainName" value="http://code.alibabatech.com/wiki"><br>    <input type="hidden" id="pageId" value="6948813"><br>    <input type="hidden" id="spaceKey" value="dubbo"><br></fieldset><br><br><div id="labels-section" class="pageSection"><br>    <div class="labels-editor"><br>        <span id="labels-section-title" class="label-title"><br>            <b>Labels:</b><br>        </span><br>        <div id="labels-section-content" class="content-column"><br>            <span id="labels-section-title-none" class="label-title none "><br>                None<br>            </span><br><br>            <div id="labelsList" class="label-list"><br>                            </div><br><br>                    </div><br><br>        <span class="errorMessage error" id="errorSpan"></span><br>        <form method="GET" action="" id="add-labels-form"><br>            <div id="labelInputSpan" class="labels-input"><br>                <div id="labelOperationErrorContainer" class="hidden"><br>                    <span class="error"><span class="errorMessage" id="labelOperationErrorMessage"></span></span><br>                </div><br><br>                <div class="caption">Enter labels to add to this page:</div><br>                <div id="label-input-fields"><br>                    <input autocomplete="off" id="labelsString" name="labelsString" value="" size="40"><br>                    <input id="add-labels-editor-button" type="submit" class="add-labels" value="Add"><br>                    <input id="close-labels-editor-button" type="submit" class="hide-labels-editor" value="Done"><br>                </div><br>                <div id="waitImageAndStatus"><br>                    &lt;img class=”waiting” alt=”Please wait” src=”wait.gif” tppabs=”<a href="http://dubbo.io/wiki/s/en/2166/34/" target="_blank" rel="external">http://dubbo.io/wiki/s/en/2166/34/</a>/images/icons/wait.gif”&gt;&nbsp;<br>                    <span id="labelOperationStatus" class="smalltext"></span><br>                </div><br>                <div id="labelsAutocompleteList" class="aui-dd-parent"></div><br>                <div class="labels-tip"><br>                    <div id="suggestedLabelsSpan"></div><br>                    Looking for a label? Just start typing.<br>                </div><br>            </div><br>        </form><br>    </div><br></div><br><br>                    <div id="children-section" class="pageSection children-showing"><br><br>        <div class="section-header "><br>            <h2 id="children-section-title" class="section-title"><br>                <a href="User+Guide-zh-showChildren=false.htm#children" tppabs="http://dubbo.io/wiki/display/dubbo/User+Guide-zh?showChildren=false#children" class="children-show-hide"><br>                                            19 Child Pages<br>                                    </a><br>            </h2>

<pre><code>    &lt;a href=&quot;User+Guide-zh-showChildren=false.htm#children&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/User+Guide-zh?showChildren=false#children&quot; class=&quot;children-show-hide icon&quot;&gt;&lt;/a&gt;

    &lt;span class=&quot;noprint grey&quot;&gt;
        &lt;a class=&quot;children-subtitle&quot; href=&quot;javascript:if(confirm(%27http://dubbo.io/wiki/pages/listpages-dirview.action?key=dubbo&amp;openId=6948813  \n\nThis file was not retrieved by Teleport Ultra, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://dubbo.io/wiki/pages/listpages-dirview.action?key=dubbo&amp;openId=6948813#selectedPageInHierarchy%27&quot; tppabs=&quot;http://dubbo.io/wiki/pages/listpages-dirview.action?key=dubbo&amp;openId=6948813#selectedPageInHierarchy&quot;&gt;Reorder Pages&lt;/a&gt;
                    &lt;/span&gt;
&lt;/div&gt;
&lt;div id=&quot;page-children&quot; class=&quot;pageSectionBody children-loaded&quot;&gt;
                                &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;API+Reference-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/API+Reference-zh&quot;&gt;API Reference-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Benchmark+Test+Toolkit-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Benchmark+Test+Toolkit-zh&quot;&gt;Benchmark Test Toolkit-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Capacity+Estimated-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Capacity+Estimated-zh&quot;&gt;Capacity Estimated-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Code+Coverage+Report-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Code+Coverage+Report-zh&quot;&gt;Code Coverage Report-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Configs-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Configs-zh&quot;&gt;Configs-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Configuration+Reference-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Configuration+Reference-zh&quot;&gt;Configuration Reference-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Dependencies-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Dependencies-zh&quot;&gt;Dependencies-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Examples-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Examples-zh&quot;&gt;Examples-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Getting+Started-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Getting+Started-zh&quot;&gt;Getting Started-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Maturity-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Maturity-zh&quot;&gt;Maturity-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Maven+Plugin+Reference-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Maven+Plugin+Reference-zh&quot;&gt;Maven Plugin Reference-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Performance+Test+Report-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Performance+Test+Report-zh&quot;&gt;Performance Test Report-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Protocol+Reference-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Protocol+Reference-zh&quot;&gt;Protocol Reference-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Quick+Start-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Quick+Start-zh&quot;&gt;Quick Start-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Recommended+Usage-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Recommended+Usage-zh&quot;&gt;Recommended Usage-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Registry+Reference-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Registry+Reference-zh&quot;&gt;Registry Reference-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Serialization+Issues-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Serialization+Issues-zh&quot;&gt;Serialization Issues-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Service+Best+Practices-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Service+Best+Practices-zh&quot;&gt;Service Best Practices-zh&lt;/a&gt;
                 &lt;/span&gt;
                    &lt;span class=&quot;child-display&quot;&gt;
                             &lt;span class=&quot;icon icon-page&quot; title=&quot;Page&quot;&gt;Page:&lt;/span&gt;
                 &lt;a href=&quot;Telnet+Command+Reference-zh.htm&quot; tppabs=&quot;http://dubbo.io/wiki/display/dubbo/Telnet+Command+Reference-zh&quot;&gt;Telnet Command Reference-zh&lt;/a&gt;
                 &lt;/span&gt;
                        &lt;/div&gt;
&lt;/div&gt;
</code></pre></div></div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/06/22/news-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/22/news-01/" itemprop="url">转载:一个分布式服务器集群架构方案</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-22T14:24:27+08:00">
                2017-06-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1>0x01.大型网站演化</h1>

<p>简单说，分布式是以缩短单个任务的执行时间来提升效率的，而集群则是通过提高单位时间内执行的任务数来提升效率。</p>

<p>集群主要分为：高可用集群(High Availability Cluster)，负载均衡集群(Load Balance Cluster，nginx即可实现)，科学计算集群(High Performance Computing Cluster)。</p>

<p>分布式是指将不同的业务分布在不同的地方；而集群指的是将几台服务器集中在一起，实现同一业务。分布式中的每一个节点，都可以做集群。 而集群并不一定就是分布式的。</p>

<p>之前在网上看到一篇关于大型网站演化的博客。<a rel="external" href="http://www.cnblogs.com/leefreeman/p/3993449.html" target="_blank"></a><a rel="external" href="http://www.cnblogs.com/leefreeman/p/3993449.html" target="_blank">http://www.cnblogs.com/leefreeman/p/3993449.html</a></p>

<p>每个大型网站都会有不同的架构模式，而架构内容也就是在处理均衡负载，缓存，数据库，文件系统等，只是在不同的环境下，不同的条件下，架构的模型不一样，目的旨在提高网站的性能。</p>

<p>最初的架构只有应用程序，数据库，文件服务。</p>

<p><span class="img-wrap"><img data-src="https://segmentfault.com/image?src=http://homeway.me/image/2014-12-10-big-website-framwork-1.jpg&amp;objectId=1190000002418709&amp;token=b0c31c6be938e0f9f001f8c99864f764"></span></p>

<p><br></p>

<p>到后来，分布式服务、集群架设。</p>

<p><span class="img-wrap"><img data-src="https://segmentfault.com/image?src=http://homeway.me/image/2014-12-10-big-website-framwork-10.jpg&amp;objectId=1190000002418709&amp;token=52cdb401b9ebdc64708779f2415b9fa7"></span></p>

<p><br></p>

<p><hr></p>
<p><br></p>

<h1>0x02.关于均衡负载方案</h1>

<p>在上一篇，<a rel="external" href="http://homeway.me/2014/12/05/nginx-reverse-proxy-to-load-balance/" target="_blank">《Nginx反向代理实现均衡负载》</a>讨论过过的nginx现实均衡负载方案，这里选择另一种HAProxy+Keepalived双机高可用均衡负载方案。</p>

<p>HAProxy是免费、极速且可靠的用于为TCP和基于HTTP应用程序提供高可用、负载均衡和代理服务的解决方案，尤其适用于高负载且需要持久连接或7层处理机制的web站点。</p>

<p>不论是Haproxy还是Keepalived甚至是上游服务器均提高生产力并增强可用性,也就是如下架构中Haproxy,Keepalived,Httpd服务器任意宕机一台服务还是可以正常运行的。</p>

<p>HAProxy的优点：</p>

<p>1、HAProxy是支持虚拟主机的，可以工作在4、7层(支持多网段)；</p>

<p>2、能够补充Nginx的一些缺点比如Session的保持，Cookie的引导等工作；</p>

<p>3、支持url检测后端的服务器；</p>

<p>4、本身仅仅就只是一款负载均衡软件；单纯从效率上来讲HAProxy更会比Nginx有更出色的负载均衡速度，在并发处理上也是优于Nginx的；</p>

<p>5、HAProxy可以对Mysql读进行负载均衡，对后端的MySQL节点进行检测和负载均衡；</p>

<p><span class="img-wrap"><img data-src="https://segmentfault.com/image?src=http://homeway.me/image/2014-12-10-keepalive-haproxy.jpg&amp;objectId=1190000002418709&amp;token=f7a1c5cd0092ca2c2882d3b4e2bde773"></span></p>

<p><br></p>

<p><hr></p>
<p><br></p>

<h1>0x03.关于Redis缓存方案</h1>

<p>缓存分为服务器缓存和应用程序缓存。</p>

<p>关于应用程序内缓存，已经在<a rel="external" href="https://github.com/grasses/Jue-MVC" target="_blank">Jue后台框架</a>里面做了模块处理了。</p>

<p>关于服务器缓存，主要缓存服务器文件，减少服务器和php交互，减少均衡负载服务器和应用程序服务器交互。</p>

<p>缓存里面有一种典型的memcached，现在用的多的是redis轻量级缓存方案。</p>

<p>关于memcached与redis，看这篇 <a rel="external" href="http://www.bigdatalittlegeek.com/blog/2014/3/25/memcached-vs-redis" target="_blank">《Memcached vs Redis?》</a></p>

<p>Redis主要将数据存储在各种格式：列表，数组，集合和排序集，一次能接受多个命令，阻塞读写，等待直到另一个进程将数据写入高速缓存。</p>

<p><span class="img-wrap"><img data-src="https://segmentfault.com/image?src=http://homeway.me/image/2014-12-10-redis-cache.jpg&amp;objectId=1190000002418709&amp;token=e42e3ab7a22ac3a9697f9321b90b47e8"></span></p>

<p><br></p>

<p>一篇关于Reids缓存方案。<a rel="external" href="http://www.infoq.com/cn/news/2014/11/open-source-redis-cache" target="_blank">《高可用、开源的Redis缓存集群方案》</a></p>

<p><br></p>

<p><hr></p>
<p><br></p>

<h1>0x04.关于搜索引擎Sphinx方案</h1>

<p>(第一期不做，后期需求时候考虑)</p>

<p>Sphinx是俄罗斯人开发的，号称是很吊啦，千万级数据检索，每秒10MB/s，搭过环境。</p>

<p>Sphinx和MySQL是基于数据库的全文引擎，创建索引是B+树和hash key-value的方式。</p>

<p>原理类似于用底层C检索MySQL，然后弄出一个sphinx.conf配置文件，索引与搜索均以这个文件为依据进行，要进行全文检索，首先就要配置好sphinx.conf，告诉sphinx哪些字段需要进行索引，哪些字段需要在where,orderby,groupby中用到。</p>

<p><a rel="external" href="http://sphinxsearch.com/wiki/doku.php?id=sphinx_chinese_tutorial" target="_blank">Sphinx中文</a></p>

<p><br></p>

<p><hr></p>
<p><br></p>

<h1>0x05.关于NoSQL快速存储方案</h1>

<p>NoSQL在这里的使用价值是处理一些琐事，比如用户个人网站的一些css值，height,width,color等等的小而繁多的数据，采用NoSQL旨在提升数据库速度，减少对MySQL的SELECT请求。</p>

<p>关于NoSQL的方案很多了，选一个简单的MongDB好了。</p>

<p><br></p>

<p><hr></p>
<p><br></p>

<h1>0x06.关于分布式MySQL方案</h1>

<p>(做分布式MySQL还没尝试过，初期也不清楚mysql所需要的压力，所以第一期不打算做分布式MySQL)</p>

<p><a rel="external" href="http://www.infoq.com/cn/news/2014/11/mysql-five-open-source-project" target="_blank">《标准MySQL数据库外的5个开源兼容方案》</a></p>

<p><br></p>

<p><hr></p>
<p><br></p>

<h1>0x07.分布式集群方案</h1>

<p>综合起来，大致就是如下模型，初探分布式架构，很多模块将就形势做调整，时时更新中，待续。。。</p>

<p><span class="img-wrap"><img data-src="https://segmentfault.com/image?src=http://homeway.me/image/2014-12-10-big-website-framwork-design.png&amp;objectId=1190000002418709&amp;token=47f5bedac40478ce42e5bd7445f8de89"></span></p>

<p><br></p>

<p><hr></p>
<p><br></p>

<h5>本文出自 <a rel="external" href="http://homeway.me" target="_blank">夏日小草</a>,转载请注明出处:<a rel="external" href="http://homeway.me/2014/12/10/think-about-distributed-clusters/" target="_blank"></a><a rel="external" href="http://homeway.me/2014/12/10/think-about-distributed-clusters/" target="_blank">http://homeway.me/2014/12/10/think-about-distributed-clusters/</a><br></h5>

<p><br></p>

<p>-by小草</p>

<p></p><p>2014-12-10 23:27:01</p><br><br>                <p></p>
<pre><code>&lt;div class=&quot;clearfix mt10&quot;&gt;

    &lt;ul class=&quot;article-operation list-inline pull-left&quot;&gt;
        &lt;li&gt;&lt;a href=&quot;/a/1190000002418709&quot; class=&quot;text-muted&quot;&gt;2014年12月11日发布&lt;/a&gt;&lt;/li&gt;
                                                                                                            &lt;li class=&quot;dropdown js__content-ops&quot; data-module=&quot;article&quot;
                data-id=&quot;1190000002418709&quot;
                data-typetext=&quot;文章&quot;&gt;
                &lt;a href=&quot;javascript:void(0);&quot; class=&quot;dropdown-toggle text-muted&quot; data-toggle=&quot;dropdown&quot;&gt;更多&lt;b
                            class=&quot;caret&quot;&gt;&lt;/b&gt;&lt;/a&gt;
                &lt;ul class=&quot;dropdown-menu dropdown-menu-left&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;#911&quot;
                           data-toggle=&quot;modal&quot;
                           data-target=&quot;#911&quot;
                           data-action=&quot;report&quot;
                        &gt;举报&lt;/a&gt;&lt;/li&gt;




                                                    &lt;/ul&gt;
            &lt;/li&gt;
                            &lt;/ul&gt;

    &lt;div class=&quot;pull-right&quot;&gt;
        &lt;div class=&quot;widget-share__full&quot; data-text=&quot;一个分布式服务器集群架构方案&quot;
</code></pre><p> data-url=”<a href="https://segmentfault.com/a/1190000002418709" target="_blank" rel="external">https://segmentfault.com/a/1190000002418709</a>“ data-shorturl=”<a href="http://sfau.lt/b5kjnB&quot;&gt;" target="_blank" rel="external">http://sfau.lt/b5kjnB&quot;&gt;</a></p>
<pre><code>    &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;mt10 text-center&quot;&gt;&lt;button type=&quot;button&quot; id=&quot;mainLike&quot; data-id=&quot;1190000002418709&quot;
                    class=&quot;btn btn-success btn-lg mr15 &quot;&gt;&lt;i class=&quot;fa fa-caret-up fa-lg&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;seprator&quot;&gt;|&lt;/span&gt;&amp;nbsp;&amp;nbsp;
                &lt;span id=&quot;mainLikeNum&quot;&gt;8 &lt;/span&gt;&lt;/button&gt;&lt;button type=&quot;button&quot; id=&quot;mainBookmark&quot; data-type=&quot;article&quot; data-id=&quot;1190000002418709&quot;
                    class=&quot;btn btn-default btn-lg &quot;&gt;&lt;span id=&quot;mainBookmarkText&quot;&gt;收藏&lt;/span&gt;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;seprator&quot;&gt;|&lt;/span&gt;&amp;nbsp;&amp;nbsp;&lt;span id=&quot;mainBookmarkNum&quot;&gt;165&lt;/span&gt;&lt;/button&gt;&lt;/div&gt;
                    &lt;div class=&quot;recommend-post pt30 mt40 mb30 border-top&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-8&quot;&gt;
                                                    &lt;h4 class=&quot;mt0&quot;&gt;你可能感兴趣的文章&lt;/h4&gt;
                    &lt;ul class=&quot;widget-links list-unstyled&quot;&gt;
                                                                    &lt;li class=&quot;widget-links__item&quot;&gt;
                                &lt;a href=&quot;/a/1190000008161248&quot;
                                   title=&quot;大型网站技术架构-入门梳理&quot;&gt;大型网站技术架构-入门梳理&lt;/a&gt;
                                &lt;small class=&quot;text-muted&quot;&gt;
                                    25 收藏，639
                                    浏览
                                &lt;/small&gt;
                            &lt;/li&gt;
                                                                    &lt;li class=&quot;widget-links__item&quot;&gt;
                                &lt;a href=&quot;/a/1190000008016139&quot;
                                   title=&quot;互联网时代，我眼中的架构变迁&quot;&gt;互联网时代，我眼中的架构变迁&lt;/a&gt;
                                &lt;small class=&quot;text-muted&quot;&gt;
                                    17 收藏，926
                                    浏览
                                &lt;/small&gt;
                            &lt;/li&gt;
                                                                    &lt;li class=&quot;widget-links__item&quot;&gt;
                                &lt;a href=&quot;/a/1190000009334350&quot;
                                   title=&quot;黄东旭：Cloud-Native 的分布式数据库架构与实践&quot;&gt;黄东旭：Cloud-Native 的分布式数据库架构与实践&lt;/a&gt;
                                &lt;small class=&quot;text-muted&quot;&gt;
                                    244
                                    浏览
                                &lt;/small&gt;
                            &lt;/li&gt;
                                                            &lt;/ul&gt;
                                            &lt;/div&gt;
            &lt;div class=&quot;col-md-4&quot;&gt;
                                            &lt;/div&gt;
        &lt;/div&gt;

    &lt;/div&gt;
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/06/16/activeMq-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/16/activeMq-03/" itemprop="url">Sping+ActiveMQ整合</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-16T17:13:23+08:00">
                2017-06-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>&lt;div class=&quot;entry&quot;&gt;
</code></pre><p>通过前一篇《<a href="http://blog.csdn.net/u013256816/article/details/51161548" class="external" rel="nofollow" target="_blank">ActiveMQ简述</a>》大概对ActiveMQ有了一个大概的认识，本篇所阐述的是如何通过Spring继承ActiveMQ进而更有效、更灵活的运用ActiveMQ.</p><br><p>Spring和ActiveMQ整合需要在项目中包含以下这几个jar包（缺一不可）：activeio-core-3.1.4.jar，activemq-all-5.13.2.jar，activemq-pool-5.13.2.jar，commons-pool2-2.4.2.jar，这些jar可以在ActiveMQ的安装包中的/lib/optional/下找到，或者从<a href="http://download.csdn.net/detail/u013256816/9492418" class="external" rel="nofollow" target="_blank">这里</a>下载。</p><br><h2 id="配置connectionfactory"><a name="t0"></a>配置ConnectionFactory</h2><br><p>ConnectionFactory是用于产生到JMS服务器的链接的，Spring为我们提供了多个ConnectionFactory，有SingleConnectionFactory和CachingConnectionFactory。SingleConnectionFactory对于建立JMS服务器链接的请求会一直返回同一个链接，并且会忽略Connection的close方法调用。CachingConnectionFactory继承了SingleConnectionFactory，所以它拥有SingleConnectionFactory的所有功能，同时它还新增了缓存功能，可以缓存Session, MessageProducer和MessageConsumer。</p><br><p>Spring提供的ConnectionFactory只是Spring用于管理ConnectionFactory的，真正产生到JMS服务器链接的ConnectionFactory还得是JMS服务厂商提供的，并且需要把它注入到Spring提供的ConnectionFactory中，这里使用ActiveMQ提供的ConnectionFactory，所以定义如下（10.10.195.187是博主的测试ip地址）：</p><br><pre class="brush: java; gutter: true">&lt;bean id=&quot;targetConnectionFactory&quot; class=&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;&gt;<br>        &lt;property name=&quot;brokerURL&quot; value=&quot;tcp://10.10.195.187:61616&quot; /&gt;<br>    &lt;/bean&gt;<br>    &lt;bean id=&quot;connectionFactory&quot; class=&quot;org.springframework.jms.connection.SingleConnectionFactory&quot;&gt;<br>        &lt;property name=&quot;targetConnectionFactory&quot; ref=&quot;targetConnectionFactory&quot;/&gt;<br>    &lt;/bean&gt;</pre><br><p>ActiveMQ为我们提供了一个PooledConnectionFactory，通过往里面注入一个ActiveMQConnectionFactory可以用来将Connection, Session和MessageProducer池化，这样可以大大的减少我们的资源消耗。当使用PooledConnectionFactory时，我们在定义一个ConnectionFactory时这样定义：</p><br><pre class="brush: java; gutter: true"> &lt;bean id=&quot;targetConnectionFactory&quot; class=&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;&gt;<br>        &lt;property name=&quot;brokerURL&quot; value=&quot;tcp://10.10.195.187:61616&quot; /&gt;<br>    &lt;/bean&gt;<br>    &lt;bean id=&quot;poolConnectionFactory&quot; class=&quot;org.apache.activemq.pool.PooledConnectionFactory&quot;  &gt;<br>        &lt;property name=&quot;connectionFactory&quot; ref=&quot;targetConnectionFactory&quot; /&gt;<br>        &lt;property name=&quot;maxConnections&quot; value=&quot;10&quot;/&gt;<br>    &lt;/bean&gt;<br>    &lt;bean id=&quot;connectionFactory&quot; class=&quot;org.springframework.jms.connection.SingleConnectionFactory&quot;&gt;<br>        &lt;property name=&quot;targetConnectionFactory&quot; ref=&quot;poolConnectionFactory&quot;/&gt;<br>    &lt;/bean&gt;</pre><br><p>这里也可以去掉spring提供的SingleConnectionFactory,类似这样：</p><br><pre class="brush: java; gutter: true">&lt;bean id=&quot;targetConnectionFactory&quot; class=&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;&gt;<br>        &lt;property name=&quot;brokerURL&quot; value=&quot;tcp://10.10.195.187:61616&quot; /&gt;<br>    &lt;/bean&gt;<br>    &lt;bean id=&quot;connectionFactory&quot; class=&quot;org.apache.activemq.pool.PooledConnectionFactory&quot;  &gt;<br>        &lt;property name=&quot;connectionFactory&quot; ref=&quot;targetConnectionFactory&quot; /&gt;<br>        &lt;property name=&quot;maxConnections&quot; value=&quot;10&quot;/&gt;<br>    &lt;/bean&gt;</pre><br><hr><br><h2 id="配置消息发送生产者"><a name="t1"></a>配置消息发送（生产）者</h2><br><p>配置好ConnectionFactory之后我们就需要配置生产者。生产者负责生产消息并发送到JMS服务器，这通常对应的是我们的一个业务逻辑服务实现类。但是我们的服务实现类是怎么进行消息的发送的呢？这通常是利用Spring为我们提供的JmsTemplate类来实现，所以配置生产者其实最核心的就是配置进行消息发送的JmsTemplate。对于消息发送者而言，它在发送消息的时候要知道自己该往哪里发，为此，我们在定义JmsTemplate的时候需要往里面注入一个Spring提供的ConnectionFactory对象。</p><br><p>spring配置文件中添加:</p><br><pre class="brush: java; gutter: true"> &lt;bean id=&quot;jmsTemplate&quot; class=&quot;org.springframework.jms.core.JmsTemplate&quot;&gt;<br>        &lt;property name=&quot;connectionFactory&quot; ref=&quot;poolConnectionFactory&quot;/&gt;<br>    &lt;/bean&gt;</pre><br><p>在<a title="Java EE知识库" href="http://lib.csdn.net/base/17" target="_blank" class="external" rel="nofollow">Java</a>相关处理文件中添加(这里用的是@Inject注解，当然也可以用@Autowired)：</p><br><pre class="brush: java; gutter: true"> @Inject<br>    @Named(&quot;jmsTemplate&quot;)<br>    private JmsTemplate jmsTemplate;</pre><br><p>这样就可以通过jmsTemplate对象来处理相关信息，譬如：</p><br><pre class="brush: java; gutter: true">  jmsTemplate.convertAndSend(&quot;sqlQueue&quot;,sql);</pre><br><p>真正利用JmsTemplate进行消息发送的时候，我们需要知道消息发送的目的地，即Destination。在Jms中有一个用来表示目的地的Destination接口，它里面没有任何方法定义，只是用来做一个标志而已。当我们在使用JmsTemplate进行消息发送时没有指定destination的时候将使用默认的Destination。默认Destination可以通过在定义jmsTemplate bean对象时通过属性defaultDestination或defaultDestinationName来进行诸如，defaultDestinationName对于的就是一个普通字符串。在ActiveMQ中实现了两种类型的Destination，一个是点对点的ActiveMQQueue,另一个就是支持订阅-发布模式的ActiveMQTopic。</p><br><pre class="brush: java; gutter: true">&lt;bean id=&quot;queueDestination&quot; class=&quot;org.apache.activemq.command.ActiveMQQueue&quot;&gt;<br>        &lt;constructor-arg&gt;<br>            &lt;value&gt;sqlQueue&lt;/value&gt;<br>        &lt;/constructor-arg&gt;<br>    &lt;/bean&gt;<br>    &lt;bean id=&quot;topicDestination&quot; class=&quot;org.apache.activemq.command.ActiveMQTopic&quot;&gt;<br>        &lt;constructor-arg&gt;<br>            &lt;value&gt;topic&lt;/value&gt;<br>        &lt;/constructor-arg&gt;<br>    &lt;/bean&gt;</pre><br><p>对面上面的那个例子可以在Java程序中添加：</p><br><pre class="brush: java; gutter: true"> @Inject<br>    @Named(&quot;queueDestination&quot;)<br>    private Destination queueDestination;</pre><br><p>进而【jmsTemplate.convertAndSend(“sqlQueue”,sql);】可以改为【jmsTemplate.convertAndSend(queueDestination,sql);】<br><br>也可以这样修改jmsTemplate：</p><br><pre class="brush: java; gutter: true">&lt;bean id=&quot;jmsTemplate&quot; class=&quot;org.springframework.jms.core.JmsTemplate&quot;&gt;<br>        &lt;property name=&quot;connectionFactory&quot; ref=&quot;connectionFactory&quot;/&gt;<br>        &lt;property name=&quot;defaultDestination&quot; ref=&quot;queueDestination&quot;/&gt;<br>    &lt;/bean&gt;</pre><br><p>或者：</p><br><pre class="brush: java; gutter: true">&lt;bean id=&quot;jmsTemplate&quot; class=&quot;org.springframework.jms.core.JmsTemplate&quot;&gt;<br>        &lt;property name=&quot;connectionFactory&quot; ref=&quot;connectionFactory&quot;/&gt;<br>        &lt;property name=&quot;defaultDestinationName&quot; value=&quot;sqlQueue&quot;/&gt;<br>    &lt;/bean&gt;</pre><br><p>进而在java程序中这样调用：jmsTemplate.convertAndSend(sql);</p><br><hr><br><h2 id="配置消息接收消费者"><a name="t2"></a>配置消息接收（消费）者</h2><br><p>生产者往指定目的地Destination发送消息后，接下来就是消费者对指定目的地的消息进行消费了。那么消费者是如何知道有生产者发送消息到指定目的地Destination了呢？这是通过Spring为我们封装的消息监听容器MessageListenerContainer实现的，它负责接收信息，并把接收到的信息分发给真正的MessageListener进行处理。每个消费者对应每个目的地都需要有对应的MessageListenerContainer。对于消息监听容器而言，除了要知道监听哪个目的地之外，还需要知道到哪里去监听，也就是说它还需要知道去监听那个JMS服务器，这是通过在配置MessageConnectionFactory的时候往里面注入一个ConnectionFactory来实现的。所以我们在配置一个MessageListenerContainer的时候有三个属性必须指定，一个是表示从哪里监听的ConnectionFactory，一个是表示监听什么的Destination，一个是接收到消息以后进行消息处理的MessageListener.</p><br><p>Spring为我们听过了两种类型的MessageListenerContainer：SimpleMessageListenerContainer和DefaultMessageListenerContainer。MessageListenerContainer：SimpleMessageListenerContainer会在一开始的时候就创建一个会话Session和消费者Consumer，并且会适用标准的JMS的MessageConsumer.setMessageListener()方法注册监听器让JMS提供调用监听器的回调函数。它不会动态的适应运行时需要和参与外部的事务管理。兼容性方面，它非常接近于独立的JMS规范，但一般不兼容J2EE的JMS限制。大多数情况下，我们还是使用DefaultMessageListenerContainer，跟MessageListenerContainer：SimpleMessageListenerContainer想比，它会动态的适应运行时的需求，并且能够参与外部的事务管理。它很好的平衡了JMS提供者要求低，先进功能如事务参与和兼容J2EE环境。</p><br><p>spring配置文件中添加:</p><br><pre class="brush: java; gutter: true"> &lt;bean id=&quot;queueDestination&quot; class=&quot;org.apache.activemq.command.ActiveMQQueue&quot;&gt;<br>        &lt;constructor-arg&gt;<br>            &lt;value&gt;sqlQueue&lt;/value&gt;<br>        &lt;/constructor-arg&gt;<br>    &lt;/bean&gt;<br>    &lt;bean id=&quot;listenerContainer&quot; class=&quot;org.springframework.jms.listener.DefaultMessageListenerContainer&quot;&gt;<br>        &lt;property name=&quot;connectionFactory&quot; ref=&quot;poolConnectionFactory&quot; /&gt;<br>        &lt;property name=&quot;messageListener&quot; ref=&quot;jmsQueueReceiver&quot; /&gt;<br>        &lt;property name=&quot;destination&quot; ref=&quot;queueDestination&quot; /&gt;<br>    &lt;/bean&gt;</pre><br><p>其中的jmsQueueReceiver代码如下：</p><br><pre class="brush: java; gutter: true">import javax.jms.JMSException;<br>import javax.jms.Message;<br>import javax.jms.MessageListener;<br>import javax.jms.TextMessage;<br><br>import org.springframework.stereotype.Component;<br><br>@Component(&quot;jmsQueueReceiver&quot;)<br>public class JmsQueueReceiver implements MessageListener<br>{<br>    @Override<br>    public void onMessage(Message messgae)<br>    {<br>        if(messgae instanceof TextMessage)<br>        {<br>            TextMessage textMessage = (TextMessage) messgae;<br>            try<br>            {<br>                String text = textMessage.getText();<br>                System.out.println(&quot;######################[&quot;+text+&quot;]######################&quot;);<br>            }<br>            catch (JMSException e)<br>            {<br>                e.printStackTrace();<br>            }<br>        }<br>    }<br>}</pre><br><hr><br><h2 id="事务管理"><a name="t3"></a>事务管理</h2><br><p>Spring提供了一个JmsTransactionManager用于对JMS ConnectionFactory做事务管理。这将允许JMS应用利用Spring的事务管理特性。JmsTransactionManager在执行本地资源事务管理时将从指定的ConnectionFactory绑定一个ConnectionFactory/Session这样的配对到线程中。JmsTemplate会自动检测这样的事务资源，并对他们进行相应的操作。</p><br><p>在J2EE环境中，ConnectionFactory会池化Connection和Session，这样这些资源将会在整个事务中被有效地重复利用。在一个独立的环境中，使用Spring的SingleConnectionFactory时所有的事务将公用一个Connection，但是每个事务将保留自己独立的Session.</p><br><p>JmsTemplate可以利用JtaTransactionManager和能够进行分布式的JMS ConnectionFactory处理分布式事务。</p><br><p>在Spring整合JMS的应用中，如果我们要进行本地的事务管理的话非常简单，只需要在定义对于的消息监听容器时指定其sessionTransacted属性为true(默认为false)：</p><br><pre class="brush: java; gutter: true">&lt;bean id=&quot;listenerContainer&quot; class=&quot;org.springframework.jms.listener.DefaultMessageListenerContainer&quot;&gt;<br>        &lt;property name=&quot;connectionFactory&quot; ref=&quot;connectionFactory&quot; /&gt;<br>        &lt;property name=&quot;messageListener&quot; ref=&quot;jmsQueueReceiver&quot; /&gt;<br>        &lt;property name=&quot;destination&quot; ref=&quot;queueDestination&quot; /&gt;<br>        &lt;property name=&quot;sessionTransacted&quot; value=&quot;true&quot;/&gt;<br>    &lt;/bean&gt;</pre><br><p>这样JMS在进行消息监听的时候就会进行事务控制，当在接收消息时监听器执行失败时JMS就会对接收到的消息进行回滚。这里需要注意的是对于其他操作如<a title="MySQL知识库" href="http://lib.csdn.net/base/14" target="_blank" class="external" rel="nofollow">数据库</a>等访问不属于该事务控制。</p><br><p>可以在JmsQueueReceiver中修改一下代码从而检测到发送异常时是否会进行事务回滚：</p><br><pre class="brush: java; gutter: true">@Component(&quot;jmsQueueReceiver&quot;)<br>public class JmsQueueReceiver implements MessageListener<br>{<br>    @Override<br>    public void onMessage(Message messgae)<br>    {<br>        if(messgae instanceof TextMessage)<br>        {<br>            TextMessage textMessage = (TextMessage) messgae;<br>            try<br>            {<br>                String text = textMessage.getText();<br>                System.out.println(&quot;######################[&quot;+text+&quot;]######################&quot;);<br>                if(true)<br>                {<br>                    throw new RuntimeException(&quot;Error&quot;);<br>                }<br>            }<br>            catch (JMSException e)<br>            {<br>                e.printStackTrace();<br>            }<br>        }<br>    }<br>}</pre><br><p>你可以通过向Destination发送一条信息，通过JmsQueueReceiver处理后，发送异常进而事务混滚。可以通过<a href="http://10.10.195.187:8161/admin/queues.jsp" class="external" rel="nofollow" target="_blank">http://10.10.195.187:8161/admin/queues.jsp</a>查看相关信息（ip地址是博主的ActiveMQ服务器所在id，根据实际情况修改）。</p><br><p>如果想要接收消息和数据库访问处于同一事务中，那么我们就可以配置一个外部的事务管理同时配置一个支持外部事务管理的消息监听容器（如DefaultMessageListenerContainer)。要配置这样一个参与分布式事务管理的消息监听容器，我们可以配置一个JtaTransactionManager，当然底层的JMS ConnectionFactory需要能够支持分布式事务管理，并正确地注册我们的JtaTransactionManager。这样消息监听器进行消息接收和对应的数据库访问就会处于同一数据库控制下，当消息接收失败或数据库访问失败都会进行事务回滚操作。</p><br><pre class="brush: java; gutter: true"> &lt;bean id=&quot;listenerContainer&quot; class=&quot;org.springframework.jms.listener.DefaultMessageListenerContainer&quot;&gt;<br>        &lt;property name=&quot;connectionFactory&quot; ref=&quot;connectionFactory&quot; /&gt;<br>        &lt;property name=&quot;messageListener&quot; ref=&quot;jmsQueueReceiver&quot; /&gt;<br>        &lt;property name=&quot;destination&quot; ref=&quot;queueDestination&quot; /&gt;<br>        &lt;property name=&quot;sessionTransacted&quot; value=&quot;true&quot;/&gt;<br>        &lt;property name=&quot;transactionManager&quot; ref=&quot;jtaTransactionManager&quot;/&gt;<br>    &lt;/bean&gt;<br>    &lt;bean id=&quot;jtaTransactionManager&quot; class=&quot;org.springframework.transaction.jta.JtaTransactionManager&quot;/&gt;</pre><br><p>当给小时监听容器指定了transactionManager时，消息监听容器将忽略sessionTransacted的值。</p><br><p>到这里大概的Spring+ActiveMQ整合告一段落，所有代码经博主亲测，确保有效性及正确性。如有疑问，可在下方留言。</p><br><hr><br><p>参考资料：<br><br>1. <a href="http://haohaoxuexi.iteye.com/blog/1893038" class="external" rel="nofollow" target="_blank">Spring整合JMS(一)——基于ActiveMQ实现</a><br><br>2. <a href="http://blog.csdn.net/wilsonke/article/details/42191015" class="external" rel="nofollow" target="_blank">Spring+ActiveMQ+Mysql 配置JMS</a><br><br>3. <a href="http://blog.csdn.net/u013256816/article/details/51161548" class="external" rel="nofollow" target="_blank">ActiveMQ简述</a></p>



<pre><code>&lt;!-- BEGIN #author-bio --&gt;
</code></pre><!-- END #author-bio -->
<pre><code>&lt;/div&gt;
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/06/15/thread-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/15/thread-01/" itemprop="url">JAVA多线程实现的三种方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-15T14:08:06+08:00">
                2017-06-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>多线程的基础知识进行一下总结：</p>

<p><img alt="Java中多线程实现方式有哪些，听听大神的分析" src="https://static.oschina.net/uploads/img/201706/13190436_vVnS.jpg"></p>

<p>线程生命周期</p>

<p><strong>Java中的多线程有三种完结办法：</strong></p>

<p>1.完结Runnable接口，并完结该接口的run()办法.创立一个Thread目标，用完结的Runnable接口的目标作为参数实例化Thread目标，调用此目标的start办法。</p>

<p>2.承继Thread类，重写run办法。Thread本质上也是一个完结了Runnable的实例，他代表一个线程的实例，而且发动线程的仅有办法即是经过Thread类的start办法。</p>

<p>3.完结Callable接口，重写call办法。Callable接口与Runnable接口的功用相似，但供给了比Runnable更强壮的功用。有以下三点</p>

<p>1）.Callable能够在人物完毕后供给一个返回值，Runnable没有供给这个功用。</p>

<p>2）.Callable中的call办法能够抛出反常，而Runnable的run办法不能抛出反常。</p>

<p>3）.运转Callable能够拿到一个Future目标，表明异步核算的成果，供给了查看核算是不是完结的办法。</p>

<p>需求留意的是，不管用那种办法完结了多线程，调用start办法并不意味着当即履行多线程代码，而是使得线程变为可运转状况。</p>

<p><strong>run、 start的差异</strong></p>

<p>start办法是发动一个线程，而线程中的run办法来完结实践的操作。</p>

<p>假如咱们直接调用run办法，那么就会将这个办法当作一个一般函数来调用，并没有多拓荒线程，假如期望多线程异步履行，则需求调用start办法。</p>

<p><strong>sleep wait的差异</strong></p>

<p>1.sleep是Threa的静态办法，是用来操控线程自身流程的，而wait是object的办法，用于进行线程通讯。</p>

<p>2.两者处理的机制不一样，sleep办法主要是，让线程暂停履行一段时刻，时刻一到主动康复，并不会开释所占用的锁，当调用wait办法今后，他会开释所占用的目标锁，等候别的线程调用notify办法才会再次醒来。</p>

<p>3.两者运用的区域不一样。sleep能够在任何地方运用，wait有必要放在同步操控办法，或者语句块中履行。</p>

<p><img alt="Java中多线程实现方式有哪些，听听大神的分析" src="https://static.oschina.net/uploads/img/201706/13190436_AeYw.jpg"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/06/14/activemq-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/14/activemq-02/" itemprop="url">Spring整合ActiveMQ 事务管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-14T15:58:38+08:00">
                2017-06-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> <div id="blog_content" class="blog_content"><br>    <div class="iteye-blog-content-contain" style="font-size: 14px;"></div></div></p>
<p></p><h2 class="iteye-blog-content-contain" style="margin: 13pt 0cm 13pt 28.8pt;"> </h2><p></p>
<p></p><p class="MsoNormal" style="text-indent: 21pt; margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span><span style="font-family: Calibri;">Spring</span></span><span style="font-family: 宋体;">提供了一个</span><span><span style="font-family: Calibri;">JmsTransactionManager</span></span><span style="font-family: 宋体;">用于对</span><span><span style="font-family: Calibri;">JMS ConnectionFactory</span></span><span style="font-family: 宋体;">做事务管理。这将允许</span><span><span style="font-family: Calibri;">JMS</span></span><span style="font-family: 宋体;">应用利用</span><span><span style="font-family: Calibri;">Spring</span></span><span style="font-family: 宋体;">的事务管理特性。</span><span><span style="font-family: Calibri;">JmsTransactionManager</span></span><span style="font-family: 宋体;">在执行本地资源事务管理时将从指定的</span><span><span style="font-family: Calibri;">ConnectionFactory</span></span><span style="font-family: 宋体;">绑定一个</span><span><span style="font-family: Calibri;">ConnectionFactory/Session</span></span><span style="font-family: 宋体;">这样的配对到线程中。</span><span><span style="font-family: Calibri;">JmsTemplate</span></span><span style="font-family: 宋体;">会自动检测这样的事务资源，并对它们进行相应操作。</span></span></p><p></p>
<p></p><p class="MsoNormal" style="text-indent: 21pt; margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span style="font-family: 宋体;">在</span><span><span style="font-family: Calibri;">Java EE</span></span><span style="font-family: 宋体;">环境中，</span><span><span style="font-family: Calibri;">ConnectionFactory</span></span><span style="font-family: 宋体;">会池化</span><span><span style="font-family: Calibri;">Connection</span></span><span style="font-family: 宋体;">和</span><span><span style="font-family: Calibri;">Session</span></span><span style="font-family: 宋体;">，这样这些资源将会在整个事务中被有效地重复利用。在一个独立的环境中，使用</span><span><span style="font-family: Calibri;">Spring</span></span><span style="font-family: 宋体;">的</span><span><span style="font-family: Calibri;">SingleConnectionFactory</span></span><span style="font-family: 宋体;">时所有的事务将公用一个</span><span><span style="font-family: Calibri;">Connection</span></span><span style="font-family: 宋体;">，但是每个事务将保留自己独立的</span><span><span style="font-family: Calibri;">Session</span></span><span style="font-family: 宋体;">。</span></span></p><p></p>
<p></p><p class="MsoNormal" style="text-indent: 21pt; margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span><span style="font-family: Calibri;">JmsTemplate</span></span><span style="font-family: 宋体;">可以利用</span><span><span style="font-family: Calibri;">JtaTransactionManager</span></span><span style="font-family: 宋体;">和能够进行分布式的</span><span><span style="font-family: Calibri;"> JMS ConnectionFactory</span></span><span style="font-family: 宋体;">处理分布式事务。</span></span></p><p></p>
<p></p><p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span><span><span style="font-family: Calibri;">       </span></span></span><span style="font-family: 宋体;">在</span><span><span style="font-family: Calibri;">Spring</span></span><span style="font-family: 宋体;">整合</span><span><span style="font-family: Calibri;">JMS</span></span><span style="font-family: 宋体;">的应用中，如果我们要进行本地的事务管理的话非常简单，只需要在定义对应的消息监听容器时指定其</span><span><span style="font-family: Calibri;">sessionTransacted</span></span><span style="font-family: 宋体;">属性为</span><span><span style="font-family: Calibri;">true</span></span><span style="font-family: 宋体;">，如：</span></span></p><p></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;"> </p><p></p>
<p><div class="iteye-blog-content-contain" style="font-size: 14px;"></div></p>
<p><pre class="xml" name="code">    &lt;bean id=”jmsContainer”<br>        class=”org.springframework.jms.listener.DefaultMessageListenerContainer”&gt;<br>        &lt;property name=”connectionFactory” ref=”connectionFactory” /&gt;<br>        &lt;property name=”destination” ref=”queueDestination” /&gt;<br>        &lt;property name=”messageListener” ref=”consumerMessageListener” /&gt;<br>        &lt;property name=”sessionTransacted” value=”true”/&gt;<br>    &lt;/bean&gt;<br></pre><br></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;"> </p><p></p>
<p></p><p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span><span><span style="font-family: Calibri;">       </span></span></span><span style="font-family: 宋体;">该属性值默认为</span><span><span style="font-family: Calibri;">false</span></span><span style="font-family: 宋体;">，这样</span><span><span style="font-family: Calibri;">JMS</span></span><span style="font-family: 宋体;">在进行消息监听的时候就会进行事务控制，当在接收消息时监听器执行失败时</span><span><span style="font-family: Calibri;">JMS</span></span><span style="font-family: 宋体;">就会对接收到的消息进行回滚，对于</span><span><span style="font-family: Calibri;">SessionAwareMessageListener</span></span><span style="font-family: 宋体;">在接收到消息后发送一个返回消息时也处于同一事务下，但是对于其他操作如数据库访问等将不属于该事务控制。</span></span></p><p></p>
<p></p><p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span style="font-family: 宋体;">这里我们可以来做一个这样的测试：我们如上配置监听在</span><span><span style="font-family: Calibri;">queueDestination</span></span><span style="font-family: 宋体;">的消息监听容器的</span><span><span style="font-family: Calibri;">sessionTransacted</span></span><span style="font-family: 宋体;">属性为</span><span><span style="font-family: Calibri;">true</span></span><span style="font-family: 宋体;">，然后把我们前面提到的消息监听器</span><span><span style="font-family: Calibri;">ConsumerMessageListener</span></span><span style="font-family: 宋体;">改成这样：</span></span></p><p></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;"> </p><p></p>
<p><div class="iteye-blog-content-contain" style="font-size: 14px;"></div></p>
<p><pre class="java" name="code">public class ConsumerMessageListener implements MessageListener {</pre></p>
<pre><code>public void onMessage(Message message) {
        //这里我们知道生产者发送的就是一个纯文本消息，所以这里可以直接进行强制转换，或者直接把onMessage方法的参数改成Message的子类TextMessage
        TextMessage textMsg = (TextMessage) message;
        System.out.println(&quot;接收到一个纯文本消息。&quot;);
        try {
            System.out.println(&quot;消息内容是：&quot; + textMsg.getText());
            if (1 == 1) {
                throw new RuntimeException(&quot;Error&quot;);
            }
        } catch (JMSException e) {
            e.printStackTrace();
        }
}
</code></pre><p>}<br><br></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;">        </p><p></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span style="font-family: 宋体;">我们可以看到在上述代码中我们的</span><span><span style="font-family: Calibri;">ConsumerMessageListener</span></span><span style="font-family: 宋体;">在进行消息接收的时候抛出了一个</span><span><span style="font-family: Calibri;">RuntimeException</span></span><span style="font-family: 宋体;">，根据我们上面说的，因为我们已经在对应的监听容器上定义了其</span><span><span style="font-family: Calibri;">sessionTransacted</span></span><span style="font-family: 宋体;">属性为</span><span><span style="font-family: Calibri;">true</span></span><span style="font-family: 宋体;">，所以当这里抛出异常的时候</span><span><span style="font-family: Calibri;">JMS</span></span><span style="font-family: 宋体;">将对接收到的消息进行回滚，即下次进行消息接收的时候该消息仍然能够被接收到。为了验证这一点，我们先执行一遍测试代码，往</span><span><span style="font-family: Calibri;">queueDestination</span></span><span style="font-family: 宋体;">发送一个文本消息，这个时候</span><span><span style="font-family: Calibri;">ConsumerMessageListener</span></span><span style="font-family: 宋体;">在进行接收的时候将会抛出一个</span><span><span style="font-family: Calibri;">RuntimeException</span></span><span style="font-family: 宋体;">，已经接收到的纯文本消息将进行回滚；接着我们去掉上面代码中抛出异常的语句，即</span><span><span style="font-family: Calibri;">ConsumerMessageListener</span></span><span style="font-family: 宋体;">能够正常的进行消息接收，这个时候我们再运行一次测试代码，往</span><span><span style="font-family: Calibri;">ConsumerMessageListener</span></span><span style="font-family: 宋体;">监听的</span><span><span style="font-family: Calibri;">queueDestination</span></span><span style="font-family: 宋体;">发送一条消息。如果之前在接手时抛出了异常的那条消息已经回滚了的话，那么这个时候将能够接收到两条消息，控制台将输出接收到的两条消息的内容。具体结果有兴趣的朋友可以自己验证一下。</span></span></p><p></p>
<p></p><p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span><span><span style="font-family: Calibri;">       </span></span></span><span style="font-family: 宋体;">如果想接收消息和数据库访问处于同一事务中，那么我们就可以配置一个外部的事务管理同时配置一个支持外部事务管理的消息监听容器（如</span><span><span style="font-family: Calibri;">DefaultMessageListenerContainer</span></span><span style="font-family: 宋体;">）。要配置这样一个参与分布式事务管理的消息监听容器，我们可以配置一个</span><span><span style="font-family: Calibri;">JtaTransactionManager</span></span><span style="font-family: 宋体;">，当然底层的</span><span><span style="font-family: Calibri;">JMS ConnectionFactory</span></span><span style="font-family: 宋体;">需要能够支持分布式事务管理，并正确地注册我们的</span><span><span style="font-family: Calibri;">JtaTransactionManager</span></span><span style="font-family: 宋体;">。这样消息监听器进行消息接收和对应的数据库访问就会处于同一数据库控制下，当消息接收失败或数据库访问失败都会进行事务回滚操作。</span></span></p><p></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;"> </p><p></p>
<p><div class="iteye-blog-content-contain" style="font-size: 14px;"></div></p>
<p><pre class="xml" name="code">    &lt;bean id=”jmsContainer”<br>        class=”org.springframework.jms.listener.DefaultMessageListenerContainer”&gt;<br>        &lt;property name=”connectionFactory” ref=”connectionFactory” /&gt;<br>        &lt;property name=”destination” ref=”queueDestination” /&gt;<br>        &lt;property name=”messageListener” ref=”consumerMessageListener” /&gt;<br>        &lt;property name=”transactionManager” ref=”jtaTransactionManager”/&gt;<br>    &lt;/bean&gt;</pre></p>
<pre><code>&amp;lt;bean id=&quot;jtaTransactionManager&quot; class=&quot;org.springframework.transaction.jta.JtaTransactionManager&quot;/&amp;gt;
</code></pre><p><br></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;">        </p><p></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span style="font-family: 宋体;">当给消息监听容器指定了</span><span><span style="font-family: Calibri;">transactionManager</span></span><span style="font-family: 宋体;">时，消息监听容器将忽略</span><span><span style="font-family: Calibri;">sessionTransacted</span></span><span style="font-family: 宋体;">的值。</span></span><span><span style="font-family: Calibri; font-size: medium;"> </span></span></p><p></p>
<p></p><p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span><span><span style="font-family: Calibri;">       </span></span></span><span style="font-family: 宋体;">关于使用</span><span><span style="font-family: Calibri;">JtaTransactionManager</span></span><span style="font-family: 宋体;">来管理上述分布式事务，我们这里也可以来做一个试验。</span></span></p><p></p>
<p></p><p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span><span><span style="font-family: Calibri;">       </span></span></span><span style="font-family: 宋体;">首先：往</span><span><span style="font-family: Calibri;">Spring</span></span><span style="font-family: 宋体;">配置文件</span><span><span style="font-family: Calibri;">applicationContext.xml</span></span><span style="font-family: 宋体;">中添加如下配置：</span></span></p><p></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;"><span style="font-family: Consolas; color: black; font-size: 10pt;"><span>    </span></span></p><p></p>
<p><div class="iteye-blog-content-contain" style="font-size: 14px;"></div></p>
<p><pre class="xml" name="code">    &lt;bean id=”jdbcTemplate” class=”org.springframework.jdbc.core.JdbcTemplate”&gt;<br>        &lt;property name=”dataSource” ref=”dataSource”/&gt;<br>    &lt;/bean&gt;</pre></p>
<pre><code>&amp;lt;jee:jndi-lookup jndi-name=&quot;jdbc/mysql&quot; id=&quot;dataSource&quot;/&amp;gt;
&amp;lt;bean id=&quot;jtaTransactionManager&quot; class=&quot;org.springframework.transaction.jta.JtaTransactionManager&quot;/&amp;gt;

&amp;lt;tx:annotation-driven transaction-manager=&quot;jtaTransactionManager&quot;/&amp;gt;
</code></pre><p><br></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;">  </p><p></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span><span><span style="font-family: Calibri;">       </span></span></span><span style="font-family: 宋体;">我们可以看到，在这里我们引入了一个</span><span><span style="font-family: Calibri;">jndi</span></span><span style="font-family: 宋体;">数据源，定义了一个</span><span><span style="font-family: Calibri;">JtaTransactionManager</span></span><span style="font-family: 宋体;">，定义了</span><span><span style="font-family: Calibri;">Spring</span></span><span style="font-family: 宋体;">基于注解的声明式事务管理，定义了一个</span><span><span style="font-family: Calibri;">Spring</span></span><span style="font-family: 宋体;">提供的进行</span><span><span style="font-family: Calibri;">Jdbc</span></span><span style="font-family: 宋体;">操作的工具类</span><span><span style="font-family: Calibri;">jdbcTemplate</span></span><span style="font-family: 宋体;">。</span></span></p><p></p>
<p></p><p class="iteye-blog-content-contain" style="font-size: 14px;"> </p><p></p>
<p></p><p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span><span><span style="font-family: Calibri;">       </span></span></span><span style="font-family: 宋体;">接下来把我们的</span><span><span style="font-family: Calibri;">ConsumerMessageListener</span></span><span style="font-family: 宋体;">改为如下形式：</span></span></p><p></p>
<p><div class="iteye-blog-content-contain" style="font-size: 14px;"></div></p>
<p><pre class="java" name="code">public class ConsumerMessageListener implements MessageListener {</pre></p>
<pre><code>@Autowired
private TestDao testDao;

private int count = 0;

public void onMessage(Message message) {
        //这里我们知道生产者发送的就是一个纯文本消息，所以这里可以直接进行强制转换，或者直接把onMessage方法的参数改成Message的子类TextMessage
        TextMessage textMsg = (TextMessage) message;
        System.out.println(new Date().toLocaleString() + &quot;接收到一个纯文本消息。&quot;);
        try {
            String text = textMsg.getText();
            System.out.println(&quot;消息内容是：&quot; + text);
            System.out.println(&quot;当前count的值是：&quot; + count);
            testDao.insert(text + count);
            if (count == 0) {
                count ++;
                throw new RuntimeException(&quot;Error! 出错啦！&quot;);
            }
        } catch (JMSException e) {
            e.printStackTrace();
        }
}
</code></pre><p>}<br><br></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;"> </p><p></p>
<p></p><p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span><span><span style="font-family: Calibri;">       </span></span></span><span style="font-family: 宋体;">我们可以看到，在</span><span><span style="font-family: Calibri;">ConsumerMessageListener</span></span><span style="font-family: 宋体;">中我们定义了一个实例变量</span><span><span style="font-family: Calibri;">count</span></span><span style="font-family: 宋体;">，其初始值为</span><span><span style="font-family: Calibri;">0</span></span><span style="font-family: 宋体;">；在</span><span><span style="font-family: Calibri;">onMessage</span></span><span style="font-family: 宋体;">里面，我们可以看到我们把接收到的消息内容作为参数调用了</span><span><span style="font-family: Calibri;">testDao</span></span><span style="font-family: 宋体;">的</span><span><span style="font-family: Calibri;">insert</span></span><span style="font-family: 宋体;">方法；当</span><span><span style="font-family: Calibri;">count</span></span><span style="font-family: 宋体;">值为</span><span><span style="font-family: Calibri;">0</span></span><span style="font-family: 宋体;">，也就是进行第一次消息接收的时候会将</span><span><span style="font-family: Calibri;">count</span></span><span style="font-family: 宋体;">的值加</span><span><span style="font-family: Calibri;">1</span></span><span style="font-family: 宋体;">，同时抛出一个运行时异常。那么我们这里要测试的就是进行第一次接收的时候</span><span><span style="font-family: Calibri;">testDao</span></span><span style="font-family: 宋体;">已经把相关内容插入数据库了，接着在</span><span><span style="font-family: Calibri;">onMessage</span></span><span style="font-family: 宋体;">里面抛出了一个异常同时</span><span><span style="font-family: Calibri;">count</span></span><span style="font-family: 宋体;">加</span><span><span style="font-family: Calibri;">1</span></span><span style="font-family: 宋体;">，我们预期的结果应该是此时数据库进行回滚，同时</span><span><span style="font-family: Calibri;">JMS</span></span><span style="font-family: 宋体;">也回滚，这样</span><span><span style="font-family: Calibri;">JMS</span></span><span style="font-family: 宋体;">将继续尝试接收该消息，此时同样会调用</span><span><span style="font-family: Calibri;">testDao</span></span><span style="font-family: 宋体;">的</span><span><span style="font-family: Calibri;">insert</span></span><span style="font-family: 宋体;">方法将内容插入数据库，再接着</span><span><span style="font-family: Calibri;">count</span></span><span style="font-family: 宋体;">已经不为</span><span><span style="font-family: Calibri;">0</span></span><span style="font-family: 宋体;">了，所以此时将不再抛出异常，</span><span><span style="font-family: Calibri;">JMS</span></span><span style="font-family: 宋体;">成功进行消息的接收，</span><span><span style="font-family: Calibri;">testDao</span></span><span style="font-family: 宋体;">也成功的将消息内容插入到了数据库。要证明这个预期我们除了看数据库中插入的数据外，还可以看控制台的输出，正常情况控制台将输出两次消息接收的内容，且第一次时</span><span><span style="font-family: Calibri;">count</span></span><span style="font-family: 宋体;">为</span><span><span style="font-family: Calibri;">0</span></span><span style="font-family: 宋体;">，第二次</span><span><span style="font-family: Calibri;">count</span></span><span style="font-family: 宋体;">为</span><span><span style="font-family: Calibri;">1</span></span><span style="font-family: 宋体;">。</span></span></p><p></p>
<p></p><p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span><span style="font-family: Calibri;"><span>       </span>TestDao</span></span><span style="font-family: 宋体;">是一个接口，其</span><span><span style="font-family: Calibri;">TestDaoImpl</span></span><span style="font-family: 宋体;">对</span><span><span style="font-family: Calibri;">insert</span></span><span style="font-family: 宋体;">的方法实现如下：</span></span> </p><p></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;"> </p><p></p>
<p><div class="iteye-blog-content-contain" style="font-size: 14px;"></div></p>
<p><pre class="java" name="code">    @Transactional(readOnly=false)<br>    public void insert(final String name) {</pre></p>
<pre><code>    jdbcTemplate.update(&quot;insert into test(name) values(?)&quot;, name);

}
</code></pre><p><br></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;">       </p><p></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span style="font-family: 宋体;">这里我们使用支持</span><span><span style="font-family: Calibri;">JtaTransactionManager</span></span><span style="font-family: 宋体;">的</span><span><span style="font-family: Calibri;">Weblogic</span></span><span style="font-family: 宋体;">来进行测试，因为是</span><span><span style="font-family: Calibri;">Web</span></span><span style="font-family: 宋体;">容器，所以我们这里定义了一个</span><span><span style="font-family: Calibri;">Controller</span></span><span style="font-family: 宋体;">来进行消息的发送，具体代码如下：</span></span></p><p></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;"> </p><p></p>
<p><div class="iteye-blog-content-contain" style="font-size: 14px;"></div></p>
<p><pre class="java" name="code">@Controller<br>@RequestMapping(“test”)<br>public class TestController {</pre></p>
<pre><code>@Autowired
@Qualifier(&quot;queueDestination&quot;)
private Destination destination;

@Autowired
private ProducerService producerService;

@RequestMapping(&quot;first&quot;)
public String first() {
    producerService.sendMessage(destination, &quot;你好，现在是：&quot; + new Date().toLocaleString());
    return &quot;/test/first&quot;;
}
</code></pre><p>}<br><br></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;">      </p><p></p>
<p></p><p class="MsoNormal" style="text-align: left; margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span style="font-family: 宋体;">接下来就是启用</span><span><span style="font-family: Calibri;">Weblogic</span></span><span style="font-family: 宋体;">服务器，进入其控制台，定义一个名叫“</span><span><span style="font-family: Calibri;">jdbc/mysql</span></span><span style="font-family: 宋体;">”的</span><span><span style="font-family: Calibri;">JNDI</span></span><span style="font-family: 宋体;">数据源，然后把该项目部署到</span><span><span style="font-family: Calibri;">Weblogic</span></span><span style="font-family: 宋体;">服务器上并进行启动。接下来我们就可以访问</span><span><span style="font-family: Calibri;">/test/first.do</span></span><span style="font-family: 宋体;">访问到上述</span><span><span style="font-family: Calibri;">first</span></span><span style="font-family: 宋体;">方法。之后控制台会输出如下信息：</span></span></p><p></p>
<p></p><p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: medium;"><span><span><span style="font-family: Calibri;"><br><img alt="" src="http://dl2.iteye.com/upload/attachment/0091/7448/655db0fd-c363-3ebb-9165-9e3c59515307.png"><br>        </span></span></span><span style="font-family: 宋体;">我们可以看到当</span><span><span style="font-family: Calibri;">count</span></span><span style="font-family: 宋体;">为</span><span><span style="font-family: Calibri;">0</span></span><span style="font-family: 宋体;">时接收了一次，并随后抛出了异常，之后</span><span><span style="font-family: Calibri;">count</span></span><span style="font-family: 宋体;">为</span><span><span style="font-family: Calibri;">1</span></span><span style="font-family: 宋体;">又接收了一次，这说明在</span><span><span style="font-family: Calibri;">count</span></span><span style="font-family: 宋体;">为</span><span><span style="font-family: Calibri;">0</span></span><span style="font-family: 宋体;">时抛出异常后我们的</span><span><span style="font-family: Calibri;">JMS</span></span><span style="font-family: 宋体;">进行回滚了，那么我们的数据库是否有进行回滚呢？接着我们来看数据库中的内容：</span></span></p><p></p>
<p></p><p class="iteye-blog-content-contain" style="font-size: 14px;"><span><span><br><img alt="" src="http://dl2.iteye.com/upload/attachment/0091/7450/7196d8b4-8947-3ca9-aee2-c0831cc15061.png"><br>        </span></span><span style="font-family: 宋体; font-size: 12pt;">我们可以看到数据库表中只有一条记录，而且最后一位表示</span><span>count</span><span style="font-family: 宋体; font-size: 12pt;">的值的为</span><span>1</span><span style="font-family: 宋体; font-size: 12pt;">，这说明在</span><span>JMS</span><span style="font-family: 宋体; font-size: 12pt;">进行消息接收抛出异常时我们的数据库也回滚了。关于使用</span><span>JtaTransactionManager</span><span style="font-family: 宋体; font-size: 12pt;">进行分布式事务管理的问题就说到这里了，有兴趣的朋友可以自己试验一下。</span></p><p></p>
<p></p><p class="iteye-blog-content-contain" style="font-size: 14px;"> </p><p></p>
<div class="iteye-blog-content-contain" style="font-size: 14px;">

</div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/06/14/activemq-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/14/activemq-01/" itemprop="url">Spring整合ActiveMQ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-14T14:17:28+08:00">
                2017-06-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post"><br><br><h1>1.管理ActiveMQ</h1><br><p>地址 &nbsp;<a target="_blank" href="http://localhost:8161/admin/" style="color:rgb(255,153,0); text-decoration:none; font-family:'microsoft yahei'; font-size:14px; line-height:26px">http://localhost:8161/admin/</a></p><br><p>&nbsp; &nbsp; 默认用户和密码：admin=admin</p><br><p></p><br><ol style="font-family:'microsoft yahei'; font-size:14px; line-height:26px"><br><li style=""><br><p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"><br>运行发送者，eclipse控制台输出，如下图：&nbsp;<br style=""><br><img src="http://img.blog.csdn.net/20150920173405956" alt="这里写图片描述" title="" style="border:none; max-width:100%">&nbsp;<br style=""><br>此时，我们先看一下ActiveMQ服务器，Queues内容如下：&nbsp;<br style=""><br><img src="http://img.blog.csdn.net/20150920173620033" alt="这里写图片描述" title="" style="border:none; max-width:100%"><br style=""><br>我们可以看到创建了一个名称为HelloWorld的消息队列，队列中有10条消息未被消费，我们也可以通过Browse查看是哪些消息，如下图：&nbsp;<br style=""><br><img src="http://img.blog.csdn.net/20150920174135335" alt="这里写图片描述" title="" style="border:none; max-width:100%"><br style=""><br>如果这些队列中的消息，被删除，消费者则无法消费。</p><br></li><li style=""><br><p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"><br>我们继续运行一下消费者，eclipse控制台打印消息，如下：&nbsp;<br style=""><br><img src="http://img.blog.csdn.net/20150920174317150" alt="这里写图片描述" title="" style="border:none; max-width:100%">&nbsp;<br style=""><br>此时，我们先看一下ActiveMQ服务器，Queues内容如下：&nbsp;<br style=""><br><img src="http://img.blog.csdn.net/20150920174417511" alt="这里写图片描述" title="" style="border:none; max-width:100%"><br style=""><br>我们可以看到HelloWorld的消息队列发生变化，多一个消息者，队列中的10条消息被消费了，点击Browse查看，已经为空了。&nbsp;<br style=""><br>点击Active Consumers，我们可以看到这个消费者的详细信息：&nbsp;<br style=""><br><img src="http://img.blog.csdn.net/20150920175100179" alt="这里写图片描述" title="" style="border:none; max-width:100%"></p><br></li></ol><br><br><br><p></p><br><p><br><br></p><br><h1>2.Spring整合ActiveMQ</h1><br><h2>&nbsp; &nbsp;1.maven</h2><br><div>&nbsp; &nbsp; &nbsp; &nbsp;<pre code_snippet_id="1660918" snippet_file_name="blog_20160425_1_1952419" name="code" class="html">&lt;!–ActiveMQ依赖 –&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;<br>            &lt;artifactId&gt;activemq-all&lt;/artifactId&gt;<br>            &lt;version&gt;5.13.2&lt;/version&gt;<br>        &lt;/dependency&gt;<br>&lt;!– Spring整合ActiveMQ所需依赖 –&gt;<br>            &lt;dependency&gt;<br>                &lt;groupId&gt;org.springframework&lt;/groupId&gt;<br>                &lt;artifactId&gt;spring-jms&lt;/artifactId&gt;<br>            &lt;/dependency&gt;<br>            &lt;dependency&gt;<br>                &lt;groupId&gt;org.springframework&lt;/groupId&gt;<br>                &lt;artifactId&gt;spring-messaging&lt;/artifactId&gt;<br>            &lt;/dependency&gt;</pre><br><br><br><br><br><br><br><br></div><br><h2>&nbsp; &nbsp;2.ActiveMQ配置文件</h2><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_2_1712439" name="code" class="html">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;beans xmlns=&quot;<a href="http://www.springframework.org/schema/beans&amp;quot" target="_blank" rel="external">http://www.springframework.org/schema/beans&amp;quot</a>;<br>    xmlns:context=&quot;<a href="http://www.springframework.org/schema/context&amp;quot" target="_blank" rel="external">http://www.springframework.org/schema/context&amp;quot</a>;<br>    xmlns:xsi=&quot;<a href="http://www.w3.org/2001/XMLSchema-instance&amp;quot" target="_blank" rel="external">http://www.w3.org/2001/XMLSchema-instance&amp;quot</a>; xmlns:amq=&quot;<a href="http://activemq.apache.org/schema/core&amp;quot" target="_blank" rel="external">http://activemq.apache.org/schema/core&amp;quot</a>;<br>    xmlns:jms=&quot;<a href="http://www.springframework.org/schema/jms&amp;quot" target="_blank" rel="external">http://www.springframework.org/schema/jms&amp;quot</a>;<br>    xsi:schemaLocation=&quot;<a href="http://www.springframework.org/schema/beans" target="_blank" rel="external">http://www.springframework.org/schema/beans</a><br>        <a href="http://www.springframework.org/schema/beans/spring-beans-4.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</a><br>        <a href="http://www.springframework.org/schema/context" target="_blank" rel="external">http://www.springframework.org/schema/context</a><br>        <a href="http://www.springframework.org/schema/context/spring-context-4.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/context/spring-context-4.0.xsd</a><br>        <a href="http://www.springframework.org/schema/jms" target="_blank" rel="external">http://www.springframework.org/schema/jms</a><br>        <a href="http://www.springframework.org/schema/jms/spring-jms-4.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/jms/spring-jms-4.0.xsd</a><br>        <a href="http://activemq.apache.org/schema/core" target="_blank" rel="external">http://activemq.apache.org/schema/core</a><br>        <a href="http://activemq.apache.org/schema/core/activemq-core-5.8.0.xsd&quot;&amp;gt" target="_blank" rel="external">http://activemq.apache.org/schema/core/activemq-core-5.8.0.xsd&quot;&amp;gt</a>;<br><br>    &lt;!– ActiveMQ 连接工厂 –&gt;<br>    &lt;!– 真正可以产生Connection的ConnectionFactory，由对应的 JMS服务厂商提供–&gt;<br>    &lt;!– 如果连接网络：tcp://ip:61616；未连接网络：tcp://localhost:61616 以及用户名，密码–&gt;<br>    &lt;amq:connectionFactory id=&quot;amqConnectionFactory&quot;<br>        brokerURL=&quot;tcp://172.17.65.29:61616&quot; userName=&quot;admin&quot; password=&quot;admin&quot;  /&gt;<br><br>    &lt;!– Spring Caching连接工厂 –&gt;<br>    &lt;!– Spring用于管理真正的ConnectionFactory的ConnectionFactory –&gt;<br>    &lt;bean id=&quot;connectionFactory&quot; class=&quot;org.springframework.jms.connection.CachingConnectionFactory&quot;&gt;<br>        &lt;!– 目标ConnectionFactory对应真实的可以产生JMS Connection的ConnectionFactory –&gt;<br>        &lt;property name=&quot;targetConnectionFactory&quot; ref=&quot;amqConnectionFactory&quot;&gt;&lt;/property&gt;<br>        &lt;!– 同上，同理 –&gt;<br>        &lt;!– &lt;constructor-arg ref=&quot;amqConnectionFactory&quot; /&gt; –&gt;<br>        &lt;!– Session缓存数量 –&gt;<br>        &lt;property name=&quot;sessionCacheSize&quot; value=&quot;100&quot; /&gt;<br>    &lt;/bean&gt;<br><br>    &lt;!– Spring JmsTemplate 的消息生产者 start–&gt;<br><br>    &lt;!– 定义JmsTemplate的Queue类型 –&gt;<br>    &lt;bean id=&quot;jmsQueueTemplate&quot; class=&quot;org.springframework.jms.core.JmsTemplate&quot;&gt;<br>        &lt;!– 这个connectionFactory对应的是我们定义的Spring提供的那个ConnectionFactory对象 –&gt;<br>        &lt;constructor-arg ref=&quot;connectionFactory&quot; /&gt;<br>        &lt;!– 非pub/sub模型（发布/订阅），即队列模式 –&gt;<br>        &lt;property name=&quot;pubSubDomain&quot; value=&quot;false&quot; /&gt;<br>    &lt;/bean&gt;<br><br>    &lt;!– 定义JmsTemplate的Topic类型 –&gt;<br>    &lt;bean id=&quot;jmsTopicTemplate&quot; class=&quot;org.springframework.jms.core.JmsTemplate&quot;&gt;<br>         &lt;!– 这个connectionFactory对应的是我们定义的Spring提供的那个ConnectionFactory对象 –&gt;<br>        &lt;constructor-arg ref=&quot;connectionFactory&quot; /&gt;<br>        &lt;!– pub/sub模型（发布/订阅） –&gt;<br>        &lt;property name=&quot;pubSubDomain&quot; value=&quot;true&quot; /&gt;<br>    &lt;/bean&gt;<br><br>    &lt;!–Spring JmsTemplate 的消息生产者 end–&gt;<br><br><br>    &lt;!– 消息消费者 start–&gt;<br><br>    &lt;!– 定义Queue监听器 –&gt;<br>    &lt;jms:listener-container destination-type=&quot;queue&quot; container-type=&quot;default&quot; connection-factory=&quot;connectionFactory&quot; acknowledge=&quot;auto&quot;&gt;<br>        &lt;jms:listener destination=&quot;test.queue&quot; ref=&quot;queueReceiver1&quot;/&gt;<br>        &lt;jms:listener destination=&quot;test.queue&quot; ref=&quot;queueReceiver2&quot;/&gt;<br>    &lt;/jms:listener-container&gt;<br><br>    &lt;!– 定义Topic监听器 –&gt;<br>    &lt;jms:listener-container destination-type=&quot;topic&quot; container-type=&quot;default&quot; connection-factory=&quot;connectionFactory&quot; acknowledge=&quot;auto&quot;&gt;<br>        &lt;jms:listener destination=&quot;test.topic&quot; ref=&quot;topicReceiver1&quot;/&gt;<br>        &lt;jms:listener destination=&quot;test.topic&quot; ref=&quot;topicReceiver2&quot;/&gt;<br>    &lt;/jms:listener-container&gt;<br><br>    &lt;!– 消息消费者 end –&gt;<br>&lt;/beans&gt;  </pre><br><br><h2>3.生产者</h2><br></div><br><h3>1.queue消息队列模式</h3><br><div><br><br></div><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_3_2410550" name="code" class="java">package com.jay.mq.demo1.producer.queue;<br><br><br>import javax.jms.JMSException;<br>import javax.jms.Message;<br>import javax.jms.Session;<br><br><br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.beans.factory.annotation.Qualifier;<br>import org.springframework.jms.core.JmsTemplate;<br>import org.springframework.jms.core.MessageCreator;<br>import org.springframework.stereotype.Component;<br><br><br>/<strong><br>&#160;<em> ActiveMQ的消息队列模式<br>&#160;</em> Description: &lt;br/&gt;<br>&#160;<em> 队列消息的生产者，发哦是哪个消息到队列<br>&#160;</em> @author hetiewei<br>&#160;<em> @date 2016年4月25日 上午10:20:20<br>&#160;</em><br>&#160;*/<br>@Component(&quot;queueSender&quot;)<br>public class QueueSender1 {<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;/</strong><br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; <em> 通过Qualifier来注入对应的Bean<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; </em>/<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;@Autowired<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;@Qualifier(&quot;jmsQueueTemplate&quot;)<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;private JmsTemplate jmsTemplate;<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;/<strong><br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; <em> Description: &lt;br/&gt;<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; </em> 发送消息到指定的队列(目标)<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; <em> @author hetiewei<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; </em> @date 2016年4月25日 上午10:24:57<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; <em> @param queueName &#160;队列名称<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; </em> @param message &#160; &#160;消息内容<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; */<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;public void send(String queueName, final String message){<br>&lt;span style=&quot;white-space:pre&quot;&gt;        &lt;/span&gt;jmsTemplate.send(queueName, new MessageCreator() {<br>&lt;span style=&quot;white-space:pre&quot;&gt;            &lt;/span&gt;<br>&lt;span style=&quot;white-space:pre&quot;&gt;            &lt;/span&gt;public Message createMessage(Session session) throws JMSException {<br>&lt;span style=&quot;white-space:pre&quot;&gt;                &lt;/span&gt;return session.createTextMessage(message);<br>&lt;span style=&quot;white-space:pre&quot;&gt;            &lt;/span&gt;}<br>&lt;span style=&quot;white-space:pre&quot;&gt;        &lt;/span&gt;});<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;}<br>}<br></strong></pre><br><h3><br><br><br><br>2.&nbsp;topic/sub订阅模式</h3><br></div><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_4_2552254" name="code" class="java">package com.jay.mq.demo1.producer.topic;<br><br>import javax.jms.JMSException;<br>import javax.jms.Message;<br>import javax.jms.Session;<br><br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.beans.factory.annotation.Qualifier;<br>import org.springframework.jms.core.JmsTemplate;<br>import org.springframework.jms.core.MessageCreator;<br>import org.springframework.stereotype.Component;<br><br>/<br> <em> ActiveMQ的topic/sub模式
 </em> Description: &lt;br/&gt;<br> <em> Topic生产者发送消息到Topic
 </em> @author hetiewei<br> <em> @date 2016年4月25日 上午11:22:40
 </em><br> <em>/<br>@Component<br>public class TopicSender1 {<br><br>    @Autowired<br>    @Qualifier(&quot;jmsTopicTemplate&quot;)<br>    private JmsTemplate jmsTemplate;<br><br>    /**
     </em> 发送一条消息到指定的队列（目标）<br>     <em> @param queueName 队列名称
     </em> @param message 消息内容<br>     <em>/<br>    public void send(String topicName,final String message){<br>        jmsTemplate.send(topicName, new MessageCreator() {<br><br>            public Message createMessage(Session session) throws JMSException {<br>                return session.createTextMessage(message);<br>            }<br>        });<br>    }<br><br>}<br></em></pre><br><br><br><br></div><br><h2>4.消费者</h2><br><h3>1.queue消息队列模式</h3><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_5_3250365" name="code" class="java">package com.jay.mq.demo1.consumer.queue;<br><br>import javax.jms.JMSException;<br>import javax.jms.Message;<br>import javax.jms.MessageListener;<br>import javax.jms.TextMessage;<br><br>import org.springframework.stereotype.Component;<br><br>/**
  Description: &lt;br/&gt;<br> <em> 消息队列监听器
 </em> @author hetiewei<br> <em> @date 2016年4月25日 上午10:32:14
 </em><br> <em>/<br>@Component<br>public class QueueReceiver1 implements MessageListener {<br><br>    public void onMessage(Message message) {<br>        try {<br>            System.out.println(&quot;QueueReceiver1接收到消息：&quot;+((TextMessage)message).getText());<br>        } catch (JMSException e) {<br>            e.printStackTrace();<br>        }<br>    }<br><br>}<br></em></pre><br><br><br><br></div><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_6_3915457" name="code" class="java">package com.jay.mq.demo1.consumer.queue;<br><br>import javax.jms.JMSException;<br>import javax.jms.Message;<br>import javax.jms.MessageListener;<br>import javax.jms.TextMessage;<br><br>import org.springframework.stereotype.Component;<br><br>/**
  Description: &lt;br/&gt;<br> <em> 消息队列监听器
 </em> @author hetiewei<br> <em> @date 2016年4月25日 上午10:32:14
 </em><br> <em>/<br>@Component<br>public class QueueReceiver2 implements MessageListener {<br><br>    public void onMessage(Message message) {<br>        try {<br>            System.out.println(&quot;QueueReceiver2接收到消息：&quot;+((TextMessage)message).getText());<br>        } catch (JMSException e) {<br>            e.printStackTrace();<br>        }<br>    }<br><br>}<br></em></pre><br><br><br><br></div><br><h3>2.topic/sub订阅模式</h3><br><div><br><br></div><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_7_6249771" name="code" class="java">package com.jay.mq.demo1.consumer.topic;<br><br>import javax.jms.JMSException;<br>import javax.jms.Message;<br>import javax.jms.MessageListener;<br>import javax.jms.TextMessage;<br><br>import org.springframework.stereotype.Component;<br><br>@Component<br>public class TopicReceiver1 implements MessageListener{<br><br>    public void onMessage(Message message) {<br>        try {<br>            System.out.println(&quot;TopicReceiver1接收到消息:&quot;+((TextMessage)message).getText());<br>        } catch (JMSException e) {<br>            e.printStackTrace();<br>        }<br>    }<br><br>}<br></pre><br><br><br><br></div><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_8_4755272" name="code" class="java">package com.jay.mq.demo1.consumer.topic;<br><br>import javax.jms.JMSException;<br>import javax.jms.Message;<br>import javax.jms.MessageListener;<br>import javax.jms.TextMessage;<br><br>import org.springframework.stereotype.Component;<br><br>@Component<br>public class TopicReceiver2 implements MessageListener{<br><br>    public void onMessage(Message message) {<br>        try {<br>            System.out.println(&quot;TopicReceiver2接收到消息:&quot;+((TextMessage)message).getText());<br>        } catch (JMSException e) {<br>            e.printStackTrace();<br>        }<br>    }<br><br>}<br></pre><br><h2></h2><br><h2>5.Controller</h2><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_9_993281" name="code" class="java">package com.jay.controller.demo1;<br><br>import javax.annotation.Resource;<br><br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.stereotype.Controller;<br>import org.springframework.web.bind.annotation.RequestMapping;<br>import org.springframework.web.bind.annotation.RequestParam;<br>import org.springframework.web.bind.annotation.ResponseBody;<br><br>import com.jay.mq.demo1.producer.queue.QueueSender1;<br>import com.jay.mq.demo1.producer.topic.TopicSender1;<br><br>/**
  Description: &lt;br/&gt;<br> <em> 
 </em> @author hetiewei<br> <em> @date 2016年4月25日 上午10:35:31
 </em><br> <em>/<br>@Controller<br>@RequestMapping(&quot;activemq&quot;)<br>public class ActivemqController1 {<br><br>    @Resource<br>    private QueueSender1 queueSender;<br>    @Autowired<br>    private TopicSender1 topicSender;<br><br>    /**
     </em> 发送消息到队列<br>     <em> Queue队列：仅有一个订阅者会收到消息，消息一旦被处理就不会存在队列中
     </em> @param message<br>     <em> @return String
     </em>/<br>    @ResponseBody<br>    @RequestMapping(&quot;queueSender&quot;)<br>    public String queueSender(@RequestParam(&quot;message&quot;)String message){<br>        String opt=&quot;&quot;;<br>        try {<br>            queueSender.send(&quot;test.queue&quot;, message);<br>            opt = &quot;suc&quot;;<br>        } catch (Exception e) {<br>            opt = e.getCause().toString();<br>        }<br>        return opt;<br>    }<br><br>    @ResponseBody<br>    @RequestMapping(&quot;topicSender&quot;)<br>    public String topoicSender(@RequestParam(&quot;message&quot;)String message){<br>        String opt = &quot;&quot;;<br>        try {<br>            topicSender.send(&quot;test.topic&quot;, message);<br>            opt = &quot;suc&quot;;<br>        } catch (Exception e) {<br>            opt = e.getCause().toString();<br>        }<br>        return opt;<br>    }<br><br><br>}<br></pre><br><h1><br><br><br><br>3.<span style="color:rgb(64,64,64); line-height:25.2px; font-family:Cambria; font-size:14px">ActiveMQ</span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:1.3em; line-height:1.1">的多种部署方式</span></h1><br></div><br></div><br><div><br><p align="left" style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>单点的<span style="line-height:25.2px; font-family:Calibri">ActiveMQ</span>作为企业应用无法满足高可用和集群的需求，所以<span style="line-height:25.2px; font-family:Calibri">ActiveMQ</span>提供了<span style="line-height:25.2px; font-family:Calibri">master-slave</span>、<span style="line-height:25.2px; font-family:Calibri">broker<br> cluster</span>等多种部署方式，但通过分析多种部署方式之后我认为需要将两种部署方式相结合才能满足我们公司分布式和高可用的需求，所以后面就重点将解如何将两种部署方式相结合。</p><br><h5 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:14px"><br><a target="_blank" name="t7" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:25.2px">1、Master-Slave部署方式</span></h5><br><h6 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:12px"><br><a target="_blank" name="t8" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:21.6px">1）shared filesystem Master-Slave部署方式</span></h6><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>主要是通过共享存储目录来实现<span style="line-height:25.2px; font-family:Calibri">master</span>和<span style="line-height:25.2px; font-family:Calibri">slave</span>的热备，所有的<span style="line-height:25.2px; font-family:Calibri">ActiveMQ</span>应用都在不断地获取共享目录的控制权，哪个应用抢到了控制权，它就成为<span style="line-height:25.2px; font-family:Calibri">master</span>。</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>多个共享存储目录的应用，谁先启动，谁就可以最早取得共享目录的控制权成为<span style="line-height:25.2px; font-family:Calibri">master</span>，其他的应用就只能作为<span style="line-height:25.2px; font-family:Calibri">slave</span>。</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><img title="p2.png" border="0" alt="p2.png" src="http://static.open-open.com/lib/uploadImg/20140515/20140515120001_591.png" width="323" height="250" style="border:0px; vertical-align:middle; max-width:100%"></p><br><h6 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:12px"><br><a target="_blank" name="t9" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:21.6px">2）shared database Master-Slave方式</span></h6><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>与<span style="line-height:25.2px; font-family:Calibri">shared filesystem</span>方式类&#20284;，只是共享的存储介质由文件系统改成了数据库而已。</p><br><h6 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:12px"><br><a target="_blank" name="t10" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:21.6px">3）Replicated LevelDB Store方式</span></h6><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>这种主备方式是<span style="line-height:25.2px; font-family:Calibri">ActiveMQ5.9</span>以后才新增的特性，使用<span style="line-height:25.2px; font-family:Calibri">ZooKeeper</span>协调选择一个<span style="line-height:25.2px; font-family:Calibri">node</span>作为<span style="line-height:25.2px; font-family:Calibri">master</span>。被选择的<span style="line-height:25.2px; font-family:Calibri">master<br> broker node</span>开启并接受客户端连接。</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px">其他<span style="line-height:25.2px; font-family:Calibri">node</span>转入<span style="line-height:25.2px; font-family:Calibri">slave</span>模式，连接<span style="line-height:25.2px; font-family:Calibri">master</span>并同步他们的存储状态。<span style="line-height:25.2px; font-family:Calibri">slave</span>不接受客户端连接。所有的存储操作都将被复制到连接至<span style="line-height:25.2px; font-family:Calibri">Master</span>的<span style="line-height:25.2px; font-family:Calibri">slaves</span>。</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px">如果<span style="line-height:25.2px; font-family:Calibri">master</span>死了，得到了最新更新的<span style="line-height:25.2px; font-family:Calibri">slave</span>被允许成为<span style="line-height:25.2px; font-family:Calibri">master</span>。<span style="line-height:25.2px; font-family:Calibri">fialed<br> node</span>能够重新加入到网络中并连接<span style="line-height:25.2px; font-family:Calibri">master</span>进入<span style="line-height:25.2px; font-family:Calibri">slave mode</span>。所有需要同步的<span style="line-height:25.2px; font-family:Calibri">disk</span>的消息操作都将等待存储状态被复制到其他法定节点的操作完成才能完成。所以，如果你配置了<span style="line-height:25.2px; font-family:Calibri">replicas=3</span>，那么法定大小是<span style="line-height:25.2px; font-family:Calibri">(3/2)&#43;1=2.<br> Master</span>将会存储并更新然后等待<span style="line-height:25.2px; font-family:Calibri">&nbsp;(2-1)=1</span>个<span style="line-height:25.2px; font-family:Calibri">slave</span>存储和更新完成，才汇报<span style="line-height:25.2px; font-family:Calibri">success</span>。至于为什么是<span style="line-height:25.2px; font-family:Calibri">2-1</span>，熟悉<span style="line-height:25.2px; font-family:Calibri">Zookeeper</span>的应该知道，有一个<span style="line-height:25.2px; font-family:Calibri">node</span>要作为观擦者存在。</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px">单一个新的<span style="line-height:25.2px; font-family:Calibri">master</span>被选中，你需要至少保障一个法定<span style="line-height:25.2px; font-family:Calibri">node</span>在线以能够找到拥有最新状态的<span style="line-height:25.2px; font-family:Calibri">node</span>。这个<span style="line-height:25.2px; font-family:Calibri">node</span>将会成为新的<span style="line-height:25.2px; font-family:Calibri">master</span>。因此，推荐运行至少<span style="line-height:25.2px; font-family:Calibri">3</span>个<span style="line-height:25.2px; font-family:Calibri">replica<br> nodes</span>，以防止一个<span style="line-height:25.2px; font-family:Calibri">node</span>失败了，服务中断。</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><img title="p3.png" border="0" alt="p3.png" src="http://static.open-open.com/lib/uploadImg/20140515/20140515115951_604.png" width="328" height="153" style="border:0px; vertical-align:middle; max-width:100%"></p><br><h5 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:14px"><br><a target="_blank" name="t11" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:25.2px">2、Broker-Cluster部署方式</span></h5><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>前面的<span style="line-height:25.2px; font-family:Calibri">Master-Slave</span>的方式虽然能解决多服务热备的高可用问题，但无法解决负载均衡和分布式的问题。<span style="line-height:25.2px; font-family:Calibri">Broker-Cluster</span>的部署方式就可以解决负载均衡的问题。</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Broker-Cluster</span>部署方式中，各个<span style="line-height:25.2px; font-family:Calibri">broker</span>通过网络互相连接，并共享<span style="line-height:25.2px; font-family:Calibri">queue</span>。当<span style="line-height:25.2px; font-family:Calibri">broker-A</span>上面指定的<span style="line-height:25.2px; font-family:Calibri">queue-A</span>中接收到一个<span style="line-height:25.2px; font-family:Calibri">message</span>处于<span style="line-height:25.2px; font-family:Calibri">pending</span>状态，而此时没有<span style="line-height:25.2px; font-family:Calibri">consumer</span>连接<span style="line-height:25.2px; font-family:Calibri">broker-A</span>时。如果<span style="line-height:25.2px; font-family:Calibri">cluster</span>中的<span style="line-height:25.2px; font-family:Calibri">broker-B</span>上面由一个<span style="line-height:25.2px; font-family:Calibri">consumer</span>在消费<span style="line-height:25.2px; font-family:Calibri">queue-A</span>的消息，那么<span style="line-height:25.2px; font-family:Calibri">broker-B</span>会先通过内部网络获取到<span style="line-height:25.2px; font-family:Calibri">broker-A</span>上面的<span style="line-height:25.2px; font-family:Calibri">message</span>，并通知自己的<span style="line-height:25.2px; font-family:Calibri">consumer</span>来消费。</p><br><h6 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:12px"><br><a target="_blank" name="t12" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:21.6px">1）static Broker-Cluster部署</span></h6><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>在<span style="line-height:25.2px; font-family:Calibri">activemq.xml</span>文件中静态指定<span style="line-height:25.2px; font-family:Calibri">Broker</span>需要建立桥连接的其他<span style="line-height:25.2px; font-family:Calibri">Broker</span>：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">1、</span>&nbsp;&nbsp;<span style="line-height:25.2px">首先在<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnector&nbsp;&nbsp; uri=&quot;static:(tcp:// 0.0.0.0:61617)&quot;duplex=&quot;false&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">2、</span>&nbsp;&nbsp;<span style="line-height:25.2px">修改<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61616</span>：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61616?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">3、</span>&nbsp;&nbsp;<span style="line-height:25.2px">在<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnector&nbsp;&nbsp; uri=&quot;static:(tcp:// 0.0.0.0:61616)&quot;duplex=&quot;false&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">4、</span>&nbsp;&nbsp;<span style="line-height:25.2px">修改<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61617</span>：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61617?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">5</span>、分别启动<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>和<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>。</p><br><h6 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:12px"><br><a target="_blank" name="t13" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:21.6px">2）Dynamic Broker-Cluster部署</span></h6><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>在<span style="line-height:25.2px; font-family:Calibri">activemq.xml</span>文件中不直接指定<span style="line-height:25.2px; font-family:Calibri">Broker</span>需要建立桥连接的其他<span style="line-height:25.2px; font-family:Calibri">Broker</span>，由<span style="line-height:25.2px; font-family:Calibri">activemq</span>在启动后动态查找：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">1、</span>&nbsp;&nbsp;<span style="line-height:25.2px">首先在<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnectoruri=&quot;multicast://default&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynamicOnly=&quot;true&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;networkTTL=&quot;3&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefetchSize=&quot;1&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;decreaseNetworkConsumerPriority=&quot;true&quot; /&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">2</span>、修改<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61616</span>：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61616? &quot; discoveryUri=&quot;multicast://default&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">3</span>、在<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnectoruri=&quot;multicast://default&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynamicOnly=&quot;true&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;networkTTL=&quot;3&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefetchSize=&quot;1&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;decreaseNetworkConsumerPriority=&quot;true&quot; /&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">4</span>、修改<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61617</span>：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61617&quot; discoveryUri=&quot;multicast://default&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">5</span>、启动<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>和<span style="line-height:25.2px; font-family:Calibri">Broker-B</span></p><br><h5 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:14px"><br><a target="_blank" name="t14" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:25.2px">2、Master-Slave与<span style="line-height:25.2px; font-family:Calibri">Broker-Cluster</span>相结合的部署方式</span></h5><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>可以看到<span style="line-height:25.2px; font-family:Calibri">Master-Slave</span>的部署方式虽然解决了高可用的问题，但不支持负载均衡，<span style="line-height:25.2px; font-family:Calibri">Broker-Cluster</span>解决了负载均衡，但当其中一个<span style="line-height:25.2px; font-family:Calibri">Broker</span>突然宕掉的话，那么存在于该<span style="line-height:25.2px; font-family:Calibri">Broker</span>上处于<span style="line-height:25.2px; font-family:Calibri">Pending</span>状态的<span style="line-height:25.2px; font-family:Calibri">message</span>将会丢失，无法达到高可用的目的。</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>由于目前<span style="line-height:25.2px; font-family:Calibri">ActiveMQ</span>官网上并没有一个明确的将两种部署方式相结合的部署方案，所以我尝试者把两者结合起来部署：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img title="p4.png" border="0" alt="p4.png" src="http://static.open-open.com/lib/uploadImg/20140515/20140515115919_992.png" width="636" height="361" style="border:0px; vertical-align:middle; max-width:100%"></span></p><br><h6 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:12px"><br><a target="_blank" name="t15" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:21.6px">1、部署的配置修改</span></h6><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>这里以<span style="line-height:25.2px; font-family:Calibri">Broker-A &#43; Broker-B</span>建立<span style="line-height:25.2px; font-family:Calibri">cluster</span>，<span style="line-height:25.2px; font-family:Calibri">Broker-C</span>作为<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>的<span style="line-height:25.2px; font-family:Calibri">slave</span>为例：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">1）</span>首先在<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnector&nbsp;&nbsp; uri=&quot;<span style="line-height:25.2px; color:red">masterslave:(tcp://0.0.0.0:61617,tcp:// 0.0.0.0:61618</span>)&quot; duplex=&quot;false&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">2）</span>修改<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61616</span>：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61616?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">3）</span>在<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnector&nbsp;&nbsp; uri=&quot;static:(tcp:// 0.0.0.0:61616)&quot;duplex=&quot;false&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">4）</span>修改<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61617</span>：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61617?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">5）</span><span style="line-height:25.2px">修改<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中的持久化方式：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;persistenceAdapter&gt;</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;kahaDB directory=&quot;<span style="line-height:25.2px; color:red">/localhost/kahadb</span>&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&lt;/persistenceAdapter&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">6）</span>在<span style="line-height:25.2px; font-family:Calibri">Broker-C</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnector&nbsp;&nbsp; uri=&quot;static:(tcp:// 0.0.0.0:61616)&quot;duplex=&quot;false&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">7）</span>修改<span style="line-height:25.2px; font-family:Calibri">Broker-C</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61618</span>：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61618?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">8）</span>修改<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中的持久化方式：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;persistenceAdapter&gt;</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;kahaDB directory=&quot;<span style="line-height:25.2px; color:red">/localhost/kahadb</span>&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/persistenceAdapter&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">9）</span>分别启动<span style="line-height:25.2px; font-family:Calibri">broker-A</span>、<span style="line-height:25.2px; font-family:Calibri">broker-B</span>、<span style="line-height:25.2px; font-family:Calibri">broker-C</span>，因为是<span style="line-height:25.2px; font-family:Calibri">broker-B</span>先启动，所以“<span style="line-height:25.2px; font-family:Calibri">/localhost/kahadb</span>”目录被<span style="line-height:25.2px; font-family:Calibri">lock</span>住，<span style="line-height:25.2px; font-family:Calibri">broker-C</span>将一直处于挂起状态，当人为停掉<span style="line-height:25.2px; font-family:Calibri">broker-B</span>之后，<span style="line-height:25.2px; font-family:Calibri">broker-C</span>将获取目录“<span style="line-height:25.2px; font-family:Calibri">/localhost/kahadb</span>”的控制权，重新与<span style="line-height:25.2px; font-family:Calibri">broker-A</span>组成<span style="line-height:25.2px; font-family:Calibri">cluster</span>提供服务。</p><br><br><br></div><br><h1><br><br>4.ActiveMQ之Master-Slaver&#43;负载均衡</h1><br><div><br><br></div><br><div><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br>什么叫中间件?<br style="line-height:10px"><br>中间件为软件应用提供了操作系统所提供的服务之外的服务，可以把中间件描述为&quot;软件胶水&quot;。中间件不是操作系统的一部分，不是数据库操作系统，也不是应用软件的一部分，而是能够让软件开发者方便的处理通信、输入和输出，能够专注自己应用的部分。</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; color:rgb(76,51,229)">消息中间件解决了应用之间的消息传递、解耦、异步的问题。</span><br style="line-height:10px"><br><span style="line-height:1.5">ActiveMQ 是Apache出品，最流行的，能力强劲的开源消息总线。ActiveMQ 是一个完全支持JMS1.1和J2EE 1.4规范的 JMS Provider实现，尽管JMS规范出台已经是很久的事情了，但是JMS在当今的J2EE应用中间仍然扮演着特殊的地位。</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5">一般中间件都提供了横向扩展和纵向扩展，<span style="line-height:25.2px">横向扩展就是我们经常说的<span style="line-height:25.2px; color:rgb(76,51,229)">负载均衡</span></span>,<span style="line-height:25.2px">纵向扩展提供了<span style="line-height:25.2px; color:rgb(76,51,229)">Master-Slaver</span></span>;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)">负载均衡:<span style="line-height:25.2px; color:rgb(0,0,0)">提供</span></span>负载均衡的中间件都对外提供服务<br style="line-height:10px"><br><span style="line-height:25.2px; color:rgb(76,51,229)">Master-Slaver：<span style="line-height:25.2px; color:rgb(0,0,0)">同时只有一个中间件对外提供服务,当Master出现挂机等问题，Slaver会自动接管</span></span><br style="line-height:10px"><br></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">看一个整合的简图:<br style="line-height:10px"><br><img alt="" src="http://static.open-open.com/lib/uploadImg/20160102/20160102210319_351.png" width="509" height="308" style="border:0px; vertical-align:middle; max-width:100%"><br style="line-height:10px"><br></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)">Master-Slave和Broker Cluster</span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px">准备：<br style="line-height:10px"><br>jdk1.6，apache-activemq-5.10.0，mysql5.1，zookeeper-3.4.3</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">先来看看<span style="line-height:25.2px; color:rgb(76,51,229)">Master-Slave<span style="line-height:25.2px; color:rgb(0,0,0)">模式</span></span></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)">Shared File System Master Slave</span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">本次测试在同一台机器上：<br style="line-height:10px"><br>首先更改配置conf/activemq,做如下修改：<br style="line-height:10px"><br></span></span></span></p><br><pre class="brush:java; toolbar: true; auto-links: false;" style="overflow:auto; font-family:Menlo,Monaco,Consolas,'Courier New',monospace; padding:6px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; border:none; background-color:rgb(246,246,246)">&lt;persistenceAdapter&gt;<br>        &lt;!–&lt;kahaDB directory=&quot;${activemq.data}/kahadb&quot;/&gt;–&gt;<br>    &lt;kahaDB directory=&quot;D:/kahaDB&quot;/&gt;<br> &lt;/persistenceAdapter&gt;</pre><br><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">将activemq拷贝3份，分别：apache-activemq-5.10.0-M1，&nbsp;</span><span style="line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px">apache-activemq-5.10.0-M2，<span style="line-height:25.2px">apache-activemq-5.10.0-M3</span></span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">，分别启动activemq命令，启动的日志分别是:&nbsp;</span><br style="line-height:10px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><img alt="" src="http://static.open-open.com/lib/uploadImg/20160102/20160102210319_3.png" width="644" height="69" style="border:0px; vertical-align:middle; max-width:100%; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px"><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px"></span><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">表示当前进程是Master<br style="line-height:10px"><br><br style="line-height:10px"><br><img alt="" src="http://static.open-open.com/lib/uploadImg/20160102/20160102210319_893.png" width="643" height="72" style="border:0px; vertical-align:middle; max-width:100%"><br style="line-height:10px"><br></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">表示当前进程没有获取到锁，作为Slaver<br style="line-height:10px"><br></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">测试：</span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px">下面的例子中分别提供了<span style="line-height:25.2px; color:rgb(76,51,229)">Producer<span style="line-height:25.2px; color:rgb(0,0,0)">(Sender类)</span></span>和<span style="line-height:25.2px; color:rgb(76,51,229)">Consumer<span style="line-height:25.2px; color:rgb(0,0,0)">(Receiver类)<br style="line-height:10px"><br>我们首先用Producer发送消息给activemq，然后停止Master，然后再用Consumer接受消息，测试结果是可以接受到数据的。</span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">2）.<span style="line-height:25.2px; color:rgb(76,51,229)">JDBC Master Slave</span><span style="line-height:25.2px; color:rgb(76,51,229)"><br style="line-height:10px"><br><span style="line-height:25.2px; color:rgb(0,0,0)">JDBC Master Slave模式和Shared File Sysytem Master Slave模式的原理是一样的，只是把共享文件系统换成了共享数据库。</span></span></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">修改配置文件conf/activemq<br style="line-height:10px"><br></span></span></span></span></span></p><br><pre class="brush:java; toolbar: true; auto-links: false;" style="overflow:auto; font-family:Menlo,Monaco,Consolas,'Courier New',monospace; padding:6px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; border:none; background-color:rgb(246,246,246)"><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_10_9093290" name="code" class="html">&lt;persistenceAdapter&gt;<br>        &lt;!–&lt;kahaDB directory=&quot;${activemq.data}/kahadb&quot;/&gt;–&gt;<br>    &lt;!–&lt;kahaDB directory=&quot;D:/kahaDB&quot;/&gt;–&gt;<br>        &lt;jdbcPersistenceAdapter dataDirectory=&quot;${activemq.base}/data&quot; dataSource=&quot;#mysql-ds&quot;/&gt;<br>  &lt;/persistenceAdapter&gt;</pre><br><br></pre><br><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">添加数据源：</span><br><pre class="brush:java; toolbar: true; auto-links: false;" style="overflow:auto; font-family:Menlo,Monaco,Consolas,'Courier New',monospace; padding:6px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; border:none; background-color:rgb(246,246,246)"><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_11_1808506" name="code" class="html">&lt;bean id=&quot;mysql-ds&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; destroy-method=&quot;close&quot;&gt;<br>    &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;<br>    &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost/activemq?relaxAutoCommit=true&quot;/&gt;<br>    &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;<br>    &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;<br>    &lt;property name=&quot;poolPreparedStatements&quot; value=&quot;true&quot;/&gt;<br>    &lt;/bean&gt;</pre><br><br></pre><br><span style="line-height:25.2px; font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; color:rgb(229,51,51)">注：这里使用的是mysql，所以需要mysql驱动程序：</span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">&nbsp;</span><span style="line-height:25.2px; font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; color:rgb(229,51,51)">mysql-connector-java-5.1.18，讲jar包放入lib文件夹下面，驱动版本不对，会出现如下错误:</span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">&nbsp;</span><span style="line-height:25.2px; font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; color:rgb(229,51,51)">Database<br> lock driver override not found for : [mysql_connect</span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">&nbsp;</span><span style="line-height:25.2px; font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; color:rgb(229,51,51)">…</span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px"></span><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><br style="line-height:10px"><br></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5">分别拷贝到其他几个文件夹下，分别启动，启动成功后我们可以看到数据库中多了几张表：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><img alt="" src="http://static.open-open.com/lib/uploadImg/20160102/20160102210319_95.png" width="318" height="148" style="border:0px; vertical-align:middle; max-width:100%"><br style="line-height:10px"><br></span></span></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">测试方式同上；<br style="line-height:10px"><br>官网手册:<a target="_blank" href="http://activemq.apache.org/jdbc-master-slave.html" rel="nofollow" style="color:rgb(0,95,169); text-decoration:none; background-color:transparent">http://activemq.apache.org/jdbc-master-slave.html</a></span></span></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">3).<span style="line-height:25.2px; color:rgb(76,51,229)">Replicated<br> LevelDB Store</span><br style="line-height:10px"><br><span style="line-height:25px; color:rgb(64,64,64); background-color:rgb(250,250,250)">这种方式是</span><span style="line-height:25px; font-family:Calibri; color:rgb(64,64,64); background-color:rgb(250,250,250)">ActiveMQ5.9</span><span style="line-height:25px; color:rgb(64,64,64); background-color:rgb(250,250,250)">以后才新增的特性，使用</span><span style="line-height:25px; font-family:Calibri; color:rgb(64,64,64); background-color:rgb(250,250,250)">ZooKeeper</span><span style="line-height:25px; color:rgb(64,64,64); background-color:rgb(250,250,250)">协调选择一个</span><span style="line-height:25px; font-family:Calibri; color:rgb(64,64,64); background-color:rgb(250,250,250)">node</span><span style="line-height:25px; color:rgb(64,64,64); background-color:rgb(250,250,250)">作为</span><span style="line-height:25px; font-family:Calibri; color:rgb(64,64,64); background-color:rgb(250,250,250)">master</span></span></span></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px">修改配置文件conf/activemq：<br style="line-height:10px"><br></span></span></span></span></span></span></p><br><pre class="brush:java; toolbar: true; auto-links: false;" style="overflow:auto; font-family:Menlo,Monaco,Consolas,'Courier New',monospace; padding:6px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; border:none; background-color:rgb(246,246,246)"><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_12_5047109" name="code" class="html">&lt;!–&lt;persistenceAdapter&gt;<br>         &lt;kahaDB directory=&quot;${activemq.data}/kahadb&quot;/&gt;<br>         &lt;kahaDB directory=&quot;D:/kahaDB&quot;/&gt;<br>         &lt;jdbcPersistenceAdapter dataDirectory=&quot;${activemq.base}/data&quot; dataSource=&quot;#mysql-ds&quot;/&gt;<br> &lt;/persistenceAdapter&gt;–&gt;<br> &lt;persistenceAdapter&gt;<br>    &lt;replicatedLevelDB<br>        directory=&quot;${activemq.data}/leveldb&quot;<br>        replicas=&quot;3&quot;<br>        bind=&quot;tcp://0.0.0.0:0&quot;<br>        zkAddress=&quot;127.0.0.1:2181&quot;<br>        hostname=&quot;127.0.0.1&quot;<br>        sync=&quot;local_disk&quot;<br>        zkPath=&quot;/activemq/leveldb-stores&quot;/&gt;<br> &lt;/persistenceAdapter&gt;</pre><br><br></pre><br><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">首先启动zookeeper，这里没有做集群处理,默认端口是2181，然后分别启动activemq，&nbsp;</span><br style="line-height:10px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; color:rgb(229,51,51)">启动之后报错：&quot;activemq LevelDB IOException handler&quot;。</span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">&nbsp;</span><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(229,51,51)"><span style="line-height:22px; font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; color:rgb(51,51,51)">原因：版本5.10.0存在的依赖冲突。</span><br style="line-height:10px"><br></span></span></span></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(51,51,51); font-size:14px; font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="line-height:28.8px; font-size:16px"><span style="line-height:25.2px; font-size:14px">解决方案：<br style="line-height:10px"><br></span></span><span style="line-height:1.5">（1）移除lib目录中的pax-url-aether-1.5.2.jar包<br style="line-height:10px"><br></span><span style="line-height:28.8px; font-size:16px"><span style="line-height:25.2px; font-size:14px">（2）注释掉配置文件中的日志配置；</span></span><span style="line-height:25.2px">&nbsp;</span></p><br><pre class="brush:java; toolbar: true; auto-links: false;" style="overflow:auto; font-family:Menlo,Monaco,Consolas,'Courier New',monospace; padding:6px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; border:none; background-color:rgb(246,246,246)">&lt;!– Allows accessing the server log<br>    &lt;bean id=&quot;logQuery&quot; class=&quot;org.fusesource.insight.log.log4j.Log4jLogQuery&quot;<br>          lazy-init=&quot;false&quot; scope=&quot;singleton&quot;<br>          init-method=&quot;start&quot; destroy-method=&quot;stop&quot;&gt;<br>    &lt;/bean&gt;<br>–&gt;</pre><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px">测试方式同上；</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">提供java版的例子：<br style="line-height:10px"><br></span></span></span></p><br><pre class="brush:java; toolbar: true; auto-links: false;" style="overflow:auto; font-family:Menlo,Monaco,Consolas,'Courier New',monospace; padding:6px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; border:none; background-color:rgb(246,246,246)"><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_13_2397151" name="code" class="java">public class Sender {<br>    private static final int SEND_NUMBER = 5;<br><br>    public static void main(String[] args) {<br>        ConnectionFactory connectionFactory;<br>        Connection connection = null;<br>        Session session;<br>        Destination destination;<br>        MessageProducer producer;<br>        connectionFactory = new ActiveMQConnectionFactory(<br>            ActiveMQConnection.DEFAULT_USER,<br>            ActiveMQConnection.DEFAULT_PASSWORD, &quot;tcp://localhost:61616&quot;);<br>        try {<br>            connection = connectionFactory.createConnection();<br>            connection.start();<br>            session = connection.createSession(Boolean.TRUE,<br>                    Session.AUTO_ACKNOWLEDGE);<br>            destination = session.createQueue(&quot;FirstQueue&quot;);<br>            producer = session.createProducer(destination);<br>            producer.setDeliveryMode(DeliveryMode.PERSISTENT);<br>            sendMessage(session, producer);<br>            session.commit();<br>        } catch (Exception e) {<br>            e.printStackTrace();<br>        } finally {<br>            try {<br>                if (null != connection)<br>                    connection.close();<br>            } catch (Throwable ignore) {<br>            }<br>        }<br>    }<br><br>    public static void sendMessage(Session session, MessageProducer producer)<br>            throws Exception {<br>        for (int i = 1; i &lt;= SEND_NUMBER; i++) {<br>            TextMessage message = session.createTextMessage(&quot;发送的消息&quot;<br>                    + i);<br>            System.out.println(&quot;发送消息：&quot; + &quot;ActiveMq 发送的消息&quot; + i);<br>            producer.send(message);<br>        }<br>    }<br>}<br>public class Receiver {<br>    public static void main(String[] args) {<br>        ConnectionFactory connectionFactory;<br>        Connection connection = null;<br>        Session session;<br>        Destination destination;<br>        MessageConsumer consumer;<br>        connectionFactory = new ActiveMQConnectionFactory(<br>            ActiveMQConnection.DEFAULT_USER,<br>            ActiveMQConnection.DEFAULT_PASSWORD, &quot;tcp://localhost:61616&quot;);<br>        try {<br>            connection = connectionFactory.createConnection();<br>            connection.start();<br>            session = connection.createSession(Boolean.FALSE,<br>                    Session.AUTO_ACKNOWLEDGE);<br>            destination = session.createQueue(&quot;FirstQueue&quot;);<br>            consumer = session.createConsumer(destination);<br>            while (true) {<br>                TextMessage message = (TextMessage) consumer.receive(100000);<br>                if (null != message) {<br>                    System.out.println(&quot;收到消息&quot; + message.getText());<br>                } else {<br>                    break;<br>                }<br>            }<br>        } catch (Exception e) {<br>            e.printStackTrace();<br>        } finally {<br>            try {<br>                if (null != connection)<br>                    connection.close();<br>            } catch (Throwable ignore) {<br>            }<br>        }<br>    }<br>}</pre><br><br></pre><br><h1 style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><br><br><h1><span style="padding:0px; margin:0px; color:rgb(76,51,229)">5.Broker-Cluster实现负载均衡</span></h1><br></h1><br></div><br><div><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px; font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; font-size:13px; line-height:24.05px">Broker-Cluster部署方式中，各个broker通过网络互相连接，并共享queue，提供了2中部署方式：<br style="padding:0px; margin:0px"><br><span style="padding:0px; margin:0px; color:rgb(76,51,229)">static Broker-Cluster</span><span style="padding:0px; margin:0px; color:rgb(76,51,229)"></span>和<span style="padding:0px; margin:0px; color:rgb(76,51,229)">Dynamic Broker-Cluster</span><span style="padding:0px; margin:0px; color:rgb(76,51,229)"></span></span></p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px; color:rgb(76,51,229)">1).static Broker-Cluster</span></span></p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px">将ActiveMq拷贝2份，分别命名:apache-activemq-5.10.0_M1,apache-activemq-5.10.0_M2，<br style="padding:0px; margin:0px"><br>下面就是配置activemq,xml:<br style="padding:0px; margin:0px"><br>M1做如下配置:<br style="padding:0px; margin:0px"><br></span></span></p><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_483577" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:704px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:675px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnector<br> uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;static:(tcp://localhost:61617)&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/networkConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_774067" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:1024px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:995px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnector<br> name=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;openwire&quot;</code><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br>uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;tcp://0.0.0.0:61616?maximumConnectio&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> ns=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/transportConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><span style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; font-size:13px; line-height:24.05px">M2做如下配置:</span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px">&nbsp;</span><br style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_592019" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:704px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:675px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnector<br> uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;static:(tcp://localhost:61616)&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/networkConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_351396" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:1024px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:995px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnector<br> name=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;openwire&quot;</code><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br>uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;tcp://0.0.0.0:61617?maximumConnectio&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> ns=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/transportConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px">通过以上配置使M1和M2这两个&nbsp;</span><span style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; font-size:13px; line-height:24.05px">broker通过网络互相连接，并共享queue，<br style="padding:0px; margin:0px"><br>启动M1和M2,可以看到如下启动日志：</span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px">&nbsp;</span><span style="padding:0px; margin:0px; color:rgb(51,51,51); font-size:13px; line-height:24.05px; font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif"><br style="padding:0px; margin:0px"><br><a target="_blank" href="http://static.oschina.net/uploads/space/2016/0103/194536_ySvR_159239.png" style="padding:0px; margin:0px; color:rgb(255,131,115); outline:0px; font-size:12px"><img src="http://static.oschina.net/uploads/space/2016/0103/194536_ySvR_159239.png" alt="" style="padding:0px; margin:10px 0px; border:1px solid rgb(221,221,221); max-width:640px; background:rgb(244,247,249)"></a><br style="padding:0px; margin:0px"><br></span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"></span><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px"><a target="_blank" href="http://static.oschina.net/uploads/space/2016/0103/194609_AlHc_159239.png" style="padding:0px; margin:0px; color:rgb(255,131,115); outline:0px; font-size:12px"><img src="http://static.oschina.net/uploads/space/2016/0103/194609_AlHc_159239.png" alt="" style="padding:0px; margin:10px 0px; border:1px solid rgb(221,221,221); max-width:640px; background:rgb(244,247,249)"></a><br style="padding:0px; margin:0px"><br></span></span></p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px">可以看到M1和M2，<span style="padding:0px; margin:0px; color:rgb(76,51,229)">network connection has been established</span></span></span></p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px"><span style="padding:0px; margin:0px; color:rgb(76,51,229)"><span style="padding:0px; margin:0px; color:rgb(0,0,0)">测试我们还是用上一篇中的Sender和Receiver类，只需要做一点点修改：<br style="padding:0px; margin:0px"><br></span><span style="padding:0px; margin:0px; color:rgb(0,0,0)">Sender类还是链接tcp://localhost:61616，发送消息到queue，<br style="padding:0px; margin:0px"><br>Receiver做如下修改:<br style="padding:0px; margin:0px"><br></span></span></span></span></p><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_256279" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:704px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:675px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">connectionFactory<br> = </code><code class="java keyword" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:rgb(0,102,153)!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-weight:bold!important; font-size:1em!important; min-height:auto!important; background:none!important">new</code><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br>ActiveMQConnectionFactory(</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">ActiveMQConnection.DEFAULT_USER,</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">ActiveMQConnection.DEFAULT_PASSWORD,<br></code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;tcp://localhost:61617&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">);</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br>经测试Receiver可以接受到数据，表示M1和M2已经共享了queue</p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px"><span style="padding:0px; margin:0px; color:rgb(76,51,229)">2).<span style="padding:0px; margin:0px; font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; line-height:24.05px">Dynamic<br> Broker-Cluster</span></span></span></span></p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px"><span style="padding:0px; margin:0px; color:rgb(76,51,229)"><span style="padding:0px; margin:0px; font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; line-height:24.05px"><span style="padding:0px; margin:0px; color:rgb(0,0,0)">Dynamic<br> Discovery集群方式在配置ActiveMQ实例时，不需要知道所有其它实例的URI地址</span><span style="padding:0px; margin:0px; color:rgb(0,0,0)"><br style="padding:0px; margin:0px"><br></span><span style="padding:0px; margin:0px; color:rgb(0,0,0)">对activemq.xml做如下配置:<br style="padding:0px; margin:0px"><br><span style="padding:0px; margin:0px; line-height:24.05px">M1做如下配置:<br style="padding:0px; margin:0px"><br></span></span></span></span></span></span></p><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_464186" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:704px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:675px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnector<br> uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;multicast://default&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/networkConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_579267" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:962px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br><div class="line number4 index3 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>4</div><br></td><br><td class="code" style="width:933px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnector<br> name=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;openwire&quot;</code><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br>uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;tcp://0.0.0.0:61616?<br> maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">discoveryUri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;multicast://default&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number4 index3 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/transportConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><span style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; font-size:13px; line-height:24.05px">M2<span style="padding:0px; margin:0px; line-height:24.05px">做如下配置:</span></span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"></span><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_377292" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:704px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:675px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnector<br> uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;multicast://default&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/networkConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_494719" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:962px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br><div class="line number4 index3 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>4</div><br></td><br><td class="code" style="width:933px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnector<br> name=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;openwire&quot;</code><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br>uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;tcp://0.0.0.0:61617?<br> maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">discoveryUri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;multicast://default&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number4 index3 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/transportConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><span style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; font-size:13px; line-height:24.05px">启动M1和M2,可以看到如下启动日志：</span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px">&nbsp;</span><span style="padding:0px; margin:0px; font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; color:rgb(76,51,229); font-size:13px; line-height:24.05px">network<br> connection has been established</span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"></span><span style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"></span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"></span><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br>测试同static broker-cluster,可以得到相同的结果。<br style="padding:0px; margin:0px"><br>官网配置说明：<a target="_blank" href="http://activemq.apache.org/networks-of-brokers.html" rel="nofollow" style="padding:0px; margin:0px; color:rgb(255,131,115); outline:0px; font-size:12px">http://activemq.apache.org/networks-of-brokers.html</a></p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br>Master-Slaver保证了数据的可靠性，Broker-Cluster提供了负载均衡，所以一般正式环境中都会采用：<br style="padding:0px; margin:0px"><br><span style="padding:0px; margin:0px">Master-Slaver&#43;</span><span style="padding:0px; margin:0px">Broker-Cluster的模式</span></p><br><br><br></div>

<p></p></div><p></p>
<!-- Baidu Button BEGIN -->
<div class="bdsharebuttonbox tracking-ad" style="float: right;" data-mod="popu_172"><br><a href="#" class="bds_more" data-cmd="more" style="background-position:0 0 !important; background-image: url(http://bdimg.share.baidu.com/static/api/img/share/icons_0_16.png?v=d754dcc0.png) !important"></a><br><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间" style="background-position:0 -52px !important"></a><br><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博" style="background-position:0 -104px !important"></a><br><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博" style="background-position:0 -260px !important"></a><br><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网" style="background-position:0 -208px !important"></a><br><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信" style="background-position:0 -1612px !important"></a><br></div><br><script>window._bd_share_config = { “common”: { “bdSnsKey”: {}, “bdText”: “”, “bdMini”: “1”, “bdMiniList”: false, “bdPic”: “”, “bdStyle”: “0”, “bdSize”: “16” }, “share”: {} }; with (document) 0[(getElementsByTagName(‘head’)[0] || body).appendChild(createElement(‘script’)).src = ‘<a href="http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=">http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=</a>‘ + ~(-new Date() / 36e5)];</script><br><!-- Baidu Button END --><br><br><br><br><br><!--172.16.140.12--><br><br><!-- Baidu Button BEGIN --><br><script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=1536434"></script><br><script type="text/javascript" id="bdshell_js"></script><br><script type="text/javascript"><br>    document.getElementById(“bdshell_js”).src = “<a href="http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=">http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=</a>“ + Math.ceil(new Date()/3600000)<br></script><br><!-- Baidu Button END --><br><br><br><br><br><br><br>        <div id="digg" articleid="51241597"><br>            <dl id="btnDigg" class="digg digg_disable" onclick="btndigga();"><br><br>                 <dt>顶</dt><br>                <dd>3</dd><br>            </dl><br><br><br>            <dl id="btnBury" class="digg digg_disable" onclick="btnburya();"><br><br>                  <dt>踩</dt><br>                <dd>0</dd><br>            </dl><br><br>        </div><br>     <div class="tracking-ad" data-mod="popu_222"><a href="javascript:void(0);" target="_blank" rel="external">&nbsp;</a>   </div><br>    <div class="tracking-ad" data-mod="popu_223"> <a href="javascript:void(0);" target="_blank" rel="external">&nbsp;</a></div><br>    <script type="text/javascript"><br>                function btndigga() {<br>                    $(“.tracking-ad[data-mod=’popu_222’] a”).click();<br>                }<br>                function btnburya() {<br>                    $(“.tracking-ad[data-mod=’popu_223’] a”).click();<br>                }<br>            </script><br><br>   <ul class="article_next_prev"><br>                <li class="prev_article"><span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_shangyipian']);location.href='/he90227/article/details/51163822';">上一篇</span><a href="/he90227/article/details/51163822" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_shangyipian'])">多线程笔记</a></li><br>                <li class="next_article"><span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_xiayipian']);location.href='/he90227/article/details/51248063';">下一篇</span><a href="/he90227/article/details/51248063" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_xiayipian'])">亿级Web系统搭建——单机到分布式集群</a></li><br>    </ul><br><br>    <div style="clear:both; height:10px;"></div>


<pre><code>&lt;div class=&quot;similar_article&quot;   &gt;
        &lt;h4&gt;&lt;/h4&gt;
        &lt;div class=&quot;similar_c&quot;style=&quot;margin:20px 0px 0px 0px&quot;&gt;
            &lt;div class=&quot;similar_c_t&quot;&gt;
              &amp;nbsp;&amp;nbsp;相关文章推荐
            &lt;/div&gt;

            &lt;div class=&quot;similar_wrap tracking-ad&quot; data-mod=&quot;popu_36&quot;  style=&quot;max-height:195px;&quot;&gt;                       
                &lt;ul class=&quot;similar_list fl&quot;&gt;    
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/lee1991723/article/details/48268861&quot; title=&quot;Spring整合JMS(一)——基于ActiveMQ实现&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;Spring整合JMS(一)——基于ActiveMQ实现&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/zwk626542417/article/details/48063383&quot; title=&quot;Spring整合JMS(一)——基于ActiveMQ实现&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;Spring整合JMS(一)——基于ActiveMQ实现&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/u010961759/article/details/39293649&quot; title=&quot;Spring整合JMS(一)——基于ActiveMQ实现&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;Spring整合JMS(一)——基于ActiveMQ实现&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/lingyun870801/article/details/23991513&quot; title=&quot;ActiveMQ整合Spring实现消息机制二(消息接收端配置)&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;ActiveMQ整合Spring实现消息机制二(消息接收端配置)&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/u014756827/article/details/52449232&quot; title=&quot;深入浅出JMS(四)--Spring和ActiveMQ整合的完整实例&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;深入浅出JMS(四)--Spring和ActiveMQ整合的完整实例&lt;/a&gt;
                       &lt;/li&gt;
                &lt;/ul&gt;
                  &lt;ul class=&quot;similar_list fr&quot;&gt;      
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/jianfpeng241241/article/details/51678695&quot; title=&quot;JMS学习(4):--Spring和ActiveMQ整合的完整实例&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;JMS学习(4):--Spring和ActiveMQ整合的完整实例&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/jingqiang521/article/details/49047847&quot; title=&quot;4、深入浅出JMS(四)--Spring和ActiveMQ整合的完整实例&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;4、深入浅出JMS(四)--Spring和ActiveMQ整合的完整实例&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/Leonardo9029/article/details/43154385&quot; title=&quot;浅谈jms之（通过spring整合activeMQ实现jms）实例&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;浅谈jms之（通过spring整合activeMQ实现jms）实例&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/yinbucheng/article/details/72477543&quot; title=&quot;spring整合activeMQ&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;spring整合activeMQ&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/polo_longsan/article/details/52317966&quot; title=&quot;ActiveMQ与Spring整合:(1)基本使用&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;ActiveMQ与Spring整合:(1)基本使用&lt;/a&gt;
                       &lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;   
</code></pre><p></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://bloodorange2017.github.io/images/img_head_001.jpg"
               alt="XueCheng" />
          <p class="site-author-name" itemprop="name">XueCheng</p>
           
              <p class="site-description motion-element" itemprop="description">Do one thing at a time, and do well.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">46</span>
                <span class="site-state-item-name">Artikel</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XueCheng</span>
</div>


<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

<script type="text/javascript"
color="160,160,233" opacity='0.4' zIndex="-2" count="16" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
