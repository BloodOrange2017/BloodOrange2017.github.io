<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="Do one thing at a time, and do well.">
<meta property="og:type" content="website">
<meta property="og:title" content="XueCheng Notes">
<meta property="og:url" content="https://bloodorange2017.github.io/archives/page/5/index.html">
<meta property="og:site_name" content="XueCheng Notes">
<meta property="og:description" content="Do one thing at a time, and do well.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="XueCheng Notes">
<meta name="twitter:description" content="Do one thing at a time, and do well.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://bloodorange2017.github.io/archives/page/5/"/>





  <title>XueCheng Notes</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">XueCheng Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Where there is a will, there is a way.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/06/14/activemq-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/14/activemq-01/" itemprop="url">Spring整合ActiveMQ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-14T14:17:28+08:00">
                2017-06-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post"><br><br><h1>1.管理ActiveMQ</h1><br><p>地址 &nbsp;<a target="_blank" href="http://localhost:8161/admin/" style="color:rgb(255,153,0); text-decoration:none; font-family:'microsoft yahei'; font-size:14px; line-height:26px">http://localhost:8161/admin/</a></p><br><p>&nbsp; &nbsp; 默认用户和密码：admin=admin</p><br><p></p><br><ol style="font-family:'microsoft yahei'; font-size:14px; line-height:26px"><br><li style=""><br><p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"><br>运行发送者，eclipse控制台输出，如下图：&nbsp;<br style=""><br><img src="http://img.blog.csdn.net/20150920173405956" alt="这里写图片描述" title="" style="border:none; max-width:100%">&nbsp;<br style=""><br>此时，我们先看一下ActiveMQ服务器，Queues内容如下：&nbsp;<br style=""><br><img src="http://img.blog.csdn.net/20150920173620033" alt="这里写图片描述" title="" style="border:none; max-width:100%"><br style=""><br>我们可以看到创建了一个名称为HelloWorld的消息队列，队列中有10条消息未被消费，我们也可以通过Browse查看是哪些消息，如下图：&nbsp;<br style=""><br><img src="http://img.blog.csdn.net/20150920174135335" alt="这里写图片描述" title="" style="border:none; max-width:100%"><br style=""><br>如果这些队列中的消息，被删除，消费者则无法消费。</p><br></li><li style=""><br><p style="margin-top:0px; margin-bottom:1.1em; padding-top:0px; padding-bottom:0px"><br>我们继续运行一下消费者，eclipse控制台打印消息，如下：&nbsp;<br style=""><br><img src="http://img.blog.csdn.net/20150920174317150" alt="这里写图片描述" title="" style="border:none; max-width:100%">&nbsp;<br style=""><br>此时，我们先看一下ActiveMQ服务器，Queues内容如下：&nbsp;<br style=""><br><img src="http://img.blog.csdn.net/20150920174417511" alt="这里写图片描述" title="" style="border:none; max-width:100%"><br style=""><br>我们可以看到HelloWorld的消息队列发生变化，多一个消息者，队列中的10条消息被消费了，点击Browse查看，已经为空了。&nbsp;<br style=""><br>点击Active Consumers，我们可以看到这个消费者的详细信息：&nbsp;<br style=""><br><img src="http://img.blog.csdn.net/20150920175100179" alt="这里写图片描述" title="" style="border:none; max-width:100%"></p><br></li></ol><br><br><br><p></p><br><p><br><br></p><br><h1>2.Spring整合ActiveMQ</h1><br><h2>&nbsp; &nbsp;1.maven</h2><br><div>&nbsp; &nbsp; &nbsp; &nbsp;<pre code_snippet_id="1660918" snippet_file_name="blog_20160425_1_1952419" name="code" class="html">&lt;!–ActiveMQ依赖 –&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;<br>            &lt;artifactId&gt;activemq-all&lt;/artifactId&gt;<br>            &lt;version&gt;5.13.2&lt;/version&gt;<br>        &lt;/dependency&gt;<br>&lt;!– Spring整合ActiveMQ所需依赖 –&gt;<br>            &lt;dependency&gt;<br>                &lt;groupId&gt;org.springframework&lt;/groupId&gt;<br>                &lt;artifactId&gt;spring-jms&lt;/artifactId&gt;<br>            &lt;/dependency&gt;<br>            &lt;dependency&gt;<br>                &lt;groupId&gt;org.springframework&lt;/groupId&gt;<br>                &lt;artifactId&gt;spring-messaging&lt;/artifactId&gt;<br>            &lt;/dependency&gt;</pre><br><br><br><br><br><br><br><br></div><br><h2>&nbsp; &nbsp;2.ActiveMQ配置文件</h2><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_2_1712439" name="code" class="html">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;beans xmlns=&quot;<a href="http://www.springframework.org/schema/beans&amp;quot" target="_blank" rel="external">http://www.springframework.org/schema/beans&amp;quot</a>;<br>    xmlns:context=&quot;<a href="http://www.springframework.org/schema/context&amp;quot" target="_blank" rel="external">http://www.springframework.org/schema/context&amp;quot</a>;<br>    xmlns:xsi=&quot;<a href="http://www.w3.org/2001/XMLSchema-instance&amp;quot" target="_blank" rel="external">http://www.w3.org/2001/XMLSchema-instance&amp;quot</a>; xmlns:amq=&quot;<a href="http://activemq.apache.org/schema/core&amp;quot" target="_blank" rel="external">http://activemq.apache.org/schema/core&amp;quot</a>;<br>    xmlns:jms=&quot;<a href="http://www.springframework.org/schema/jms&amp;quot" target="_blank" rel="external">http://www.springframework.org/schema/jms&amp;quot</a>;<br>    xsi:schemaLocation=&quot;<a href="http://www.springframework.org/schema/beans" target="_blank" rel="external">http://www.springframework.org/schema/beans</a><br>        <a href="http://www.springframework.org/schema/beans/spring-beans-4.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</a><br>        <a href="http://www.springframework.org/schema/context" target="_blank" rel="external">http://www.springframework.org/schema/context</a><br>        <a href="http://www.springframework.org/schema/context/spring-context-4.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/context/spring-context-4.0.xsd</a><br>        <a href="http://www.springframework.org/schema/jms" target="_blank" rel="external">http://www.springframework.org/schema/jms</a><br>        <a href="http://www.springframework.org/schema/jms/spring-jms-4.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/jms/spring-jms-4.0.xsd</a><br>        <a href="http://activemq.apache.org/schema/core" target="_blank" rel="external">http://activemq.apache.org/schema/core</a><br>        <a href="http://activemq.apache.org/schema/core/activemq-core-5.8.0.xsd&quot;&amp;gt" target="_blank" rel="external">http://activemq.apache.org/schema/core/activemq-core-5.8.0.xsd&quot;&amp;gt</a>;<br><br>    &lt;!– ActiveMQ 连接工厂 –&gt;<br>    &lt;!– 真正可以产生Connection的ConnectionFactory，由对应的 JMS服务厂商提供–&gt;<br>    &lt;!– 如果连接网络：tcp://ip:61616；未连接网络：tcp://localhost:61616 以及用户名，密码–&gt;<br>    &lt;amq:connectionFactory id=&quot;amqConnectionFactory&quot;<br>        brokerURL=&quot;tcp://172.17.65.29:61616&quot; userName=&quot;admin&quot; password=&quot;admin&quot;  /&gt;<br><br>    &lt;!– Spring Caching连接工厂 –&gt;<br>    &lt;!– Spring用于管理真正的ConnectionFactory的ConnectionFactory –&gt;<br>    &lt;bean id=&quot;connectionFactory&quot; class=&quot;org.springframework.jms.connection.CachingConnectionFactory&quot;&gt;<br>        &lt;!– 目标ConnectionFactory对应真实的可以产生JMS Connection的ConnectionFactory –&gt;<br>        &lt;property name=&quot;targetConnectionFactory&quot; ref=&quot;amqConnectionFactory&quot;&gt;&lt;/property&gt;<br>        &lt;!– 同上，同理 –&gt;<br>        &lt;!– &lt;constructor-arg ref=&quot;amqConnectionFactory&quot; /&gt; –&gt;<br>        &lt;!– Session缓存数量 –&gt;<br>        &lt;property name=&quot;sessionCacheSize&quot; value=&quot;100&quot; /&gt;<br>    &lt;/bean&gt;<br><br>    &lt;!– Spring JmsTemplate 的消息生产者 start–&gt;<br><br>    &lt;!– 定义JmsTemplate的Queue类型 –&gt;<br>    &lt;bean id=&quot;jmsQueueTemplate&quot; class=&quot;org.springframework.jms.core.JmsTemplate&quot;&gt;<br>        &lt;!– 这个connectionFactory对应的是我们定义的Spring提供的那个ConnectionFactory对象 –&gt;<br>        &lt;constructor-arg ref=&quot;connectionFactory&quot; /&gt;<br>        &lt;!– 非pub/sub模型（发布/订阅），即队列模式 –&gt;<br>        &lt;property name=&quot;pubSubDomain&quot; value=&quot;false&quot; /&gt;<br>    &lt;/bean&gt;<br><br>    &lt;!– 定义JmsTemplate的Topic类型 –&gt;<br>    &lt;bean id=&quot;jmsTopicTemplate&quot; class=&quot;org.springframework.jms.core.JmsTemplate&quot;&gt;<br>         &lt;!– 这个connectionFactory对应的是我们定义的Spring提供的那个ConnectionFactory对象 –&gt;<br>        &lt;constructor-arg ref=&quot;connectionFactory&quot; /&gt;<br>        &lt;!– pub/sub模型（发布/订阅） –&gt;<br>        &lt;property name=&quot;pubSubDomain&quot; value=&quot;true&quot; /&gt;<br>    &lt;/bean&gt;<br><br>    &lt;!–Spring JmsTemplate 的消息生产者 end–&gt;<br><br><br>    &lt;!– 消息消费者 start–&gt;<br><br>    &lt;!– 定义Queue监听器 –&gt;<br>    &lt;jms:listener-container destination-type=&quot;queue&quot; container-type=&quot;default&quot; connection-factory=&quot;connectionFactory&quot; acknowledge=&quot;auto&quot;&gt;<br>        &lt;jms:listener destination=&quot;test.queue&quot; ref=&quot;queueReceiver1&quot;/&gt;<br>        &lt;jms:listener destination=&quot;test.queue&quot; ref=&quot;queueReceiver2&quot;/&gt;<br>    &lt;/jms:listener-container&gt;<br><br>    &lt;!– 定义Topic监听器 –&gt;<br>    &lt;jms:listener-container destination-type=&quot;topic&quot; container-type=&quot;default&quot; connection-factory=&quot;connectionFactory&quot; acknowledge=&quot;auto&quot;&gt;<br>        &lt;jms:listener destination=&quot;test.topic&quot; ref=&quot;topicReceiver1&quot;/&gt;<br>        &lt;jms:listener destination=&quot;test.topic&quot; ref=&quot;topicReceiver2&quot;/&gt;<br>    &lt;/jms:listener-container&gt;<br><br>    &lt;!– 消息消费者 end –&gt;<br>&lt;/beans&gt;  </pre><br><br><h2>3.生产者</h2><br></div><br><h3>1.queue消息队列模式</h3><br><div><br><br></div><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_3_2410550" name="code" class="java">package com.jay.mq.demo1.producer.queue;<br><br><br>import javax.jms.JMSException;<br>import javax.jms.Message;<br>import javax.jms.Session;<br><br><br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.beans.factory.annotation.Qualifier;<br>import org.springframework.jms.core.JmsTemplate;<br>import org.springframework.jms.core.MessageCreator;<br>import org.springframework.stereotype.Component;<br><br><br>/<strong><br>&#160;<em> ActiveMQ的消息队列模式<br>&#160;</em> Description: &lt;br/&gt;<br>&#160;<em> 队列消息的生产者，发哦是哪个消息到队列<br>&#160;</em> @author hetiewei<br>&#160;<em> @date 2016年4月25日 上午10:20:20<br>&#160;</em><br>&#160;*/<br>@Component(&quot;queueSender&quot;)<br>public class QueueSender1 {<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;/</strong><br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; <em> 通过Qualifier来注入对应的Bean<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; </em>/<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;@Autowired<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;@Qualifier(&quot;jmsQueueTemplate&quot;)<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;private JmsTemplate jmsTemplate;<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;/<strong><br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; <em> Description: &lt;br/&gt;<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; </em> 发送消息到指定的队列(目标)<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; <em> @author hetiewei<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; </em> @date 2016年4月25日 上午10:24:57<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; <em> @param queueName &#160;队列名称<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; </em> @param message &#160; &#160;消息内容<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt; */<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;public void send(String queueName, final String message){<br>&lt;span style=&quot;white-space:pre&quot;&gt;        &lt;/span&gt;jmsTemplate.send(queueName, new MessageCreator() {<br>&lt;span style=&quot;white-space:pre&quot;&gt;            &lt;/span&gt;<br>&lt;span style=&quot;white-space:pre&quot;&gt;            &lt;/span&gt;public Message createMessage(Session session) throws JMSException {<br>&lt;span style=&quot;white-space:pre&quot;&gt;                &lt;/span&gt;return session.createTextMessage(message);<br>&lt;span style=&quot;white-space:pre&quot;&gt;            &lt;/span&gt;}<br>&lt;span style=&quot;white-space:pre&quot;&gt;        &lt;/span&gt;});<br>&lt;span style=&quot;white-space:pre&quot;&gt;    &lt;/span&gt;}<br>}<br></strong></pre><br><h3><br><br><br><br>2.&nbsp;topic/sub订阅模式</h3><br></div><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_4_2552254" name="code" class="java">package com.jay.mq.demo1.producer.topic;<br><br>import javax.jms.JMSException;<br>import javax.jms.Message;<br>import javax.jms.Session;<br><br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.beans.factory.annotation.Qualifier;<br>import org.springframework.jms.core.JmsTemplate;<br>import org.springframework.jms.core.MessageCreator;<br>import org.springframework.stereotype.Component;<br><br>/<br> <em> ActiveMQ的topic/sub模式
 </em> Description: &lt;br/&gt;<br> <em> Topic生产者发送消息到Topic
 </em> @author hetiewei<br> <em> @date 2016年4月25日 上午11:22:40
 </em><br> <em>/<br>@Component<br>public class TopicSender1 {<br><br>    @Autowired<br>    @Qualifier(&quot;jmsTopicTemplate&quot;)<br>    private JmsTemplate jmsTemplate;<br><br>    /**
     </em> 发送一条消息到指定的队列（目标）<br>     <em> @param queueName 队列名称
     </em> @param message 消息内容<br>     <em>/<br>    public void send(String topicName,final String message){<br>        jmsTemplate.send(topicName, new MessageCreator() {<br><br>            public Message createMessage(Session session) throws JMSException {<br>                return session.createTextMessage(message);<br>            }<br>        });<br>    }<br><br>}<br></em></pre><br><br><br><br></div><br><h2>4.消费者</h2><br><h3>1.queue消息队列模式</h3><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_5_3250365" name="code" class="java">package com.jay.mq.demo1.consumer.queue;<br><br>import javax.jms.JMSException;<br>import javax.jms.Message;<br>import javax.jms.MessageListener;<br>import javax.jms.TextMessage;<br><br>import org.springframework.stereotype.Component;<br><br>/**
  Description: &lt;br/&gt;<br> <em> 消息队列监听器
 </em> @author hetiewei<br> <em> @date 2016年4月25日 上午10:32:14
 </em><br> <em>/<br>@Component<br>public class QueueReceiver1 implements MessageListener {<br><br>    public void onMessage(Message message) {<br>        try {<br>            System.out.println(&quot;QueueReceiver1接收到消息：&quot;+((TextMessage)message).getText());<br>        } catch (JMSException e) {<br>            e.printStackTrace();<br>        }<br>    }<br><br>}<br></em></pre><br><br><br><br></div><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_6_3915457" name="code" class="java">package com.jay.mq.demo1.consumer.queue;<br><br>import javax.jms.JMSException;<br>import javax.jms.Message;<br>import javax.jms.MessageListener;<br>import javax.jms.TextMessage;<br><br>import org.springframework.stereotype.Component;<br><br>/**
  Description: &lt;br/&gt;<br> <em> 消息队列监听器
 </em> @author hetiewei<br> <em> @date 2016年4月25日 上午10:32:14
 </em><br> <em>/<br>@Component<br>public class QueueReceiver2 implements MessageListener {<br><br>    public void onMessage(Message message) {<br>        try {<br>            System.out.println(&quot;QueueReceiver2接收到消息：&quot;+((TextMessage)message).getText());<br>        } catch (JMSException e) {<br>            e.printStackTrace();<br>        }<br>    }<br><br>}<br></em></pre><br><br><br><br></div><br><h3>2.topic/sub订阅模式</h3><br><div><br><br></div><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_7_6249771" name="code" class="java">package com.jay.mq.demo1.consumer.topic;<br><br>import javax.jms.JMSException;<br>import javax.jms.Message;<br>import javax.jms.MessageListener;<br>import javax.jms.TextMessage;<br><br>import org.springframework.stereotype.Component;<br><br>@Component<br>public class TopicReceiver1 implements MessageListener{<br><br>    public void onMessage(Message message) {<br>        try {<br>            System.out.println(&quot;TopicReceiver1接收到消息:&quot;+((TextMessage)message).getText());<br>        } catch (JMSException e) {<br>            e.printStackTrace();<br>        }<br>    }<br><br>}<br></pre><br><br><br><br></div><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_8_4755272" name="code" class="java">package com.jay.mq.demo1.consumer.topic;<br><br>import javax.jms.JMSException;<br>import javax.jms.Message;<br>import javax.jms.MessageListener;<br>import javax.jms.TextMessage;<br><br>import org.springframework.stereotype.Component;<br><br>@Component<br>public class TopicReceiver2 implements MessageListener{<br><br>    public void onMessage(Message message) {<br>        try {<br>            System.out.println(&quot;TopicReceiver2接收到消息:&quot;+((TextMessage)message).getText());<br>        } catch (JMSException e) {<br>            e.printStackTrace();<br>        }<br>    }<br><br>}<br></pre><br><h2></h2><br><h2>5.Controller</h2><br><div><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_9_993281" name="code" class="java">package com.jay.controller.demo1;<br><br>import javax.annotation.Resource;<br><br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.stereotype.Controller;<br>import org.springframework.web.bind.annotation.RequestMapping;<br>import org.springframework.web.bind.annotation.RequestParam;<br>import org.springframework.web.bind.annotation.ResponseBody;<br><br>import com.jay.mq.demo1.producer.queue.QueueSender1;<br>import com.jay.mq.demo1.producer.topic.TopicSender1;<br><br>/**
  Description: &lt;br/&gt;<br> <em> 
 </em> @author hetiewei<br> <em> @date 2016年4月25日 上午10:35:31
 </em><br> <em>/<br>@Controller<br>@RequestMapping(&quot;activemq&quot;)<br>public class ActivemqController1 {<br><br>    @Resource<br>    private QueueSender1 queueSender;<br>    @Autowired<br>    private TopicSender1 topicSender;<br><br>    /**
     </em> 发送消息到队列<br>     <em> Queue队列：仅有一个订阅者会收到消息，消息一旦被处理就不会存在队列中
     </em> @param message<br>     <em> @return String
     </em>/<br>    @ResponseBody<br>    @RequestMapping(&quot;queueSender&quot;)<br>    public String queueSender(@RequestParam(&quot;message&quot;)String message){<br>        String opt=&quot;&quot;;<br>        try {<br>            queueSender.send(&quot;test.queue&quot;, message);<br>            opt = &quot;suc&quot;;<br>        } catch (Exception e) {<br>            opt = e.getCause().toString();<br>        }<br>        return opt;<br>    }<br><br>    @ResponseBody<br>    @RequestMapping(&quot;topicSender&quot;)<br>    public String topoicSender(@RequestParam(&quot;message&quot;)String message){<br>        String opt = &quot;&quot;;<br>        try {<br>            topicSender.send(&quot;test.topic&quot;, message);<br>            opt = &quot;suc&quot;;<br>        } catch (Exception e) {<br>            opt = e.getCause().toString();<br>        }<br>        return opt;<br>    }<br><br><br>}<br></pre><br><h1><br><br><br><br>3.<span style="color:rgb(64,64,64); line-height:25.2px; font-family:Cambria; font-size:14px">ActiveMQ</span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:1.3em; line-height:1.1">的多种部署方式</span></h1><br></div><br></div><br><div><br><p align="left" style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>单点的<span style="line-height:25.2px; font-family:Calibri">ActiveMQ</span>作为企业应用无法满足高可用和集群的需求，所以<span style="line-height:25.2px; font-family:Calibri">ActiveMQ</span>提供了<span style="line-height:25.2px; font-family:Calibri">master-slave</span>、<span style="line-height:25.2px; font-family:Calibri">broker<br> cluster</span>等多种部署方式，但通过分析多种部署方式之后我认为需要将两种部署方式相结合才能满足我们公司分布式和高可用的需求，所以后面就重点将解如何将两种部署方式相结合。</p><br><h5 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:14px"><br><a target="_blank" name="t7" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:25.2px">1、Master-Slave部署方式</span></h5><br><h6 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:12px"><br><a target="_blank" name="t8" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:21.6px">1）shared filesystem Master-Slave部署方式</span></h6><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>主要是通过共享存储目录来实现<span style="line-height:25.2px; font-family:Calibri">master</span>和<span style="line-height:25.2px; font-family:Calibri">slave</span>的热备，所有的<span style="line-height:25.2px; font-family:Calibri">ActiveMQ</span>应用都在不断地获取共享目录的控制权，哪个应用抢到了控制权，它就成为<span style="line-height:25.2px; font-family:Calibri">master</span>。</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>多个共享存储目录的应用，谁先启动，谁就可以最早取得共享目录的控制权成为<span style="line-height:25.2px; font-family:Calibri">master</span>，其他的应用就只能作为<span style="line-height:25.2px; font-family:Calibri">slave</span>。</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><img title="p2.png" border="0" alt="p2.png" src="http://static.open-open.com/lib/uploadImg/20140515/20140515120001_591.png" width="323" height="250" style="border:0px; vertical-align:middle; max-width:100%"></p><br><h6 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:12px"><br><a target="_blank" name="t9" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:21.6px">2）shared database Master-Slave方式</span></h6><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>与<span style="line-height:25.2px; font-family:Calibri">shared filesystem</span>方式类&#20284;，只是共享的存储介质由文件系统改成了数据库而已。</p><br><h6 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:12px"><br><a target="_blank" name="t10" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:21.6px">3）Replicated LevelDB Store方式</span></h6><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>这种主备方式是<span style="line-height:25.2px; font-family:Calibri">ActiveMQ5.9</span>以后才新增的特性，使用<span style="line-height:25.2px; font-family:Calibri">ZooKeeper</span>协调选择一个<span style="line-height:25.2px; font-family:Calibri">node</span>作为<span style="line-height:25.2px; font-family:Calibri">master</span>。被选择的<span style="line-height:25.2px; font-family:Calibri">master<br> broker node</span>开启并接受客户端连接。</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px">其他<span style="line-height:25.2px; font-family:Calibri">node</span>转入<span style="line-height:25.2px; font-family:Calibri">slave</span>模式，连接<span style="line-height:25.2px; font-family:Calibri">master</span>并同步他们的存储状态。<span style="line-height:25.2px; font-family:Calibri">slave</span>不接受客户端连接。所有的存储操作都将被复制到连接至<span style="line-height:25.2px; font-family:Calibri">Master</span>的<span style="line-height:25.2px; font-family:Calibri">slaves</span>。</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px">如果<span style="line-height:25.2px; font-family:Calibri">master</span>死了，得到了最新更新的<span style="line-height:25.2px; font-family:Calibri">slave</span>被允许成为<span style="line-height:25.2px; font-family:Calibri">master</span>。<span style="line-height:25.2px; font-family:Calibri">fialed<br> node</span>能够重新加入到网络中并连接<span style="line-height:25.2px; font-family:Calibri">master</span>进入<span style="line-height:25.2px; font-family:Calibri">slave mode</span>。所有需要同步的<span style="line-height:25.2px; font-family:Calibri">disk</span>的消息操作都将等待存储状态被复制到其他法定节点的操作完成才能完成。所以，如果你配置了<span style="line-height:25.2px; font-family:Calibri">replicas=3</span>，那么法定大小是<span style="line-height:25.2px; font-family:Calibri">(3/2)&#43;1=2.<br> Master</span>将会存储并更新然后等待<span style="line-height:25.2px; font-family:Calibri">&nbsp;(2-1)=1</span>个<span style="line-height:25.2px; font-family:Calibri">slave</span>存储和更新完成，才汇报<span style="line-height:25.2px; font-family:Calibri">success</span>。至于为什么是<span style="line-height:25.2px; font-family:Calibri">2-1</span>，熟悉<span style="line-height:25.2px; font-family:Calibri">Zookeeper</span>的应该知道，有一个<span style="line-height:25.2px; font-family:Calibri">node</span>要作为观擦者存在。</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px">单一个新的<span style="line-height:25.2px; font-family:Calibri">master</span>被选中，你需要至少保障一个法定<span style="line-height:25.2px; font-family:Calibri">node</span>在线以能够找到拥有最新状态的<span style="line-height:25.2px; font-family:Calibri">node</span>。这个<span style="line-height:25.2px; font-family:Calibri">node</span>将会成为新的<span style="line-height:25.2px; font-family:Calibri">master</span>。因此，推荐运行至少<span style="line-height:25.2px; font-family:Calibri">3</span>个<span style="line-height:25.2px; font-family:Calibri">replica<br> nodes</span>，以防止一个<span style="line-height:25.2px; font-family:Calibri">node</span>失败了，服务中断。</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><img title="p3.png" border="0" alt="p3.png" src="http://static.open-open.com/lib/uploadImg/20140515/20140515115951_604.png" width="328" height="153" style="border:0px; vertical-align:middle; max-width:100%"></p><br><h5 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:14px"><br><a target="_blank" name="t11" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:25.2px">2、Broker-Cluster部署方式</span></h5><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>前面的<span style="line-height:25.2px; font-family:Calibri">Master-Slave</span>的方式虽然能解决多服务热备的高可用问题，但无法解决负载均衡和分布式的问题。<span style="line-height:25.2px; font-family:Calibri">Broker-Cluster</span>的部署方式就可以解决负载均衡的问题。</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Broker-Cluster</span>部署方式中，各个<span style="line-height:25.2px; font-family:Calibri">broker</span>通过网络互相连接，并共享<span style="line-height:25.2px; font-family:Calibri">queue</span>。当<span style="line-height:25.2px; font-family:Calibri">broker-A</span>上面指定的<span style="line-height:25.2px; font-family:Calibri">queue-A</span>中接收到一个<span style="line-height:25.2px; font-family:Calibri">message</span>处于<span style="line-height:25.2px; font-family:Calibri">pending</span>状态，而此时没有<span style="line-height:25.2px; font-family:Calibri">consumer</span>连接<span style="line-height:25.2px; font-family:Calibri">broker-A</span>时。如果<span style="line-height:25.2px; font-family:Calibri">cluster</span>中的<span style="line-height:25.2px; font-family:Calibri">broker-B</span>上面由一个<span style="line-height:25.2px; font-family:Calibri">consumer</span>在消费<span style="line-height:25.2px; font-family:Calibri">queue-A</span>的消息，那么<span style="line-height:25.2px; font-family:Calibri">broker-B</span>会先通过内部网络获取到<span style="line-height:25.2px; font-family:Calibri">broker-A</span>上面的<span style="line-height:25.2px; font-family:Calibri">message</span>，并通知自己的<span style="line-height:25.2px; font-family:Calibri">consumer</span>来消费。</p><br><h6 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:12px"><br><a target="_blank" name="t12" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:21.6px">1）static Broker-Cluster部署</span></h6><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>在<span style="line-height:25.2px; font-family:Calibri">activemq.xml</span>文件中静态指定<span style="line-height:25.2px; font-family:Calibri">Broker</span>需要建立桥连接的其他<span style="line-height:25.2px; font-family:Calibri">Broker</span>：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">1、</span>&nbsp;&nbsp;<span style="line-height:25.2px">首先在<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnector&nbsp;&nbsp; uri=&quot;static:(tcp:// 0.0.0.0:61617)&quot;duplex=&quot;false&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">2、</span>&nbsp;&nbsp;<span style="line-height:25.2px">修改<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61616</span>：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61616?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">3、</span>&nbsp;&nbsp;<span style="line-height:25.2px">在<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnector&nbsp;&nbsp; uri=&quot;static:(tcp:// 0.0.0.0:61616)&quot;duplex=&quot;false&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">4、</span>&nbsp;&nbsp;<span style="line-height:25.2px">修改<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61617</span>：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61617?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">5</span>、分别启动<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>和<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>。</p><br><h6 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:12px"><br><a target="_blank" name="t13" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:21.6px">2）Dynamic Broker-Cluster部署</span></h6><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>在<span style="line-height:25.2px; font-family:Calibri">activemq.xml</span>文件中不直接指定<span style="line-height:25.2px; font-family:Calibri">Broker</span>需要建立桥连接的其他<span style="line-height:25.2px; font-family:Calibri">Broker</span>，由<span style="line-height:25.2px; font-family:Calibri">activemq</span>在启动后动态查找：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">1、</span>&nbsp;&nbsp;<span style="line-height:25.2px">首先在<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnectoruri=&quot;multicast://default&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynamicOnly=&quot;true&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;networkTTL=&quot;3&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefetchSize=&quot;1&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;decreaseNetworkConsumerPriority=&quot;true&quot; /&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">2</span>、修改<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61616</span>：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61616? &quot; discoveryUri=&quot;multicast://default&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">3</span>、在<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnectoruri=&quot;multicast://default&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynamicOnly=&quot;true&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;networkTTL=&quot;3&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prefetchSize=&quot;1&quot;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;decreaseNetworkConsumerPriority=&quot;true&quot; /&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">4</span>、修改<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61617</span>：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61617&quot; discoveryUri=&quot;multicast://default&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">5</span>、启动<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>和<span style="line-height:25.2px; font-family:Calibri">Broker-B</span></p><br><h5 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:14px"><br><a target="_blank" name="t14" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:25.2px">2、Master-Slave与<span style="line-height:25.2px; font-family:Calibri">Broker-Cluster</span>相结合的部署方式</span></h5><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>可以看到<span style="line-height:25.2px; font-family:Calibri">Master-Slave</span>的部署方式虽然解决了高可用的问题，但不支持负载均衡，<span style="line-height:25.2px; font-family:Calibri">Broker-Cluster</span>解决了负载均衡，但当其中一个<span style="line-height:25.2px; font-family:Calibri">Broker</span>突然宕掉的话，那么存在于该<span style="line-height:25.2px; font-family:Calibri">Broker</span>上处于<span style="line-height:25.2px; font-family:Calibri">Pending</span>状态的<span style="line-height:25.2px; font-family:Calibri">message</span>将会丢失，无法达到高可用的目的。</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>由于目前<span style="line-height:25.2px; font-family:Calibri">ActiveMQ</span>官网上并没有一个明确的将两种部署方式相结合的部署方案，所以我尝试者把两者结合起来部署：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img title="p4.png" border="0" alt="p4.png" src="http://static.open-open.com/lib/uploadImg/20140515/20140515115919_992.png" width="636" height="361" style="border:0px; vertical-align:middle; max-width:100%"></span></p><br><h6 style="font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-weight:500; line-height:1.1; color:rgb(64,64,64); margin-top:10px; margin-bottom:10px; font-size:12px"><br><a target="_blank" name="t15" style="color:rgb(136,136,136); background-color:transparent"></a><span style="line-height:21.6px">1、部署的配置修改</span></h6><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>这里以<span style="line-height:25.2px; font-family:Calibri">Broker-A &#43; Broker-B</span>建立<span style="line-height:25.2px; font-family:Calibri">cluster</span>，<span style="line-height:25.2px; font-family:Calibri">Broker-C</span>作为<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>的<span style="line-height:25.2px; font-family:Calibri">slave</span>为例：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">1）</span>首先在<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnector&nbsp;&nbsp; uri=&quot;<span style="line-height:25.2px; color:red">masterslave:(tcp://0.0.0.0:61617,tcp:// 0.0.0.0:61618</span>)&quot; duplex=&quot;false&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">2）</span>修改<span style="line-height:25.2px; font-family:Calibri">Broker-A</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61616</span>：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61616?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">3）</span>在<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnector&nbsp;&nbsp; uri=&quot;static:(tcp:// 0.0.0.0:61616)&quot;duplex=&quot;false&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">4）</span>修改<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61617</span>：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61617?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">5）</span><span style="line-height:25.2px">修改<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中的持久化方式：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;persistenceAdapter&gt;</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;kahaDB directory=&quot;<span style="line-height:25.2px; color:red">/localhost/kahadb</span>&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&lt;/persistenceAdapter&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">6）</span>在<span style="line-height:25.2px; font-family:Calibri">Broker-C</span>节点中添加<span style="line-height:25.2px; font-family:Calibri">networkConnector</span>节点：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;networkConnectors&gt;&nbsp;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;networkConnector&nbsp;&nbsp; uri=&quot;static:(tcp:// 0.0.0.0:61616)&quot;duplex=&quot;false&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/networkConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">7）</span>修改<span style="line-height:25.2px; font-family:Calibri">Broker-C</span>节点中的服务提供端口为<span style="line-height:25.2px; font-family:Calibri">61618</span>：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;transportConnectorname=&quot;openwire&quot;uri=&quot;tcp://0.0.0.0:61618?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&lt;/transportConnectors&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">8）</span>修改<span style="line-height:25.2px; font-family:Calibri">Broker-B</span>节点中的持久化方式：</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;persistenceAdapter&gt;</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;kahaDB directory=&quot;<span style="line-height:25.2px; color:red">/localhost/kahadb</span>&quot;/&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/persistenceAdapter&gt;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:Calibri">9）</span>分别启动<span style="line-height:25.2px; font-family:Calibri">broker-A</span>、<span style="line-height:25.2px; font-family:Calibri">broker-B</span>、<span style="line-height:25.2px; font-family:Calibri">broker-C</span>，因为是<span style="line-height:25.2px; font-family:Calibri">broker-B</span>先启动，所以“<span style="line-height:25.2px; font-family:Calibri">/localhost/kahadb</span>”目录被<span style="line-height:25.2px; font-family:Calibri">lock</span>住，<span style="line-height:25.2px; font-family:Calibri">broker-C</span>将一直处于挂起状态，当人为停掉<span style="line-height:25.2px; font-family:Calibri">broker-B</span>之后，<span style="line-height:25.2px; font-family:Calibri">broker-C</span>将获取目录“<span style="line-height:25.2px; font-family:Calibri">/localhost/kahadb</span>”的控制权，重新与<span style="line-height:25.2px; font-family:Calibri">broker-A</span>组成<span style="line-height:25.2px; font-family:Calibri">cluster</span>提供服务。</p><br><br><br></div><br><h1><br><br>4.ActiveMQ之Master-Slaver&#43;负载均衡</h1><br><div><br><br></div><br><div><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br>什么叫中间件?<br style="line-height:10px"><br>中间件为软件应用提供了操作系统所提供的服务之外的服务，可以把中间件描述为&quot;软件胶水&quot;。中间件不是操作系统的一部分，不是数据库操作系统，也不是应用软件的一部分，而是能够让软件开发者方便的处理通信、输入和输出，能够专注自己应用的部分。</p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; color:rgb(76,51,229)">消息中间件解决了应用之间的消息传递、解耦、异步的问题。</span><br style="line-height:10px"><br><span style="line-height:1.5">ActiveMQ 是Apache出品，最流行的，能力强劲的开源消息总线。ActiveMQ 是一个完全支持JMS1.1和J2EE 1.4规范的 JMS Provider实现，尽管JMS规范出台已经是很久的事情了，但是JMS在当今的J2EE应用中间仍然扮演着特殊的地位。</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5">一般中间件都提供了横向扩展和纵向扩展，<span style="line-height:25.2px">横向扩展就是我们经常说的<span style="line-height:25.2px; color:rgb(76,51,229)">负载均衡</span></span>,<span style="line-height:25.2px">纵向扩展提供了<span style="line-height:25.2px; color:rgb(76,51,229)">Master-Slaver</span></span>;</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)">负载均衡:<span style="line-height:25.2px; color:rgb(0,0,0)">提供</span></span>负载均衡的中间件都对外提供服务<br style="line-height:10px"><br><span style="line-height:25.2px; color:rgb(76,51,229)">Master-Slaver：<span style="line-height:25.2px; color:rgb(0,0,0)">同时只有一个中间件对外提供服务,当Master出现挂机等问题，Slaver会自动接管</span></span><br style="line-height:10px"><br></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">看一个整合的简图:<br style="line-height:10px"><br><img alt="" src="http://static.open-open.com/lib/uploadImg/20160102/20160102210319_351.png" width="509" height="308" style="border:0px; vertical-align:middle; max-width:100%"><br style="line-height:10px"><br></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)">Master-Slave和Broker Cluster</span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px">准备：<br style="line-height:10px"><br>jdk1.6，apache-activemq-5.10.0，mysql5.1，zookeeper-3.4.3</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">先来看看<span style="line-height:25.2px; color:rgb(76,51,229)">Master-Slave<span style="line-height:25.2px; color:rgb(0,0,0)">模式</span></span></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)">Shared File System Master Slave</span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">本次测试在同一台机器上：<br style="line-height:10px"><br>首先更改配置conf/activemq,做如下修改：<br style="line-height:10px"><br></span></span></span></p><br><pre class="brush:java; toolbar: true; auto-links: false;" style="overflow:auto; font-family:Menlo,Monaco,Consolas,'Courier New',monospace; padding:6px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; border:none; background-color:rgb(246,246,246)">&lt;persistenceAdapter&gt;<br>        &lt;!–&lt;kahaDB directory=&quot;${activemq.data}/kahadb&quot;/&gt;–&gt;<br>    &lt;kahaDB directory=&quot;D:/kahaDB&quot;/&gt;<br> &lt;/persistenceAdapter&gt;</pre><br><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">将activemq拷贝3份，分别：apache-activemq-5.10.0-M1，&nbsp;</span><span style="line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px">apache-activemq-5.10.0-M2，<span style="line-height:25.2px">apache-activemq-5.10.0-M3</span></span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">，分别启动activemq命令，启动的日志分别是:&nbsp;</span><br style="line-height:10px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><img alt="" src="http://static.open-open.com/lib/uploadImg/20160102/20160102210319_3.png" width="644" height="69" style="border:0px; vertical-align:middle; max-width:100%; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px"><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px"></span><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">表示当前进程是Master<br style="line-height:10px"><br><br style="line-height:10px"><br><img alt="" src="http://static.open-open.com/lib/uploadImg/20160102/20160102210319_893.png" width="643" height="72" style="border:0px; vertical-align:middle; max-width:100%"><br style="line-height:10px"><br></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">表示当前进程没有获取到锁，作为Slaver<br style="line-height:10px"><br></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">测试：</span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px">下面的例子中分别提供了<span style="line-height:25.2px; color:rgb(76,51,229)">Producer<span style="line-height:25.2px; color:rgb(0,0,0)">(Sender类)</span></span>和<span style="line-height:25.2px; color:rgb(76,51,229)">Consumer<span style="line-height:25.2px; color:rgb(0,0,0)">(Receiver类)<br style="line-height:10px"><br>我们首先用Producer发送消息给activemq，然后停止Master，然后再用Consumer接受消息，测试结果是可以接受到数据的。</span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">2）.<span style="line-height:25.2px; color:rgb(76,51,229)">JDBC Master Slave</span><span style="line-height:25.2px; color:rgb(76,51,229)"><br style="line-height:10px"><br><span style="line-height:25.2px; color:rgb(0,0,0)">JDBC Master Slave模式和Shared File Sysytem Master Slave模式的原理是一样的，只是把共享文件系统换成了共享数据库。</span></span></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">修改配置文件conf/activemq<br style="line-height:10px"><br></span></span></span></span></span></p><br><pre class="brush:java; toolbar: true; auto-links: false;" style="overflow:auto; font-family:Menlo,Monaco,Consolas,'Courier New',monospace; padding:6px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; border:none; background-color:rgb(246,246,246)"><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_10_9093290" name="code" class="html">&lt;persistenceAdapter&gt;<br>        &lt;!–&lt;kahaDB directory=&quot;${activemq.data}/kahadb&quot;/&gt;–&gt;<br>    &lt;!–&lt;kahaDB directory=&quot;D:/kahaDB&quot;/&gt;–&gt;<br>        &lt;jdbcPersistenceAdapter dataDirectory=&quot;${activemq.base}/data&quot; dataSource=&quot;#mysql-ds&quot;/&gt;<br>  &lt;/persistenceAdapter&gt;</pre><br><br></pre><br><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">添加数据源：</span><br><pre class="brush:java; toolbar: true; auto-links: false;" style="overflow:auto; font-family:Menlo,Monaco,Consolas,'Courier New',monospace; padding:6px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; border:none; background-color:rgb(246,246,246)"><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_11_1808506" name="code" class="html">&lt;bean id=&quot;mysql-ds&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; destroy-method=&quot;close&quot;&gt;<br>    &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;<br>    &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost/activemq?relaxAutoCommit=true&quot;/&gt;<br>    &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;<br>    &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;<br>    &lt;property name=&quot;poolPreparedStatements&quot; value=&quot;true&quot;/&gt;<br>    &lt;/bean&gt;</pre><br><br></pre><br><span style="line-height:25.2px; font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; color:rgb(229,51,51)">注：这里使用的是mysql，所以需要mysql驱动程序：</span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">&nbsp;</span><span style="line-height:25.2px; font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; color:rgb(229,51,51)">mysql-connector-java-5.1.18，讲jar包放入lib文件夹下面，驱动版本不对，会出现如下错误:</span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">&nbsp;</span><span style="line-height:25.2px; font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; color:rgb(229,51,51)">Database<br> lock driver override not found for : [mysql_connect</span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">&nbsp;</span><span style="line-height:25.2px; font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; color:rgb(229,51,51)">…</span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px"></span><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><br style="line-height:10px"><br></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5">分别拷贝到其他几个文件夹下，分别启动，启动成功后我们可以看到数据库中多了几张表：</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><img alt="" src="http://static.open-open.com/lib/uploadImg/20160102/20160102210319_95.png" width="318" height="148" style="border:0px; vertical-align:middle; max-width:100%"><br style="line-height:10px"><br></span></span></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">测试方式同上；<br style="line-height:10px"><br>官网手册:<a target="_blank" href="http://activemq.apache.org/jdbc-master-slave.html" rel="nofollow" style="color:rgb(0,95,169); text-decoration:none; background-color:transparent">http://activemq.apache.org/jdbc-master-slave.html</a></span></span></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">3).<span style="line-height:25.2px; color:rgb(76,51,229)">Replicated<br> LevelDB Store</span><br style="line-height:10px"><br><span style="line-height:25px; color:rgb(64,64,64); background-color:rgb(250,250,250)">这种方式是</span><span style="line-height:25px; font-family:Calibri; color:rgb(64,64,64); background-color:rgb(250,250,250)">ActiveMQ5.9</span><span style="line-height:25px; color:rgb(64,64,64); background-color:rgb(250,250,250)">以后才新增的特性，使用</span><span style="line-height:25px; font-family:Calibri; color:rgb(64,64,64); background-color:rgb(250,250,250)">ZooKeeper</span><span style="line-height:25px; color:rgb(64,64,64); background-color:rgb(250,250,250)">协调选择一个</span><span style="line-height:25px; font-family:Calibri; color:rgb(64,64,64); background-color:rgb(250,250,250)">node</span><span style="line-height:25px; color:rgb(64,64,64); background-color:rgb(250,250,250)">作为</span><span style="line-height:25px; font-family:Calibri; color:rgb(64,64,64); background-color:rgb(250,250,250)">master</span></span></span></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px">修改配置文件conf/activemq：<br style="line-height:10px"><br></span></span></span></span></span></span></p><br><pre class="brush:java; toolbar: true; auto-links: false;" style="overflow:auto; font-family:Menlo,Monaco,Consolas,'Courier New',monospace; padding:6px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; border:none; background-color:rgb(246,246,246)"><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_12_5047109" name="code" class="html">&lt;!–&lt;persistenceAdapter&gt;<br>         &lt;kahaDB directory=&quot;${activemq.data}/kahadb&quot;/&gt;<br>         &lt;kahaDB directory=&quot;D:/kahaDB&quot;/&gt;<br>         &lt;jdbcPersistenceAdapter dataDirectory=&quot;${activemq.base}/data&quot; dataSource=&quot;#mysql-ds&quot;/&gt;<br> &lt;/persistenceAdapter&gt;–&gt;<br> &lt;persistenceAdapter&gt;<br>    &lt;replicatedLevelDB<br>        directory=&quot;${activemq.data}/leveldb&quot;<br>        replicas=&quot;3&quot;<br>        bind=&quot;tcp://0.0.0.0:0&quot;<br>        zkAddress=&quot;127.0.0.1:2181&quot;<br>        hostname=&quot;127.0.0.1&quot;<br>        sync=&quot;local_disk&quot;<br>        zkPath=&quot;/activemq/leveldb-stores&quot;/&gt;<br> &lt;/persistenceAdapter&gt;</pre><br><br></pre><br><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">首先启动zookeeper，这里没有做集群处理,默认端口是2181，然后分别启动activemq，&nbsp;</span><br style="line-height:10px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px; font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; color:rgb(229,51,51)">启动之后报错：&quot;activemq LevelDB IOException handler&quot;。</span><span style="color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px; line-height:25.2px">&nbsp;</span><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)"><span style="line-height:25.2px; color:rgb(229,51,51)"><span style="line-height:22px; font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; color:rgb(51,51,51)">原因：版本5.10.0存在的依赖冲突。</span><br style="line-height:10px"><br></span></span></span></span></span></span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(51,51,51); font-size:14px; font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="line-height:28.8px; font-size:16px"><span style="line-height:25.2px; font-size:14px">解决方案：<br style="line-height:10px"><br></span></span><span style="line-height:1.5">（1）移除lib目录中的pax-url-aether-1.5.2.jar包<br style="line-height:10px"><br></span><span style="line-height:28.8px; font-size:16px"><span style="line-height:25.2px; font-size:14px">（2）注释掉配置文件中的日志配置；</span></span><span style="line-height:25.2px">&nbsp;</span></p><br><pre class="brush:java; toolbar: true; auto-links: false;" style="overflow:auto; font-family:Menlo,Monaco,Consolas,'Courier New',monospace; padding:6px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; border:none; background-color:rgb(246,246,246)">&lt;!– Allows accessing the server log<br>    &lt;bean id=&quot;logQuery&quot; class=&quot;org.fusesource.insight.log.log4j.Log4jLogQuery&quot;<br>          lazy-init=&quot;false&quot; scope=&quot;singleton&quot;<br>          init-method=&quot;start&quot; destroy-method=&quot;stop&quot;&gt;<br>    &lt;/bean&gt;<br>–&gt;</pre><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:25.2px">测试方式同上；</span></p><br><p style="margin-top:10px; margin-bottom:10px; line-height:25.2px; color:rgb(64,64,64); font-family:'Microsoft YaHei',Verdana,sans-serif,SimSun; font-size:14px"><br><span style="line-height:1.5"><span style="line-height:25.2px; color:rgb(76,51,229)"><span style="line-height:25.2px; color:rgb(0,0,0)">提供java版的例子：<br style="line-height:10px"><br></span></span></span></p><br><pre class="brush:java; toolbar: true; auto-links: false;" style="overflow:auto; font-family:Menlo,Monaco,Consolas,'Courier New',monospace; padding:6px; margin-top:0px; margin-bottom:10px; line-height:1.45; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; border:none; background-color:rgb(246,246,246)"><pre code_snippet_id="1660918" snippet_file_name="blog_20160425_13_2397151" name="code" class="java">public class Sender {<br>    private static final int SEND_NUMBER = 5;<br><br>    public static void main(String[] args) {<br>        ConnectionFactory connectionFactory;<br>        Connection connection = null;<br>        Session session;<br>        Destination destination;<br>        MessageProducer producer;<br>        connectionFactory = new ActiveMQConnectionFactory(<br>            ActiveMQConnection.DEFAULT_USER,<br>            ActiveMQConnection.DEFAULT_PASSWORD, &quot;tcp://localhost:61616&quot;);<br>        try {<br>            connection = connectionFactory.createConnection();<br>            connection.start();<br>            session = connection.createSession(Boolean.TRUE,<br>                    Session.AUTO_ACKNOWLEDGE);<br>            destination = session.createQueue(&quot;FirstQueue&quot;);<br>            producer = session.createProducer(destination);<br>            producer.setDeliveryMode(DeliveryMode.PERSISTENT);<br>            sendMessage(session, producer);<br>            session.commit();<br>        } catch (Exception e) {<br>            e.printStackTrace();<br>        } finally {<br>            try {<br>                if (null != connection)<br>                    connection.close();<br>            } catch (Throwable ignore) {<br>            }<br>        }<br>    }<br><br>    public static void sendMessage(Session session, MessageProducer producer)<br>            throws Exception {<br>        for (int i = 1; i &lt;= SEND_NUMBER; i++) {<br>            TextMessage message = session.createTextMessage(&quot;发送的消息&quot;<br>                    + i);<br>            System.out.println(&quot;发送消息：&quot; + &quot;ActiveMq 发送的消息&quot; + i);<br>            producer.send(message);<br>        }<br>    }<br>}<br>public class Receiver {<br>    public static void main(String[] args) {<br>        ConnectionFactory connectionFactory;<br>        Connection connection = null;<br>        Session session;<br>        Destination destination;<br>        MessageConsumer consumer;<br>        connectionFactory = new ActiveMQConnectionFactory(<br>            ActiveMQConnection.DEFAULT_USER,<br>            ActiveMQConnection.DEFAULT_PASSWORD, &quot;tcp://localhost:61616&quot;);<br>        try {<br>            connection = connectionFactory.createConnection();<br>            connection.start();<br>            session = connection.createSession(Boolean.FALSE,<br>                    Session.AUTO_ACKNOWLEDGE);<br>            destination = session.createQueue(&quot;FirstQueue&quot;);<br>            consumer = session.createConsumer(destination);<br>            while (true) {<br>                TextMessage message = (TextMessage) consumer.receive(100000);<br>                if (null != message) {<br>                    System.out.println(&quot;收到消息&quot; + message.getText());<br>                } else {<br>                    break;<br>                }<br>            }<br>        } catch (Exception e) {<br>            e.printStackTrace();<br>        } finally {<br>            try {<br>                if (null != connection)<br>                    connection.close();<br>            } catch (Throwable ignore) {<br>            }<br>        }<br>    }<br>}</pre><br><br></pre><br><h1 style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><br><br><h1><span style="padding:0px; margin:0px; color:rgb(76,51,229)">5.Broker-Cluster实现负载均衡</span></h1><br></h1><br></div><br><div><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px; font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; font-size:13px; line-height:24.05px">Broker-Cluster部署方式中，各个broker通过网络互相连接，并共享queue，提供了2中部署方式：<br style="padding:0px; margin:0px"><br><span style="padding:0px; margin:0px; color:rgb(76,51,229)">static Broker-Cluster</span><span style="padding:0px; margin:0px; color:rgb(76,51,229)"></span>和<span style="padding:0px; margin:0px; color:rgb(76,51,229)">Dynamic Broker-Cluster</span><span style="padding:0px; margin:0px; color:rgb(76,51,229)"></span></span></p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px; color:rgb(76,51,229)">1).static Broker-Cluster</span></span></p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px">将ActiveMq拷贝2份，分别命名:apache-activemq-5.10.0_M1,apache-activemq-5.10.0_M2，<br style="padding:0px; margin:0px"><br>下面就是配置activemq,xml:<br style="padding:0px; margin:0px"><br>M1做如下配置:<br style="padding:0px; margin:0px"><br></span></span></p><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_483577" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:704px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:675px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnector<br> uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;static:(tcp://localhost:61617)&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/networkConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_774067" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:1024px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:995px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnector<br> name=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;openwire&quot;</code><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br>uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;tcp://0.0.0.0:61616?maximumConnectio&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> ns=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/transportConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><span style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; font-size:13px; line-height:24.05px">M2做如下配置:</span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px">&nbsp;</span><br style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_592019" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:704px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:675px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnector<br> uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;static:(tcp://localhost:61616)&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/networkConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_351396" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:1024px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:995px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnector<br> name=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;openwire&quot;</code><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br>uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;tcp://0.0.0.0:61617?maximumConnectio&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> ns=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/transportConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px">通过以上配置使M1和M2这两个&nbsp;</span><span style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; font-size:13px; line-height:24.05px">broker通过网络互相连接，并共享queue，<br style="padding:0px; margin:0px"><br>启动M1和M2,可以看到如下启动日志：</span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px">&nbsp;</span><span style="padding:0px; margin:0px; color:rgb(51,51,51); font-size:13px; line-height:24.05px; font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif"><br style="padding:0px; margin:0px"><br><a target="_blank" href="http://static.oschina.net/uploads/space/2016/0103/194536_ySvR_159239.png" style="padding:0px; margin:0px; color:rgb(255,131,115); outline:0px; font-size:12px"><img src="http://static.oschina.net/uploads/space/2016/0103/194536_ySvR_159239.png" alt="" style="padding:0px; margin:10px 0px; border:1px solid rgb(221,221,221); max-width:640px; background:rgb(244,247,249)"></a><br style="padding:0px; margin:0px"><br></span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"></span><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px"><a target="_blank" href="http://static.oschina.net/uploads/space/2016/0103/194609_AlHc_159239.png" style="padding:0px; margin:0px; color:rgb(255,131,115); outline:0px; font-size:12px"><img src="http://static.oschina.net/uploads/space/2016/0103/194609_AlHc_159239.png" alt="" style="padding:0px; margin:10px 0px; border:1px solid rgb(221,221,221); max-width:640px; background:rgb(244,247,249)"></a><br style="padding:0px; margin:0px"><br></span></span></p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px">可以看到M1和M2，<span style="padding:0px; margin:0px; color:rgb(76,51,229)">network connection has been established</span></span></span></p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px"><span style="padding:0px; margin:0px; color:rgb(76,51,229)"><span style="padding:0px; margin:0px; color:rgb(0,0,0)">测试我们还是用上一篇中的Sender和Receiver类，只需要做一点点修改：<br style="padding:0px; margin:0px"><br></span><span style="padding:0px; margin:0px; color:rgb(0,0,0)">Sender类还是链接tcp://localhost:61616，发送消息到queue，<br style="padding:0px; margin:0px"><br>Receiver做如下修改:<br style="padding:0px; margin:0px"><br></span></span></span></span></p><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_256279" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:704px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:675px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">connectionFactory<br> = </code><code class="java keyword" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:rgb(0,102,153)!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-weight:bold!important; font-size:1em!important; min-height:auto!important; background:none!important">new</code><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br>ActiveMQConnectionFactory(</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">ActiveMQConnection.DEFAULT_USER,</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">ActiveMQConnection.DEFAULT_PASSWORD,<br></code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;tcp://localhost:61617&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">);</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br>经测试Receiver可以接受到数据，表示M1和M2已经共享了queue</p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px"><span style="padding:0px; margin:0px; color:rgb(76,51,229)">2).<span style="padding:0px; margin:0px; font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; line-height:24.05px">Dynamic<br> Broker-Cluster</span></span></span></span></p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br><span style="padding:0px; margin:0px"><span style="padding:0px; margin:0px; font-size:13px; line-height:24.05px"><span style="padding:0px; margin:0px; color:rgb(76,51,229)"><span style="padding:0px; margin:0px; font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; line-height:24.05px"><span style="padding:0px; margin:0px; color:rgb(0,0,0)">Dynamic<br> Discovery集群方式在配置ActiveMQ实例时，不需要知道所有其它实例的URI地址</span><span style="padding:0px; margin:0px; color:rgb(0,0,0)"><br style="padding:0px; margin:0px"><br></span><span style="padding:0px; margin:0px; color:rgb(0,0,0)">对activemq.xml做如下配置:<br style="padding:0px; margin:0px"><br><span style="padding:0px; margin:0px; line-height:24.05px">M1做如下配置:<br style="padding:0px; margin:0px"><br></span></span></span></span></span></span></p><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_464186" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:704px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:675px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnector<br> uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;multicast://default&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/networkConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_579267" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:962px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br><div class="line number4 index3 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>4</div><br></td><br><td class="code" style="width:933px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnector<br> name=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;openwire&quot;</code><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br>uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;tcp://0.0.0.0:61616?<br> maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">discoveryUri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;multicast://default&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number4 index3 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/transportConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><span style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; font-size:13px; line-height:24.05px">M2<span style="padding:0px; margin:0px; line-height:24.05px">做如下配置:</span></span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"></span><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_377292" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:704px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br></td><br><td class="code" style="width:675px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;networkConnector<br> uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;multicast://default&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/networkConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><div style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"><br><div id="highlighter_494719" class="syntaxhighlighter  java" style="padding:0px; width:704px; margin:1em 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"><br><div class="toolbar" style="padding:0px!important; margin:0px!important; border:none!important; bottom:auto!important; float:none!important; height:11px!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:absolute!important; right:1px!important; top:1px!important; vertical-align:baseline!important; width:11px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:10px!important; min-height:auto!important; z-index:10!important; color:white!important; background:rgb(108,226,108)!important"><br><span style="padding:0px; margin:0px"><a target="_blank" href="http://my.oschina.net/OutOfMemory/blog/596552#" class="toolbar_item command_help help" style="padding:1px 0px 0px!important; margin:0px!important; color:white!important; outline:0px!important; font-size:1em!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; overflow:visible!important; position:static!important; right:auto!important; text-align:center!important; top:auto!important; vertical-align:baseline!important; width:auto!important; min-height:auto!important; display:block!important; text-decoration:none!important; background:none!important">?</a></span></div><br><table border="0" cellpadding="0" cellspacing="0" style="width:962px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tbody style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><tr style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><td class="gutter" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; font-size:1em!important; min-height:auto!important; color:rgb(175,175,175)!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>1</div><br><div class="line number2 index1 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>2</div><br><div class="line number3 index2 alt2" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>3</div><br><div class="line number4 index3 alt1" style="padding:0px 0.5em 0px 1em!important; margin:0px!important; border-width:0px 3px 0px 0px!important; border-right-style:solid!important; border-right-color:rgb(108,226,108)!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; text-align:right!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br>4</div><br></td><br><td class="code" style="width:933px; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="container" style="padding:0px!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:relative!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br><div class="line number1 index0 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnectors&gt;</code></div><br><div class="line number2 index1 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;transportConnector<br> name=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;openwire&quot;</code><br><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important"><br>uri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;tcp://0.0.0.0:61617?<br> maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;</code></div><br><div class="line number3 index2 alt2" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">discoveryUri=</code><code class="java string" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; color:blue!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&quot;multicast://default&quot;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">/&gt;</code></div><br><div class="line number4 index3 alt1" style="padding:0px 1em!important; margin:0px!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; white-space:pre!important"><br><code class="java spaces" style="color:red; padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&nbsp;</code><code class="java plain" style="padding:0px!important; margin:0px!important; font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace!important; border:0px!important; bottom:auto!important; float:none!important; height:auto!important; left:auto!important; line-height:1.1em!important; outline:0px!important; overflow:visible!important; position:static!important; right:auto!important; top:auto!important; vertical-align:baseline!important; width:auto!important; font-size:1em!important; min-height:auto!important; background:none!important">&lt;/transportConnectors&gt;</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div><br><span style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',微软雅黑,Arial,'Lucida Grande',Tahoma,sans-serif; font-size:13px; line-height:24.05px">启动M1和M2,可以看到如下启动日志：</span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px">&nbsp;</span><span style="padding:0px; margin:0px; font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; color:rgb(76,51,229); font-size:13px; line-height:24.05px">network<br> connection has been established</span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"></span><span style="padding:0px; margin:0px; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"></span><span style="color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体; font-size:12.5px; line-height:22.5px"></span><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br>测试同static broker-cluster,可以得到相同的结果。<br style="padding:0px; margin:0px"><br>官网配置说明：<a target="_blank" href="http://activemq.apache.org/networks-of-brokers.html" rel="nofollow" style="padding:0px; margin:0px; color:rgb(255,131,115); outline:0px; font-size:12px">http://activemq.apache.org/networks-of-brokers.html</a></p><br><p style="padding-top:0px; padding-bottom:0px; margin-top:8px; margin-bottom:8px; line-height:22.5px; letter-spacing:0.5px; font-size:12.5px; word-wrap:break-word; word-break:break-all; color:rgb(51,51,51); font-family:'Microsoft YaHei',Verdana,sans-serif,宋体"><br>Master-Slaver保证了数据的可靠性，Broker-Cluster提供了负载均衡，所以一般正式环境中都会采用：<br style="padding:0px; margin:0px"><br><span style="padding:0px; margin:0px">Master-Slaver&#43;</span><span style="padding:0px; margin:0px">Broker-Cluster的模式</span></p><br><br><br></div>

<p></p></div><p></p>
<!-- Baidu Button BEGIN -->
<div class="bdsharebuttonbox tracking-ad" style="float: right;" data-mod="popu_172"><br><a href="#" class="bds_more" data-cmd="more" style="background-position:0 0 !important; background-image: url(http://bdimg.share.baidu.com/static/api/img/share/icons_0_16.png?v=d754dcc0.png) !important"></a><br><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间" style="background-position:0 -52px !important"></a><br><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博" style="background-position:0 -104px !important"></a><br><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博" style="background-position:0 -260px !important"></a><br><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网" style="background-position:0 -208px !important"></a><br><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信" style="background-position:0 -1612px !important"></a><br></div><br><script>window._bd_share_config = { “common”: { “bdSnsKey”: {}, “bdText”: “”, “bdMini”: “1”, “bdMiniList”: false, “bdPic”: “”, “bdStyle”: “0”, “bdSize”: “16” }, “share”: {} }; with (document) 0[(getElementsByTagName(‘head’)[0] || body).appendChild(createElement(‘script’)).src = ‘<a href="http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=">http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=</a>‘ + ~(-new Date() / 36e5)];</script><br><!-- Baidu Button END --><br><br><br><br><br><!--172.16.140.12--><br><br><!-- Baidu Button BEGIN --><br><script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=1536434"></script><br><script type="text/javascript" id="bdshell_js"></script><br><script type="text/javascript"><br>    document.getElementById(“bdshell_js”).src = “<a href="http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=">http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=</a>“ + Math.ceil(new Date()/3600000)<br></script><br><!-- Baidu Button END --><br><br><br><br><br><br><br>        <div id="digg" articleid="51241597"><br>            <dl id="btnDigg" class="digg digg_disable" onclick="btndigga();"><br><br>                 <dt>顶</dt><br>                <dd>3</dd><br>            </dl><br><br><br>            <dl id="btnBury" class="digg digg_disable" onclick="btnburya();"><br><br>                  <dt>踩</dt><br>                <dd>0</dd><br>            </dl><br><br>        </div><br>     <div class="tracking-ad" data-mod="popu_222"><a href="javascript:void(0);" target="_blank" rel="external">&nbsp;</a>   </div><br>    <div class="tracking-ad" data-mod="popu_223"> <a href="javascript:void(0);" target="_blank" rel="external">&nbsp;</a></div><br>    <script type="text/javascript"><br>                function btndigga() {<br>                    $(“.tracking-ad[data-mod=’popu_222’] a”).click();<br>                }<br>                function btnburya() {<br>                    $(“.tracking-ad[data-mod=’popu_223’] a”).click();<br>                }<br>            </script><br><br>   <ul class="article_next_prev"><br>                <li class="prev_article"><span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_shangyipian']);location.href='/he90227/article/details/51163822';">上一篇</span><a href="/he90227/article/details/51163822" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_shangyipian'])">多线程笔记</a></li><br>                <li class="next_article"><span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_xiayipian']);location.href='/he90227/article/details/51248063';">下一篇</span><a href="/he90227/article/details/51248063" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_xiayipian'])">亿级Web系统搭建——单机到分布式集群</a></li><br>    </ul><br><br>    <div style="clear:both; height:10px;"></div>


<pre><code>&lt;div class=&quot;similar_article&quot;   &gt;
        &lt;h4&gt;&lt;/h4&gt;
        &lt;div class=&quot;similar_c&quot;style=&quot;margin:20px 0px 0px 0px&quot;&gt;
            &lt;div class=&quot;similar_c_t&quot;&gt;
              &amp;nbsp;&amp;nbsp;相关文章推荐
            &lt;/div&gt;

            &lt;div class=&quot;similar_wrap tracking-ad&quot; data-mod=&quot;popu_36&quot;  style=&quot;max-height:195px;&quot;&gt;                       
                &lt;ul class=&quot;similar_list fl&quot;&gt;    
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/lee1991723/article/details/48268861&quot; title=&quot;Spring整合JMS(一)——基于ActiveMQ实现&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;Spring整合JMS(一)——基于ActiveMQ实现&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/zwk626542417/article/details/48063383&quot; title=&quot;Spring整合JMS(一)——基于ActiveMQ实现&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;Spring整合JMS(一)——基于ActiveMQ实现&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/u010961759/article/details/39293649&quot; title=&quot;Spring整合JMS(一)——基于ActiveMQ实现&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;Spring整合JMS(一)——基于ActiveMQ实现&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/lingyun870801/article/details/23991513&quot; title=&quot;ActiveMQ整合Spring实现消息机制二(消息接收端配置)&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;ActiveMQ整合Spring实现消息机制二(消息接收端配置)&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/u014756827/article/details/52449232&quot; title=&quot;深入浅出JMS(四)--Spring和ActiveMQ整合的完整实例&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;深入浅出JMS(四)--Spring和ActiveMQ整合的完整实例&lt;/a&gt;
                       &lt;/li&gt;
                &lt;/ul&gt;
                  &lt;ul class=&quot;similar_list fr&quot;&gt;      
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/jianfpeng241241/article/details/51678695&quot; title=&quot;JMS学习(4):--Spring和ActiveMQ整合的完整实例&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;JMS学习(4):--Spring和ActiveMQ整合的完整实例&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/jingqiang521/article/details/49047847&quot; title=&quot;4、深入浅出JMS(四)--Spring和ActiveMQ整合的完整实例&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;4、深入浅出JMS(四)--Spring和ActiveMQ整合的完整实例&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/Leonardo9029/article/details/43154385&quot; title=&quot;浅谈jms之（通过spring整合activeMQ实现jms）实例&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;浅谈jms之（通过spring整合activeMQ实现jms）实例&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/yinbucheng/article/details/72477543&quot; title=&quot;spring整合activeMQ&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;spring整合activeMQ&lt;/a&gt;
                       &lt;/li&gt;
                       &lt;li&gt;
                           &lt;em&gt;•&lt;/em&gt;
                           &lt;a href=&quot;http://blog.csdn.net/polo_longsan/article/details/52317966&quot; title=&quot;ActiveMQ与Spring整合:(1)基本使用&quot; strategy=&quot;&quot; target=&quot;_blank&quot; style=&quot;width: 290px;&quot;&gt;ActiveMQ与Spring整合:(1)基本使用&lt;/a&gt;
                       &lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;   
</code></pre><p></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/06/13/disruptor-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/13/disruptor-01/" itemprop="url">Disruptor入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-13T16:23:09+08:00">
                2017-06-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="post_content"><br>      <p>翻译自Disruptor git库教程   <a href="https://github.com/LMAX-Exchange/disruptor/wiki/Getting-Started" target="_blank">英文地址</a></p><br><h2>获得Disruptor</h2><br><p>可以通过<a href="http://mvnrepository.com/artifact/com.lmax/disruptor" target="_blank" rel="external">Maven</a>或者下载<a href="https://github.com/LMAX-Exchange/disruptor/wiki/Downloads" target="_blank" rel="external">jar</a>来安装Disruptor。只要把对应的jar放在Java classpath就可以了。</p><br><h2>基本的事件生产和消费</h2><br><p>我们从一个简单的例子开始学习Disruptor：生产者传递一个long类型的值给消费者，而消费者消费这个数据的方式仅仅是把它打印出来。首先声明一个Event来包含需要传递的数据：</p><br><pre style="color: #000000;"><span class="s2" style="color: #cc7832;">public class </span><span class="s1" style="color: #a9b7c6;">LongEvent {<br>    </span><span class="s2" style="color: #cc7832;">private long </span><span class="s1" style="color: #a9b7c6;">value</span><span class="s2" style="color: #cc7832;">;<br></span><span class="s2" style="color: #cc7832;">    public long </span><span class="s1" style="color: #a9b7c6;">getValue() {<br>        </span><span class="s2" style="color: #cc7832;">return </span><span class="s1" style="color: #a9b7c6;">value</span><span class="s2" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>    }<br><br>    </span><span class="s2" style="color: #cc7832;">public void </span><span class="s1" style="color: #a9b7c6;">setValue(</span><span class="s2" style="color: #cc7832;">long </span><span class="s1" style="color: #a9b7c6;">value) {<br>        </span><span class="s2" style="color: #cc7832;">this</span><span class="s1" style="color: #a9b7c6;">.value = value</span><span class="s2" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>    }<br>} </span></pre><br><p><span id="more-13560"></span></p><br><p>由于需要让Disruptor为我们创建事件，我们同时还声明了一个EventFactory来实例化Event对象。</p><br><pre><span class="s0" style="color: #cc7832;">public class </span><span class="s1" style="color: #a9b7c6;">LongEventFactory </span><span class="s0" style="color: #cc7832;">implements </span><span class="s1" style="color: #a9b7c6;">EventFactory { </span></pre><br><pre style="color: #000000;"><span class="s1" style="color: #a9b7c6;">    @Override<br>    </span><span class="s0" style="color: #cc7832;">public </span><span class="s1" style="color: #a9b7c6;">Object newInstance() {<br>        </span><span class="s0" style="color: #cc7832;">return new </span><span class="s1" style="color: #a9b7c6;">LongEvent()</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>    }<br>} </span></pre><br><p>我们还需要一个事件消费者，也就是一个事件处理器。这个事件处理器简单地把事件中存储的数据打印到终端：</p><br><pre style="color: #000000;"><span class="s2" style="color: #629755;">/<strong><br> */</strong></span><span class="s0" style="color: #cc7832;">public class </span><span class="s1" style="color: #a9b7c6;">LongEventHandler </span><span class="s0" style="color: #cc7832;">implements </span><span class="s1" style="color: #a9b7c6;">EventHandler&lt;LongEvent&gt; {<br>    @Override<br>    </span><span class="s0" style="color: #cc7832;">public void </span><span class="s1" style="color: #a9b7c6;">onEvent(LongEvent longEvent</span><span class="s0" style="color: #cc7832;">, long </span><span class="s1" style="color: #a9b7c6;">l</span><span class="s0" style="color: #cc7832;">, boolean </span><span class="s1" style="color: #a9b7c6;">b) </span><span class="s0" style="color: #cc7832;">throws </span><span class="s1" style="color: #a9b7c6;">Exception {<br>        System.out.println(longEvent.getValue())</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>    }<br>} </span></pre><br><p>事件都会有一个生成事件的源，这个例子中假设事件是由于磁盘IO或者network读取数据的时候触发的，事件源使用一个ByteBuffer来模拟它接受到的数据，也就是说，事件源会在IO读取到一部分数据的时候触发事件（触发事件不是自动的，程序员需要在读取到数据的时候自己触发事件并发布）：</p><br><p>&nbsp;</p><br><pre style="color: #000000;"><span class="s0" style="color: #cc7832;">public class </span><span class="s1" style="color: #a9b7c6;">LongEventProducer {<br>    </span><span class="s0" style="color: #cc7832;">private final </span><span class="s1" style="color: #a9b7c6;">RingBuffer&lt;LongEvent&gt; ringBuffer</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s0" style="color: #cc7832;">    public </span><span class="s1" style="color: #a9b7c6;">LongEventProducer(RingBuffer&lt;LongEvent&gt; ringBuffer) {<br>        </span><span class="s0" style="color: #cc7832;">this</span><span class="s1" style="color: #a9b7c6;">.ringBuffer = ringBuffer</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>    }<br><br>    </span><span class="s2" style="color: #629755;">/<br>     <em> onData用来发布事件，每调用一次就发布一次事件事件 
     </em> 它的参数会通过事件传递给消费者<br>     <em> 
     </em> @param bb<br>     <em>/</em></span><span class="s0" style="color: #cc7832;">public void </span><span class="s1" style="color: #a9b7c6;">onData(ByteBuffer bb) {<br>            </span><span class="s3" style="color: #808080;">//可以把ringBuffer看做一个事件队列，那么next就是得到下面一个事件槽<br></span><span class="s0" style="color: #cc7832;">            long </span><span class="s1" style="color: #a9b7c6;">sequence = ringBuffer.next()</span><span class="s0" style="color: #cc7832;">;</span><span class="s0" style="color: #cc7832;">try </span><span class="s1" style="color: #a9b7c6;">{<br>            </span><span class="s3" style="color: #808080;">//用上面的索引取出一个空的事件用于填充</span><span class="s1" style="color: #a9b7c6;"><br>            LongEvent event = ringBuffer.get(sequence)</span><span class="s0" style="color: #cc7832;">;</span><span class="s3" style="color: #808080;">// for the sequence</span><span class="s1" style="color: #a9b7c6;"><br>            event.setValue(bb.getLong(</span><span class="s4" style="color: #6897bb;">0</span><span class="s1" style="color: #a9b7c6;">))</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>        } </span><span class="s0" style="color: #cc7832;">finally </span><span class="s1" style="color: #a9b7c6;">{<br>            </span><span class="s3" style="color: #808080;">//发布事件</span><span class="s1" style="color: #a9b7c6;"><br>            ringBuffer.publish(sequence)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>        }<br>    }<br>} </span></pre><br><p>很明显的是：当用一个简单队列来发布事件的时候会牵涉更多的细节，这是因为事件对象还需要预先创建。发布事件最少需要两步：获取下一个事件槽并发布事件（发布事件的时候要使用try/finnally保证事件一定会被发布）。如果我们使用RingBuffer.next()获取一个事件槽，那么一定要发布对应的事件。如果不能发布事件，那么就会引起Disruptor状态的混乱。尤其是在多个事件生产者的情况下会导致事件消费者失速，从而不得不重启应用才能会恢复。</p><br><p>Disruptor 3.0提供了lambda式的API。这样可以把一些复杂的操作放在Ring Buffer，所以在Disruptor3.0以后的版本最好使用Event Publisher或者Event Translator来发布事件。</p><br><p>&nbsp;</p><br><pre style="color: #000000;"><span class="s0" style="color: #cc7832;">public class </span><span class="s1" style="color: #a9b7c6;">LongEventProducerWithTranslator {<br>    </span><span class="s3" style="color: #808080;">//一个translator可以看做一个事件初始化器，publicEvent方法会调用它<br></span><span class="s3" style="color: #808080;">    //填充Event<br></span><span class="s0" style="color: #cc7832;">    private static final </span><span class="s1" style="color: #a9b7c6;">EventTranslatorOneArg&lt;LongEvent</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">ByteBuffer&gt; TRANSLATOR =<br>            </span><span class="s0" style="color: #cc7832;">new </span><span class="s1" style="color: #a9b7c6;">EventTranslatorOneArg&lt;LongEvent</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">ByteBuffer&gt;() {<br>                </span><span class="s0" style="color: #cc7832;">public void </span><span class="s1" style="color: #a9b7c6;">translateTo(LongEvent event</span><span class="s0" style="color: #cc7832;">, long </span><span class="s1" style="color: #a9b7c6;">sequence</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">ByteBuffer bb) {<br>                    event.setValue(bb.getLong(</span><span class="s4" style="color: #6897bb;">0</span><span class="s1" style="color: #a9b7c6;">))</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>                }<br>            }</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s0" style="color: #cc7832;">    private final </span><span class="s1" style="color: #a9b7c6;">RingBuffer&lt;LongEvent&gt; ringBuffer</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s0" style="color: #cc7832;">    public </span><span class="s1" style="color: #a9b7c6;">LongEventProducerWithTranslator(RingBuffer&lt;LongEvent&gt; ringBuffer) {<br>        </span><span class="s0" style="color: #cc7832;">this</span><span class="s1" style="color: #a9b7c6;">.ringBuffer = ringBuffer</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>    }<br><br>    </span><span class="s0" style="color: #cc7832;">public void </span><span class="s1" style="color: #a9b7c6;">onData(ByteBuffer bb) {<br>        ringBuffer.publishEvent(TRANSLATOR</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">bb)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>    }<br>} </span></pre><br><p>上面写法的另一个好处是，Translator可以分离出来并且更加容易单元测试。Disruptor提供了不同的接口(EventTranslator, EventTranslatorOneArg, EventTranslatorTwoArg, 等等)去产生一个Translator对象。很明显，Translator中方法的参数是通过RingBuffer来传递的。</p><br><p>&nbsp;</p><br><p>最后一步就是把所有的代码组合起来完成一个完整的事件处理系统。Disruptor在这方面做了简化，使用了DSL风格的代码（其实就是按照直观的写法，不太能算得上真正的DSL）。虽然DSL的写法比较简单，但是并没有提供所有的选项。如果依靠DSL已经可以处理大部分情况了。</p><br><p>&nbsp;</p><br><pre style="color: #000000;"><span class="s0" style="color: #cc7832;">public class </span><span class="s1" style="color: #a9b7c6;">LongEventMain {<br>    </span><span class="s0" style="color: #cc7832;">public static void </span><span class="s1" style="color: #a9b7c6;">main(String[] args) </span><span class="s0" style="color: #cc7832;">throws </span><span class="s1" style="color: #a9b7c6;">InterruptedException {<br>        </span><span class="s3" style="color: #808080;">// Executor that will be used to construct new threads for consumers</span><span class="s1" style="color: #a9b7c6;"><br>        Executor executor = Executors.newCachedThreadPool()</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s3" style="color: #808080;">        // The factory for the event</span><span class="s1" style="color: #a9b7c6;"><br>        LongEventFactory factory = </span><span class="s0" style="color: #cc7832;">new </span><span class="s1" style="color: #a9b7c6;">LongEventFactory()</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s3" style="color: #808080;">        // Specify the size of the ring buffer, must be power of 2.<br></span><span class="s0" style="color: #cc7832;">        int </span><span class="s1" style="color: #a9b7c6;">bufferSize = </span><span class="s4" style="color: #6897bb;">1024</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s3" style="color: #808080;">        // Construct the Disruptor</span><span class="s1" style="color: #a9b7c6;"><br>        Disruptor&lt;LongEvent&gt; disruptor = </span><span class="s0" style="color: #cc7832;">new </span><span class="s1" style="color: #a9b7c6;">Disruptor&lt;LongEvent&gt;(factory</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">bufferSize</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">executor)</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s3" style="color: #808080;">        // Connect the handler</span><span class="s1" style="color: #a9b7c6;"><br>        disruptor.handleEventsWith(</span><span class="s0" style="color: #cc7832;">new </span><span class="s1" style="color: #a9b7c6;">LongEventHandler())</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s3" style="color: #808080;">        // Start the Disruptor, starts all threads running</span><span class="s1" style="color: #a9b7c6;"><br>        disruptor.start()</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s3" style="color: #808080;">        // Get the ring buffer from the Disruptor to be used for publishing.</span><span class="s1" style="color: #a9b7c6;"><br>        RingBuffer&lt;LongEvent&gt; ringBuffer = disruptor.getRingBuffer()</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br><br>        LongEventProducer producer = </span><span class="s0" style="color: #cc7832;">new </span><span class="s1" style="color: #a9b7c6;">LongEventProducer(ringBuffer)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br><br>        ByteBuffer bb = ByteBuffer.allocate(</span><span class="s4" style="color: #6897bb;">8</span><span class="s1" style="color: #a9b7c6;">)</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s0" style="color: #cc7832;">        for </span><span class="s1" style="color: #a9b7c6;">(</span><span class="s0" style="color: #cc7832;">long </span><span class="s1" style="color: #a9b7c6;">l = </span><span class="s4" style="color: #6897bb;">0</span><span class="s0" style="color: #cc7832;">; true; </span><span class="s1" style="color: #a9b7c6;">l++) {<br>            bb.putLong(</span><span class="s4" style="color: #6897bb;">0</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">l)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>            producer.onData(bb)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>            Thread.sleep(</span><span class="s4" style="color: #6897bb;">1000</span><span class="s1" style="color: #a9b7c6;">)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>        }<br>    }<br>} </span></pre><br><h2>使用Java 8</h2><br><p>Disruptor在自己的接口里面添加了对于Java 8 Lambda的支持。大部分Disruptor中的接口都符合Functional Interface的要求（也就是在接口中仅仅有一个方法）。所以在Disruptor中，可以广泛使用Lambda来代替自定义类。</p><br><pre style="color: #000000;"><span class="s0" style="color: #cc7832;">public class </span><span class="s1" style="color: #a9b7c6;">LongEventMainJava8 {<br>    </span><span class="s2" style="color: #629755;">/** 
      用lambda表达式来注册EventHandler和EventProductor<br>     <em> @param args 
     </em> @throws InterruptedException<br>     */</span><span class="s0" style="color: #cc7832;">public static void </span><span class="s1" style="color: #a9b7c6;">main(String[] args) </span><span class="s0" style="color: #cc7832;">throws </span><span class="s1" style="color: #a9b7c6;">InterruptedException {<br>        </span><span class="s3" style="color: #808080;">// Executor that will be used to construct new threads for consumers</span><span class="s1" style="color: #a9b7c6;"><br>        Executor executor = Executors.newCachedThreadPool()</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s3" style="color: #808080;">        // Specify the size of the ring buffer, must be power of 2.<br></span><span class="s0" style="color: #cc7832;">        int </span><span class="s1" style="color: #a9b7c6;">bufferSize = </span><span class="s4" style="color: #6897bb;">1024</span><span class="s0" style="color: #cc7832;">;</span><span class="s3" style="color: #808080;">// Construct the Disruptor</span><span class="s1" style="color: #a9b7c6;"><br>        Disruptor&lt;LongEvent&gt; disruptor = </span><span class="s0" style="color: #cc7832;">new </span><span class="s1" style="color: #a9b7c6;">Disruptor&lt;&gt;(LongEvent::</span><span class="s0" style="color: #cc7832;">new, </span><span class="s1" style="color: #a9b7c6;">bufferSize</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">executor)</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s3" style="color: #808080;">        // 可以使用lambda来注册一个EventHandler</span><span class="s1" style="color: #a9b7c6;"><br>        disruptor.handleEventsWith((event</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">sequence</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">endOfBatch) -&gt; System.out.println(</span><span class="s5" style="color: #6a8759;">“Event: “ </span><span class="s1" style="color: #a9b7c6;">+ event.getValue()))</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s3" style="color: #808080;">        // Start the Disruptor, starts all threads running</span><span class="s1" style="color: #a9b7c6;"><br>        disruptor.start()</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s3" style="color: #808080;">        // Get the ring buffer from the Disruptor to be used for publishing.</span><span class="s1" style="color: #a9b7c6;"><br>        RingBuffer&lt;LongEvent&gt; ringBuffer = disruptor.getRingBuffer()</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br><br>        LongEventProducer producer = </span><span class="s0" style="color: #cc7832;">new </span><span class="s1" style="color: #a9b7c6;">LongEventProducer(ringBuffer)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br><br>        ByteBuffer bb = ByteBuffer.allocate(</span><span class="s4" style="color: #6897bb;">8</span><span class="s1" style="color: #a9b7c6;">)</span><span class="s0" style="color: #cc7832;">;</span><span class="s0" style="color: #cc7832;">for </span><span class="s1" style="color: #a9b7c6;">(</span><span class="s0" style="color: #cc7832;">long </span><span class="s1" style="color: #a9b7c6;">l = </span><span class="s4" style="color: #6897bb;">0</span><span class="s0" style="color: #cc7832;">; true; </span><span class="s1" style="color: #a9b7c6;">l++) {<br>            bb.putLong(</span><span class="s4" style="color: #6897bb;">0</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">l)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>            ringBuffer.publishEvent((event</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">sequence</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">buffer) -&gt; event.setValue(buffer.getLong(</span><span class="s4" style="color: #6897bb;">0</span><span class="s1" style="color: #a9b7c6;">))</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">bb)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>            Thread.sleep(</span><span class="s4" style="color: #6897bb;">1000</span><span class="s1" style="color: #a9b7c6;">)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>        }<br>    }<br>} </span></pre><br><p>在上面的代码中，有很多自定义类型可以被省略了。还有注意的是：publishEvent方法中仅调用传递给它的参数，并不是直接调用对应的对象。如果把这段代码换成下面的代码：</p><br><p>&nbsp;</p><br><pre><span class="n">ByteBuffer</span> <span class="n">bb</span> <span class="o" style="font-weight: bold;">=</span> <span class="n">ByteBuffer</span><span class="o" style="font-weight: bold;">.</span><span class="na" style="color: teal;">allocate</span><span class="o" style="font-weight: bold;">(</span><span class="mi" style="color: #009999;">8</span><span class="o" style="font-weight: bold;">);</span><br><span class="k" style="font-weight: bold;">for</span> <span class="o" style="font-weight: bold;">(</span><span class="kt" style="font-weight: bold; color: #445588;">long</span> <span class="n">l</span> <span class="o" style="font-weight: bold;">=</span> <span class="mi" style="color: #009999;">0</span><span class="o" style="font-weight: bold;">;</span> <span class="kc" style="font-weight: bold;">true</span><span class="o" style="font-weight: bold;">;</span> <span class="n">l</span><span class="o" style="font-weight: bold;">++)</span><br><span class="o" style="font-weight: bold;">{</span><br>    <span class="n">bb</span><span class="o" style="font-weight: bold;">.</span><span class="na" style="color: teal;">putLong</span><span class="o" style="font-weight: bold;">(</span><span class="mi" style="color: #009999;">0</span><span class="o" style="font-weight: bold;">,</span> <span class="n">l</span><span class="o" style="font-weight: bold;">);</span><br>    <span class="n">ringBuffer</span><span class="o" style="font-weight: bold;">.</span><span class="na" style="color: teal;">publishEvent</span><span class="o" style="font-weight: bold;">((</span><span class="n">event</span><span class="o" style="font-weight: bold;">,</span> <span class="n">sequence</span><span class="o" style="font-weight: bold;">)</span> <span class="o" style="font-weight: bold;">-&gt;</span> <span class="n">event</span><span class="o" style="font-weight: bold;">.</span><span class="na" style="color: teal;">set</span><span class="o" style="font-weight: bold;">(</span><span class="n">bb</span><span class="o" style="font-weight: bold;">.</span><span class="na" style="color: teal;">getLong</span><span class="o" style="font-weight: bold;">(</span><span class="mi" style="color: #009999;">0</span><span class="o" style="font-weight: bold;">)));</span><br>    <span class="n">Thread</span><span class="o" style="font-weight: bold;">.</span><span class="na" style="color: teal;">sleep</span><span class="o" style="font-weight: bold;">(</span><span class="mi" style="color: #009999;">1000</span><span class="o" style="font-weight: bold;">);</span><br><span class="o" style="font-weight: bold;">}</span></pre><br><p>这段代码中有一个捕获参数的lambda，意味着在lambda表达式生成的内部类中会生成一个对象来存储这个捕获的bb对象。这会增加不必要的GC。所以在需要较低GC水平的情况下最好把所有的参数都通过publishEvent传递。</p><br><p>&nbsp;</p><br><p>由于在Java 8中方法引用也是一个lambda，因此还可以把上面的代码改成下面的代码：</p><br><pre style="color: #000000;"><span class="s0" style="color: #cc7832;">public class </span><span class="s1" style="color: #a9b7c6;">LongEventWithMethodRef {<br>    </span><span class="s0" style="color: #cc7832;">public static void </span><span class="s1" style="color: #a9b7c6;">handleEvent(LongEvent event</span><span class="s0" style="color: #cc7832;">, long </span><span class="s1" style="color: #a9b7c6;">sequence</span><span class="s0" style="color: #cc7832;">, boolean </span><span class="s1" style="color: #a9b7c6;">endOfBatch)<br>    {<br>        System.out.println(event.getValue())</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>    }<br><br>    </span><span class="s0" style="color: #cc7832;">public static void </span><span class="s1" style="color: #a9b7c6;">translate(LongEvent event</span><span class="s0" style="color: #cc7832;">, long </span><span class="s1" style="color: #a9b7c6;">sequence</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">ByteBuffer buffer)<br>    {<br>        event.setValue(buffer.getLong(</span><span class="s3" style="color: #6897bb;">0</span><span class="s1" style="color: #a9b7c6;">))</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>    }<br><br>    </span><span class="s0" style="color: #cc7832;">public static void </span><span class="s1" style="color: #a9b7c6;">main(String[] args) </span><span class="s0" style="color: #cc7832;">throws </span><span class="s1" style="color: #a9b7c6;">Exception<br>    {<br>        </span><span class="s4" style="color: #808080;">// Executor that will be used to construct new threads for consumers</span><span class="s1" style="color: #a9b7c6;"><br>        Executor executor = Executors.newCachedThreadPool()</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s4" style="color: #808080;">        // Specify the size of the ring buffer, must be power of 2.<br></span><span class="s0" style="color: #cc7832;">        int </span><span class="s1" style="color: #a9b7c6;">bufferSize = </span><span class="s3" style="color: #6897bb;">1024</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s4" style="color: #808080;">        // Construct the Disruptor</span><span class="s1" style="color: #a9b7c6;"><br>        Disruptor&lt;LongEvent&gt; disruptor = </span><span class="s0" style="color: #cc7832;">new </span><span class="s1" style="color: #a9b7c6;">Disruptor&lt;&gt;(LongEvent::</span><span class="s0" style="color: #cc7832;">new, </span><span class="s1" style="color: #a9b7c6;">bufferSize</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">executor)</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s4" style="color: #808080;">        // Connect the handler</span><span class="s1" style="color: #a9b7c6;"><br>        disruptor.handleEventsWith(LongEventWithMethodRef::handleEvent)</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s4" style="color: #808080;">        // Start the Disruptor, starts all threads running</span><span class="s1" style="color: #a9b7c6;"><br>        disruptor.start()</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s4" style="color: #808080;">        // Get the ring buffer from the Disruptor to be used for publishing.</span><span class="s1" style="color: #a9b7c6;"><br>        RingBuffer&lt;LongEvent&gt; ringBuffer = disruptor.getRingBuffer()</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br><br>        LongEventProducer producer = </span><span class="s0" style="color: #cc7832;">new </span><span class="s1" style="color: #a9b7c6;">LongEventProducer(ringBuffer)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br><br>        ByteBuffer bb = ByteBuffer.allocate(</span><span class="s3" style="color: #6897bb;">8</span><span class="s1" style="color: #a9b7c6;">)</span><span class="s0" style="color: #cc7832;">;<br></span><span class="s0" style="color: #cc7832;">        for </span><span class="s1" style="color: #a9b7c6;">(</span><span class="s0" style="color: #cc7832;">long </span><span class="s1" style="color: #a9b7c6;">l = </span><span class="s3" style="color: #6897bb;">0</span><span class="s0" style="color: #cc7832;">; true; </span><span class="s1" style="color: #a9b7c6;">l++)<br>        {<br>            bb.putLong(</span><span class="s3" style="color: #6897bb;">0</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">l)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>            ringBuffer.publishEvent(LongEventWithMethodRef::translate</span><span class="s0" style="color: #cc7832;">, </span><span class="s1" style="color: #a9b7c6;">bb)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>            Thread.sleep(</span><span class="s3" style="color: #6897bb;">1000</span><span class="s1" style="color: #a9b7c6;">)</span><span class="s0" style="color: #cc7832;">;</span><span class="s1" style="color: #a9b7c6;"><br>        }<br>    }<br>} </span></pre><br><p>&nbsp;</p><br><h2 style="color: #000000;">基本调整选项</h2><br><p style="color: #000000;">上面的代码已经可以处理大多数的情况了，但是在有的时候还是会需要根据不同的软件或者硬件来调整选项以获得更高的性能。基本的选项有两个：单或者多生产者模式和可选的等待策略。</p><br><h3>单或多 事件生产者</h3><br><p>在并发系统中提高性能最好的方式之一就是<a href="http://mechanical-sympathy.blogspot.co.nz/2011/09/single-writer-principle.html" target="_blank" rel="external">单一写者原则</a>，对Disruptor也是适用的。如果在你的代码中仅仅有一个事件生产者，那么可以设置为单一生产者模式来提高系统的性能。</p><br><p>&nbsp;</p><br><pre style="color: #000000;"><span class="s0" style="color: #cc7832;">public class </span><span class="s1" style="color: #a9b7c6;">singleProductorLongEventMain {<br>    </span><span class="s0" style="color: #cc7832;">public static void </span><span class="s1" style="color: #a9b7c6;">main(String[] args) </span><span class="s0" style="color: #cc7832;">throws </span><span class="s1" style="color: #a9b7c6;">Exception {<br>        </span><span class="s3" style="color: #808080;">//…..</span><span class="s3" style="color: #808080;">// Construct the Disruptor with a SingleProducerSequencer</span><span class="s1" style="color: #a9b7c6;"><br><br>        Disruptor&lt;LongEvent&gt; disruptor = </span><span class="s0" style="color: #cc7832;">new </span><span class="s1" style="color: #a9b7c6;">Disruptor(factory</span><span class="s0" style="color: #cc7832;">,</span><span class="s1" style="color: #a9b7c6;"><br>                bufferSize</span><span class="s0" style="color: #cc7832;">,</span><span class="s1" style="color: #a9b7c6;"><br>                ProducerType.SINGLE</span><span class="s0" style="color: #cc7832;">, </span><span class="s3" style="color: #808080;">// Single producer</span><span class="s0" style="color: #cc7832;">new </span><span class="s1" style="color: #a9b7c6;">BlockingWaitStrategy()</span><span class="s0" style="color: #cc7832;">,</span><span class="s1" style="color: #a9b7c6;"><br>                executor)</span><span class="s0" style="color: #cc7832;">;</span><span class="s3" style="color: #808080;">//…..</span><span class="s1" style="color: #a9b7c6;"><br>    }<br>}<br></span></pre><br><p>为了证明，下面的数据是从Mac Air i7上面测试的结果：</p><br><h3>多生产者：</h3><br><p>&nbsp;</p><br><pre><code>Run 0, Disruptor=26,553,372 ops/sec<br>Run 1, Disruptor=28,727,377 ops/sec<br>Run 2, Disruptor=29,806,259 ops/sec<br>Run 3, Disruptor=29,717,682 ops/sec<br>Run 4, Disruptor=28,818,443 ops/sec<br>Run 5, Disruptor=29,103,608 ops/sec<br>Run 6, Disruptor=29,239,766 ops/sec</code></pre><br><h3>单生产者：</h3><br><pre><code>Run 0, Disruptor=89,365,504 ops/sec<br>Run 1, Disruptor=77,579,519 ops/sec<br>Run 2, Disruptor=78,678,206 ops/sec<br>Run 3, Disruptor=80,840,743 ops/sec<br>Run 4, Disruptor=81,037,277 ops/sec<br>Run 5, Disruptor=81,168,831 ops/sec<br>Run 6, Disruptor=81,699,346 ops/sec</code></pre><br><p>&nbsp;</p><br><h2><strong> 可选的等待策略</strong></h2><br><p>Disruptor默认的等待策略是BlockingWaitStrategy。这个策略的内部适用一个锁和条件变量来控制线程的执行和等待（Java基本的同步方法）。BlockingWaitStrategy是最慢的等待策略，但也是CPU使用率最低和最稳定的选项。然而，可以根据不同的部署环境调整选项以提高性能。</p><br><h3>SleepingWaitStrategy</h3><br><p>和BlockingWaitStrategy一样，SpleepingWaitStrategy的CPU使用率也比较低。它的方式是循环等待并且在循环中间调用LockSupport.parkNanos(1)来睡眠，（在Linux系统上面睡眠时间60µs）.然而，它的优点在于生产线程只需要计数，而不执行任何指令。并且没有条件变量的消耗。但是，事件对象从生产者到消费者传递的延迟变大了。SleepingWaitStrategy最好用在不需要低延迟，而且事件发布对于生产者的影响比较小的情况下。比如异步日志功能。</p><br><h3>YieldingWaitStrategy</h3><br><p>YieldingWaitStrategy是可以被用在低延迟系统中的两个策略之一，这种策略在减低系统延迟的同时也会增加CPU运算量。YieldingWaitStrategy策略会循环等待sequence增加到合适的值。循环中调用Thread.yield()允许其他准备好的线程执行。如果需要高性能而且事件消费者线程比逻辑内核少的时候，推荐使用YieldingWaitStrategy策略。例如：在开启超线程的时候。</p><br><h3>BusySpinWaitStrategy</h3><br><p>BusySpinWaitStrategy是性能最高的等待策略，同时也是对部署环境要求最高的策略。这个性能最好用在事件处理线程比物理内核数目还要小的时候。例如：在禁用超线程技术的时候。</p><br><h3></h3><br><p>&nbsp;</p><br><div style="margin-top: 15px; font-style: italic"><br><p><strong>原创文章，转载请注明：</strong> 转载自<a href="http://ifeve.com/" target="_blank" rel="external">并发编程网 &#8211; ifeve.com</a><strong>本文链接地址:</strong> <a href="http://ifeve.com/disruptor-getting-started/" target="_blank" rel="external">Disruptor入门</a></p><br></div>
</div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/06/08/jvm-API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/08/jvm-API/" itemprop="url">JVM Management API</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-08T16:05:27+08:00">
                2017-06-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post"><br><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>JVM本身提供了一组管理的API，通过该API，我们可以获取得到JVM内部主要运行信息，包括内存各代的数据、JVM当前所有线程及其栈相关信 息等等。各种JDK自带的剖析工具，包括jps、jstack、jinfo、jstat、jmap、jconsole等，都是基于此API开发的。本篇对 这部分内容进行一个详细的说明。</p><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 参考：<a target="_blank" href="http://java.sun.com/javase/6/docs/api/java/lang/management/package-summary.html" style="margin:0px; padding:0px; color:black">http://java.sun.com/javase/6/docs/api/java/lang/management/package-summary.html</a><br style="margin:0px; padding:0px"><br>一、Management API<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 我们先看一下从Sun JVM我们可以获取到哪些信息，如下图（来自于JConsole的MBean部分的截图）：<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="file:///C:/Documents%20and%20Settings/Administrator/Local%20Settings/Temp/CyberArticle/abc7ee61d958d83f5239799a7ceef2fe_397_files/1e07dd78_b6ba_3d05_be3b_94d0c4a75f5f[1].jpg" alt="" style="margin:0px; padding:0px; border:0px; max-width:900px"><br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1．HotSpotDiagnostic：非标准的监控JMX，这块是Sun JVM自带的，主要提供了两个功能</p><br><ul style="margin:0px 0px 0px 30px; padding:0px; word-break:break-all; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br><li style="margin:0px 0px 1em; padding:0px; list-style:disc">修改JVM的启动参数（譬如在不需要重启的情况下设置-XX:&#43;HeapDumpOnOutOfMemoryError参数使得JVM内存不足的时候自动dump出堆空间到文件提供后续分析）</li><li style="margin:0px 0px 1em; padding:0px; list-style:disc">Dump堆信息到文件，可以猜测jmap工具是基于此功能来完成的</li></ul><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp; 我们通过com.sun.management.HotSpotDiagnosticMXBean定义了解其主要功能<br style="margin:0px; padding:0px"><br></p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;HotSpotDiagnosticMXBean&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>{&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">void&nbsp;dumpHeap(String&nbsp;s,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;flag)&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">throws&nbsp;IOException;&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;List&nbsp;getDiagnosticOptions();&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;VMOption&nbsp;getVMOption(String&nbsp;s);&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">void&nbsp;setVMOption(String&nbsp;s,&nbsp;String&nbsp;s1);&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;HotSpotDiagnosticMXBean&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>{&nbsp;&nbsp;</li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">void&nbsp;dumpHeap(String&nbsp;s,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;flag)&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">throws&nbsp;IOException;&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;List&nbsp;getDiagnosticOptions();&nbsp;&nbsp;</li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;VMOption&nbsp;getVMOption(String&nbsp;s);&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">void&nbsp;setVMOption(String&nbsp;s,&nbsp;String&nbsp;s1);&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp; 2．ClassLoading：加载的类的总体信息，我们可以通过此MBean获取到JVM加载的类定义的总体信息，可以猜测JConsole的类功能就 是通过此MBean来提供的。我们可以通过java.lang.management.ClassLoadingMXBean定义了解其提供的主要功能</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;ClassLoadingMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getTotalLoadedClassCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;getLoadedClassCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getUnloadedClassCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isVerbose();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;setVerbose(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;value);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;ClassLoadingMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getTotalLoadedClassCount();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;getLoadedClassCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getUnloadedClassCount();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isVerbose();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;setVerbose(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;value);&nbsp;&nbsp;</span></span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp; 3.Compilation：提供JVM的JIT(Just In Time)编译器(将bytecode编译成native code)的信息，我们可以通过java.lang.management.CompilationMXBean定义了解其提供的主要功能</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;CompilationMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;java.lang.String&nbsp;&nbsp;&nbsp;&nbsp;getName();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isCompilationTimeMonitoringSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getTotalCompilationTime();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;CompilationMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;java.lang.String&nbsp;&nbsp;&nbsp;&nbsp;getName();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isCompilationTimeMonitoringSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getTotalCompilationTime();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp; 4.GarbageCollector：垃圾回收器信息，譬如在如上图中，我们启动的JVM会包含一个Copy垃圾回收器(用于Young Gen垃圾回收)和一个MarkAndSweep垃圾回收器(用于Tenured Gen垃圾回收)。我们可以通过java.lang.management.GarbageCollectorMXBean定义了解其提供的主要功能</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;GarbageCollectorMXBean&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">extends&nbsp;MemoryManagerMXBean&nbsp;{&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getCollectionCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getCollectionTime();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;GarbageCollectorMXBean&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">extends&nbsp;MemoryManagerMXBean&nbsp;{&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getCollectionCount();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getCollectionTime();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp; java.lang.management.MemoryManagerMXBean定义是</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;MemoryManagerMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getName();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isValid();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String[]&nbsp;getMemoryPoolNames();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;MemoryManagerMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getName();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isValid();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String[]&nbsp;getMemoryPoolNames();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp; 除了如上信息，Sun JVM在实现上还提供了一个额外的信息LastGCInfo，见com.sun.management.GarbageCollectorMXBean定义</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;GarbageCollectorMXBean&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">extends&nbsp;java.lang.management.GarbageCollectorMXBean&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>{&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;GcInfo&nbsp;getLastGcInfo();&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;GarbageCollectorMXBean&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">extends&nbsp;java.lang.management.GarbageCollectorMXBean&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>{&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;GcInfo&nbsp;getLastGcInfo();&nbsp;&nbsp;</li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp; 我们可以通过下面的截图了解GcInfo包含的主要信息<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<img src="file:///C:/Documents%20and%20Settings/Administrator/Local%20Settings/Temp/CyberArticle/abc7ee61d958d83f5239799a7ceef2fe_397_files/09ef4960_c6e2_35b0_abbc_fdf1dd3d282c[1].jpg" alt="" width="592" height="208" style="margin:0px; padding:0px; border:0px; max-width:900px"><br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 其中java.lang.management.MemoryUsage后续可以看说明<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5.内存相关<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 可以猜测，JConsole的内存部分的功能都是通过此部分的相关Bean来完成的。<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1)Memory/MemoryManager：内存块相关信息，通过这MBean我们可以获取到内存的总体信息，并可以通过提供的gc操作进行强制gc 的功能(System.gc())。我们可以通过java.lang.management.MemoryMXBean和 java.lang.management.MemoryManagerMXBean了解其主要提供的功能</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;MemoryMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;getObjectPendingFinalizationCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;MemoryUsage&nbsp;getHeapMemoryUsage();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;MemoryUsage&nbsp;getNonHeapMemoryUsage();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isVerbose();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;setVerbose(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;value);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;gc();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;MemoryMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;getObjectPendingFinalizationCount();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;MemoryUsage&nbsp;getHeapMemoryUsage();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;MemoryUsage&nbsp;getNonHeapMemoryUsage();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isVerbose();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;setVerbose(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;value);&nbsp;&nbsp;</span></span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;gc();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 其中java.lang.management.MemoryUsage我们可以通过下图来了解其提供的主要信息</p><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br><img src="file:///C:/Documents%20and%20Settings/Administrator/Local%20Settings/Temp/CyberArticle/abc7ee61d958d83f5239799a7ceef2fe_397_files/ae098db5_5693_3ea1_89cd_24ebc53b0ccd[1].jpg" alt="" width="439" height="209" style="margin:0px; padding:0px; border:0px; max-width:900px"></p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;MemoryManagerMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getName();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isValid();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String[]&nbsp;getMemoryPoolNames();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;MemoryManagerMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getName();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isValid();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String[]&nbsp;getMemoryPoolNames();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp; 2)MemoryPool：通过该MBean可以了解JVM各内存块的信息，譬如对于Sun JVM，目前包括Eden Space、Suvivor Space、Tenured Gen、CodeCache、Perm Gen，可以猜测JConsole的内存监控功能就是通过此MBean来做到的。我们可以通过 java.lang.management.MemoryPoolMXBean了解其主要提供的功能</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;MemoryPoolMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getName();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;MemoryType&nbsp;getType();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;MemoryUsage&nbsp;getUsage();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;MemoryUsage&nbsp;getPeakUsage();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;resetPeakUsage();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isValid();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String[]&nbsp;getMemoryManagerNames();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getUsageThreshold();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;setUsageThreshold(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;threshold);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isUsageThresholdExceeded();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getUsageThresholdCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isUsageThresholdSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getCollectionUsageThreshold();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;setCollectionUsageThreshold(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;threhsold);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isCollectionUsageThresholdExceeded();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getCollectionUsageThresholdCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;MemoryUsage&nbsp;getCollectionUsage();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isCollectionUsageThresholdSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;MemoryPoolMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getName();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;MemoryType&nbsp;getType();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;MemoryUsage&nbsp;getUsage();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;MemoryUsage&nbsp;getPeakUsage();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;resetPeakUsage();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isValid();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String[]&nbsp;getMemoryManagerNames();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getUsageThreshold();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;setUsageThreshold(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;threshold);&nbsp;&nbsp;</span></span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isUsageThresholdExceeded();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getUsageThresholdCount();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isUsageThresholdSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getCollectionUsageThreshold();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;setCollectionUsageThreshold(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;threhsold);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isCollectionUsageThresholdExceeded();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getCollectionUsageThresholdCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;MemoryUsage&nbsp;getCollectionUsage();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isCollectionUsageThresholdSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp; 6.系统运行信息<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp; 1）OperatingSystem：通过该MBean我们可以了解到JVM所运行在的操作系统上的一些相关信息，通过java.lang.management.OperatingSystemMXBean定义我们可以了解到其主要提供的功能</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;OperatingSystemMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getName();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getArch();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getVersion();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;getAvailableProcessors();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">double&nbsp;getSystemLoadAverage();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;OperatingSystemMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getName();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getArch();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getVersion();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;getAvailableProcessors();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">double&nbsp;getSystemLoadAverage();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SunJVM在此基础上提供更多的一些信息，可以通过com.sun.management.OperatingSystemMXBean了解一些额外可以获取到的信息</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;OperatingSystemMXBean&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">extends&nbsp;java.lang.management.OperatingSystemMXBean&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>{&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">long&nbsp;getCommittedVirtualMemorySize();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">long&nbsp;getTotalSwapSpaceSize();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">long&nbsp;getFreeSwapSpaceSize();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">long&nbsp;getProcessCpuTime();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">long&nbsp;getFreePhysicalMemorySize();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">long&nbsp;getTotalPhysicalMemorySize();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;OperatingSystemMXBean&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">extends&nbsp;java.lang.management.OperatingSystemMXBean&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>{&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">long&nbsp;getCommittedVirtualMemorySize();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">long&nbsp;getTotalSwapSpaceSize();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">long&nbsp;getFreeSwapSpaceSize();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">long&nbsp;getProcessCpuTime();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">long&nbsp;getFreePhysicalMemorySize();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">long&nbsp;getTotalPhysicalMemorySize();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp; 2）Runtime：通过该MBean获取获取到JVM一些相关的信息，通过java.lang.management.RuntimeMXBean可以了解其主要提供的功能</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;RuntimeMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getName();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getVmName();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getVmVendor();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getVmVersion();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getSpecName();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getSpecVendor();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getSpecVersion();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getManagementSpecVersion();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getClassPath();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getLibraryPath();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isBootClassPathSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getBootClassPath();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;java.util.List&lt;String&gt;&nbsp;getInputArguments();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getUptime();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getStartTime();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;java.util.Map&lt;String,&nbsp;String&gt;&nbsp;getSystemProperties();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;RuntimeMXBean&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getName();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getVmName();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getVmVendor();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getVmVersion();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getSpecName();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getSpecVendor();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getSpecVersion();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getManagementSpecVersion();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getClassPath();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getLibraryPath();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isBootClassPathSupported();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;String&nbsp;getBootClassPath();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;java.util.List&lt;String&gt;&nbsp;getInputArguments();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getUptime();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getStartTime();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;java.util.Map&lt;String,&nbsp;String&gt;&nbsp;getSystemProperties();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 可以通过RuntimeMXBean.getUptime()和OperatingSystemMXBean. getProcessCpuTime()来计算JVM占用的系统CPU比例的情况，JConsole的CPU视图就是通过这种方式计算的。<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7.Threading：可以通过该MBean获取线程信息，包括线程状态、执行栈等。可以通过java.lang.management.ThreadMXBean了解其提供的主要功能</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;ThreadMXBean&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;getThreadCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;getPeakThreadCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getTotalStartedThreadCount();&nbsp;&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;getDaemonThreadCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long[]&nbsp;getAllThreadIds();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;ThreadInfo&nbsp;getThreadInfo(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;id);&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;ThreadInfo[]&nbsp;getThreadInfo(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long[]&nbsp;ids);&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;ThreadInfo&nbsp;getThreadInfo(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;id,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;maxDepth);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;ThreadInfo[]&nbsp;getThreadInfo(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long[]&nbsp;ids,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;maxDepth);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isThreadContentionMonitoringSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isThreadContentionMonitoringEnabled();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;setThreadContentionMonitoringEnabled(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;enable);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getCurrentThreadCpuTime();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getCurrentThreadUserTime();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getThreadCpuTime(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;id);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getThreadUserTime(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;id);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isThreadCpuTimeSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isCurrentThreadCpuTimeSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isThreadCpuTimeEnabled();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;setThreadCpuTimeEnabled(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;enable);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long[]&nbsp;findMonitorDeadlockedThreads();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;resetPeakThreadCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long[]&nbsp;findDeadlockedThreads();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isObjectMonitorUsageSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isSynchronizerUsageSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;ThreadInfo[]&nbsp;getThreadInfo(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long[]&nbsp;ids,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;lockedMonitors,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;lockedSynchronizers);&nbsp;&nbsp;</span></span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;ThreadInfo[]&nbsp;dumpAllThreads(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;lockedMonitors,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;lockedSynchronizers);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;&nbsp;</li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">interface&nbsp;ThreadMXBean&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;getThreadCount();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;getPeakThreadCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getTotalStartedThreadCount();&nbsp;&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;getDaemonThreadCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long[]&nbsp;getAllThreadIds();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;ThreadInfo&nbsp;getThreadInfo(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;id);&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;ThreadInfo[]&nbsp;getThreadInfo(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long[]&nbsp;ids);&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;ThreadInfo&nbsp;getThreadInfo(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;id,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;maxDepth);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;ThreadInfo[]&nbsp;getThreadInfo(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long[]&nbsp;ids,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">int&nbsp;maxDepth);&nbsp;&nbsp;</span></span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isThreadContentionMonitoringSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isThreadContentionMonitoringEnabled();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;setThreadContentionMonitoringEnabled(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;enable);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getCurrentThreadCpuTime();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getCurrentThreadUserTime();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getThreadCpuTime(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;id);&nbsp;&nbsp;</span></span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;getThreadUserTime(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long&nbsp;id);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isThreadCpuTimeSupported();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isCurrentThreadCpuTimeSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isThreadCpuTimeEnabled();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;setThreadCpuTimeEnabled(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;enable);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long[]&nbsp;findMonitorDeadlockedThreads();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;resetPeakThreadCount();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long[]&nbsp;findDeadlockedThreads();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isObjectMonitorUsageSupported();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;isSynchronizerUsageSupported();&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;ThreadInfo[]&nbsp;getThreadInfo(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">long[]&nbsp;ids,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;lockedMonitors,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;lockedSynchronizers);&nbsp;&nbsp;</span></span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;ThreadInfo[]&nbsp;dumpAllThreads(<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;lockedMonitors,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">boolean&nbsp;lockedSynchronizers);&nbsp;&nbsp;</span></span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp; 二、编程获取到JVM Manage信息<br style="margin:0px; padding:0px"><br>我们可以通过JMX的方式读取到JVM Manage定义的MBean，如下是3种获取方法<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp; 1.监控应用与被监控应用位于同一JVM</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>MBeanServer&nbsp;server&nbsp;=&nbsp;<span id="casearchresult" style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px">ManagementFactory</span>.getPlatformMBeanServer();&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>RuntimeMXBean&nbsp;rmxb&nbsp;=&nbsp;<span id="casearchresult" style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px">ManagementFactory</span>.newPlatformMXBeanProxy(server,&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;java.lang:type=Runtime&quot;,&nbsp;RuntimeMXBean.<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">class);&nbsp;&nbsp;</span></span></li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>MBeanServer&nbsp;server&nbsp;=&nbsp;&lt;span&nbsp;style=<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;BACKGROUND-COLOR:&nbsp;#00ff40;&nbsp;COLOR:&nbsp;black;&nbsp;&quot;&nbsp;id=<span class="string" style="margin:0px; padding:0px; border:none; background-color:inherit">&quot;casearchresult&quot;&gt;&lt;strong&gt;ManagementFactory&lt;/strong&gt;&lt;/span&gt;.getPlatformMBeanServer();&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>RuntimeMXBean&nbsp;rmxb&nbsp;=&nbsp;&lt;span&nbsp;style=<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;BACKGROUND-COLOR:&nbsp;#00ff40;&nbsp;COLOR:&nbsp;black;&nbsp;&quot;&nbsp;id=<span class="string" style="margin:0px; padding:0px; border:none; background-color:inherit">&quot;casearchresult&quot;&gt;&lt;strong&gt;ManagementFactory&lt;/strong&gt;&lt;/span&gt;.newPlatformMXBeanProxy(server,&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;java.lang:type=Runtime&quot;,&nbsp;RuntimeMXBean.<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">class);&nbsp;&nbsp;</span></span></li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.监控应用与被监控应用不位于同一JVM<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1)首先在被监控的JVM的启动参数中加入如下的启动参数以启JVM代理</p><br><div class="quote_div" style="margin:0px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=127.0.0.1:8000 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false</div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2)连接到代理上</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>JMXServiceURL&nbsp;url&nbsp;=&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">new&nbsp;JMXServiceURL(&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;service:jmx:rmi:///jndi/rmi://127.0.0.1:8000/jmxrmi&quot;);&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>JMXConnector&nbsp;connector&nbsp;=&nbsp;JMXConnectorFactory.connect(url);&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>RuntimeMXBean&nbsp;rmxb&nbsp;=&nbsp;<span id="casearchresult" style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px">ManagementFactory</span>.newPlatformMXBeanProxy(connector&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.getMBeanServerConnection(),<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;java.lang:type=Runtime&quot;,&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RuntimeMXBean.<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">class);&nbsp;&nbsp;</span></li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>JMXServiceURL&nbsp;url&nbsp;=&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">new&nbsp;JMXServiceURL(&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;service:jmx:rmi:///jndi/rmi://127.0.0.1:8000/jmxrmi&quot;);&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>JMXConnector&nbsp;connector&nbsp;=&nbsp;JMXConnectorFactory.connect(url);&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>RuntimeMXBean&nbsp;rmxb&nbsp;=&nbsp;&lt;span&nbsp;style=<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;BACKGROUND-COLOR:&nbsp;#00ff40;&nbsp;COLOR:&nbsp;black;&nbsp;&quot;&nbsp;id=<span class="string" style="margin:0px; padding:0px; border:none; background-color:inherit">&quot;casearchresult&quot;&gt;&lt;strong&gt;ManagementFactory&lt;/strong&gt;&lt;/span&gt;.newPlatformMXBeanProxy(connector&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.getMBeanServerConnection(),<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;java.lang:type=Runtime&quot;,&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RuntimeMXBean.<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">class);&nbsp;&nbsp;</span></li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp; 3.监控应用与被监控应用不位于同一JVM但在同一物理主机上(2的特化情况，通过进程Attach)<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 我们使用JDK工具，如jmap、jstack等的时候，工具所在的JVM当然与被监控的JVM不是同一个，所以不能使用方式1，被监控的JVM一般也不 会在启动参数中增加JMX的支持，所以方式2也没有办法。还好Sun JVM给我们提供了第3种非标准的方式，就是通过Attach到被监控的JVM进程，并在被监控的JVM中启动一个JMX代理，然后使用该代理通过2的方 式连接到被监控的JVM的JMX上。下面是一个使用范例，由于里面使用到的知识涉及到Java Instrutment(JVMTI的一个技术的Java实现)和Attach<br> API，因此此处不做详细解析，在后续看完Java Instrutment和Attach API自然就会明白。（注意，仅在JDK6&#43;中支持，另外，运行需要jdk的tools.jar包）</p><br><div class="dp-highlighter" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//Attach&nbsp;到5656的JVM进程上，后续Attach&nbsp;API再讲解&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>VirtualMachine&nbsp;virtualmachine&nbsp;=&nbsp;VirtualMachine.attach(<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;5656&quot;);&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//让JVM加载jmx&nbsp;Agent，后续讲到Java&nbsp;Instrutment再讲解&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>String&nbsp;javaHome&nbsp;=&nbsp;virtualmachine.getSystemProperties().getProperty(<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;java.home&quot;);&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>String&nbsp;jmxAgent&nbsp;=&nbsp;javaHome&nbsp;&#43;&nbsp;File.separator&nbsp;&#43;&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;lib&quot;&nbsp;&#43;&nbsp;File.separator&nbsp;&#43;&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; background-color:inherit">&quot;management-agent.jar&quot;;&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>virtualmachine.loadAgent(jmxAgent,&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;com.sun.management.jmxremote&quot;);&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//获得连接地址&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>Properties&nbsp;properties&nbsp;=&nbsp;virtualmachine.getAgentProperties();&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>String&nbsp;address&nbsp;=&nbsp;(String)properties.get(<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;com.sun.management.jmxremote.localConnectorAddress&quot;);&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//Detach&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>virtualmachine.detach();&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>JMXServiceURL&nbsp;url&nbsp;=&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">new&nbsp;JMXServiceURL(address);&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>JMXConnector&nbsp;connector&nbsp;=&nbsp;JMXConnectorFactory.connect(url);&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>RuntimeMXBean&nbsp;rmxb&nbsp;=&nbsp;<span id="casearchresult" style="margin:0px; padding:0px; border:none; color:black; background-color:inherit"><span style="margin:0px; padding:0px">ManagementFactory</span>.newPlatformMXBeanProxy(connector&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.getMBeanServerConnection(),&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;java.lang:type=Runtime&quot;,RuntimeMXBean.<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">class);&nbsp;&nbsp;</span></span></li></ol><br></div><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//Attach&nbsp;到5656的JVM进程上，后续Attach&nbsp;API再讲解&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>VirtualMachine&nbsp;virtualmachine&nbsp;=&nbsp;VirtualMachine.attach(<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;5656&quot;);&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//让JVM加载jmx&nbsp;Agent，后续讲到Java&nbsp;Instrutment再讲解&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>String&nbsp;javaHome&nbsp;=&nbsp;virtualmachine.getSystemProperties().getProperty(<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;java.home&quot;);&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>String&nbsp;jmxAgent&nbsp;=&nbsp;javaHome&nbsp;&#43;&nbsp;File.separator&nbsp;&#43;&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;lib&quot;&nbsp;&#43;&nbsp;File.separator&nbsp;&#43;&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; background-color:inherit">&quot;management-agent.jar&quot;;&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>virtualmachine.loadAgent(jmxAgent,&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;com.sun.management.jmxremote&quot;);&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;</li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//获得连接地址&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>Properties&nbsp;properties&nbsp;=&nbsp;virtualmachine.getAgentProperties();&nbsp;&nbsp;</li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>String&nbsp;address&nbsp;=&nbsp;(String)properties.get(<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;com.sun.management.jmxremote.localConnectorAddress&quot;);&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">//Detach&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>virtualmachine.detach();&nbsp;&nbsp;</li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>JMXServiceURL&nbsp;url&nbsp;=&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">new&nbsp;JMXServiceURL(address);&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>JMXConnector&nbsp;connector&nbsp;=&nbsp;JMXConnectorFactory.connect(url);&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>RuntimeMXBean&nbsp;rmxb&nbsp;=&nbsp;&lt;span&nbsp;style=<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;BACKGROUND-COLOR:&nbsp;#00ff40;&nbsp;COLOR:&nbsp;black;&nbsp;&quot;&nbsp;id=<span class="string" style="margin:0px; padding:0px; border:none; background-color:inherit">&quot;casearchresult&quot;&gt;&lt;strong&gt;ManagementFactory&lt;/strong&gt;&lt;/span&gt;.newPlatformMXBeanProxy(connector&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.getMBeanServerConnection(),&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;java.lang:type=Runtime&quot;,RuntimeMXBean.<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">class);&nbsp;&nbsp;</span></span></li></ol><br></div><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 三、结束语<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 可以看到，通过标准的接口，我们已经可以获得运行的JVM很详细的信息，从运行JVM、操作系统，到内存、GC和线程，通过这些标准的接口我们已经可以对 JVM进行功能完善的监控。但是仅此是不够的，这部分接口描述的主要是JVM的总体性的信息，而无法提供更多的细节。在下一部分，我们将使用JPDA来更 深入地了解JVM内部信息更细节的信息，并了解我们如何通过JVM TI实现自动的性能监控<br style="margin:0px; padding:0px"><br></p><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br><br style="margin:0px; padding:0px"><br></p><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br><span style="margin:0px; padding:0px">软件包 java.lang.management 提供管理接口，用于监视和管理 Java 虚拟机以及 Java 虚拟机在其上运行的操作系统。<br style="margin:0px; padding:0px"><br>它同时允许从本地和远程对正在运行的 Java 虚拟机进行监视和管理。&nbsp;</span><br style="margin:0px; padding:0px"><br><br style="margin:0px; padding:0px"><br>管理接口<br style="margin:0px; padding:0px"><br><span style="margin:0px; padding:0px; background-color:rgb(204,255,255)"><span style="margin:0px; padding:0px; color:rgb(255,0,255)">ClassLoadingMXBean&nbsp; Java 虚拟机的类加载系统。<br style="margin:0px; padding:0px"><br>CompilationMXBean&nbsp; Java 虚拟机的编译系统。&nbsp;<br style="margin:0px; padding:0px"><br>MemoryMXBean&nbsp; Java 虚拟机的内存系统。&nbsp;<br style="margin:0px; padding:0px"><br>ThreadMXBean&nbsp; Java 虚拟机的线程系统。&nbsp;<br style="margin:0px; padding:0px"><br>RuntimeMXBean&nbsp; Java 虚拟机的运行时系统。&nbsp;<br style="margin:0px; padding:0px"><br>OperatingSystemMXBean&nbsp; Java 虚拟机在其上运行的操作系统。&nbsp;<br style="margin:0px; padding:0px"><br>GarbageCollectorMXBean&nbsp; Java 虚拟机中的垃圾回收器。&nbsp;<br style="margin:0px; padding:0px"><br>MemoryManagerMXBean&nbsp; Java 虚拟机中的内存管理器。&nbsp;<br style="margin:0px; padding:0px"><br>MemoryPoolMXBean&nbsp; Java 虚拟机中的内存池。&nbsp;<br style="margin:0px; padding:0px"><br>示例如下：<br style="margin:0px; padding:0px"><br>import java.lang.management.ClassLoadingMXBean;<br style="margin:0px; padding:0px"><br>import java.lang.management.CompilationMXBean;<br style="margin:0px; padding:0px"><br>import java.lang.management.<span id="casearchresult" style="margin:0px; padding:0px; color:black"><span style="margin:0px; padding:0px">ManagementFactory</span>;<br style="margin:0px; padding:0px"><br>import java.lang.management.MemoryMXBean;<br style="margin:0px; padding:0px"><br>import java.lang.management.ThreadMXBean;<br style="margin:0px; padding:0px"><br>import java.lang.management.RuntimeMXBean;<br style="margin:0px; padding:0px"><br>import java.lang.management.OperatingSystemMXBean;<br style="margin:0px; padding:0px"><br>import java.lang.management.MemoryPoolMXBean;<br style="margin:0px; padding:0px"><br>import java.util.List;<br style="margin:0px; padding:0px"><br><br style="margin:0px; padding:0px"><br>public class JVM {<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; public static void main(String[] args) {<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; //Java 虚拟机线程系统的管理接口 ThreadMXBean<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ThreadMXBean th=(ThreadMXBean)<span id="casearchresult" style="margin:0px; padding:0px"><span style="margin:0px; padding:0px">ManagementFactory</span>.getThreadMXBean() ;<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; System.out.println(&quot;活动线程的当前数目&quot;&#43;th.getThreadCount());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; System.out.println(&quot;返回活动守护线程的当前数目&quot;&#43;th.getDaemonThreadCount());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; System.out.println(&quot;Java 虚拟机启动或峰&#20540;重置以来峰&#20540;活动线程计数&quot;&#43;th.getPeakThreadCount());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; System.out.println(&quot;返回当前线程的总 CPU 时间&quot;&#43;th.getCurrentThreadUserTime());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; System.out.println(&quot;当前线程在用户模式中执行的 CPU 时间&quot;&#43;th.getCurrentThreadUserTime());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; //Java 虚拟机的运行时系统的管理接口。 RuntimeMXBean<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; RuntimeMXBean run=(RuntimeMXBean)<span id="casearchresult" style="margin:0px; padding:0px"><span style="margin:0px; padding:0px">ManagementFactory</span>.getRuntimeMXBean();<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; System.out.println(&quot;正在运行的 Java 虚拟机的名称&quot;&#43;run.getName());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; System.out.println(&quot;Java 虚拟机规范名称&quot;&#43;run.getSpecName());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; System.out.println(&quot;返回 Java 库路径&quot;&#43;run.getLibraryPath());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; System.out.println(&quot;系统类加载器用于搜索类文件的 Java 类路径&quot;&#43;run.getClassPath());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; //用于操作系统的管理接口，Java 虚拟机在此操作系统上运行 OperatingSystemMXBean<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; OperatingSystemMXBean op=(OperatingSystemMXBean)<span id="casearchresult" style="margin:0px; padding:0px"><span style="margin:0px; padding:0px">ManagementFactory</span>.getOperatingSystemMXBean();<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; System.out.println(&quot;返回操作系统的架构&quot;&#43;op.getArch());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; System.out.println(&quot;返回操作系统名称&quot;&#43;op.getName());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; System.out.println(&quot;返回操作系统的版本&quot;&#43;op.getVersion());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; System.out.println(&quot;Java 虚拟机可以使用的处理器数目&quot;&#43;op.getAvailableProcessors());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; //内存池的管理接口。内存池表示由 Java 虚拟机管理的内存资源，<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; //由一个或多个内存管理器对内存池进行管理 MemoryPoolMXBean<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;List&lt;MemoryPoolMXBean&gt; list=<span id="casearchresult" style="margin:0px; padding:0px"><span style="margin:0px; padding:0px">ManagementFactory</span>.getMemoryPoolMXBeans();<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for(MemoryPoolMXBean mem:list){<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; System.out.println(&quot;Java 虚拟机启动以来或自峰&#20540;重置以来此内存池的峰&#20540;内存使用量&quot;&#43;mem.getPeakUsage());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(&quot;返回此内存池的类型&quot;&#43;mem.getType());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; System.out.println(&quot;内存使用量超过其阈&#20540;的次数&quot;&#43; mem.getUsage());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//Java 虚拟机内存系统的管理接口。 MemoryMXBean<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;MemoryMXBean mem=(MemoryMXBean)<span id="casearchresult" style="margin:0px; padding:0px"><span style="margin:0px; padding:0px">ManagementFactory</span>.getMemoryMXBean();<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;System.out.println(&quot; 返回用于对象分配的堆的当前内存使用量&quot;&#43;mem.getHeapMemoryUsage());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;System.out.println(&quot;Java 虚拟机使用的非堆内存的当前内存使用量&quot;&#43;mem.getNonHeapMemoryUsage());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// Java 虚拟机的编译系统的管理接口 CompilationMXBean<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;CompilationMXBean com=(CompilationMXBean)<span id="casearchresult" style="margin:0px; padding:0px"><span style="margin:0px; padding:0px">ManagementFactory</span>.getCompilationMXBean();<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;System.out.println(&quot;即时 (JIT) 编译器的名称&quot;&#43;com.getName());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;System.out.println(&quot;在编译上花费的累积耗费时间的近&#20284;&#20540;(毫秒)&quot;&#43;com.getTotalCompilationTime());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//Java 虚拟机的类加载系统的管理接口 ClassLoadingMXBean<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ClassLoadingMXBean cl=(ClassLoadingMXBean)<span id="casearchresult" style="margin:0px; padding:0px"><span style="margin:0px; padding:0px">ManagementFactory</span>.getClassLoadingMXBean();<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;System.out.println(&quot;当前加载到 Java 虚拟机中的类的数量&quot;&#43;cl.getLoadedClassCount());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;System.out.println(&quot;Java 虚拟机开始执行到目前已经加载的类的总数&quot;&#43;cl.getTotalLoadedClassCount());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;System.out.println(&quot;Java 虚拟机开始执行到目前已经卸载的类的总数&quot;&#43;cl.getUnloadedClassCount());<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<br style="margin:0px; padding:0px"><br>&nbsp;&nbsp;&nbsp; }<br style="margin:0px; padding:0px"><br><br style="margin:0px; padding:0px"><br>}</span></span></span></span></span></span></span></span></span></span></p><br><p style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:21px; background-color:rgb(199,237,204)"><br><br style="margin:0px; padding:0px"><br></p><br><div class="dp-highlighter bg_java" style="padding:0px; font-family:Consolas,'Courier New',Courier,mono,serif; overflow:auto; word-break:break-word; margin:18px 0px!important; background-color:rgb(199,237,204)"><br><ol class="dp-j" start="1" style="padding-left:40px; border:none; color:rgb(92,92,92); margin:0px 0px 1px 45px!important; padding-top:0px!important; padding-right:0px!important; padding-bottom:0px!important; background-color:rgb(255,255,255)"><br><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">class&nbsp;TestExcho&nbsp;{&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">/<em>*&nbsp;</em></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">&nbsp;&nbsp;@param&nbsp;args&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br><span class="comment" style="margin:0px; padding:0px; border:none; color:rgb(0,130,0); background-color:inherit">&nbsp;*/&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br><span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">public&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">static&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">void&nbsp;main(String[]&nbsp;args)&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">throws&nbsp;Exception{&nbsp;&nbsp;</span></span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MBeanServer&nbsp;server&nbsp;=&nbsp;ManagementFactory.getPlatformMBeanServer();&nbsp;&nbsp;</li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ObjectName&nbsp;name&nbsp;=&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">new&nbsp;ObjectName(<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;com.demo.mbean:type=Excho&quot;);&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Echo&nbsp;ei&nbsp;=<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">new&nbsp;Echo();&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.registerMBean(ei,name);&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.invoke(name,&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;setName&quot;,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">new&nbsp;Object[]&nbsp;{&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;jack&quot;},&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit">new&nbsp;String[]&nbsp;{<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;java.lang.String&quot;});&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span></span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.invoke(name,&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;showName&quot;,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">null,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">null);&nbsp;&nbsp;</span></span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;yourName&nbsp;=&nbsp;(String)server.invoke(name,&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;fetchName&quot;,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">new&nbsp;Object[]&nbsp;{&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;mimi&quot;,<span class="number" style="margin:0px; padding:0px; border:none; color:rgb(0,0,0); background-color:inherit">10},&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); background-color:inherit">new&nbsp;String[]&nbsp;{<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;java.lang.String&quot;,<span class="string" style="margin:0px; padding:0px; border:none; background-color:inherit">&quot;int&quot;});&nbsp;&nbsp;</span></span></span></span></span></span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;<del>~&quot;&#43;yourName);&nbsp;&nbsp;</del></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CompositeData&nbsp;d&nbsp;=&nbsp;&nbsp;(CompositeData)&nbsp;server.invoke(name,&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;fetchConfig&quot;,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">null,&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; background-color:inherit">null);&nbsp;&nbsp;</span></span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;fn&nbsp;=&nbsp;(String)d.get(<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;firstName&quot;);&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;ln&nbsp;=&nbsp;(String)d.get(<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;lastName&quot;);&nbsp;&nbsp;</span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;~@@@&quot;&#43;fn&#43;<span class="string" style="margin:0px; padding:0px; border:none; background-color:inherit">&quot;@@&quot;&#43;ln);&nbsp;&nbsp;</span></span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px; padding:0px; border:none; color:rgb(0,102,153); font-weight:bold; background-color:inherit">int&nbsp;num&nbsp;=&nbsp;(Integer)server.getAttribute(name,&nbsp;<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;Num&quot;);&nbsp;&nbsp;</span></span></li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="string" style="margin:0px; padding:0px; border:none; color:blue; background-color:inherit">&quot;~OOOOO~~&quot;&#43;num);&nbsp;&nbsp;</span></li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>&nbsp;&nbsp;&nbsp;&nbsp;Thread.currentThread().sleep(Integer.MAX_VALUE);&nbsp;&nbsp;</li><li class="alt" style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); color:inherit; line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important"><br>}&nbsp;&nbsp;</li><li style="list-style:decimal outside; border-style:none none none solid; border-left-width:3px; border-left-color:rgb(108,226,108); line-height:1.6; margin:0px!important; padding:0px 3px 0px 10px!important; background-color:rgb(248,248,248)"><br>}&nbsp;</li></ol><br></div>

<p></p></div><p></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/06/01/exception-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/01/exception-01/" itemprop="url">转载:SpringMVC对异常进行全局处理,并区分对待ajax和普通请求</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-01T15:19:35+08:00">
                2017-06-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
             <div class="article_body" id="nei"><br>            <div><br>  <p><br>    异常信息应统一进行处理. 程序员开发过程中,应尽量少用try..catch.避免因为catch造成的业务歧义.    <br><br>    而在web开发中,普通的页面提交动作,和ajax提交动作,处理方式不一样,因为跳转后直接显示响应数据,而ajax是通过error回调函数进行处理.  </p><br>  <p><br>    这里的处理思路,适用springmvc和struts2. 只是叫法不一样,一个是    <span>HandlerExceptionResolver</span><br>    ,一个是exceptioninterceptor.  </p><br>  <p>下面是部分摘要,体现一下思路</p><br>  <p>首先定义异常拦截器:</p><br>  <div><br>    <pre class="prettyprint"><span style="color: #000000;">@Component<br></span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> MyExceptionHandler implements HandlerExceptionResolver {<br>    </span><span style="color: #0000ff;">protected</span> Log log = LogFactory.getLog(<span style="color: #0000ff;">this</span><span style="color: #000000;">.getClass());<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> ModelAndView resolveException(HttpServletRequest request,<br>            HttpServletResponse response, Object handler, Exception ex) {<br>        log.error(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">异常捕获</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">, ex);<br>        String requestURI </span>=<span style="color: #000000;"> request.getRequestURI();<br>        String fileExtName </span>=<span style="color: #000000;"> StringUtils.getFileExtName(requestURI);<br>        boolean isajax </span>= <span style="color: #800000;">&quot;</span><span style="color: #800000;">ajax</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">.equals(fileExtName);<br>        Throwable parseException </span>=<span style="color: #000000;"> parseException(ex);<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> ExceptionHandlerFactory.createExceptionhandler(parseException)<br>                .resolveException(request, response, handler, parseException, isajax);<br>    }<br>　　//这里要获取到最内层的异常<br>    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> Throwable parseException(Throwable e){<br>        Throwable tmp </span>=<span style="color: #000000;"> e;<br>        </span><span style="color: #0000ff;">int</span> breakPoint = <span style="color: #800080;">0</span><span style="color: #000000;">;<br>        </span><span style="color: #0000ff;">while</span>(tmp.getCause()!=<span style="color: #0000ff;">null</span><span style="color: #000000;">){<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;">(tmp.equals(tmp.getCause())){<br>                </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br>            }<br>            tmp</span>=<span style="color: #000000;">tmp.getCause();<br>            breakPoint</span>++<span style="color: #000000;">;<br>            </span><span style="color: #0000ff;">if</span>(breakPoint&gt;<span style="color: #800080;">1000</span><span style="color: #000000;">){<br>                </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br>            }<br>        }<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> tmp;<br>    }<br>}</span></pre><br>  </div><br>  <p><br>    然后是    <span>ExceptionHandlerFactory</span><br>    主要是用于生成 异常处理的具体类型  </p><br>  <div><br>    <pre class="prettyprint"><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ExceptionHandlerFactory {<br><br>    </span><span style="color: #008000;">/<em></em></span><span style="color: #008000;"><br>     <em>  外挂的自定义处理器,用于外部扩展<br>     </em></span><span style="color: #008000;">/</span><br>    <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span>  Map&lt;String , ExceptionHandler&gt; handlerList = <span style="color: #0000ff;">null</span><span style="color: #000000;">;<br><br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> ExceptionHandler createExceptionhandler(Throwable ex){<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">这个是自定义的接口</span><br>        ExceptionHandler exceptionHandler=<span style="color: #0000ff;">null</span><span style="color: #000000;">;<br>        String packageName</span>=ExceptionHandlerFactory.<span style="color: #0000ff;">class</span>.getName().replace(ExceptionHandlerFactory.<span style="color: #0000ff;">class</span>.getSimpleName(), <span style="color: #800000;">&quot;&quot;</span><span style="color: #000000;">);<br>        String className </span>=<span style="color: #000000;"> ex.getClass().getSimpleName();<br>        String classFullName </span>=<span style="color: #000000;"> ex.getClass().getName();<br><br>        </span><span style="color: #0000ff;">if</span>(handlerList==<span style="color: #0000ff;">null</span><span style="color: #000000;">){<br>            handlerList </span>= <span style="color: #0000ff;">new</span> HashMap&lt;String, ExceptionHandler&gt;<span style="color: #000000;">();<br>        }<br>        </span><span style="color: #0000ff;">if</span><span style="color: #000000;">(handlerList.containsKey(classFullName)){<br>            </span><span style="color: #0000ff;">return</span> handlerList.<span style="color: #0000ff;">get</span><span style="color: #000000;">(classFullName);<br>        }<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">能走到这边,说明自定义的没有生效,走过之后,下面会将他缓存,也就是说,自定义的优先级永远大过系统自带的</span><br>        <span style="color: #0000ff;">try</span><span style="color: #000000;"> {<br>　　　　　　　　//这里查找系统自带的,按照捕获的异常名称+ Handler进行查找,算是简单约定,因为框架开发中的内置我可以约定,扩展的使用配置文件进行<br>            exceptionHandler </span>= (ExceptionHandler)Class.forName(packageName+ className+<span style="color: #800000;">&quot;</span><span style="color: #800000;">Handler</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">).newInstance();<br>        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {<br>            e.printStackTrace();<br>        }<br>        </span><span style="color: #0000ff;">if</span>(exceptionHandler==<span style="color: #0000ff;">null</span><span style="color: #000000;">){<br>            exceptionHandler </span>=  <span style="color: #0000ff;">new</span><span style="color: #000000;"> SimpleExceptionHandler();<br>        }<br>        handlerList.put(classFullName, exceptionHandler);<br><br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> exceptionHandler;<br>    }<br><br>    </span><span style="color: #0000ff;">public</span> Map&lt;String, ExceptionHandler&gt;<span style="color: #000000;"> getHandlerList() {<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> handlerList;<br>    }<br>　　//这里有getset,用于spring注入<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> setHandlerList(Map&lt;String, ExceptionHandler&gt;<span style="color: #000000;"> handlerList) {<br>        ExceptionHandlerFactory.handlerList </span>=<span style="color: #000000;"> handlerList;<br>    }<br><br><br><br><br><br><br>}</span></pre><br>  </div><br>  <p>最后书写一个用于验证异常的处理类型</p><br>  <div><br>    <pre class="prettyprint"><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ConstraintViolationExceptionHandler  extends <strong>BaseExceptionHandler</strong>{<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> Object processException(HttpServletRequest request,<br>            HttpServletResponse response, Object handler, Throwable ex,<br>            boolean isajax) {<br>        ConstraintViolationException e</span>=<span style="color: #000000;">(ConstraintViolationException)ex;<br>        Set</span>&lt;ConstraintViolation&lt;?&gt;&gt; constraintViolations =<span style="color: #000000;"> e.getConstraintViolations();<br> 　　　　　　//ValidateInfo包含当前出错的字段,错误信息,出错的字段所在的类型,等必要的信息<br>　　　　　　　// 在ajax特别是ajaxForm的提交中,只要前端约定好了命名规则,就可以根据返回的信息,进行界面提示,比如可渲染成和validate一样的风格<br>　　　　　　// 也可以给出一个dialog提示,或者……<br><br>         List</span>&lt;ValidateInfo&gt; validateInfos =<span style="color: #0000ff;">new</span> ArrayList&lt;ValidateInfo&gt;<span style="color: #000000;">();<br>         </span><span style="color: #0000ff;">if</span>(constraintViolations!=<span style="color: #0000ff;">null</span> &amp;&amp; !<span style="color: #000000;">constraintViolations.isEmpty()){<br>            </span><span style="color: #0000ff;">for</span>(ConstraintViolation&lt;?&gt;<span style="color: #000000;"> violation : constraintViolations){<br>                ValidateInfo info </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> ValidateInfo();<br>                info.setField(violation.getPropertyPath().toString().replaceAll(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">\.</span><span style="color: #800000;">&quot;</span>,<span style="color: #800000;">&quot;</span><span style="color: #800000;">_</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">));<br>                info.setMessage(violation.getMessage());<br>                Class</span>&lt;? extends Object&gt; class1 =<span style="color: #000000;"> violation.getRootBean().getClass();<br>                String simpleName </span>=<span style="color: #000000;">StringUtils.getSpringName(class1);<br>                </span><span style="color: #0000ff;">if</span>(simpleName.indexOf(<span style="color: #800000;">&quot;</span><span style="color: #800000;">$pcsubclass</span><span style="color: #800000;">&quot;</span>)&gt;-<span style="color: #800080;">1</span><span style="color: #000000;">){  //这个判断是openjpa的代理类型,带$的不光是代理类型,内部类的名称同样有,所以编码上要约束<br>                     String[] ss </span>= simpleName.split(<span style="color: #800000;">&quot;</span><span style="color: #800000;">\$</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br>                     </span><span style="color: #0000ff;">if</span>(ss.length&gt;<span style="color: #800080;">1</span><span style="color: #000000;">){<br>                         simpleName </span>= ss[ss.length-<span style="color: #800080;">2</span><span style="color: #000000;">];<br>                         simpleName </span>= simpleName.substring(<span style="color: #800080;">0</span>,<span style="color: #800080;">1</span>).toLowerCase()+simpleName.substring(<span style="color: #800080;">1</span><span style="color: #000000;">);<br>                     }<br>                }<br><br>                info.setClassName(simpleName);<br>                Object ov </span>=<span style="color: #000000;">violation.getInvalidValue();<br>                </span><span style="color: #0000ff;">if</span>(ov==<span style="color: #0000ff;">null</span><span style="color: #000000;">){<br>                    info.setCurrentValue(</span><span style="color: #800000;">&quot;&quot;</span><span style="color: #000000;">);<br>                }</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{<br>                    info.setCurrentValue(ov.toString());<br>                }<br><br>                validateInfos.add(info);<br>            }<br><br>         }<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> validateInfos; //返回经过封装的验证信息,用于jquery ajax error回调方法进行统一处理<br>    }<br>}</span></pre><br>  </div><br>  <p><br>    而    <span><br>      <strong>BaseExceptionHandler</strong><br>    </span><br>    只是对最后响应代码做一个判断  </p><br>  <div><br>    <pre class="prettyprint"><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> BaseExceptionHandler implements ExceptionHandler{<br><br>    </span><span style="color: #008000;">/<em></em></span><span style="color: #008000;"><br>     <em> 用于传递到页面的值<br>     </em></span><span style="color: #008000;">/</span><br>    <span style="color: #0000ff;">protected</span> Map&lt;String, Object&gt; data = <span style="color: #0000ff;">new</span> HashMap&lt;String, Object&gt;<span style="color: #000000;">();<br><br>    </span><span style="color: #008000;">/<em></em></span><span style="color: #008000;"><br>     <em> 写到输出流<br>     </em></span><span style="color: #008000;">/</span><br>    <span style="color: #0000ff;">protected</span><span style="color: #000000;"> ModelAndView write(HttpServletRequest request,<br>            HttpServletResponse response, Object handler, Throwable ex,<br>            boolean isajax,Object dt){<br>        </span><span style="color: #0000ff;">int</span> responseCode=<span style="color: #800080;">500</span><span style="color: #000000;">;<br>        </span><span style="color: #0000ff;">if</span><span style="color: #000000;">(ex instanceof BaseRuntimeException){<br>            responseCode</span>=<span style="color: #000000;">((BaseRuntimeException)ex).getResponseCode();<br>        }<br>        </span><span style="color: #0000ff;">if</span><span style="color: #000000;">(ex instanceof ConstraintViolationException){<br>            responseCode</span>=<span style="color: #800080;">5001</span><span style="color: #000000;">;<br>        }<br>        response.setStatus(responseCode);<br>        </span><span style="color: #0000ff;">if</span>(!isajax){<span style="color: #008000;">//</span><span style="color: #008000;">非ajax,直接跳转的,这里的是否ajax很简单,我们约定,ajax请求全部使用.ajax扩展.当然通过httpheader也能,jquery还支持preFilter,可以在这里统一加参数</span><br>            ModelAndView modelAndView = <span style="color: #0000ff;">new</span> ModelAndView(<span style="color: #800000;">&quot;</span><span style="color: #800000;">/error/error</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">);<br>            modelAndView.addObject(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;"><strong>exception</strong></span><span style="color: #800000;">&quot;</span><span style="color: #000000;">, ex);<br>            modelAndView.addAllObjects(data);<br>            </span><span style="color: #0000ff;">if</span>(dt!=<span style="color: #0000ff;">null</span><span style="color: #000000;">){<br>            modelAndView.addObject(dt);<br>            }<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> modelAndView;<br>        }<br>        //这个是封装的标准返回值模版,包含相应code,错误信息和响应数据等字段<br>        ResultTemplate createFailResult </span>=<span style="color: #000000;"> ResultTemplate.createFailResult(ex.getMessage());<br>        createFailResult.setData(dt);<br>        WebUtils.renderJson(createFailResult);<br>        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;<br>    }<br><br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span><span style="color: #000000;"> Object processException(HttpServletRequest request,<br>            HttpServletResponse response, Object handler, Throwable ex,<br>            boolean isajax);<br><br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> ModelAndView resolveException(HttpServletRequest request,<br>            HttpServletResponse response, Object handler, Throwable ex,<br>            boolean isajax) {<br>        Object d </span>=<span style="color: #000000;"> processException(request,  response,   handler,   ex,  isajax);<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> write(request,<br>                  response,   handler,   ex,<br>                  isajax,d);<br>    }<br><br><br><br>}</span></pre><br>  </div><br>  <p>xml 配置</p><br>  <div><br>    <pre class="prettyprint"><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">=&quot;com.core.web.interceptor.exceptionhandler.ExceptionHandlerFactory&quot;</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=&quot;handlerList&quot;</span><span style="color: #0000ff;">&gt;</span><br>                     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">map</span><span style="color: #0000ff;">&gt;</span><br>                         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">entry </span><span style="color: #ff0000;">key</span><span style="color: #0000ff;">=&quot;javax.validation.ConstraintViolationException&quot;</span> <span style="color: #0000ff;">&gt;</span> <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> jpa验证异常,这里可以不配置,系统内置,也可以配置自己的,替换系统自带的 </span><span style="color: #008000;">–&gt;</span><br>                          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">=&quot;com.core.web.interceptor.exceptionhandler.ConstraintViolationExceptionHandler&quot;</span><span style="color: #0000ff;">/&gt;</span><br>                         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">entry</span><span style="color: #0000ff;">&gt;</span><br><br>                     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">map</span><span style="color: #0000ff;">&gt;</span><br>             <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span></pre><br>  </div><br></div>
</div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/06/01/guavaCache-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/01/guavaCache-01/" itemprop="url">转载:Guava Cache高速本地缓存</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-01T15:03:48+08:00">
                2017-06-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <div class="post_content"><br>      <p><a href="http://code.google.com/p/guava-libraries/wiki/CachesExplained" target="_blank">原文地址</a>  <a href="http://ifeve.com/google-guava-cachesexplained/" target="_blank">译文地址</a>    译者：许巧辉  校对：沈义扬</p><br><h2>范例</h2><br><pre class="brush: java; title: ; notranslate" title=""><br>LoadingCache&lt;Key, Graph&gt; graphs = CacheBuilder.newBuilder()<br>        .maximumSize(1000)<br>        .expireAfterWrite(10, TimeUnit.MINUTES)<br>        .removalListener(MY_LISTENER)<br>        .build(<br>            new CacheLoader&lt;Key, Graph&gt;() {<br>                public Graph load(Key key) throws AnyException {<br>                    return createExpensiveGraph(key);<br>                }<br>        });<br></pre><br><p><span id="more-8711"></span></p><br><h2>适用性</h2><br><p>缓存在很多场景下都是相当有用的。例如，计算或检索一个值的代价很高，并且对同样的输入需要不止一次获取值的时候，就应当考虑使用缓存。</p><br><p align="left"><tt></tt><tt>Guava Cache与ConcurrentMap很相似，但也不完全一样。最基本的区别是ConcurrentMap会一直保存所有添加的元素，直到显式地移除。相对地，Guava Cache为了限制内存占用，通常都设定为自动回收元素。在某些场景下，尽管LoadingCache 不回收元素，它也是很有用的，因为它会自动加载缓存。</tt></p><br><p><tt>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/06/01/guavaCache-01/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/05/23/jvm-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/23/jvm-03/" itemprop="url">转载:03-jvm中堆栈以及内存区域分配</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-23T14:45:12+08:00">
                2017-05-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post"><br><br><p><span style="white-space:pre"></span>堆栈这个概念存在于数据结构中，也存在于jvm虚拟机中，在这两个环境中是截然不同的意思。</p><br><p><span style="white-space:pre"></span>在数据结构中，堆栈是：堆 和栈两种数据结构，堆是完全二叉树，堆中各元素是有序的。在这个二叉树中所有的双亲节点和孩子节点存在着大小关系，如所有的双亲节点都大于孩子节点则 为大头堆，如果所有的双亲节点都小于其孩子节点说明这是一个小头堆，建堆的过程就是一个排序的过程，堆得查询效率也很高。栈是一种先进后出的线性表。</p><br><p><span style="white-space:pre"></span>在jvm虚拟机中得堆栈对应内存的不同区域，和数据结构中所说的堆栈是两码事。</p><br><p><span style="white-space:pre"></span>下面介绍jvm中得堆栈以及jvm内存分配：</p><br><p><span style="color:rgb(54,54,54); font-family:微软雅黑,Arial,Verdana,sans-serif; background-color:rgb(212,212,212)"></span></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">JVM的体系结构如下：</span></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br>如下图所示，JVM的体系结构包含几个主要的子系统和内存区：</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">类装载子系统</span>&nbsp;，负责把类从文件系统中装入内存</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">GC子系统</span>&nbsp;，垃圾收集器的主要工作室自动回收不再运行的程序引用对象所占用的内存，此外，它还可能负责那些还在使用的对象，以减少的堆碎片。</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">内存区</span>&nbsp;，用于存储字节码，程序运行时创建的对象，传递给方法的参数，返回&#20540;，局部变量和中间计算结果。</p><br><div class="blog_content" style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">执行引擎：&nbsp;</span><br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>1、最简单的：一次性解释字节码。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>2、快，但消耗内存的：“即时编译器”，第一次被执行的字节码会被编译成机器代码，放入缓存，以后调用可以重用。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>3、自适应优化器，虚拟机开始的时候会解释字节码，但是会监视运行中程序的活动，并记录下使用最频繁的代码段。程序运行的时候，虚拟机只把使用最频繁的代码编译成本地代码，其他的代码由于使用的并不频繁，继续保留为字节码–由虚拟机继续解释他们。一般可以使java虚拟机80%~90%的时间里执行被优化过的本地代码，只需要编译10%~20%对性能优影响的代码。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>4、由硬件芯片组成，他用本地方法执行java字节码，这种执行引擎实际上是内嵌在芯片里的。</div><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><img src="http://i.imgur.com/ETKsm.jpg" alt="" width="500" height="390" style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:medium; border-right-width:medium; border-bottom-width:medium; border-left-width:medium; border-top-style:none; border-right-style:none; border-bottom-style:none; border-left-style:none; border-color:initial; vertical-align:middle"></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">2. Java的内存分配</span></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br>在Java程序运行过程中，JVM定义了各种区域用于存储运行时数据。其中的有些数据区域在JVM启动时创建，并只在JVM退出时销毁。其它的数据区域与每个线程相关。这些数据区域，在线程创建时创建，在线程退出时销毁。</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">2.1 程序计数器寄存器（The&nbsp;<code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">pc</code>&nbsp;Register）</span></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br>JVM支持多个线程同时运行。每个JVM都有自己的程序计数器。在任何一个点，每个JVM线程执行单个方法的代码，这个方法是线程的当前方法。如果方法不是native的，程序计数器寄存器包含了当前执行的JVM指令的地址，如果方法是 native的，程序计数器寄存器的&#20540;不会被定义。 JVM的程序计数器寄存器的宽度足够保证可以持有一个返回地址或者native的指针。</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">2.2 栈</span></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">1）栈与线程</span></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br>JVM是基于栈的虚拟机.JVM为每个新创建的线程都分配一个栈.也就是说,对于一个Java程序来说，它的运行就是通过对栈的操作来完成的。栈以帧为单位保存线程的状态。JVM对栈只进行两种操作:以帧为单位的压栈和出栈操作。</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br>我们知道,某个线程正在执行的方法称为此线程的当前方法.我们可能不知道,当前方法使用的帧称为当前帧。当线程激活一个Java方法,JVM就会在线程的 Java堆栈里新压入一个帧。这个帧自然成为了当前帧.在此方法执行期间,这个帧将用来保存参数,局部变量,中间计算过程和其他数据.这个帧在这里和编译原理中的活动纪录的概念是差不多的.</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br>从Java的这种分配机制来看,堆栈又可以这样理解:栈(Stack)是操作系统在建立某个进程时或者线程(在支持多线程的操作系统中是线程)为这个线程建立的存储区域，该区域具有先进后出的特性。</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">2）栈中的方法调用</span></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">嵌套方法的出栈和入栈示意图：</span></span>&nbsp;</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><img src="http://i.imgur.com/r4BpF.jpg" alt="" width="311" height="425" style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:medium; border-right-width:medium; border-bottom-width:medium; border-left-width:medium; border-top-style:none; border-right-style:none; border-bottom-style:none; border-left-style:none; border-color:initial; vertical-align:middle"></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br>上图中描述了嵌套方法时，stack的内存分配图，由上面可以知道，当嵌套方法调用时，嵌套越深，stack的内存就越晚才能释放，因此，在实际开发过程中，不推荐大家使用递归来进行方法的调用，递归很容易导致stack flow。</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">非嵌套方法的出栈入栈过程：</span></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><img src="http://i.imgur.com/NCQzk.jpg" alt="" width="500" height="325" style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:medium; border-right-width:medium; border-bottom-width:medium; border-left-width:medium; border-top-style:none; border-right-style:none; border-bottom-style:none; border-left-style:none; border-color:initial; vertical-align:middle"></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">2.3 堆</span></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br>每一个Java应用都唯一对应一个JVM实例，每一个实例唯一对应一个堆。应用程序在运行中所创建的所有类实例或数组都放在这个堆中,并由应用所有的线程共享.跟C/C&#43;&#43;不同，Java中分配堆内存是自动初始化的。Java中所有对象的存储空间都是在堆中分配的，但是这个对象的引用却是在堆栈中分配,也就是说在建立一个对象时从两个地方都分配内存，在堆中分配的内存实际建立这个对象，而在堆栈中分配的内存只是一个指向这个堆对象的指针(引用)而已。</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">2.4 堆和栈的区别</span></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">【下面的部分属于摘抄，描述比较好】</span></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">1. 栈(stack)与堆(heap)都是Java用来在Ram中存放数据的地方</span>&nbsp;。与C&#43;&#43;不同，Java自动管理栈和堆，程序员不能直接地设置栈或堆。</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">2. 栈的优势是，存取速度比堆要快</span>&nbsp;，仅次于直接位于CPU中的寄存器。但缺点是，存在栈中的数据大小与生存期必须是确定的，缺乏灵活性。另外，栈数据可以共享，详见第3点。堆的优势是可以动态地分配内存大小，生存期也不必事先告诉编译器，Java的垃圾收集器会自动收走这些不再使用的数据。但缺点是，由于要在运行时动态分配内存，存取速度较慢。</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">3. Java中的数据类型有两种：</span>&nbsp;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">一种是基本类型(primitive types),</span>&nbsp;共有8种，即int, short, long, byte, float, double, boolean, char(注意，并没有string的基本类型)。这种类型的定义是通过诸如int<br> a = 3; long b = 255L;的形式来定义的，称为自动变量。&#20540;得注意的是，自动变量存的是字面&#20540;，不是类的实例，即不是类的引用，这里并没有类的存在。如int a = 3; 这里的a是一个指向int类型的引用，指向3这个字面&#20540;。这些字面&#20540;的数据，由于大小可知，生存期可知(这些字面&#20540;固定定义在某个程序块里面，程序块退出后，字段&#20540;就消失了)，出于追求速度的原因，就存在于栈中。<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>另外，栈有一个很重要的特殊性，就是存在栈中的数据可以共享。假设我们同时定义：&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; int a = 3;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; int b = 3；<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>编译器先处理int a = 3；首先它会在栈中创建一个变量为a的引用，然后查找有没有字面&#20540;为3的地址，没找到，就开辟一个存放3这个字面&#20540;的地址，然后将a指向3的地址。接着处理int b = 3；在创建完b的引用变量后，由于在栈中已经有3这个字面&#20540;，便将b直接指向3的地址。这样，就出现了a与b同时均指向3的情况。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; 特别注意的是，这种字面&#20540;的引用与类对象的引用不同。假定两个类对象的引用同时指向一个对象，如果一个对象引用变量修改了这个对象的内部状态，那么另一个对象引用变量也即刻反映出这个变化。相反，通过字面&#20540;的引用来修改其&#20540;，不会导致另一个指向此字面&#20540;的引用的&#20540;也跟着改变的情况。如上例，我们定义完a与b的&#20540;后，再令a=4；那么，b不会等于4，还是等于3。在编译器内部，遇到a=4；时，它就会重新搜索栈中是否有4的字面&#20540;，如果没有，重新开辟地址存放4的&#20540;；如果已经有了，则直接将a指向这个地址。因此a&#20540;的改变不会影响到b的&#20540;。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp;&nbsp;<span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">另一种是包装类数据</span>&nbsp;，如Integer, String, Double等将相应的基本数据类型包装起来的类。这些类数据全部存在于堆中，Java用new()语句来显示地告诉编译器，在运行时才根据需要动态创建，因此比较灵活，但缺点是要占用更多的时间。</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">4. String是一个特殊的包装类数据</span>&nbsp;。即可以用String str = new String(&quot;abc&quot;);的形式来创建，也可以用String str = &quot;abc&quot;；的形式来创建(作为对比，在JDK<br> 5.0之前，你从未见过Integer i = 3;的表达式，因为类与字面&#20540;是不能通用的，除了String。而在JDK 5.0中，这种表达式是可以的！因为编译器在后台进行Integer i = new Integer(3)的转换)。前者是规范的类的创建过程，即在Java中，一切都是对象，而对象是类的实例，全部通过new()的形式来创建。Java中的有些类，如DateFormat类，可以通过该类的getInstance()方法来返回一个新创建的类，&#20284;乎违反了此原则。其实不然。该类运用了单例模式来返回类的实例，只不过这个实例是在该类内部通过new()来创建的，而getInstance()向外部隐藏了此细节。那为什么在String<br> str = &quot;abc&quot;；中，并没有通过new()来创建实例，是不是违反了上述原则？其实没有。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>5. 关于String str = &quot;abc&quot;的内部工作。<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>Java内部将此语句转化为以下几个步骤：&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>(1)先定义一个名为str的对String类的对象引用变量：String str；&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>(2)在栈中查找有没有存放&#20540;为&quot;abc&quot;的地址，如果没有，则开辟一个存放字面&#20540;为&quot;abc&quot;的地址，接着创建一个新的String类的对象o，并将o的字符串&#20540;指向这个地址，而且在栈中这个地址旁边记下这个引用的对象o。如果已经有了&#20540;为&quot;abc&quot;的地址，则查找对象o，并返回o的地址。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>(3)将str指向对象o的地址。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; &#20540;得注意的是，一般String类中字符串&#20540;都是直接存&#20540;的。但像String str = &quot;abc&quot;；这种场合下，其字符串&#20540;却是保存了一个指向存在栈中数据的引用！&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp;为了更好地说明这个问题，我们可以通过以下的几个代码进行验证。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp;String str1 = &quot;abc&quot;;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp;String str2 = &quot;abc&quot;;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp;System.out.println(str1==str2); //true&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>注意，我们这里并不用str1.equals(str2)；的方式，因为这将比较两个字符串的&#20540;是否相等。“==”号，根据JDK的说明，只有在两个引用都指向了同一个对象时才返回真&#20540;。而我们在这里要看的是，str1与str2是否都指向了同一个对象。结果说明，JVM创建了两个引用str1和str2，但只创建了一个对象，而且两个引用都指向了这个对象。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; 我们再来更进一步，将以上代码改成：&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; String str1 = &quot;abc&quot;;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; String str2 = &quot;abc&quot;;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; str1 = &quot;bcd&quot;;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; System.out.println(str1 &#43; &quot;,&quot; &#43; str2); //bcd, abc&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; System.out.println(str1==str2); //false&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>这就是说，赋&#20540;的变化导致了类对象引用的变化，str1指向了另外一个新对象！而str2仍旧指向原来的对象。上例中，当我们将str1的&#20540;改为&quot;bcd&quot;时，JVM发现在栈中没有存放该&#20540;的地址，便开辟了这个地址，并创建了一个新的对象，其字符串的&#20540;指向这个地址。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>事实上，String类被设计成为不可改变(immutable)的类。如果你要改变其&#20540;，可以，但JVM在运行时根据新&#20540;悄悄创建了一个新对象，然后将这个对象的地址返回给原来类的引用。这个创建过程虽说是完全自动进行的，但它毕竟占用了更多的时间。在对时间要求比较敏感的环境中，会带有一定的不良影响。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; 再修改原来代码：&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; String str1 = &quot;abc&quot;;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; String str2 = &quot;abc&quot;;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; str1 = &quot;bcd&quot;;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; String str3 = str1;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; System.out.println(str3); //bcd&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; String str4 = &quot;bcd&quot;;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; System.out.println(str1 == str4); //true&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>str3这个对象的引用直接指向str1所指向的对象(注意，str3并没有创建新对象)。当str1改完其&#20540;后，再创建一个String的引用str4，并指向因str1修改&#20540;而创建的新的对象。可以发现，这回str4也没有创建新的对象，从而再次实现栈中数据的共享。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; 我们再接着看以下的代码。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; String str1 = new String(&quot;abc&quot;);&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; String str2 = &quot;abc&quot;;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>&nbsp; &nbsp; System.out.println(str1==str2); //false&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>创建了两个引用。创建了两个对象。两个引用分别指向不同的两个对象。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>String str1 = &quot;abc&quot;;&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>String str2 = new String(&quot;abc&quot;);&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>System.out.println(str1==str2); //false&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>创建了两个引用。创建了两个对象。两个引用分别指向不同的两个对象。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>以上两段代码说明，只要是用new()来新建对象的，都会在堆中创建，而且其字符串是单独存&#20540;的，即使与栈中的数据相同，也不会与栈中的数据共享。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>6. 数据类型包装类的&#20540;不可修改。不仅仅是String类的&#20540;不可修改，所有的数据类型包装类都不能更改其内部的&#20540;。<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>7. 结论与建议：<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>(1)我们在使用诸如String str = &quot;abc&quot;；的&#26684;式定义类时，总是想当然地认为，我们创建了String类的对象str。担心陷阱！对象可能并没有被创建！唯一可以肯定的是，指向String类的引用被创建了。至于这个引用到底是否指向了一个新的对象，必须根据上下文来考虑，除非你通过new()方法来显要地创建一个新的对象。因此，更为准确的说法是，我们创建了一个指向String类的对象的引用变量str，这个对象引用变量指向了某个&#20540;为&quot;abc&quot;的String类。清醒地认识到这一点对排除程序中难以发现的bug是很有帮助的。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>(2)使用String str = &quot;abc&quot;；的方式，可以在一定程度上提高程序的运行速度，因为JVM会自动根据栈中数据的实际情况来决定是否有必要创建新对象。而对于String str = new String(&quot;abc&quot;)；的代码，则一概在堆中创建新对象，而不管其字符串&#20540;是否相等，是否有必要创建新对象，从而加重了程序的负担。这个思想应该是享元模式的思想，但JDK的内部在这里实现是否应用了这个模式，不得而知。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>(3)当比较包装类里面的数&#20540;是否相等时，用equals()方法；当测试两个包装类的引用是否指向同一个对象时，用“==”。&nbsp;<br style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px"><br>(4)由于String类的immutable性质，当String变量需要经常变换其&#20540;时，应该考虑使用StringBuffer类，以提高程序效率。</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">2.5 方法区</span></p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br>JVM有一个被所有的线程共享方法区。方法区类&#20284;于传统语言的编译后代码的存储区，或者UNIX进程中的text段。它存储每个类结构例如常量池（constant pool),成员字段域和方法和构造函数，包含类和实例初始化和接口类型类型中用到的特殊方法的代码。</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br>方法区在虚拟机启动时创建。尽管方法区在逻辑上时heap的一部分，简单的实现仍然可以选择对它既不回收也不压缩。</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br>The Java virtual machine has a&nbsp;<span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px">method area</span>&nbsp;that is shared among all Java virtual machine threads.<br> The method area is analogous to the storage area for compiled code of a conventional language or analogous to the &quot;text&quot; segment in a UNIX process. It stores per-class structures such as the runtime constant pool, field and method data, and the code for methods<br> and constructors, including the special methods&nbsp;(§3.9)&nbsp;used in class and instance initialization and interface type initialization.</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><a name="21952" style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; color:rgb(190,7,0); text-decoration:underline"></a>The method area is created on virtual machine<br> start-up. Although the method area is logically part of the heap, simple implementations may choose not to either garbage collect or compact it. This version of the Java virtual machine specification does not mandate the location of the method area or the<br> policies used to manage compiled code. The method area may be of a fixed size or may be expanded as required by the computation and may be contracted if a larger method area becomes unnecessary. The memory for the method area does not need to be contiguous.</p><br><p style="margin-top:1.12em; margin-bottom:1.12em; padding-top:0px; padding-bottom:0px"><br><a name="22992" style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; color:rgb(190,7,0); text-decoration:underline"></a>A Java virtual machine implementation may<br> provide the programmer or the user control over the initial size of the method area, as well as, in the case of a varying-size method area, control over the maximum and minimum method area size.</p><br><p><br><br></p><br><p><span style="color:rgb(51,51,51); font-family:Arial,sans-serif; line-height:16px; background-color:rgb(0,0,0)"></span></p><br><p style="margin-bottom:24px">Java中变量分为静态变量，实例变量，临时变量。那么各种变量具体保存在JVM中的何处呢？</p><br><p style="margin-bottom:24px">1 静态变量：位于方法区。</p><br><p style="margin-bottom:24px">2 实例变量：作为对象的一部分，保存在堆中。</p><br><p style="margin-bottom:24px">3 临时变量：保存于栈中，栈随线程的创建而被分配。</p><br><p style="margin-bottom:24px">注：常量：位于常量池，而常量池位于方法区，若JVM采用的是分代垃圾回收，则方法区就是Perm区（永久存储区）。</p><br><br><br><br></div>


          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/05/23/jvm-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/23/jvm-02/" itemprop="url">转载:02-JVM原理和优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-23T14:42:00+08:00">
                2017-05-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post"><br><br><p>JVM工作原理和特点主要是指操作系统装入JVM是通过jdk中Java.exe来完成,通过下面4步来完成JVM环境. </p><br><p>1.创建JVM装载环境和配置 </p><br><p>2.装载JVM.dll </p><br><p>3.初始化JVM.dll并挂界到JNIENV(JNI调用接口)实例 </p><br><p>4.调用JNIEnv实例装载并处理class类。 </p><br><p></p><br><p>在我们运行和调试Java程序的时候,经常会提到一个JVM的概念.JVM是Java程序运行的环境,但是他同时一个操作系统的一个应用程序一个进程,因此他也有他自己的运行的生命周期,也有自己的代码和数据空间.<br></p><br><p>首先来说一下JVM工作原理中的jdk这个东西,不管你是初学者还是高手,是j2ee程序员还是j2se程序员,jdk总是在帮我们做一些事情.我们在了解Java之前首先大师们会给我们提供说jdk这个东西.它在Java整个体系中充当着什么角色呢?我很惊叹sun大师们设计天才,能把一个如此完整的体系结构化的如此完美.jdk在这个体系中充当一个生产加工中心,产生所有的数据输出,是所有指令和战略的执行中心.本身它提供了Java的完整方案,可以开发目前Java能支持的所有应用和系统程序.这里说一个问题,大家会问,那为什么还有j2me,j2ee这些东西,这两个东西目的很简单,分别用来简化各自领域内的开发和构建过程.jdk除了JVM之外,还有一些核心的API,集成API,用户工具,开发技术,开发工具和API等组成<br></p><br><p>好了,废话说了那么多,来点于主题相关的东西吧.JVM在整个jdk中处于最底层,负责于操作系统的交互,用来屏蔽操作系统环境,提供一个完整的Java运行环境,因此也就虚拟计算机. 操作系统装入JVM是通过jdk中Java.exe来完成,通过下面4步来完成JVM环境.<br></p><br><p>1.创建JVM装载环境和配置 </p><br><p>2.装载JVM.dll </p><br><p>3.初始化JVM.dll并挂界到JNIENV(JNI调用接口)实例 </p><br><p>4.调用JNIEnv实例装载并处理class类。 </p><br><p><strong>一．JVM装入环境，JVM提供的方式是操作系统的动态连接文件．</strong>既然是文件那就一个装入路径的问题，Java是怎么找这个路径的呢？当你在调用Java test的时候，操作系统会在path下在你的Java.exe程序，Java.exe就通过下面一个过程来确定JVM的路径和相关的参数配置了．下面基于Windows的实现的分析．<br></p><br><p>首先查找jre路径，Java是通过GetApplicationHome api来获得当前的Java.exe绝对路径，c:\j2sdk1.4.2_09\bin\Java.exe,那么它会截取到绝对路径c:\j2sdk1.4.2_09\，判断c:\j2sdk1.4.2_09\bin\Java.dll文件是否存在，如果存在就把c:\j2sdk1.4.2_09\作为jre路径，如果不存在则判断c:\j2sdk1.4.2_09\jre\bin\Java.dll是否存在，如果存在这c:\j2sdk1.4.2_09\jre作为jre路径．如果不存在调用GetPublicJREHome查HKEY_LOCAL_MACHINE\Software\JavaSoft\Java<br> Runtime Environment\“当前JRE版本号”\JavaHome的路径为jre路径。 </p><br><p>然后装载JVM.cfg文件JRE路径&#43;\lib&#43;\ARCH（CPU构架）&#43;\JVM.cfgARCH（CPU构架）的判断是通过Java_md.c中GetArch函数判断的，该函数中windows平台只有两种情况：WIN64的‘ia64’，其他情况都为‘i386’。以我的为例：C:\j2sdk1.4.2_09\jre\lib\i386\JVM.cfg.主要的内容如下：<br></p><br><pre><ol class="dp-xml"><li class="alt"><span>-client&nbsp;KNOWN&nbsp; &nbsp;</span></li><li><span>-server&nbsp;KNOWN&nbsp; &nbsp;</span></li><li class="alt"><span>-hotspot&nbsp;ALIASED_TO&nbsp;-client&nbsp; &nbsp;</span></li><li><span>-classic&nbsp;WARN&nbsp; &nbsp;</span></li><li class="alt"><span>-native&nbsp;ERROR&nbsp; &nbsp;</span></li><li><span>-green&nbsp;ERROR&nbsp;&nbsp;</span></li></ol></pre><br><p>在我们的jdk目录中jre\bin\server和jre\bin\client都有JVM.dll文件存在，而Java正是通过JVM.cfg配置文件来管理这些不同版本的JVM.dll的．通过文件我们可以定义目前jdk中支持那些JVM,前面部分（client）是JVM名称，后面是参数，KNOWN表示JVM存在，ALIASED_TO表示给别的JVM取一个别名，WARN表示不存在时找一个JVM替代，ERROR表示不存在抛出异常．在运行Java XXX是，Java.exe会通过CheckJVMType来检查当前的JVM类型，Java可以通过两种参数的方式来指定具体的JVM类型，一种按照JVM.cfg文件中的JVM名称指定，第二种方法是直接指定，它们执行的方法分别是“Java<br> -J”、“Java -XXaltJVM=”或“Java -J-XXaltJVM=”。如果是第一种参数传递方式，CheckJVMType函数会取参数‘-J’后面的JVM名称，然后从已知的JVM配置参数中查找如果找到同名的则去掉该JVM名称前的‘-’直接返回该&#20540;；而第二种方法，会直接返回“-XXaltJVM=”或“-J-XXaltJVM=”后面的JVM类型名称；如果在运行Java时未指定上面两种方法中的任一一种参数，CheckJVMType会取配置文件中第一个配置中的JVM名称，去掉名称前面的‘-’返回该&#20540;。CheckJVMType函数的这个返回&#20540;会在下面的函数中汇同jre路径组合成JVM.dll的绝对路径。如果没有指定这会使用JVM.cfg中第一个定义的JVM.可以通过set<br> _Java_LAUNCHER_DEBUG=1在控制台上测试． </p><br><p>最后获得JVM.dll的路径，JRE路径&#43;\bin&#43;\JVM类型字符串&#43;\JVM.dll就是JVM的文件路径了，但是如果在调用Java程序时用-XXaltJVM=参数指定的路径path,就直接用path&#43;\JVM.dll文件做为JVM.dll的文件路径．<br></p><br><p><strong>二：装载JVM.dll</strong> </p><br><p>通过第一步已经找到了JVM的路径，Java通过LoadJavaVM来装入JVM.dll文件．装入工作很简单就是调用Windows API函数： </p><br><p>LoadLibrary装载JVM.dll动态连接库．然后把JVM.dll中的导出函数JNI_CreateJavaVM和JNI_GetDefaultJavaVMInitArgs挂接到InvocationFunctions变量的CreateJavaVM和GetDefaultJavaVMInitArgs函数指针变量上。JVM.dll的装载工作宣告完成。<br></p><br><p><strong>三：初始化JVM，获得本地调用接口，</strong>这样就可以在Java中调用JVM的函数了．调用InvocationFunctions－&gt;CreateJavaVM也就是JVM中JNI_CreateJavaVM方法获得JNIEnv结构的实例．<br></p><br><p><strong>四：运行Java程序．</strong> </p><br><p>Java程序有两种方式一种是jar包，一种是class. 运行jar,Java -jar XXX.jar运行的时候，Java.exe调用GetMainClassName函数，该函数先获得JNIEnv实例然后调用Java类Java.util.jar.JarFileJNIEnv中方法getManifest()并从返回的Manifest对象中取getAttributes(&quot;Main-Class&quot;)的&#20540;即jar包中文件：META-INF/MANIFEST.MF指定的Main-Class的主类名作为运行的主类。之后main函数会调用Java.c中LoadClass方法装载该主类（使用JNIEnv实例的FindClass）。main函数直接调用Java.c中LoadClass方法装载该类。如果是执行class方法。main函数直接调用Java.c中LoadClass方法装载该类。<br></p><br><p>然后main函数调用JNIEnv实例的GetStaticMethodID方法查找装载的class主类中 </p><br><p>“public static void main(String[] args)”方法，并判断该方法是否为public方法，然后调用JNIEnv实例的 </p><br><p>CallStaticVoidMethod方法调用该Java类的main方法。&nbsp; </p><br><p style="padding-bottom:2px; line-height:normal; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial,Verdana,sans-serif; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; line-height:normal; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial,Verdana,sans-serif; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; line-height:normal; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial,Verdana,sans-serif; padding-top:2px"><br>以下转自：<a target="_blank" href="http://blog.csdn.net/cnhzgb/article/details/7179419">http://blog.csdn.net/cnhzgb/article/details/7179419</a><span style="font-size:24px"><strong></strong></span></p><br><p style="padding-bottom:2px; line-height:normal; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial,Verdana,sans-serif; padding-top:2px"><br><span style="font-size:24px"><strong>= GC 基础 =====================</strong></span></p><br><p style="padding-bottom:2px; line-height:normal; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial,Verdana,sans-serif; font-size:12px; padding-top:2px"><br><br><br></p><br><p style="padding-bottom:2px; line-height:normal; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial,Verdana,sans-serif; font-size:12px; padding-top:2px"><br>JAVA堆的描述如下：</p><br><p style="padding-bottom:2px; line-height:normal; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial,Verdana,sans-serif; font-size:12px; padding-top:2px"><br><img alt="" src="http://hi.csdn.net/attachment/201201/6/0_1325814932X3Ts.gif"><br style="line-height:normal"><br>内存由 Perm 和 Heap 组成. 其中<br><br>Heap = {Old &#43; NEW = { Eden , from, to } }<br><br>JVM内存模型中分两大块，一块是 NEW Generation, 另一块是Old Generation. 在New Generation中，有一个叫Eden的空间，主要是用来存放新生的对象，还有两个Survivor Spaces（from,to）, 它们用来存放每次垃圾回收后存活下来的对象。在Old Generation中，主要存放应用程序中生命周期长的内存对象，还有个Permanent Generation，主要用来放JVM自己的反射对象，比如类对象和方法对象等。<br><br>垃圾回收描述：<br><br>在New Generation块中，垃圾回收一般用Copying的算法，速度快。每次GC的时候，存活下来的对象首先由Eden拷贝到某个Survivor Space, 当Survivor Space空间满了后, 剩下的live对象就被直接拷贝到Old Generation中去。因此，每次GC后，Eden内存块会被清空。在Old Generation块中，垃圾回收一般用mark-compact的算法，速度慢些，但减少内存要求.<br><br>垃圾回收分多级，0级为全部(Full)的垃圾回收，会回收OLD段中的垃圾；1级或以上为部分垃圾回收，只会回收NEW中的垃圾，内存溢出通常发生于OLD段或Perm段垃圾回收后，仍然无内存空间容纳新的Java对象的情况。<br><br><br><br><br><br>当一个URL被访问时，内存申请过程如下：<br><br>A. JVM会试图为相关Java对象在Eden中初始化一块内存区域<br><br>B. 当Eden空间足够时，内存申请结束。否则到下一步<br><br>C. JVM试图释放在Eden中所有不活跃的对象（这属于1或更高级的垃圾回收）, 释放后若Eden空间仍然不足以放入新对象，则试图将部分Eden中活跃对象放入Survivor区<br><br>D. Survivor区被用来作为Eden及OLD的中间交换区域，当OLD区空间足够时，Survivor区的对象会被移到Old区，否则会被保留在Survivor区<br><br>E. 当OLD区空间不够时，JVM会在OLD区进行完全的垃圾收集（0级）<br><br>F. 完全垃圾收集后，若Survivor及OLD区仍然无法存放从Eden复制过来的部分对象，导致JVM无法在Eden区为新对象创建内存区域，则出现”out of memory错误”<br><br>JVM调优建议:<br><br>ms/mx：定义YOUNG&#43;OLD段的总尺寸，ms为JVM启动时YOUNG&#43;OLD的内存大小；mx为最大可占用的YOUNG&#43;OLD内存大小。在用户生产环境上一般将这两个&#20540;设为相同，以减少运行期间系统在内存申请上所花的开销。<br><br>NewSize/MaxNewSize：定义YOUNG段的尺寸，NewSize为JVM启动时YOUNG的内存大小；MaxNewSize为最大可占用的YOUNG内存大小。在用户生产环境上一般将这两个&#20540;设为相同，以减少运行期间系统在内存申请上所花的开销。<br><br>PermSize/MaxPermSize：定义Perm段的尺寸，PermSize为JVM启动时Perm的内存大小；MaxPermSize为最大可占用的Perm内存大小。在用户生产环境上一般将这两个&#20540;设为相同，以减少运行期间系统在内存申请上所花的开销。<br><br>SurvivorRatio：设置Survivor空间和Eden空间的比例<br><br>内存溢出的可能性<br><br><br><br><br><br>1. OLD段溢出<br><br>这种内存溢出是最常见的情况之一，产生的原因可能是：<br><br>1) 设置的内存参数过小(ms/mx, NewSize/MaxNewSize)<br><br>2) 程序问题<br><br>单个程序持续进行消耗内存的处理，如循环几千次的字符串处理，对字符串处理应建议使用StringBuffer。此时不会报内存溢出错，却会使系统持续垃圾收集，无法处理其它请求，相关问题程序可通过Thread Dump获取（见系统问题诊断一章）单个程序所申请内存过大，有的程序会申请几十乃至几百兆内存，此时JVM也会因无法申请到资源而出现内存溢出，对此首先要找到相关功能，然后交予程序员修改，要找到相关程序，必须在Apache日志中寻找。<br><br>当Java对象使用完毕后，其所引用的对象却没有销毁，使得JVM认为他还是活跃的对象而不进行回收，这样累计占用了大量内存而无法释放。由于目前市面上还没有对系统影响小的内存分析工具，故此时只能和程序员一起定位。<br><br>2. Perm段溢出<br><br>通常由于Perm段装载了大量的Servlet类而导致溢出，目前的解决办法：<br><br>1) 将PermSize扩大，一般256M能够满足要求<br><br>2) 若别无选择，则只能将servlet的路径加到CLASSPATH中，但一般不建议这么处理<br><br><br><br><br><br>3. C Heap溢出<br><br>系统对C Heap没有限制，故C Heap发生问题时，Java进程所占内存会持续增长，直到占用所有可用系统内存<br><br>其他：<br><br>JVM有2个GC线程。第一个线程负责回收Heap的Young区。第二个线程在Heap不足时，遍历Heap，将Young 区升级为Older区。Older区的大小等于-Xmx减去-Xmn，不能将-Xms的&#20540;设的过大，因为第二个线程被迫运行会降低JVM的性能。<br><br>为什么一些程序频繁发生GC？有如下原因：<br><br>l &nbsp; &nbsp; &nbsp; &nbsp; 程序内调用了System.gc()或Runtime.gc()。<br><br>l &nbsp; &nbsp; &nbsp; &nbsp; 一些中间件软件调用自己的GC方法，此时需要设置参数禁止这些GC。<br><br>l &nbsp; &nbsp; &nbsp; &nbsp; Java的Heap太小，一般默认的Heap&#20540;都很小。<br><br>l &nbsp; &nbsp; &nbsp; &nbsp; 频繁实例化对象，Release对象。此时尽量保存并重用对象，例如使用StringBuffer()和String()。<br><br>如果你发现每次GC后，Heap的剩余空间会是总空间的50%，这表示你的Heap处于健康状态。许多Server端的Java程序每次GC后最好能有65%的剩余空间。<br><br>经验之谈：<br><br>1．Server端JVM最好将-Xms和-Xmx设为相同&#20540;。为了优化GC，最好让-Xmn&#20540;约等于-Xmx的1/3[2]。<br><br>2．一个GUI程序最好是每10到20秒间运行一次GC，每次在半秒之内完成[2]。<br><br>注意：<br><br>1．增加Heap的大小虽然会降低GC的频率，但也增加了每次GC的时间。并且GC运行时，所有的用户线程将暂停，也就是GC期间，Java应用程序不做任何工作。<br><br>2．Heap大小并不决定进程的内存使用量。进程的内存使用量要大于-Xmx定义的&#20540;，因为Java为其他任务分配内存，例如每个线程的Stack等。<br><br>2．Stack的设定<br><br>每个线程都有他自己的Stack。<br><br></p><br><div style="line-height:normal; background-color:white; zoom:1!important; word-wrap:break-word; visibility:visible!important; font-size:12px; word-break:break-all"><br><p style="padding-bottom:2px; line-height:normal; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><table border="1" cellspacing="0" cellpadding="0" width="90%" style="line-height:normal; background-color:rgb(238,204,255); width:856px; table-layout:auto!important"><br><tbody style="line-height:normal"><br><tr style="line-height:normal"><br><td style="padding-bottom:1.5pt; line-height:normal; padding-left:1.5pt; padding-right:1.5pt; zoom:1!important; font-family:Arial; word-wrap:break-word; visibility:visible!important; font-size:12px; word-break:break-all; padding-top:1.5pt"><br><div align="left" style="line-height:normal; zoom:1!important; font-family:Arial; word-wrap:break-word; visibility:visible!important; font-size:14px; word-break:break-all"><br><span style="line-height:normal; font-size:12pt">-Xss</span></div><br></td><br><td style="padding-bottom:1.5pt; line-height:normal; padding-left:1.5pt; padding-right:1.5pt; zoom:1!important; font-family:Arial; word-wrap:break-word; visibility:visible!important; font-size:12px; word-break:break-all; padding-top:1.5pt"><br><div align="left" style="line-height:normal; zoom:1!important; font-family:Arial; word-wrap:break-word; visibility:visible!important; font-size:14px; word-break:break-all"><br><span style="line-height:normal; font-size:12pt">每个线程的</span><span style="line-height:normal; font-size:12pt">Stack</span><span style="line-height:normal; font-size:12pt">大小</span></div><br></td><br></tr><br></tbody><br></table><br></p><br><div style="line-height:normal; zoom:1!important; font-family:Arial; word-wrap:break-word; visibility:visible!important; font-size:14px; word-break:break-all"><br>Stack的大小限制着线程的数量。如果Stack过大就好导致内存溢漏。-Xss参数决定Stack大小，例如-Xss1024K。如果Stack太小，也会导致Stack溢漏。<br><br>3．硬件环境<br><br>硬件环境也影响GC的效率，例如机器的种类，内存，swap空间，和CPU的数量。<br><br>如果你的程序需要频繁创建很多transient对象，会导致JVM频繁GC。这种情况你可以增加机器的内存，来减少Swap空间的使用[2]。<br><br>4．4种GC<br><br>第一种为单线程GC，也是默认的GC。，该GC适用于单CPU机器。<br><br>第二种为Throughput GC，是多线程的GC，适用于多CPU，使用大量线程的程序。第二种GC与第一种GC相&#20284;，不同在于GC在收集Young区是多线程的，但在Old区和第一种一样，仍然采用单线程。-XX:&#43;UseParallelGC参数启动该GC。<br><br>第三种为Concurrent Low Pause GC，类&#20284;于第一种，适用于多CPU，并要求缩短因GC造成程序停滞的时间。这种GC可以在Old区的回收同时，运行应用程序。-XX:&#43;UseConcMarkSweepGC参数启动该GC。<br><br>第四种为Incremental Low Pause GC，适用于要求缩短因GC造成程序停滞的时间。这种GC可以在Young区回收的同时，回收一部分Old区对象。-Xincgc参数启动该GC。<br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial; word-wrap:break-word; visibility:visible!important; font-size:14px; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial; word-wrap:break-word; visibility:visible!important; font-size:14px; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><span style="font-family:Arial; font-size:14px; color:#333333; line-height:26px"></span><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br><strong>按照基本回收策略分</strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong><span style="color:#00ff">引用计数（Reference Counting）:</span></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>比较古老的回收算法。原理是此对象有一个引用，即增加一个计数，删除一个引用则减少一个计数。垃圾回收时，只用收集计数为0的对象。此算法最致命的是无法处理循环引用的问题。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong><span style="color:#00ff">标记-清除（Mark-Sweep）:</span></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;<img alt="标记清楚" src="http://hi.csdn.net/attachment/201003/6/1981948_1267862317X1a1.png" width="573" height="230" style="border-bottom-style:none; border-right-style:none; border-top-style:none; border-left-style:none"></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>此算法执行分两阶段。第一阶段从引用根节点开始标记所有被引用的对象，第二阶段遍历整个堆，把未标记的对象清除。此算法需要暂停整个应用，同时，会产生内存碎片。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong><span style="color:#00ff">复制（Copying）:</span></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><img alt="复制" src="http://hi.csdn.net/attachment/201003/6/1981948_1267862317ZvYy.png" width="573" height="230" style="border-bottom-style:none; border-right-style:none; border-top-style:none; border-left-style:none">&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>此算法把内存空间划为两个相等的区域，每次只使用其中一个区域。垃圾回收时，遍历当前使用区域，把正在使用中的对象复制到另外一个区域中。算法每次只处理正在使用中的对象，因此复制成本比较小，同时复制过去以后还能进行相应的内存整理，不会出现“碎片”问题。当然，此算法的缺点也是很明显的，就是需要两倍内存空间。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong><span style="color:#00ff">标记-整理（Mark-Compact）:</span></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;<img alt="标记整理" src="http://hi.csdn.net/attachment/201003/6/1981948_1267862317X1a1.png" width="573" height="230" style="border-bottom-style:none; border-right-style:none; border-top-style:none; border-left-style:none"></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>此算法结合了“标记-清除”和“复制”两个算法的优点。也是分两阶段，第一阶段从根节点开始标记所有被引用对象，第二阶段遍历整个堆，把清除未标记对象并且把存活对象“压缩”到堆的其中一块，按顺序排放。此算法避免了“标记-清除”的碎片问题，同时也避免了“复制”算法的空间问题。</p><br><h2 style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:0px"><br><a target="_blank" name="t0"></a><br><br>&nbsp;</h2><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br><strong>按分区对待的方式分</strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="color:#00ff"><strong>增量收集（Incremental Collecting）:</strong></span>实时垃圾回收算法，即：在应用进行的同时进行垃圾回收。不知道什么原因JDK5.0中的收集器没有使用这种算法的。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="color:#00ff"><strong>分代收集（Generational Collecting）:</strong></span>基于对对象生命周期分析后得出的垃圾回收算法。把对象分为年青代、年老代、持久代，对不同生命周期的对象使用不同的算法（上述方式中的一个）进行回收。现在的垃圾回收器（从J2SE1.2开始）都是使用此算法的。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br><strong>按系统线程分</strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong><span style="color:#00ff">串行收集:</span></strong>串行收集使用单线程处理所有垃圾回收工作，因为无需多线程交互，实现容易，而且效率比较高。但是，其局限性也比较明显，即无法使用多处理器的优势，所以此收集适合单处理器机器。当然，此收集器也可以用在小数据量（100M左右）情况下的多处理器机器上。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong><span style="color:#00ff">并行收集:</span></strong>并行收集使用多线程处理垃圾回收工作，因而速度快，效率高。而且理论上CPU数目越多，越能体现出并行收集器的优势。（串型收集的并发版本，需要暂停jvm） 并行paralise指的是多个任务在多个cpu中一起并行执行，最后将结果合并。效率是N倍。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="color:#00ff"><strong>并发收集:</strong></span>相对于串行收集和并行收集而言，前面两个在进行垃圾回收工作时，需要暂停整个运行环境，而只有垃圾回收程序在运行，因此，系统在垃圾回收时会有明显的暂停，而且暂停时间会因为堆越大而越长。（和并行收集不同，并发只有在开头和结尾会暂停jvm）并发concurrent指的是多个任务在一个cpu伪同步执行，但其实是串行调度的，效率并非直接是N倍。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; padding-top:2px"><br><strong><span style="font-size:13px">分代垃圾回收</span></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;&nbsp;&nbsp; 分代的垃圾回收策略，是基于这样一个事实：<strong>不同的对象的生命周期是不一样的</strong>。因此，不同生命周期的对象可以采取不同的收集方式，以便提高回收效率。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;&nbsp; &nbsp;在Java程序运行的过程中，会产生大量的对象，其中有些对象是与业务信息相关，比如Http请求中的Session对象、线程、Socket连接，这类对象跟业务直接挂钩，因此生命周期比较长。但是还有一些对象，主要是程序运行过程中生成的临时变量，这些对象生命周期会比较短，比如：String对象，由于其不变类的特性，系统会产生大量的这些对象，有些对象甚至只用一次即可回收。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;&nbsp; &nbsp;试想，在不进行对象存活时间区分的情况下，每次垃圾回收都是对整个堆空间进行回收，花费时间相对会长，同时，因为每次回收都需要遍历所有存活对象，但实际上，对于生命周期长的对象而言，这种遍历是没有效果的，因为可能进行了很多次遍历，但是他们依旧存在。因此，分代垃圾回收采用分治的思想，进行代的划分，把不同生命周期的对象放在不同代上，不同代上采用最适合它的垃圾回收方式进行回收。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong><span style="font-size:16px"><img alt="jvm分代" src="http://hi.csdn.net/attachment/201003/6/1981948_12678645142BKS.png" width="574" height="318" style="border-bottom-style:none; border-right-style:none; border-top-style:none; border-left-style:none"></span></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong></strong>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>如图所示：</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;&nbsp; &nbsp;虚拟机中的共划分为三个代：<strong>年轻代（Young Generation）、年老点（Old Generation）和持久代（Permanent Generation）</strong>。其中持久代主要存放的是Java类的类信息，与垃圾收集要收集的Java对象关系不大。年轻代和年老代的划分是对垃圾收集影响比较大的。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong><span style="color:#00ff">年轻代:</span></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;&nbsp; &nbsp;所有新生成的对象首先都是放在年轻代的。年轻代的目标就是尽可能快速的收集掉那些生命周期短的对象。年轻代分三个区。一个Eden区，两个Survivor区(一般而言)。大部分对象在Eden区中生成。当Eden区满时，还存活的对象将被复制到Survivor区（两个中的一个），当这个Survivor区满时，此区的存活对象将被复制到另外一个Survivor区，当这个Survivor区也满了的时候，从第一个Survivor区复制过来的并且此时还存活的对象，将被复制“年老区(Tenured)”。需要注意，Survivor的两个区是对称的，没先后关系，所以同一个区中可能同时存在从Eden复制过来<br> 对象，和从前一个Survivor复制过来的对象，而复制到年老区的只有从第一个Survivor去过来的对象。而且，Survivor区总有一个是空的。同时，根据程序需要，Survivor区是可以配置为多个的（多于两个），这样可以增加对象在年轻代中的存在时间，减少被放到年老代的可能。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong><span style="color:#00ff">年老代:</span></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;&nbsp; &nbsp;在年轻代中经历了N次垃圾回收后仍然存活的对象，就会被放到年老代中。因此，可以认为年老代中存放的都是一些生命周期较长的对象。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="color:#00ff"><strong>持久代:</strong></span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;&nbsp; &nbsp;用于存放静态文件，如今Java类、方法等。持久代对垃圾回收没有显著影响，但是有些应用可能动态生成或者调用一些class，例如Hibernate等，在这种时候需要设置一个比较大的持久代空间来存放这些运行过程中新增的类。持久代大小通过-XX:MaxPermSize=&lt;N&gt;进行设置。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; padding-top:2px"><br><strong><span style="font-size:13px">什么情况下触发垃圾回收&nbsp;</span></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>由于对象进行了分代处理，因此垃圾回收区域、时间也不一样。GC有两种类型：<strong>Scavenge GC</strong>和<strong>Full GC</strong>。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong><span style="color:#00ff">Scavenge GC</span></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;&nbsp; &nbsp;一般情况下，当新对象生成，并且在Eden申请空间失败时，就会触发Scavenge GC，对Eden区域进行GC，清除非存活对象，并且把尚且存活的对象移动到Survivor区。然后整理Survivor的两个区。这种方式的GC是对年轻代的Eden区进行，不会影响到年老代。因为大部分对象都是从Eden区开始的，同时Eden区不会分配的很大，所以Eden区的GC会频繁进行。因而，一般在这里需要使用速度快、效率高的算法，使Eden去能尽快空闲出来。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong><span style="color:#00ff">Full GC</span></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;&nbsp; &nbsp;对整个堆进行整理，包括Young、Tenured和Perm。Full GC因为需要对整个对进行回收，所以比Scavenge GC要慢，因此应该尽可能减少Full GC的次数。在对JVM调优的过程中，很大一部分工作就是对于FullGC的调节。有如下原因可能导致Full GC：</p><br><blockquote style="font-family:Arial; font-size:14px"><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; padding-top:2px"><br>· 年老代（Tenured）被写满</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; padding-top:2px"><br>· 持久代（Perm）被写满&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; padding-top:2px"><br>· System.gc()被显示调用&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; padding-top:2px"><br>·上一次GC之后Heap的各域分配策略动态变化</p><br></blockquote><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; padding-top:2px"><br><span style="font-size:16px"><img alt="分代垃圾回收流程1" src="http://hi.csdn.net/attachment/201004/18/1981948_1271591242sfBp.jpg" width="482" height="768" style="border-bottom-style:none; border-right-style:none; border-top-style:none; border-left-style:none"></span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="font-size:16px"><img alt="分代垃圾回收流程2" src="http://hi.csdn.net/attachment/201004/18/1981948_12715912450bkp.png" width="413" height="768" style="border-bottom-style:none; border-right-style:none; border-top-style:none; border-left-style:none"></span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="font-size:16px"><img alt="分代垃圾回收流程3" src="http://hi.csdn.net/attachment/201004/18/1981948_1271591246383f.png" width="413" height="768" style="border-bottom-style:none; border-right-style:none; border-top-style:none; border-left-style:none"></span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="font-size:16px"><img alt="分代垃圾回收流程" src="http://hi.csdn.net/attachment/201004/18/1981948_1271591249sb6K.png" width="415" height="768" style="border-bottom-style:none; border-right-style:none; border-top-style:none; border-left-style:none"></span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><h2><a target="_blank" name="t1"></a><strong><span style="font-size:16px">= G1 ===================================</span></strong></h2><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><strong></strong></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br>传说中的G1，传说中的low-pause垃圾收集。Java SE 6的update14版本中已经包含测试版，可以在启动时加JVM参数来启用</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="font-family:'Courier New'">-XX:&#43;UnlockExperimentalVMOptions -XX:&#43;UseG1GC</span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="font-family:'Courier New'"><br><br></span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="font-family:'Courier New'"><a target="_blank" href="http://www.blogjava.net/BlueDavy/archive/2009/03/11/259230.html">http://www.blogjava.net/BlueDavy/archive/2009/03/11/259230.html</a><br><br></span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="font-family:'Courier New'">本文摘自《构建高性能的大型分布式Java应用》一书，Garbage First简称G1，它的目标是要做到尽量减少GC所导致的应用暂停的时间，让应用达到准实时的效果，同时保持JVM堆空间的利用率，将作为CMS的替代者在JDK 7中闪亮登场，其最大的特色在于允许指定在某个时间段内GC所导致的应用暂停的时间最大为多少，例如在100秒内最多允许GC导致的应用暂停时间为1秒，这个特性对于准实时响应的系统而言非常的吸引人，这样就再也不用担心系统突然会暂停个两三秒了。</span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="font-family:'Courier New'"></span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>G1要做到这样的效果，也是有前提的，一方面是硬件环境的要求，必须是多核的CPU以及较大的内存（从规范来看，512M以上就满足条件了），另外一方面是需要接受吞吐量的稍微降低，对于实时性要求高的系统而言，这点应该是可以接受的。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>为了能够达到这样的效果，G1在原有的各种GC策略上进行了吸收和改进，在G1中可以看到增量收集器和CMS的影子，但它不仅仅是吸收原有GC策略的优点，并在此基础上做出了很多的改进，简单来说，G1吸收了增量GC以及CMS的精髓，将整个jvm Heap划分为多个固定大小的region，扫描时采用Snapshot-at-the-beginning的并发marking算法（具体在后面内容详细解释）对整个heap中的region进行mark，回收时根据region中活跃对象的bytes进行排序，首先回收活跃对象bytes小以及回收耗时短（预估出来的时间）的region，回收的方法为将此region中的活跃对象复制到另外的region中，根据指定的GC所能占用的时间来估算能回收多少region，这点和以前版本的Full<br> GC时得处理整个heap非常不同，这样就做到了能够尽量短时间的暂停应用，又能回收内存，由于这种策略在回收时首先回收的是垃圾对象所占空间最多的region，因此称为Garbage First。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>看完上面对于G1策略的简短描述，并不能清楚的掌握G1，在继续详细看G1的步骤之前，必须先明白G1对于JVM Heap的改造，这些对于习惯了划分为new generation、old generation的大家来说都有不少的新意。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>G1将Heap划分为多个固定大小的region，这也是G1能够实现控制GC导致的应用暂停时间的前提，region之间的对象引用通过remembered set来维护，每个region都有一个remembered set，remembered set中包含了引用当前region中对象的region的对象的pointer，由于同时应用也会造成这些region中对象的引用关系不断的发生改变，G1采用了Card Table来用于应用通知region修改remembered sets，Card Table由多个512字节的Card构成，这些Card在Card<br> Table中以1个字节来标识，每个应用的线程都有一个关联的remembered set log，用于缓存和顺序化线程运行时造成的对于card的修改，另外，还有一个全局的filled RS buffers，当应用线程执行时修改了card后，如果造成的改变仅为同一region中的对象之间的关联，则不记录remembered set log，如造成的改变为跨region中的对象的关联，则记录到线程的remembered set log，如线程的remembered set log满了，则放入全局的filled RS<br> buffers中，线程自身则重新创建一个新的remembered set log，remembered set本身也是一个由一堆cards构成的哈希表。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>尽管G1将Heap划分为了多个region，但其默认采用的仍然是分代的方式，只是仅简单的划分为了年轻代（young）和非年轻代，这也是由于G1仍然坚信大多数新创建的对象都是不需要长的生命周期的，对于应用新创建的对象，G1将其放入标识为young的region中，对于这些region，并不记录remembered set logs，扫描时只需扫描活跃的对象，G1在分代的方式上还可更细的划分为：fully young或partially young，fully young方式暂停的时候仅处理young regions，partially同样处理所有的young<br> regions，但它还会根据允许的GC的暂停时间来决定是否要加入其他的非young regions，G1是运行到fully-young方式还是partially young方式，外部是不能决定的，在启动时，G1采用的为fully-young方式，当G1完成一次Concurrent Marking后，则切换为partially young方式，随后G1跟踪每次回收的效率，如果回收fully-young中的regions已经可以满足内存需要的话，那么就切换回fully young方式，但当heap size的大小接近满的情况下，G1会切换到partially<br> young方式，以保证能提供足够的内存空间给应用使用。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>除了分代方式的划分外，G1还支持另外一种pure G1的方式，也就是不进行代的划分，pure方式和分代方式的具体不同在下面的具体执行步骤中进行描述。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>掌握了这些概念后，继续来看G1的具体执行步骤：</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Initial Marking</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>G1对于每个region都保存了两个标识用的bitmap，一个为previous marking bitmap，一个为next marking bitmap，bitmap中包含了一个bit的地址信息来指向对象的起始点。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>开始Initial Marking之前，首先并发的清空next marking bitmap，然后停止所有应用线程，并扫描标识出每个region中root可直接访问到的对象，将region中top的&#20540;放入next top at mark start（TAMS）中，之后恢复所有应用线程。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>触发这个步骤执行的条件为：</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>l&nbsp;&nbsp;G1定义了一个JVM Heap大小的百分比的阀&#20540;，称为h，另外还有一个H，H的&#20540;为(1-h)<em>Heap Size，目前这个h的&#20540;是固定的，后续G1也许会将其改为动态的，根据jvm的运行情况来动态的调整，在分代方式下，G1还定义了一个u以及soft limit，soft limit的&#20540;为H-u</em>Heap Size，当Heap中使用的内存超过了soft limit&#20540;时，就会在一次clean up执行完毕后在应用允许的GC暂停时间范围内尽快的执行此步骤；</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>l&nbsp;&nbsp;在pure方式下，G1将marking与clean up组成一个环，以便clean up能充分的使用marking的信息，当clean up开始回收时，首先回收能够带来最多内存空间的regions，当经过多次的clean up，回收到没多少空间的regions时，G1重新初始化一个新的marking与clean up构成的环。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Concurrent Marking</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>按照之前Initial Marking扫描到的对象进行遍历，以识别这些对象的下层对象的活跃状态，对于在此期间应用线程并发修改的对象的以来关系则记录到remembered set logs中，新创建的对象则放入比top&#20540;更高的地址区间中，这些新创建的对象默认状态即为活跃的，同时修改top&#20540;。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Final Marking Pause</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>当应用线程的remembered set logs未满时，是不会放入filled RS buffers中的，在这样的情况下，这些remebered set logs中记录的card的修改就会被更新了，因此需要这一步，这一步要做的就是把应用线程中存在的remembered set logs的内容进行处理，并相应的修改remembered sets，这一步需要暂停应用，并行的运行。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Live Data Counting and Cleanup</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>&#20540;得注意的是，在G1中，并不是说Final Marking Pause执行完了，就肯定执行Cleanup这步的，由于这步需要暂停应用，G1为了能够达到准实时的要求，需要根据用户指定的最大的GC造成的暂停时间来合理的规划什么时候执行Cleanup，另外还有几种情况也是会触发这个步骤的执行的：</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>l&nbsp;&nbsp;G1采用的是复制方法来进行收集，必须保证每次的”to space”的空间都是够的，因此G1采取的策略是当已经使用的内存空间达到了H时，就执行Cleanup这个步骤；</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>l&nbsp;&nbsp;对于full-young和partially-young的分代模式的G1而言，则还有情况会触发Cleanup的执行，full-young模式下，G1根据应用可接受的暂停时间、回收young regions需要消耗的时间来估算出一个yound regions的数量&#20540;，当JVM中分配对象的young regions的数量达到此&#20540;时，Cleanup就会执行；partially-young模式下，则会尽量频繁的在应用可接受的暂停时间范围内执行Cleanup，并最大限度的去执行non-young regions的Cleanup。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>这一步中GC线程并行的扫描所有region，计算每个region中低于next TAMS&#20540;中marked data的大小，然后根据应用所期望的GC的短延时以及G1对于region回收所需的耗时的预估，排序region，将其中活跃的对象复制到其他region中。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br>&nbsp;</p><br><span style="font-size:14px">G1为了能够尽量的做到准实时的响应，例如估算暂停时间的算法、对于经常被引用的对象的特殊处理等，G1为了能够让GC既能够充分的回收内存，又能够尽量少的导致应用的暂停，可谓费尽心思，从G1的论文中的性能评测来看效果也是不错的，不过如果G1能允许开发人员在编写代码时指定哪些对象是不用mark的就更完美了，这对于有巨大缓存的应用而言，会有很大的帮助，G1将随JDK 6 Update 14&nbsp;beta发布。</span><br><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="font-family:'Courier New'"><br><br></span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="font-family:'Courier New'"><br><br></span></p><br><h2><a target="_blank" name="t2"></a><span style="font-family:'Courier New'">= CMS ==================================</span></h2><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="font-family:'Courier New'"><br><br></span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="font-family:'Courier New'"><a target="_blank" href="http://www.iteye.com/topic/1119491">http://www.iteye.com/topic/1119491</a><br><br></span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-family:Arial; font-size:14px; padding-top:2px"><br><span style="font-family:'Courier New'"><span></span></span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; padding-top:2px"><br><span style="font-size:13px"><strong>1.总体介绍：</strong></span></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:2px"><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>CMS(Concurrent Mark-Sweep)是以牺牲吞吐量为代价来获得最短回收停顿时间的垃圾回收器。并发意味着除了开头和结束阶段，需要暂停JVM，其它时间gc和应用一起执行。对于要求服务器响应速度的应用上，这种垃圾回收器非常适合。在启动JVM参数加上<span style="color:#ff00">-XX:&#43;UseConcMarkSweepGC</span>&nbsp;，这个参数表示对于老年代的回收采用CMS。CMS采用的基础算法是：标记—清除。默认会开启 -XX :&#43;UseParNewGC，在年轻代使用并行复制收集。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; padding-top:2px"><br><strong><span style="font-size:13px">2.CMS过程：</span></strong></p><br><ul style="padding-bottom:0px; margin:0px 0px 1.5em; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><li style="padding-bottom:0px; margin:0px 0px 0.25em 30px; padding-left:0px; padding-right:0px; padding-top:0px"><br>初始标记(STW initial mark) </li><li style="padding-bottom:0px; margin:0px 0px 0.25em 30px; padding-left:0px; padding-right:0px; padding-top:0px"><br>并发标记(Concurrent marking) </li><li style="padding-bottom:0px; margin:0px 0px 0.25em 30px; padding-left:0px; padding-right:0px; padding-top:0px"><br>并发预清理(Concurrent precleaning) </li><li style="padding-bottom:0px; margin:0px 0px 0.25em 30px; padding-left:0px; padding-right:0px; padding-top:0px"><br>重新标记(STW remark) </li><li style="padding-bottom:0px; margin:0px 0px 0.25em 30px; padding-left:0px; padding-right:0px; padding-top:0px"><br>并发清理(Concurrent sweeping) </li><li style="padding-bottom:0px; margin:0px 0px 0.25em 30px; padding-left:0px; padding-right:0px; padding-top:0px"><br>并发重置(Concurrent reset)</li></ul><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><span style="color:#3366ff"><strong>初始标记</strong>&nbsp;</span>：在这个阶段，需要虚拟机停顿正在执行的任务，官方的叫法STW(Stop The Word)。这个过程从垃圾回收的&quot;根对象&quot;开始，只扫描到能够和&quot;根对象&quot;直接关联的对象，并作标记。所以这个过程虽然暂停了整个JVM，但是很快就完成了。</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><span style="color:#3366ff"><strong>并发标记</strong>&nbsp;</span>：这个阶段紧随初始标记阶段，在初始标记的基础上继续向下追溯标记。并发标记阶段，应用程序的线程和并发标记的线程并发执行，所以用户不会感受到停顿。</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><strong><span style="color:#3366ff">并发预清理</span>&nbsp;</strong>：并发预清理阶段仍然是并发的。在这个阶段，虚拟机查找在执行并发标记阶段新进入老年代的对象(可能会有一些对象从新生代晋升到老年代， 或者有一些对象被分配到老年代)。通过重新扫描，减少下一个阶段&quot;重新标记&quot;的工作，因为下一个阶段会Stop The World。</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><span style="color:#3366ff"><strong>重新标记</strong>&nbsp;</span>：这个阶段会暂停虚拟机，收集器线程扫描在CMS堆中剩余的对象。扫描从&quot;跟对象&quot;开始向下追溯，并处理对象关联。</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><strong><span style="color:#3366ff">并发清理</span>&nbsp;</strong>：清理垃圾对象，这个阶段收集器线程和应用程序线程并发执行。</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><span style="color:#3366ff"><strong>并发重置</strong>&nbsp;</span>：这个阶段，重置CMS收集器的数据结构，等待下一次垃圾回收。</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>&nbsp;</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><span style="color:#ff00">CSM执行过程：</span>&nbsp;<br><br><img class="magplus" title="点击查看原始大小图片" alt="" src="http://dl.iteye.com/upload/attachment/612577/2b525609-ce63-3a42-bf19-b2fbcd42f26c.png" width="700" height="151" style="border-right-width:0px; border-top-width:0px; border-bottom-width:0px; border-left-width:0px"></p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; padding-top:2px"><br><strong><span style="font-size:13px">3.CMS缺点</span></strong></p><br><ul style="padding-bottom:0px; margin:0px 0px 1.5em; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><li style="padding-bottom:0px; margin:0px 0px 0.25em 30px; padding-left:0px; padding-right:0px; padding-top:0px"><br>CMS回收器采用的基础算法是Mark-Sweep。所有CMS不会整理、压缩堆空间。这样就会有一个问题：经过CMS收集的堆会产生空间碎片。 CMS不对堆空间整理压缩节约了垃圾回收的停顿时间，但也带来的堆空间的浪费。为了解决堆空间浪费问题，CMS回收器不再采用简单的指针指向一块可用堆空 间来为下次对象分配使用。而是把一些未分配的空间汇总成一个列表，当JVM分配对象空间的时候，会搜索这个列表找到足够大的空间来hold住这个对象。</li></ul><br><ul style="padding-bottom:0px; margin:0px 0px 1.5em; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><li style="padding-bottom:0px; margin:0px 0px 0.25em 30px; padding-left:0px; padding-right:0px; padding-top:0px"><br>需要更多的CPU资源。从上面的图可以看到，为了让应用程序不停顿，CMS线程和应用程序线程并发执行，这样就需要有更多的CPU，单纯靠线程切 换是不靠谱的。并且，重新标记阶段，为空保证STW快速完成，也要用到更多的甚至所有的CPU资源。当然，多核多CPU也是未来的趋势！</li></ul><br><ul style="padding-bottom:0px; margin:0px 0px 1.5em; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><li style="padding-bottom:0px; margin:0px 0px 0.25em 30px; padding-left:0px; padding-right:0px; padding-top:0px"><br>CMS的另一个缺点是它需要更大的堆空间。因为CMS标记阶段应用程序的线程还是在执行的，那么就会有堆空间继续分配的情况，为了保证在CMS回 收完堆之前还有空间分配给正在运行的应用程序，必须预留一部分空间。也就是说，CMS不会在老年代满的时候才开始收集。相反，它会尝试更早的开始收集，已 避免上面提到的情况：在回收完成之前，堆没有足够空间分配！默认当老年代使用68%的时候，CMS就开始行动了。 – XX:CMSInitiatingOccupancyFraction =n 来设置这个阀&#20540;。</li></ul><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>总得来说，CMS回收器减少了回收的停顿时间，但是降低了堆空间的利用率。</p><br><p style="padding-bottom:2px; margin:4px 0px; padding-left:0px; padding-right:0px; padding-top:2px"><br><span style="font-size:13px"><strong>4.啥时候用CMS</strong></span></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>如果你的应用程序对停顿比较敏感，并且在应用程序运行的时候可以提供更大的内存和更多的CPU(也就是硬件牛&#36924;)，那么使用CMS来收集会给你带来好处。还有，如果在JVM中，有相对较多存活时间较长的对象(老年代比较大)会更适合使用CMS。</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><h2><a target="_blank" name="t3"></a>= 调试工具 ==================================</h2><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; padding-top:0px"><br><strong><span style="font-size:13px">jmap</span></strong></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>jmap -heap pid &nbsp;(不能观察G1模式）</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>using parallel threads in the new generation.<br><br>using thread-local object allocation.<br><br>Concurrent Mark-Sweep GC<br><br><br><br>Heap Configuration:<br><br>&nbsp; &nbsp;MinHeapFreeRatio = 40<br><br>&nbsp; &nbsp;MaxHeapFreeRatio = 70<br><br>&nbsp; &nbsp;MaxHeapSize &nbsp; &nbsp; &nbsp;= 2147483648 (2048.0MB)<br><br>&nbsp; &nbsp;NewSize &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 268435456 (256.0MB)<br><br>&nbsp; &nbsp;MaxNewSize &nbsp; &nbsp; &nbsp; = 268435456 (256.0MB)<br><br>&nbsp; &nbsp;OldSize &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 805306368 (768.0MB)<br><br>&nbsp; &nbsp;NewRatio &nbsp; &nbsp; &nbsp; &nbsp; = 7<br><br>&nbsp; &nbsp;SurvivorRatio &nbsp; &nbsp;= 8<br><br>&nbsp; &nbsp;PermSize &nbsp; &nbsp; &nbsp; &nbsp; = 134217728 (128.0MB)<br><br>&nbsp; &nbsp;MaxPermSize &nbsp; &nbsp; &nbsp;= 134217728 (128.0MB)<br><br><br><br>Heap Usage:<br><br>New Generation (Eden &#43; 1 Survivor Space):<br><br>&nbsp; &nbsp;capacity = 241631232 (230.4375MB)<br><br>&nbsp; &nbsp;used &nbsp; &nbsp; = 145793088 (139.03912353515625MB)<br><br>&nbsp; &nbsp;free &nbsp; &nbsp; = 95838144 (91.39837646484375MB)<br><br>&nbsp; &nbsp;60.33702133340114% used<br><br>Eden Space:<br><br>&nbsp; &nbsp;capacity = 214827008 (204.875MB)<br><br>&nbsp; &nbsp;used &nbsp; &nbsp; = 132689456 (126.54252624511719MB)<br><br>&nbsp; &nbsp;free &nbsp; &nbsp; = 82137552 (78.33247375488281MB)<br><br>&nbsp; &nbsp;61.7657236095752% used<br><br>From Space:<br><br>&nbsp; &nbsp;capacity = 26804224 (25.5625MB)<br><br>&nbsp; &nbsp;used &nbsp; &nbsp; = 13103632 (12.496597290039062MB)<br><br>&nbsp; &nbsp;free &nbsp; &nbsp; = 13700592 (13.065902709960938MB)<br><br>&nbsp; &nbsp;48.886444166411984% used<br><br>To Space:<br><br>&nbsp; &nbsp;capacity = 26804224 (25.5625MB)<br><br>&nbsp; &nbsp;used &nbsp; &nbsp; = 0 (0.0MB)<br><br>&nbsp; &nbsp;free &nbsp; &nbsp; = 26804224 (25.5625MB)<br><br>&nbsp; &nbsp;0.0% used<br><br>concurrent mark-sweep generation: （old区）<br><br>&nbsp; &nbsp;capacity = 1879048192 (1792.0MB)<br><br>&nbsp; &nbsp;used &nbsp; &nbsp; = 1360638440 (1297.6059341430664MB)<br><br>&nbsp; &nbsp;free &nbsp; &nbsp; = 518409752 (494.3940658569336MB)<br><br>&nbsp; &nbsp;72.41104543209076% used<br><br>Perm Generation:<br><br>&nbsp; &nbsp;capacity = 134217728 (128.0MB)<br><br>&nbsp; &nbsp;used &nbsp; &nbsp; = 65435064 (62.40373992919922MB)<br><br>&nbsp; &nbsp;free &nbsp; &nbsp; = 68782664 (65.59626007080078MB)<br><br>&nbsp; &nbsp;48.75292181968689% used<br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>jmap -histo:live pid</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>num &nbsp; &nbsp; #instances &nbsp; &nbsp; &nbsp; &nbsp; #bytes &nbsp;class name<br><br>———————————————-<br><br>&nbsp; &nbsp;1: &nbsp; &nbsp; &nbsp; 3148147 &nbsp; &nbsp; &nbsp;209172848 &nbsp;[B<br><br>&nbsp; &nbsp;2: &nbsp; &nbsp; &nbsp; 2584345 &nbsp; &nbsp; &nbsp;144723320 &nbsp;java.lang.ref.SoftReference<br><br>&nbsp; &nbsp;3: &nbsp; &nbsp; &nbsp; 2578827 &nbsp; &nbsp; &nbsp;123783696 &nbsp;sun.misc.CacheEntry<br><br>&nbsp; &nbsp;4: &nbsp; &nbsp; &nbsp; &nbsp;781560 &nbsp; &nbsp; &nbsp;112544640 &nbsp;com.sun.net.ssl.internal.ssl.SSLSessionImpl<br><br>&nbsp; &nbsp;5: &nbsp; &nbsp; &nbsp; 1385200 &nbsp; &nbsp; &nbsp; 89970592 &nbsp;[C<br><br>&nbsp; &nbsp;6: &nbsp; &nbsp; &nbsp; &nbsp;783287 &nbsp; &nbsp; &nbsp; 87807200 &nbsp;[Ljava.util.Hashtable$Entry;<br><br>&nbsp; &nbsp;7: &nbsp; &nbsp; &nbsp; 1421399 &nbsp; &nbsp; &nbsp; 56855960 &nbsp;java.lang.String<br><br>&nbsp; &nbsp;8: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;12 &nbsp; &nbsp; &nbsp; 56828880 &nbsp;[Lsun.misc.CacheEntry;<br><br>&nbsp; &nbsp;9: &nbsp; &nbsp; &nbsp; 2343358 &nbsp; &nbsp; &nbsp; 56240592 &nbsp;com.sun.net.ssl.internal.ssl.SessionId<br><br>&nbsp; 10: &nbsp; &nbsp; &nbsp; &nbsp;783185 &nbsp; &nbsp; &nbsp; 50123840 &nbsp;java.util.Hashtable<br><br>&nbsp; 11: &nbsp; &nbsp; &nbsp; &nbsp;783094 &nbsp; &nbsp; &nbsp; 50118016 &nbsp;java.lang.ref.Finalizer<br><br>&nbsp; 12: &nbsp; &nbsp; &nbsp; &nbsp;287243 &nbsp; &nbsp; &nbsp; 36086720 &nbsp;[Ljava.lang.Object;<br><br>&nbsp; 13: &nbsp; &nbsp; &nbsp; &nbsp;263376 &nbsp; &nbsp; &nbsp; 33712128 &nbsp;org.apache.commons.pool.impl.GenericObjectPool<br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><strong>jstat</strong></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>jstat -gccause 31169 60000 1000<br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>(sweep 1,2) (Eden) (Old) (Perm) (Young GC, GCTime)(Full GC, GCTime)</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>&nbsp; S0 &nbsp; &nbsp; &nbsp; &nbsp; S1 &nbsp; &nbsp; E &nbsp; &nbsp; &nbsp; &nbsp; O &nbsp; &nbsp; &nbsp; &nbsp; P &nbsp; &nbsp; YGC &nbsp; &nbsp; YGCT &nbsp; &nbsp; FGC &nbsp; &nbsp;FGCT &nbsp; &nbsp; &nbsp;GCT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LGCC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GCC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br><br>&nbsp;48.80 &nbsp; 0.00 &nbsp;68.94 &nbsp;69.55 &nbsp;48.86 &nbsp;30202 &nbsp;725.319 51835 5083.298 5808.616 unknown GCCause &nbsp; &nbsp; &nbsp;No GC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br><br>&nbsp;47.98 &nbsp; 0.00 &nbsp;37.47 &nbsp;69.61 &nbsp;48.86 &nbsp;30206 &nbsp;725.385 51835 5083.298 5808.682 unknown GCCause &nbsp; &nbsp; &nbsp;No GC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br><br>&nbsp;50.73 &nbsp; 0.00 &nbsp;51.72 &nbsp;69.65 &nbsp;48.86 &nbsp;30210 &nbsp;725.459 51835 5083.298 5808.757 unknown GCCause &nbsp; &nbsp; &nbsp;No GC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br><br>&nbsp; 0.00 &nbsp;50.02 &nbsp;82.67 &nbsp;69.60 &nbsp;48.84 &nbsp;30213 &nbsp;725.508 51836 5091.572 5817.081 unknown GCCause &nbsp; &nbsp; &nbsp;No GC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>jstat -gcutil $pid</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>&nbsp; S0 &nbsp; &nbsp; &nbsp; &nbsp; S1 &nbsp; &nbsp; E &nbsp; &nbsp; &nbsp; &nbsp; O &nbsp; &nbsp; &nbsp; P &nbsp; &nbsp; &nbsp; YGC &nbsp; &nbsp; YGCT &nbsp; &nbsp;FGC &nbsp; &nbsp;FGCT &nbsp; &nbsp; GCT &nbsp;&nbsp;<br><br>&nbsp;74.79 &nbsp; 0.00 &nbsp;95.15 &nbsp; 0.86 &nbsp;37.35 &nbsp; &nbsp; &nbsp;2 &nbsp; &nbsp; &nbsp; &nbsp;0.112 &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;0.000 &nbsp; &nbsp; &nbsp;0.112<br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>O = old occupied</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>YGC = young gc time ( new part )</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>YGCT = young gc total cost time</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>FGC = full gc time ( old part )</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>FGCT = full gc total cost time</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br>GCT = all gc cost time</p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; margin:0px; padding-left:0px; padding-right:0px; font-size:14px; padding-top:0px"><br><span style="font-family:Arial; font-size:14px; color:#333333; line-height:26px"></span></p><br><p><strong>jvisualvm</strong></p><br><p>window下启动远程监控，并在被监控服务端，启动jstatd服务。</p><br><p><br><br></p><br><p><span style="font-family:Arial; font-size:14px; color:#333333; line-height:26px">创建安全策略文件，并命名为jstatd.all.policy<br style="line-height:25px"><br>grant codebase &quot;file:${java.home}/../lib/tools.jar&quot; {<br style="line-height:25px"><br>&nbsp;&nbsp;&nbsp; permission java.security.AllPermission;<br style="line-height:25px"><br>};</span><br><br></p><br><p><span style="font-family:Arial; font-size:14px; color:#333333; line-height:26px"><span style="font-family:Arial; font-size:14px; color:#333333; line-height:26px">jstatd -J-Djava.security.policy=jstatd.all.policy -p 8080 &amp;</span></span></p><br><br><br><strong>======================== Tunning =================</strong></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br>典型配置：</div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><pre>-server -Xmx2g -Xms2g -Xmn512m -XX:PermSize=128m -Xss256k -XX:&#43;DisableExplicitGC -XX:&#43;UseConcMarkSweepGC -XX:&#43;UseParNewGC -XX:&#43;CMSParallelRemarkEnabled -XX:&#43;UseCMSCompactAtFullCollection -XX:LargePageSizeInBytes=128m -XX:&#43;UseFastAccessorMethods -XX:&#43;UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=70 -Djava.awt.headless=true -Djava.net.preferIPv4Stack=true<br></pre><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><a target="_blank" href="http://java.sun.com/performance/reference/whitepapers/tuning.html">http://java.sun.com/performance/reference/whitepapers/tuning.html</a><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><a target="_blank" href="http://www.oracle.com/technetwork/java/gc-tuning-5-138395.html">http://www.oracle.com/technetwork/java/gc-tuning-5-138395.html</a><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br>&#43;AggressiveOpts 激进优化，默认开启，使用java新特性优化</div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br>1. 默认使用串行收集器， 单个cpu时适用</div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br>2. 吞吐收集器（throughput collector）：命令行参数：-XX:&#43;UseParallelGC。在新生代使用并行清除收集策略，在旧生代和默认收集器相同。</div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br>适用：a、拥有2个以上cpu， b、临时对象较多的程序</div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><span style="font-family:Arial,Verdana,sans-serif">-XX:ParallelGCThreads 并行收集线程数量，最好和cpu数量相当</span><br><br><br><br>3. 并发收集器（concurrent low pause collector）：命令行参数：-XX:&#43;UseConcMarkSweepGC。在旧生代使用并发收集策略，大部分收集工作都是和应用并发进行的，在进行收集的时候，应用的暂停时间很短。默认配套打开 -XX:&#43;UseParNewGC，会在新生代使用并行复制收集。</div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br>适用：a、拥有多个cpu， b、老对象较多的程序</div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br>如果使用了UseParNewGC，那么同时使用CMSParallelRemarkEnabled参数可以降低标识暂停</div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br>-XX:&#43;UseCMSCompactAtFullCollection：打开对年老代的压缩。可能会影响性能，但是可以消除碎片<br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br>-XX:&#43;UseFastAccessorMethods 原始类型的快速优化</div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br>-XX:SurvivorRatio 新生区中，eden&amp;survivor的比例，设置为8</div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br>-XX:TargetSurvivorRatio 生存区需要做垃圾回收的比例&#20540;，默认为50%，设置高些可以更好的利用该区</div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><img alt="" src="http://img.my.csdn.net/uploads/201207/09/1341820867_5296.gif"><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br>各个垃圾收集器之间的区别：</div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><a target="_blank" href="http://www.javaperformancetuning.com/news/qotm026.shtml">http://www.javaperformancetuning.com/news/qotm026.shtml</a><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br>新生代，单独区域单独收集，不会影响老生代，因为区域小，且允许漏收集，采用复制清除的方法，更快。</div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><br><br></div><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br></div><br><span style="font-family:Arial,'Liberation Sans','DejaVu Sans',sans-serif; font-size:14px; line-height:18px; border-collapse:collapse"></span><br><p style="padding-bottom:0px; border-right-width:0px; background-color:transparent; margin:0px 0px 1em; padding-left:0px; padding-right:0px; word-wrap:break-word; border-top-width:0px; border-bottom-width:0px; clear:both; font-size:14px; vertical-align:baseline; border-left-width:0px; padding-top:0px"><br>The&nbsp;<span style="font-size:14px; padding-bottom:0px; border-right-width:0px; background-color:transparent; margin:0px; padding-left:0px; padding-right:0px; border-top-width:0px; border-bottom-width:0px; vertical-align:baseline; border-left-width:0px; padding-top:0px"><em>(original)<br> copying collector</em></span>&nbsp;(Enabled by default). When this collector kicks in, all application threads are stopped, and the copying collection proceeds using one thread (which means only one CPU even if on a multi-CPU machine). This is known as a stop-the-world<br> collection, because basically the JVM pauses everything else until the collection is completed.</p><br><p style="padding-bottom:0px; border-right-width:0px; background-color:transparent; margin:0px 0px 1em; padding-left:0px; padding-right:0px; word-wrap:break-word; border-top-width:0px; border-bottom-width:0px; clear:both; font-size:14px; vertical-align:baseline; border-left-width:0px; padding-top:0px"><br>The&nbsp;<span style="font-size:14px; padding-bottom:0px; border-right-width:0px; background-color:transparent; margin:0px; padding-left:0px; padding-right:0px; border-top-width:0px; border-bottom-width:0px; vertical-align:baseline; border-left-width:0px; padding-top:0px"><em>parallel<br> copying collector</em></span>&nbsp;(Enabled using -XX:&#43;UseParNewGC). Like the original copying collector, this is a stop-the-world collector. However this collector parallelizes the copying collection over multiple threads, which is more efficient than the original<br> single-thread copying collector for multi-CPU machines (though not for single-CPU machines). This algorithm potentially speeds up young generation collection by a factor equal to the number of CPUs available, when compared to the original singly-threaded copying<br> collector.</p><br><p style="padding-bottom:0px; border-right-width:0px; background-color:transparent; margin:0px 0px 1em; padding-left:0px; padding-right:0px; word-wrap:break-word; border-top-width:0px; border-bottom-width:0px; clear:both; font-size:14px; vertical-align:baseline; border-left-width:0px; padding-top:0px"><br>The&nbsp;<span style="font-size:14px; padding-bottom:0px; border-right-width:0px; background-color:transparent; margin:0px; padding-left:0px; padding-right:0px; border-top-width:0px; border-bottom-width:0px; vertical-align:baseline; border-left-width:0px; padding-top:0px"><em>parallel<br> scavenge collector</em></span>&nbsp;(Enabled using -XX:UseParallelGC). This is like the previous parallel copying collector, but the algorithm is tuned for gigabyte heaps (over 10GB) on multi-CPU machines. This collection algorithm is designed to maximize throughput<br> while minimizing pauses. It has an optional adaptive tuning policy which will automatically resize heap spaces. If you use this collector, you can only use the the original mark-sweep collector in the old generation (i.e. the newer old generation concurrent<br> collector cannot work with this young generation collector).</p><br><div style="line-height:normal; zoom:1!important; font-family:Arial,Verdana,sans-serif; word-wrap:break-word; visibility:visible!important; word-break:break-all"><br><p style="padding-bottom:0px; border-right-width:0px; background-color:transparent; margin:0px 0px 1em; padding-left:0px; padding-right:0px; word-wrap:break-word; border-top-width:0px; border-bottom-width:0px; clear:both; font-size:14px; vertical-align:baseline; border-left-width:0px; padding-top:0px"><br></p><br><p style="padding-bottom:0px; border-right-width:0px; background-color:transparent; margin:0px 0px 1em; padding-left:0px; padding-right:0px; word-wrap:break-word; border-top-width:0px; border-bottom-width:0px; clear:both; font-size:14px; vertical-align:baseline; border-left-width:0px; padding-top:0px"><br>UserParallelGC使用了更高效的算法，用于处理大规模内存&gt;10G场景，提供了大吞吐量功能。但是，同时在老生代，只能使用串行的标记清除方法。</p><br><p style="padding-bottom:0px; border-right-width:0px; background-color:transparent; margin:0px 0px 1em; padding-left:0px; padding-right:0px; word-wrap:break-word; border-top-width:0px; border-bottom-width:0px; clear:both; font-size:14px; vertical-align:baseline; border-left-width:0px; padding-top:0px"><br><br><br></p><br><p style="padding-bottom:0px; border-right-width:0px; background-color:transparent; margin:0px 0px 1em; padding-left:0px; padding-right:0px; word-wrap:break-word; border-top-width:0px; border-bottom-width:0px; clear:both; font-size:14px; vertical-align:baseline; border-left-width:0px; padding-top:0px"><br>老生代，必须做fullgc，必须从root开始全面标识收集。</p><br><p style="padding-bottom:0px; border-right-width:0px; background-color:transparent; margin:0px 0px 1em; padding-left:0px; padding-right:0px; word-wrap:break-word; border-top-width:0px; border-bottom-width:0px; clear:both; font-size:14px; vertical-align:baseline; border-left-width:0px; padding-top:0px"><br></p><br><ul style="font-family:Simsun; font-size:16px"><br><li>The&nbsp;<em>(original) mark-sweep collector</em>&nbsp;(Enabled by default). This uses a stop-the-world mark-and-sweep collection algorithm. The collector is single-threaded, the entire JVM is paused and the collector uses only one CPU until completed.</li><li>The&nbsp;<em>concurrent collector</em>&nbsp;(Enabled using -XX:&#43;UseConcMarkSweepGC). This collector tries to allow application processing to continue as much as possible during the collection. Splitting the collection into six phases described shortly, four are concurrent<br> while two are stop-the-world:<br><br>1. the initial-mark phase (stop-the-world, snapshot the old generation so that we can run most of the rest of the collection concurrent to the application threads);<br><br>2. the mark phase (concurrent, mark the live objects traversing the object graph from the roots);<br><br>3. the pre-cleaning phase (concurrent);<br><br>4. the re-mark phase (stop-the-world, another snapshot to capture any changes to live objects since the collection started);<br><br>5. the sweep phase (concurrent, recycles memory by clearing unreferenced objects);<br><br>6. the reset phase (concurrent).<br><br>If &quot;the rate of creation&quot; of objects is too high, and the concurrent collector is not able to keep up with the concurrent collection, it falls back to the traditional mark-sweep collector.</li><li>The&nbsp;<em>incremental collector</em>&nbsp;(Enabled using -Xincgc). The incremental collector uses a &quot;train&quot; algorithm to collect small portions of the old generation at a time. This collector has higher overheads than the mark-sweep collector, but because small<br> numbers of objects are collected each time, the (stop-the-world) garbage collection pause is minimized at the cost of total garbage collection taking longer. The &quot;train&quot; algorithm does not guarantee a maximum pause time, but pause times are typically less<br> than ten milliseconds.</li></ul><br><br><br><p></p><br><p style="padding-bottom:0px; border-right-width:0px; background-color:transparent; margin:0px 0px 1em; padding-left:0px; padding-right:0px; word-wrap:break-word; border-top-width:0px; border-bottom-width:0px; clear:both; font-size:14px; vertical-align:baseline; border-left-width:0px; padding-top:0px"><br><br><br></p><br></div><br></div>

<p></p></div><p></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://bloodorange2017.github.io/images/img_head_001.jpg"
               alt="XueCheng" />
          <p class="site-author-name" itemprop="name">XueCheng</p>
           
              <p class="site-description motion-element" itemprop="description">Do one thing at a time, and do well.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">61</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XueCheng</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

<script type="text/javascript"
color="160,160,233" opacity='0.4' zIndex="-2" count="16" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
