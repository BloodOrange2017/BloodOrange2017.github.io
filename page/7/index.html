<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="Do one thing at a time, and do well.">
<meta property="og:type" content="website">
<meta property="og:title" content="XueCheng Notes">
<meta property="og:url" content="https://bloodorange2017.github.io/archives/page/7/index.html">
<meta property="og:site_name" content="XueCheng Notes">
<meta property="og:description" content="Do one thing at a time, and do well.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="XueCheng Notes">
<meta name="twitter:description" content="Do one thing at a time, and do well.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://bloodorange2017.github.io/archives/page/7/"/>





  <title>XueCheng Notes</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">XueCheng Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Where there is a will, there is a way.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/05/16/aop-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/16/aop-01/" itemprop="url">转载:Java动态代理的两种实现方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-16T09:04:51+08:00">
                2017-05-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="article_c"><br><br>&nbsp;AOP的拦截功能是由java中的动态代理来实现的。说白了，就是在目标类的基础上增加切面逻辑，生成增强的目标类（该切面逻辑或者在目标类函数执行之前，或者目标类函数执行之后，或者在目标类函数抛出异常时候执行。不同的切入时机对应不同的Interceptor的种类，如BeforeAdviseInterceptor，AfterAdviseInterceptor以及ThrowsAdviseInterceptor等）。<br><br><p><br><br></p><br><p>那么动态代理是如何实现将切面逻辑（advise）织入到目标类方法中去的呢？下面我们就来详细介绍并实现AOP中用到的两种动态代理。<br><br></p><br><p>AOP的源码中用到了两种动态代理来实现拦截切入功能：jdk动态代理和cglib动态代理。两种方法同时存在，各有优劣。<span style="color:#FF0000">jdk动态代理是由java内部的反射机制来实现的，cglib动态代理底层则是借助asm来实现的。总的来说，反射机制在生成类的过程中比较高效，而asm在生成类之后的相关执行过程中比较高效（可以通过将asm生成的类进行缓存，这样解决asm生成类过程低效问题）。还有一点必须注意：jdk动态代理的应用前提，必须是目标类基于统一的接口。如果没有上述前提，jdk动态代理不能应用。</span>由此可以看出，jdk动态代理有一定的局限性，cglib这种第三方类库实现的动态代理应用更加广泛，且在效率上更有优势。。<br><br></p><br><h1>1、定义接口和实现</h1><br><p></p><br><pre name="code" class="java">package com.meituan.hyt.test3.service;<br><br><br>public interface UserService {<br>    public String getName(int id);<br><br>    public Integer getAge(int id);<br>}<br></pre><br><p></p><br><p><br><br></p><br><p></p><br><pre name="code" class="java">package com.meituan.hyt.test3.service.impl;<br><br>import com.meituan.hyt.test3.service.UserService;<br><br><br>public class UserServiceImpl implements UserService {<br>    @Override<br>    public String getName(int id) {<br>        System.out.println(&quot;——getName——&quot;);<br>        return &quot;Tom&quot;;<br>    }<br><br>    @Override<br>    public Integer getAge(int id) {<br>        System.out.println(&quot;——getAge——&quot;);<br>        return 10;<br>    }<br>}<br></pre><br><br><p></p><br><h1>2、jdk动态代理实现</h1><br><p></p><br><pre name="code" class="java">package com.meituan.hyt.test3.jdk;<br><br>import java.lang.reflect.InvocationHandler;<br>import java.lang.reflect.Method;<br><br><br>public class MyInvocationHandler implements InvocationHandler {<br>    private Object target;<br><br>    MyInvocationHandler() {<br>        super();<br>    }<br><br>    MyInvocationHandler(Object target) {<br>        super();<br>        this.target = target;<br>    }<br><br>    @Override<br>    public Object invoke(Object o, Method method, Object[] args) throws Throwable {<br>        if(&quot;getName&quot;.equals(method.getName())){<br>            System.out.println(&quot;++++++before &quot; + method.getName() + &quot;++++++&quot;);<br>            Object result = method.invoke(target, args);<br>            System.out.println(&quot;++++++after &quot; + method.getName() + &quot;++++++&quot;);<br>            return result;<br>        }else{<br>            Object result = method.invoke(target, args);<br>            return result;<br>        }<br><br>    }<br>}<br></pre><br><br><pre name="code" class="java">package com.meituan.hyt.test3.jdk;<br><br>import com.meituan.hyt.test3.service.UserService;<br>import com.meituan.hyt.test3.service.impl.UserServiceImpl;<br><br>import java.lang.reflect.InvocationHandler;<br>import java.lang.reflect.Proxy;<br><br><br>public class Main1 {<br>    public static void main(String[] args) {<br>        UserService userService = new UserServiceImpl();<br>        InvocationHandler invocationHandler = new MyInvocationHandler(userService);<br>        UserService userServiceProxy = (UserService)Proxy.newProxyInstance(userService.getClass().getClassLoader(),<br>                userService.getClass().getInterfaces(), invocationHandler);<br>        System.out.println(userServiceProxy.getName(1));<br>        System.out.println(userServiceProxy.getAge(1));<br>    }<br>}</pre><br><br>运行结果<br><p></p><br><p>&#43;&#43;&#43;&#43;&#43;&#43;before getName&#43;&#43;&#43;&#43;&#43;&#43;<br><br>——getName——<br><br>&#43;&#43;&#43;&#43;&#43;&#43;after getName&#43;&#43;&#43;&#43;&#43;&#43;<br><br>Tom<br><br>——getAge——<br><br>10</p><br><h1>3、cglib动态代理实现<br><br></h1><br><p>Cglib是一个优秀的动态代理框架，它的底层使用ASM在内存中动态的生成被代理类的子类，使用CGLIB即使代理类没有实现任何接口也可以实现动态代理功能。CGLIB具有简单易用，它的运行速度要远远快于JDK的Proxy动态代理：<br><br><br><br>CGLIB的核心类：<br><br>&nbsp;&nbsp;&nbsp; net.sf.cglib.proxy.Enhancer – 主要的增强类<br><br>&nbsp;&nbsp;&nbsp; net.sf.cglib.proxy.MethodInterceptor – 主要的方法拦截类，它是Callback接口的子接口，需要用户实现<br><br>&nbsp;&nbsp;&nbsp; net.sf.cglib.proxy.MethodProxy – JDK的java.lang.reflect.Method类的代理类，可以方便的实现对源对象方法的调用,如使用：<br><br>&nbsp;&nbsp;&nbsp; Object o = methodProxy.invokeSuper(proxy, args);//虽然第一个参数是被代理对象，也不会出现死循环的问题。<br><br><br><br>net.sf.cglib.proxy.MethodInterceptor接口是最通用的回调（callback）类型，它经常被基于代理的AOP用来实现拦截（intercept）方法的调用。这个接口只定义了一个方法<br><br>public Object intercept(Object object, java.lang.reflect.Method method,<br><br>Object[] args, MethodProxy proxy) throws Throwable;<br><br><br><br>第一个参数是代理对像，第二和第三个参数分别是拦截的方法和方法的参数。原来的方法可能通过使用java.lang.reflect.Method对象的一般反射调用，或者使用 net.sf.cglib.proxy.MethodProxy对象调用。net.sf.cglib.proxy.MethodProxy通常被首选使用，因为它更快。</p><br><p></p><br><pre name="code" class="java">package com.meituan.hyt.test3.cglib;<br><br><br>import net.sf.cglib.proxy.MethodInterceptor;<br>import net.sf.cglib.proxy.MethodProxy;<br><br>import java.lang.reflect.Method;<br><br><br>public class CglibProxy implements MethodInterceptor {<br>    @Override<br>    public Object intercept(Object o, Method method, Object[] args, MethodProxy methodProxy) throws Throwable {<br>        System.out.println(&quot;++++++before &quot; + methodProxy.getSuperName() + &quot;++++++&quot;);<br>        System.out.println(method.getName());<br>        Object o1 = methodProxy.invokeSuper(o, args);<br>        System.out.println(&quot;++++++before &quot; + methodProxy.getSuperName() + &quot;++++++&quot;);<br>        return o1;<br>    }<br>}<br></pre><br><br><br><br><pre name="code" class="java">package com.meituan.hyt.test3.cglib;<br><br>import com.meituan.hyt.test3.service.UserService;<br>import com.meituan.hyt.test3.service.impl.UserServiceImpl;<br>import net.sf.cglib.proxy.Enhancer;<br><br><br><br>public class Main2 {<br>    public static void main(String[] args) {<br>        CglibProxy cglibProxy = new CglibProxy();<br><br>        Enhancer enhancer = new Enhancer();<br>        enhancer.setSuperclass(UserServiceImpl.class);<br>        enhancer.setCallback(cglibProxy);<br><br>        UserService o = (UserService)enhancer.create();<br>        o.getName(1);<br>        o.getAge(1);<br>    }<br>}</pre><br><br>运行结果：<br><p></p><br><p>&#43;&#43;&#43;&#43;&#43;&#43;before CGLIB$getName$0&#43;&#43;&#43;&#43;&#43;&#43;<br><br>getName<br><br>——getName——<br><br>&#43;&#43;&#43;&#43;&#43;&#43;before CGLIB$getName$0&#43;&#43;&#43;&#43;&#43;&#43;<br><br>&#43;&#43;&#43;&#43;&#43;&#43;before CGLIB$getAge$1&#43;&#43;&#43;&#43;&#43;&#43;<br><br>getAge<br><br>——getAge——<br><br>&#43;&#43;&#43;&#43;&#43;&#43;before CGLIB$getAge$1&#43;&#43;&#43;&#43;&#43;&#43;<br><br></p><br><div id="xunlei_com_thunder_helper_plugin_d462f475-c18e-46be-bd10-327458d045bd"></div><br><div id="xunlei_com_thunder_helper_plugin_d462f475-c18e-46be-bd10-327458d045bd"></div><br><div id="xunlei_com_thunder_helper_plugin_d462f475-c18e-46be-bd10-327458d045bd"></div><br> </div>


          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/05/12/lock-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/12/lock-03/" itemprop="url">转载:Lock实现原理(底层实现)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-12T17:18:57+08:00">
                2017-05-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="article_content" class="article_content"><br>        <div class="markdown_views"><p>关于java lock的底层实现原理，讲的有点深，转载学习！</p><br><br><p>Lock完全用Java写成，在java这个层面是无关JVM实现的。</p><br><br><p>在java.util.concurrent.locks包中有很多Lock的实现类，常用的有ReentrantLock、ReadWriteLock（实现类ReentrantReadWriteLock），其实现都依赖java.util.concurrent.<strong>AbstractQueuedSynchronizer</strong>类，实现思路都大同小异，因此我们以ReentrantLock作为讲解切入点。</p><br><br><br><br><h3 id="reentrantlock的调用过程">ReentrantLock的调用过程</h3><br><br><p>经过观察ReentrantLock把所有Lock接口的操作都委派到一个<strong>Sync类</strong>上，该类继承了<strong>AbstractQueuedSynchronizer</strong>：</p><br><br><pre><code>static abstract class Sync extends AbstractQueuedSynchronizer<br></code></pre><br><br><p>Sync又有两个子类：</p><br><br><pre><code>final static class NonfairSync extends Sync<br><br>final static class FairSync extends Sync<br></code></pre><br><br><p>显然是为了支持公平锁和非公平锁而定义，默认情况下为非公平锁。 <br><br>先理一下Reentrant.lock()方法的调用过程（默认非公平锁）： <br><br><img src="http://hi.csdn.net/attachment/201107/29/0_13119022769n5R.gif" alt="这里写图片描述" title=""></p><br><br><p>这些讨厌的Template模式导致很难直观的看到整个调用过程，其实通过上面调用过程及AbstractQueuedSynchronizer的注释可以发现，AbstractQueuedSynchronizer中抽象了绝大多数Lock的功能，而只把tryAcquire方法延迟到子类中实现。tryAcquire方法的语义在于用具体子类判断请求线程是否可以获得锁，无论成功与否AbstractQueuedSynchronizer都将处理后面的流程。</p><br><br><br><br><h3 id="锁实现加锁">锁实现（加锁）</h3><br><br><p>简单说来，AbstractQueuedSynchronizer会把所有的请求线程构成一个CLH队列，当一个线程执行完毕（lock.unlock()）时会激活自己的后继节点，但正在执行的线程并不在队列中，而那些等待执行的线程全部处于阻塞状态，经过调查线程的显式阻塞是通过调用LockSupport.park()完成，而LockSupport.park()则调用sun.misc.Unsafe.park()本地方法，再进一步，HotSpot在Linux中中通过调用pthread_mutex_lock函数把线程交给系统内核进行阻塞。 <br><br>该队列如图：</p><br><br><p><img src="http://hi.csdn.net/attachment/201107/28/0_1311847049xnXb.gif" alt="这里写图片描述" title=""></p><br><br><p>与synchronized相同的是，这也是一个虚拟队列，不存在队列实例，仅存在节点之间的前后关系。令人疑惑的是为什么采用CLH队列呢？原生的CLH队列是用于自旋锁，但Doug Lea把其改造为阻塞锁。 <br><br><strong>当有线程竞争锁时，该线程会首先尝试获得锁，这对于那些已经在队列中排队的线程来说显得不公平，这也是非公平锁的由来</strong>，与synchronized实现类似，这样会极大提高吞吐量。 <br><br>如果已经存在Running线程，则新的竞争线程会被追加到队尾，具体是采用基于CAS的Lock-Free算法，因为线程并发对Tail调用CAS可能会导致其他线程CAS失败，解决办法是<strong>循环CAS直至成功</strong>。AbstractQueuedSynchronizer的实现非常精巧，令人叹为观止，不入细节难以完全领会其精髓，下面详细说明实现过程：</p><br><br><br><br><h4 id="21-syncnonfairtryacquire">2.1 Sync.nonfairTryAcquire</h4><br><br><p>nonfairTryAcquire方法将是lock方法间接调用的第一个方法，每次请求锁时都会首先调用该方法。</p><br><br><pre><code>final boolean nonfairTryAcquire(int acquires) {<br>    final Thread current = Thread.currentThread();<br>    int c = getState();<br>    if (c == 0) {<br>        if (compareAndSetState(0, acquires)) {<br>            setExclusiveOwnerThread(current);<br>            return true;<br>        }<br>    }<br>    else if (current == getExclusiveOwnerThread()) {<br>        int nextc = c + acquires;<br>        if (nextc &lt; 0) // overflow<br>            throw new Error(“Maximum lock count exceeded”);<br>        setState(nextc);<br>        return true;<br>    }<br>    return false;<br>}<br></code></pre><br><br><p>该方法会首先判断当前状态，如果c==0说明没有线程正在竞争该锁，如果不c !=0 说明有线程正拥有了该锁。 <br><br>如果发现c==0，则通过CAS设置该状态值为acquires,acquires的初始调用值为1，每次线程重入该锁都会+1，每次unlock都会-1，但为0时释放锁。如果CAS设置成功，则可以预计其他任何线程调用CAS都不会再成功，也就认为当前线程得到了该锁，也作为Running线程，<strong>很显然这个Running线程并未进入等待队列。</strong> <br><br>如果c !=0 但发现自己已经拥有锁，只是简单地++acquires，并修改status值，但因为没有竞争，所以通过setStatus修改，而非CAS，也就是说这段代码实现了偏向锁的功能，并且实现的非常漂亮。</p><br><br><br><br><h4 id="22-abstractqueuedsynchronizeraddwaiter">2.2 AbstractQueuedSynchronizer.addWaiter</h4><br><br><p>addWaiter方法负责把<strong>当前无法获得锁的线程包装为一个Node添加到队尾</strong>：</p><br><br><pre><code>private Node addWaiter(Node mode) {<br>    Node node = new Node(Thread.currentThread(), mode);<br>    // Try the fast path of enq; backup to full enq on failure<br>    Node pred = tail;<br>    if (pred != null) {<br>        node.prev = pred;<br>        if (compareAndSetTail(pred, node)) {<br>            pred.next = node;<br>            return node;<br>        }<br>    }<br>    enq(node);<br>    return node;<br>}<br></code></pre><br><br><p>其中参数mode是独占锁还是共享锁，默认为null，独占锁。追加到队尾的动作分两步： <br><br>如果当前队尾已经存在(tail!=null)，则使用CAS把当前线程更新为Tail <br><br>如果当前<strong>Tail为null或则线程调用CAS设置队尾失败</strong>，则通过enq方法继续设置Tail <br><br>下面是enq方法：</p><br><br><pre><code>private Node enq(final Node node) {<br>    for (;;) {<br>        Node t = tail;<br>        if (t == null) { // Must initialize<br>            Node h = new Node(); // Dummy header<br>            h.next = node;<br>            node.prev = h;<br>            if (compareAndSetHead(h)) {<br>                tail = node;<br>                return h;<br>            }<br>        }<br>        else {<br>            node.prev = t;<br>            if (compareAndSetTail(t, node)) {<br>                t.next = node;<br>                return t;<br>            }<br>        }<br>    }<br>}<br></code></pre><br><br><p>该方法就是<strong>循环调用CAS</strong>，即使有高并发的场景，无限循环将会最终成功把当前线程追加到队尾（或设置队头）。总而言之，<strong>addWaiter的目的就是通过CAS把当前线程追加到队尾，并返回包装后的Node实例。</strong></p><br><br><p>把线程要包装为Node对象的主要原因，除了用Node构造供虚拟队列外，还用Node包装了各种线程状态，这些状态被精心设计为一些数字值：</p><br><br><ul><br><li>SIGNAL(-1) ：线程的后继线程正/已被阻塞，当该线程release或cancel时要重新这个后继线程(unpark)</li><br><li>CANCELLED(1)：因为超时或中断，该线程已经被取消</li><br><li>CONDITION(-2)：表明该线程被处于条件队列，就是因为调用了Condition.await而被阻塞</li><br><li>PROPAGATE(-3)：传播共享锁</li><br><li>0：0代表无状态</li><br></ul><br><br><br><br><h4 id="23-abstractqueuedsynchronizeracquirequeued">2.3 AbstractQueuedSynchronizer.acquireQueued</h4><br><br><p>acquireQueued的主要作用是把已经追加到队列的线程节点（addWaiter方法返回值）进行阻塞，但阻塞前又通过tryAccquire重试是否能获得锁，如果重试成功能则无需阻塞，直接返回</p><br><br><pre><code>final boolean acquireQueued(final Node node, int arg) {<br>    try {<br>        boolean interrupted = false;<br>        for (;;) {<br>            final Node p = node.predecessor();<br>            if (p == head &amp;&amp; tryAcquire(arg)) {<br>                setHead(node);<br>                p.next = null; // help GC<br>                return interrupted;<br>            }<br>            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;<br>                parkAndCheckInterrupt())<br>                interrupted = true;<br>        }<br>    } catch (RuntimeException ex) {<br>        cancelAcquire(node);<br>        throw ex;<br>    }<br>}<br></code></pre><br><br><p>仔细看看这个方法是个无限循环，感觉如果p == head &amp;&amp; tryAcquire(arg)条件不满足循环将永远无法结束，当然不会出现死循环，奥秘在于第12行的<strong>parkAndCheckInterrupt会把当前线程挂起</strong>，从而阻塞住线程的调用栈。</p><br><br><pre><code>private final boolean parkAndCheckInterrupt() {<br>    LockSupport.park(this);<br>    return Thread.interrupted();<br>}<br></code></pre><br><br><p>如前面所述，LockSupport.park最终把线程交给系统（Linux）内核进行阻塞。当然也不是马上把请求不到锁的线程进行阻塞，还要检查该线程的状态，比如如果该线程处于Cancel状态则没有必要，具体的检查在shouldParkAfterFailedAcquire中：</p><br><br><pre><code>  private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {<br>      int ws = pred.waitStatus;<br>      if (ws == Node.SIGNAL)<br>          /<em> 
           </em> This node has already set status asking a release<br>           <em> to signal it, so it can safely park 
           </em>/<br>          return true;<br>      if (ws &gt; 0) {<br>          /<em> 
           </em> Predecessor was cancelled. Skip over predecessors and<br>           <em> indicate retry. 
           </em>/<br>   do {<br>            node.prev = pred = pred.prev;<br>    } while (pred.waitStatus &gt; 0);<br>            pred.next = node;<br>    } else {<br>          /<em> 
           </em> waitStatus must be 0 or PROPAGATE. Indicate that we<br>           <em> need a signal, but don’t park yet. Caller will need to 
           </em> retry to make sure it cannot acquire before parking.<br>           <em>/<br>          compareAndSetWaitStatus(pred, ws, Node.SIGNAL);<br>      }<br>      return false;<br>  }<br></em></code></pre><br><br><p>检查原则在于：</p><br><br><ul><br><li><p>规则1：如果前继的节点状态为SIGNAL，表明当前节点需要unpark，则返回成功，此时acquireQueued方法的第12行（parkAndCheckInterrupt）将导致线程阻塞</p></li><br><li><p>规则2：如果前继节点状态为CANCELLED(ws&gt;0)，说明前置节点已经被放弃，则回溯到一个非取消的前继节点，返回false，acquireQueued方法的无限循环将递归调用该方法，直至规则1返回true，导致线程阻塞</p></li><br><li><p>规则3：如果前继节点状态为非SIGNAL、非CANCELLED，则设置前继的状态为SIGNAL，返回false后进入acquireQueued的无限循环，与规则2同</p></li><br></ul><br><br><p>总体看来，shouldParkAfterFailedAcquire就是靠前继节点判断当前线程是否应该被阻塞，如果前继节点处于CANCELLED状态，<strong>则顺便删除这些节点重新构造队列。</strong> <br><br>至此，锁住线程的逻辑已经完成，下面讨论解锁的过程。</p><br><br><h3 id="解锁">解锁</h3><br><br><p>请求锁不成功的线程会被挂起在acquireQueued方法的第12行，12行以后的代码必须等线程被解锁锁才能执行，假如被阻塞的线程得到解锁，则执行第13行，即设置interrupted = true，之后又进入无限循环。</p><br><br><p>从无限循环的代码可以看出，并不是得到解锁的线程一定能获得锁，必须在第6行中调用tryAccquire重新竞争，因为锁是非公平的，有可能被新加入的线程获得，<strong>从而导致刚被唤醒的线程再次被阻塞</strong>，这个细节充分体现了“非公平”的精髓。通过之后将要介绍的解锁机制会看到，第一个被解锁的线程就是Head，因此p == head的判断基本都会成功。</p><br><br><p>至此可以看到，把tryAcquire方法延迟到子类中实现的做法非常精妙并具有极强的可扩展性，令人叹为观止！当然精妙的不是这个Template设计模式，而是Doug Lea对锁结构的精心布局。</p><br><br><p>解锁代码相对简单，主要体现在AbstractQueuedSynchronizer.release和Sync.tryRelease方法中： <br><br>class AbstractQueuedSynchronizer</p><br><br><pre><code>public final boolean release(int arg) {<br>    if (tryRelease(arg)) {<br>        Node h = head;<br>        if (h != null &amp;&amp; h.waitStatus != 0)<br>            unparkSuccessor(h);<br>        return true;<br>    }<br>    return false;<br>}<br></code></pre><br><br><p>class Sync</p><br><br><pre><code>protected final boolean tryRelease(int releases) {<br>    int c = getState() - releases;<br>    if (Thread.currentThread() != getExclusiveOwnerThread())<br>        throw new IllegalMonitorStateException();<br>    boolean free = false;<br>    if (c == 0) {<br>        free = true;<br>        setExclusiveOwnerThread(null);<br>    }<br>    setState(c);<br>    return free;<br>}<br></code></pre><br><br><p>tryRelease与tryAcquire语义相同，把如何释放的逻辑延迟到子类中。</p><br><br><p>tryRelease语义很明确：如果线程多次锁定，则进行多次释放，直至status==0则真正释放锁，所谓释放锁即设置status为0，因为无竞争所以没有使用CAS。 <br><br>release的语义在于：如果可以释放锁，则唤醒队列第一个线程（Head），具体唤醒代码如下：</p><br><br><pre><code>private void unparkSuccessor(Node node) {<br>    /<br>     <em> If status is negative (i.e., possibly needing signal) try 
     </em> to clear in anticipation of signalling. It is OK if this<br>     <em> fails or if status is changed by waiting thread. 
     </em>/<br>    int ws = node.waitStatus;<br>    if (ws &lt; 0)<br>        compareAndSetWaitStatus(node, ws, 0);<br><br>    /<em> 
     </em> Thread to unpark is held in successor, which is normally<br>     <em> just the next node.  But if cancelled or apparently null, 
     </em> traverse backwards from tail to find the actual<br>     <em> non-cancelled successor. 
     </em>/<br>    Node s = node.next;<br>    if (s == null || s.waitStatus &gt; 0) {<br>        s = null;<br>        for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev)<br>            if (t.waitStatus &lt;= 0)<br>                s = t;<br>    }<br>    if (s != null)<br>        LockSupport.unpark(s.thread);<br>}<br></code></pre><br><br><p>这段代码的意思在于找出第一个可以unpark的线程，一般说来head.next == head，Head就是第一个线程，但Head.next可能被取消或被置为null，因此比较稳妥的办法是从后往前找第一个可用线程。貌似回溯会导致性能降低，其实这个发生的几率很小，所以不会有性能影响。之后便是通知系统内核继续该线程，在Linux下是通过pthread_mutex_unlock完成。之后，被解锁的线程进入上面所说的重新竞争状态。</p><br><br><br><br><h3 id="lock-vs-synchronized">Lock VS Synchronized</h3><br><br><p>AbstractQueuedSynchronizer通过构造一个<strong>基于阻塞的CLH队列</strong>容纳所有的阻塞线程，而对该队列的操作均通过Lock-Free（CAS）操作，但对已经获得锁的线程而言，ReentrantLock实现了偏向锁的功能。</p><br><br><p>synchronized的底层也是一个基于CAS操作的等待队列，但JVM实现的更精细，把等待队列分为ContentionList和EntryList，目的是为了降低线程的出列速度；当然也实现了偏向锁，从数据结构来说二者设计没有本质区别。但synchronized还实现了自旋锁，并针对不同的系统和硬件体系进行了优化，而Lock则完全依靠系统阻塞挂起等待线程。</p><br><br><p>当然Lock比synchronized更适合在应用层扩展，可以继承AbstractQueuedSynchronizer定义各种实现，比如实现读写锁（ReadWriteLock），公平或不公平锁；同时，Lock对应的Condition也比wait/notify要方便的多、灵活的多。</p></div>

</div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/05/12/reflectASM-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/12/reflectASM-01/" itemprop="url">转载:JAVA下高效的反射工具包ReflectASM 使用例解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-12T17:06:29+08:00">
                2017-05-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a title="ReflectASM" href="http://code.google.com/p/reflectasm/" target="_blank">ReflectASM</a>&nbsp;使用字节码生成的方式实现了更为高效的反射机制。执行时会生成一个存取类来 set/get&nbsp;字段，访问方法或创建实例。一看到&nbsp;ASM&nbsp;就能领悟到&nbsp;ReflectASM&nbsp;会用字节码生成的方式，而不是依赖于&nbsp;Java&nbsp;本身的反射机制来实现的，所以它更快，并且避免了访问原始类型因自动装箱而产生的问题。</p><br><p>下面三个图是 ReflectASM&nbsp;与&nbsp;Java&nbsp;自身反射机制的性能对比，表现很不错的。</p><br><p style="text-align: center;"><img class="aligncenter" alt="" src="http://chart.apis.google.com/chart?chma=100&amp;chtt=Field%20Set/Get&amp;chs=700x62&amp;chd=t:1402081,11339107&amp;chds=0,11339107&amp;chxl=0:%7CJava%20Reflection%7CFieldAccess&amp;cht=bhg&amp;chbh=10&amp;chxt=y&amp;chco=6600FF&amp;.png" width="700" height="62"></p><br><p style="text-align: center;"><img class="aligncenter" alt="" src="http://chart.apis.google.com/chart?chma=100&amp;chtt=Method%20Call&amp;chs=700x62&amp;chd=t:97390,208750&amp;chds=0,208750&amp;chxl=0:%7CJava%20Reflection%7CMethodAccess&amp;cht=bhg&amp;chbh=10&amp;chxt=y&amp;chco=6600AA&amp;.png" width="700" height="62"></p><br><p style="text-align: center;"><img class="aligncenter" alt="" src="http://chart.apis.google.com/chart?chma=100&amp;chtt=Constructor&amp;chs=700x62&amp;chd=t:2853063,5828993&amp;chds=0,5828993&amp;chxl=0:%7CJava%20Reflection%7CConstructorAccess&amp;cht=bhg&amp;chbh=10&amp;chxt=y&amp;chco=660066&amp;.png" width="700" height="62"></p><br><p>测试代码包含在项目文件中.&nbsp;上面图形是在&nbsp; Oracle 的 Java 7u3, server VM&nbsp;下测试出的结果。</p><br><p>下面我们自己来做个测试，测试环境是 Mac OS X 10.8, 2.4G Core 2 Duo, 4G RAM, 64 位&nbsp;JDK 1.6.<span id="more-4685"></span></p><br><p>待反射的类 SomeClass.java</p><br><pre class="brush:java">package cc.unmi.testreflect;<br><br>public class SomeClass {<br>&nbsp;&nbsp; &nbsp;private String name;<br><br>&nbsp;&nbsp; &nbsp;public void foo(String name) {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;this.name = name;<br>&nbsp;&nbsp; &nbsp;}<br>}</pre><br><p>测试类 ReflectasmClient.java</p><br><pre class="brush:java">package cc.unmi.testreflect;<br><br>import java.lang.reflect.Method;<br>import com.esotericsoftware.reflectasm.MethodAccess;<br><br>/<em>*<br>&nbsp;</em> @author Unmi<br>&nbsp;*/<br>public class ReflectasmClient {<br><br>&nbsp;&nbsp; &nbsp;public static void main(String[] args) throws Exception {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;testJdkReflect();<br>//&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;testReflectAsm();<br>&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;public static void testJdkReflect() throws Exception {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;SomeClass someObject = new SomeClass();&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int i = 0; i &lt; 5; i++) {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;long begin = System.currentTimeMillis();<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int j = 0; j &lt; 100000000; j++) {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Method method = SomeClass.class.getMethod(“foo”, String.class);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;method.invoke(someObject, “Unmi”);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;System.out.print(System.currentTimeMillis() - begin +” “);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp; &nbsp;}<br><br>&nbsp;&nbsp; &nbsp;public static void testReflectAsm() {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;SomeClass someObject = new SomeClass();<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int i = 0; i &lt; 5; i++) {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;long begin = System.currentTimeMillis();<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int j = 0; j &lt; 100000000; j++) {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;MethodAccess access = MethodAccess.get(SomeClass.class);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;access.invoke(someObject, “foo”, “Unmi”);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;System.out.print(System.currentTimeMillis() - begin + “ “);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp; &nbsp;}<br>}</pre><br><p>分别运行 testJdkReflect()&nbsp;和 testReflectAsm 得出各自的运行时间数据，如下：</p><br><p>运行&nbsp;testJdkReflect():&nbsp; 31473 31663 31578 31658 31552</p><br><p>运行 testReflectAsm(): 312814 310666 312867 311234 311792</p><br><p>这个数据是非常恐怖的，似乎在带领我们往相反的方向上走，用 ReflectASM&nbsp;怎么反而耗时多的多，高一个数量级，为什么呢？原因是大部分的时间都耗费在了</p><br><p>MethodAccess access = MethodAccess.get(SomeClass.class);</p><br><p>上，正是生成字节码的环节上，也让你体验到 MethodAccess&nbsp;是个无比耗时的操作，如果把这行放到循环之外会是什么样的结果呢，同时也把方法 testJdkReflect()&nbsp;中的</p><br><p>Method method = SomeClass.class.getMethod(“foo”, String.class);</p><br><p>也提出去，改变后的 testJdkReflect()&nbsp;和 testReflectAsm()&nbsp;分别如下：</p><br><pre class="brush:java">&nbsp;&nbsp;&nbsp; public static void testJdkReflect() throws Exception {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;SomeClass someObject = new SomeClass();&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;Method method = SomeClass.class.getMethod(“foo”, String.class);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int i = 0; i &lt; 5; i++) {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;long begin = System.currentTimeMillis();<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int j = 0; j &lt; 100000000; j++) {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;method.invoke(someObject, “Unmi”);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;System.out.print(System.currentTimeMillis() - begin +” “);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp; &nbsp;}<br><br>&nbsp;&nbsp; &nbsp;public static void testReflectAsm() {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;SomeClass someObject = new SomeClass();<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;MethodAccess access = MethodAccess.get(SomeClass.class);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int i = 0; i &lt; 5; i++) {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;long begin = System.currentTimeMillis();<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int j = 0; j &lt; 100000000; j++) {&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;access.invoke(someObject, “foo”, “Unmi”);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;System.out.print(System.currentTimeMillis() - begin + “ “);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp; &nbsp;}</pre><br><p>再次分别跑下 testJdkReflect()&nbsp;和&nbsp; testReflectAsm()，新的结果如下：</p><br><p>运行&nbsp;testJdkReflect():&nbsp; 1682 1696 1858 1774 1780 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ——&nbsp;平均&nbsp; 1758</p><br><p>运行 testReflectAsm(): 327 549 520 509 514 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ——&nbsp;平均 483.8</p><br><p>胜负十分明显，上面的实验两相一比较，用 ReflectAsm&nbsp;进行方法调用节省时间是 72.48％</p><br><p>也因此可以得到使用 ReflectASM&nbsp;时需特别注意的是，获得类似 MethodAccess&nbsp;实例只做一次，或它的实例应缓存起来，才是真正用好 ReflectASM。</p><br><p>进一步深入的话，不妨看看分别从 testJdkReflect()/testReflectAsm()&nbsp;到&nbsp;SomeClass.foo()&nbsp;过程中到底发生了什么，断点看调用栈。</p><br><p>testJdkReflect()&nbsp;到&nbsp;SomeClass.foo()&nbsp;的调用栈：</p><br><p style="text-align: center;"><img class="aligncenter  wp-image-4688" title="testJdkReflect_debug" alt="" src="http://unmi.cc/wp-content/uploads/2012/08/testJdkReflect_debug.png" srcset="https://unmi.cc/wp-content/uploads/2012/08/testJdkReflect_debug.png 645w, https://unmi.cc/wp-content/uploads/2012/08/testJdkReflect_debug-300x158.png 300w" sizes="(max-width: 645px) 100vw, 645px"></p><br><p>借助了&nbsp;JDK&nbsp;的 DelegatingMethodAccessorImpl&nbsp;和&nbsp; NativeMethodAccessorImpl。</p>

<!-- Easy Plugin for AdSense V8.7 -->
<!-- [midtext: 1 urCount: 1 urMax: 0] -->
<p><div class="ezAdsense adsense adsense-midtext" style="float:left;margin:12px;"><span class="inner_copyright"><!--POST_URL--></span></div><br><!-- Easy Plugin for AdSense V8.7 --></p>
<p>再看 testReflectAsm()&nbsp;到 SomeClass.foo(）的调用栈：</p><br><p style="text-align: center;"><img class="aligncenter  wp-image-4689" title="testReflectAsm_debug" alt="" src="http://unmi.cc/wp-content/uploads/2012/08/testReflectAsm_debug.png" srcset="https://unmi.cc/wp-content/uploads/2012/08/testReflectAsm_debug.png 645w, https://unmi.cc/wp-content/uploads/2012/08/testReflectAsm_debug-300x158.png 300w" sizes="(max-width: 645px) 100vw, 645px"></p><br><p>可以看到，ReflectAsm&nbsp;在执行 MethodAccess access = MethodAccess.get(SomeClass.class);&nbsp;为你生成了类 SomeClassMethodAccess，经由它来进行后续的方法调用，使得性能上有很可观的改善。</p><br><p>上面只是讲述了，调用方法时如何使用 ReflectAsm，以及怎么确保高效性。下面补上 ReflectAsm&nbsp;更多的用法，翻译自 ReflectAsm&nbsp;官方。</p><br><hr><br><p>ReflectASM&nbsp;反射调用方法:</p><br><pre class="brush:java">SomeClass someObject = …<br>MethodAccess access = MethodAccess.get(SomeClass.class);<br>access.invoke(someObject, “setName”, “Awesome McLovin”);<br>String name = (String)access.invoke(someObject, “getName”);</pre><br><p>用 ReflectASM&nbsp;反射来 set/get&nbsp;字段值:</p><br><pre class="brush:java">SomeClass someObject = …<br>FieldAccess access = FieldAccess.get(SomeClass.class);<br>access.set(someObject, “name”, “Awesome McLovin”);<br>String name = (String)access.get(someObject, “name”);</pre><br><p>用 ReflectASM&nbsp;反射来调用构造方法:</p><br><pre class="brush:java">ConstructorAccess&lt;SomeClass&gt; access = ConstructorAccess.get(SomeClass.class);<br>SomeClass someObject = access.newInstance();</pre><br><p><strong>避免用方法名来查找</strong></p><br><p>为了在重复性的反射来访问方法或字段时最大化性能，应该用方法和字段的索引来定位而不是名称：</p><br><pre class="brush:java">SomeClass someObject = …<br>MethodAccess access = MethodAccess.get(SomeClass.class);<br>int addNameIndex = access.getIndex(“addName”);<br>for (String name : names)<br>&nbsp; &nbsp; access.invoke(someObject, addNameIndex, “Awesome McLovin”);</pre><br><p>说到这，不妨再次来验证一下，把 testReflectAsm()&nbsp;方法改为如下：</p><br><pre class="brush:java">&nbsp;&nbsp;&nbsp; public static void testReflectAsm() {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;SomeClass someObject = new SomeClass();<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;MethodAccess access = MethodAccess.get(SomeClass.class);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;int fooIndex = access.getIndex(“foo”, String.class);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int i = 0; i &lt; 5; i++) {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;long begin = System.currentTimeMillis();<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (int j = 0; j &lt; 100000000; j++) {&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;access.invoke(someObject, fooIndex, “Unmi”);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;System.out.print(System.currentTimeMillis() - begin + “ “);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp; &nbsp;}</pre><br><p>运行的输出结果是，你可能想像不到的：</p><br><p>206 182 171 175 171</p><br><p>而用名称查找方法时的测试数据为：327 549 520 509 514</p><br><p>当然你调用的重复性应该带有一点夸张性质的。性能更优化的原因是用名称来查找最科要被转换成索引来查找。</p><br><p><strong>可见性</strong></p><br><p>ReflectASM&nbsp;总是能访问公有成员的.&nbsp;它会尝试在同一个 package&nbsp;中去定义访问类的，并且同一个类加载器去加载。所以，如果安全管理器允许 setAccessible&nbsp;调用成功的话，protected&nbsp;或包私有(package private)&nbsp;的成员也可被访问到.&nbsp;假如 setAccessible&nbsp;失败，仅当当有公有成员可被访问时，不会有异常抛出.&nbsp;私有成员总是无法访问到。</p><br><p><strong>有关异常</strong></p><br><p>当使用 ReflectASM&nbsp;有异常时，栈跟踪更清淅了。这是 Java&nbsp;在反射调用方法时抛出了一个 RuntimeException 异常：</p><br><pre class="brush:java">Exception in thread “main” java.lang.reflect.InvocationTargetException<br>&nbsp; &nbsp; &nbsp; &nbsp; at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>&nbsp; &nbsp; &nbsp; &nbsp; at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)<br>&nbsp; &nbsp; &nbsp; &nbsp; at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)<br>&nbsp; &nbsp; &nbsp; &nbsp; at java.lang.reflect.Method.invoke(Method.java:597)<br>&nbsp; &nbsp; &nbsp; &nbsp; at com.example.SomeCallingCode.doit(SomeCallingCode.java:22)<br>Caused by: java.lang.RuntimeException<br>&nbsp; &nbsp; &nbsp; &nbsp; at com.example.SomeClass.someMethod(SomeClass.java:48)<br>&nbsp; &nbsp; &nbsp; &nbsp; … 5 more</pre><br><p>再看用 ReflectASM&nbsp;时抛出的同样的异常:</p><br><pre class="brush:java">Exception in thread “main” java.lang.RuntimeException<br>&nbsp; &nbsp; &nbsp; &nbsp; at com.example.SomeClass.someMethod(SomeClass.java:48)<br>&nbsp; &nbsp; &nbsp; &nbsp; at com.example.SomeClassMethodAccess.invoke(Unknown Source)<br>&nbsp; &nbsp; &nbsp; &nbsp; at com.example.SomeCallingCode.doit(SomeCallingCode.java:22)</pre><br><p>如果被 ReflectASM&nbsp;调用的代码抛出了需检测的异常，也需要抛出需检测异常.&nbsp;因为如果你在用 try/catch&nbsp;捕获块中未声明抛出的具体类型的异常时会报编译错误。（Unmi&nbsp;注：这句话的意思是说，比如方法 foo()&nbsp;未声明抛出 IOException，而你 try&nbsp;它时却 catch(IOException)&nbsp;就会出现编译错误）所以当你在用 ReflectASM 反射调用，并需要关心其中抛出的异常时，你必须捕获的异常类型是 Exception。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/05/12/reflectASM-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/12/reflectASM-02/" itemprop="url">转载:浅析高性能反射ReflectASM</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-12T16:18:38+08:00">
                2017-05-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
              <div id="blog_content" class="blog_content"><br>    <strong>什么是ReflectASM</strong>&nbsp;&nbsp;&nbsp; ReflectASM是一个很小的java类库，主要是通过asm生产类来实现java反射，执行速度非常快，看了网上很多和反射的对比，觉得ReflectASM比较神奇，很想知道其原理，下面介绍下如何使用及原理。<br><br><br><br><strong>如何使用</strong> <pre name="code" class="java"><br>public class User {<br>    private int id;<br>    private String name;<br><br>    public int getId() {<br>        return id;<br>    }<br><br>    public void setId(int id) {<br>        this.id = id;<br>    }<br><br>    public String getName() {<br>        return name;<br>    }<br><br>    public void setName(String name) {<br>        this.name = name;<br>    }<br>}<br><br><br><br>public class ReflectAsmTest {<br>    public static void main(String[] args) {<br>        User user = new User();<br>        //使用reflectasm生产User访问类<br>        MethodAccess access = MethodAccess.get(User.class);<br>        //invoke setName方法name值<br>        access.invoke(user, “setName”, “张三”);<br>        //invoke getName方法 获得值<br>        String name = (String)access.invoke(user, “getName”, null);<br>        System.out.println(name);<br>    }<br>}</pre><br><br><br><br>输出：<br><br>张三<br><br><br><br><strong>原理</strong><br><br>&nbsp;&nbsp; 上面代码的确实现反射的功能，代码主要的核心是 MethodAccess.get(User.class);<br><br>看了下源码，这段代码主要是通过asm生产一个User的处理类 UserMethodAccess（这个类主要是实现了invoke方法）的ByteCode，然后获得该对象，通过上面的invoke操作user类。<br><br><br><br>MethodAccess反编辑源码<br><br><pre name="code" class="java"><br>// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.<br>// Jad home page: <a href="http://www.kpdus.com/jad.html" target="_blank" rel="external">http://www.kpdus.com/jad.html</a><br>// Decompiler options: packimports(3)<br><br>package com.johhny.ra;<br><br>import com.esotericsoftware.reflectasm.MethodAccess;<br><br>// Referenced classes of package com.johhny.ra:<br>//            User<br><br>public class UserMethodAccess extends MethodAccess<br>{<br><br>    public UserMethodAccess()<br>    {<br>    }<br><br>    /<em>*
     </em> 这个方法是主要是实现了MethodAccess 的抽象方法，来实现反射的功能<br>     <em> @param obj  需要反射的对象
     </em> @param i  class.getDeclaredMethods 对应方法的index<br>     <em> @param 参数对象集合
     </em> @return<br>     */<br>    public transient Object invoke(Object obj, int i, Object aobj[])<br>    {<br>        User user = (User)obj;<br>        switch(i)<br>        {<br>        case 0: // ‘\0’<br>            return user.getName();<br><br>        case 1: // ‘\001’<br>            return Integer.valueOf(user.getId());<br><br>        case 2: // ‘\002’<br>            user.setName((String)aobj[0]);<br>            return null;<br><br>        case 3: // ‘\003’<br>            user.setId(((Integer)aobj[0]).intValue());<br>            return null;<br>        }<br>        throw new IllegalArgumentException((new StringBuilder(“Method not found: “)).append(i).toString());<br>    }<br>}<br></pre>：<br><br><br><br>看了UserMethodAccess源码后明白 ReflectASM 为什么会比java放射快那么多，其实就是我们的bean调用里面的方法，速度当然很快<br><br><br><br><strong>注意：</strong><br><br>&nbsp;&nbsp;&nbsp; 1. MethodAccess.get()方法比较耗时的,特别是类方法比较多的时候，如果生成的反射类用到的地方比较多或者会多次调用，建议缓存下来，如果使用次数很少建议还是使用反射来完成功能<br><br>&nbsp;&nbsp;&nbsp;<br>  </div>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/05/12/class-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/12/class-01/" itemprop="url">转载:Java类加载机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-12T16:02:45+08:00">
                2017-05-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="tony_body"><br><h2>一、Java类加载机制</h2><br></div><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">1．概述</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Class文件由类装载器装载后，在JVM中将形成一份描述Class结构的元信息对象，通过该元信息对象可以获知Class的结构信息：如构造函数，属性和方法等，Java允许用户借由这个Class相关的元信息对象间接调用Class对象的功能。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;虚拟机把描述类的数据从class文件加载到内存，并对数据进行校验，转换解析和初始化，最终形成可以被虚拟机直接使用的Java类型，这就是虚拟机的类加载机制。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">2．工作机制</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;类装载器就是寻找类的字节码文件，并构造出类在JVM内部表示的对象组件。在Java中，类装载器把一个类装入JVM中，要经过以下步骤：</span></p><br><p class="p0" style="margin-left: 60px;"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1)&nbsp;装载：查找和导入Class文件；</span></p><br><p class="p0" style="margin-left: 60px;"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)&nbsp;链接：把类的二进制数据合并到JRE中；</span></p><br><p class="p0" style="margin-left: 60px;"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(a)校验：检查载入Class文件数据的正确性；</span></p><br><p class="p0" style="margin-left: 60px;"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(b)准备：给类的静态变量分配存储空间；</span></p><br><p class="p0" style="margin-left: 60px;"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(c)解析：将符号引用转成直接引用；</span></p><br><p class="p0" style="margin-left: 60px;"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)&nbsp;初始化：对类的静态变量，静态代码块执行初始化操作</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;"><img style="display: block; margin-left: auto; margin-right: auto;" src="http://images.cnitblog.com/blog/400827/201409/172116264092898.png" alt=""></span></p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp; &nbsp; &nbsp; Java程序可以动态扩展是由运行期动态加载和动态链接实现的；比如：如果编写一个使用接口的应用程序，可以等到运行时再指定其实际的实现(多态)，解析过程有时候还可以在初始化之后执行；比如：动态绑定(多态)；</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ff0000;">【类初始化】</span>&nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1)&nbsp;遇到new、getstatic、putstatic或invokestatic这4条字节码指令时，如果类没有进行过初始化，则需要先触发其初始化。生成这4条指令的最常见的Java代码场景是：使用new关键字实例化对象的时候，读取或设置一个类的静态字段（被final修饰、已在编译期把结果放入常量池的静态字段除外）的时候，以及调用一个类的静态方法的时候。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)&nbsp;使用java.lang.reflect包的方法对类进行反射调用的时候，如果类没有进行过初始化，则需要先触发其初始化。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)&nbsp;当初始化一个类的时候，如果发现其父类还没有进行过初始化，则需要先触发其父类的初始化。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp; &nbsp; &nbsp; (4)当虚拟机启动时，用户需要指定一个要执行的主类（包含main()方法的那个类），虚拟机会先初始化这个主类。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">只有上述四种情况会触发初始化，也称为对一个类进行主动引用，除此以外，所有其他方式都不会触发初始化，称为被动引用</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">代码清单1</span></p><br><p class="p0" style="margin-left: 60px;"><span style="font-family: 'courier new', courier; font-size: 16px;"><img style="float: left;" src="http://images.cnitblog.com/blog/400827/201409/172118431435624.png" alt=""></span></p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">上述代码运行后，只会输出【—SuperClass&nbsp;init】,&nbsp;而不会输出【SubClass&nbsp;init】,<span style="background-color: #33cccc;">对于静态字段，只有直接定义这个字段的类才会被初始化</span>,因此，通过子类来调用父类的静态字段，只会触发父类的初始化,但是这是要看不同的虚拟机的不同实现。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">代码清单2</span></p><br><p class="p0" style="margin-left: 60px;"><span style="font-family: 'courier new', courier; font-size: 16px;"><img style="float: left;" src="http://images.cnitblog.com/blog/400827/201409/172122331434025.png" alt=""></span></p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">此处不会引起SuperClass的初始化，但是却触发了【[Ltest.SuperClass】的初始化，通过arr.toString()可以看出，对于用户代码来说，这不是一个合法的类名称，它是由虚拟机自动生成的，直接继承于Object的子类，创建动作由字节码指令newarray触发,此时数组越界检查也会伴随数组对象的所有调用过程，越界检查并不是封装在数组元素访问的类中，而是封装在数组访问的xaload,xastore字节码指令中.</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">代码清单3</span></p><br><p class="p0" style="margin-left: 60px;"><span style="font-family: 'courier new', courier; font-size: 16px;"><img style="float: left;" src="http://images.cnitblog.com/blog/400827/201409/172123338006093.png" alt=""></span></p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">对常量ConstClass.value&nbsp;的引用实际都被转化为NotInitialization类对自身常量池的引用，这两个类被编译成class后不存在任何联系。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ff0000;">【装载】</span></span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp; &nbsp; 在装载阶段，虚拟机需要完成以下3件事情</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1)&nbsp;通过一个类的全限定名来获取定义此类的二进制字节流</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)&nbsp;将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)&nbsp;在Java堆中生成一个代表这个类的java.lang.Class对象，作为方法区这些数据的访问入口。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;虚拟机规范中并没有准确说明二进制字节流应该从哪里获取以及怎样获取,这里可以通过定义自己的类加载器去控制字节流的获取方式。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="background-color: #ff0000;">【验证】</span></span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;虚拟机如果不检查输入的字节流，对其完全信任的话，很可能会因为载入了有害的字节流而导致系统奔溃。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="background-color: #ff0000;">【准备】</span></span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp; &nbsp; 准备阶段是正式为类变量分配并设置类变量初始值的阶段，这些内存都将在方法区中进行分配,需要说明的是：</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">这时候进行内存分配的仅包括类变量(被static修饰的变量),而不包括实例变量,实例变量将会在对象实例化时随着对象一起分配在Java堆中;这里所说的初始值&ldquo;通常情况&rdquo;是数据类型的零值，假如:</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">public&nbsp;static&nbsp;int&nbsp;value&nbsp;=&nbsp;123;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">value在准备阶段过后的初始值为0而不是123,而把value赋值的putstatic指令将在初始化阶段才会被执行</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;</span>&nbsp;</p><br><div id="tony_body"><br><h2>二、类加载器与双亲委派模型</h2><br></div><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #c0c0c0;">类加载器</span></span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1)&nbsp;Bootstrap&nbsp;ClassLoader&nbsp;:&nbsp;将存放于&lt;JAVA_HOME&gt;\lib目录中的，或者被-Xbootclasspath参数所指定的路径中的，并且是虚拟机识别的（仅按照文件名识别，如&nbsp;rt.jar&nbsp;名字不符合的类库即使放在lib目录中也不会被加载）类库加载到虚拟机内存中。启动类加载器无法被Java程序直接引用</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)&nbsp;Extension&nbsp;ClassLoader&nbsp;:&nbsp;将&lt;JAVA_HOME&gt;\lib\ext目录下的，或者被java.ext.dirs系统变量所指定的路径中的所有类库加载。开发者可以直接使用扩展类加载器。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)&nbsp;Application&nbsp;ClassLoader&nbsp;:&nbsp;负责加载用户类路径(ClassPath)上所指定的类库,开发者可直接使用。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><br><p class="p0" style="text-align: center;"><span style="font-family: 'courier new', courier; font-size: 16px;">双亲委派模型</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;"><img style="display: block; margin-left: auto; margin-right: auto;" src="http://images.cnitblog.com/blog/400827/201409/172124489257909.png" alt=""></span></p><br><p class="p0">&nbsp;</p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">工作过程：如果一个类加载器接收到了类加载的请求，它首先把这个请求委托给他的父类加载器去完成，每个层次的类加载器都是如此，因此所有的加载请求都应该传送到顶层的启动类加载器中，只有当父加载器反馈自己无法完成这个加载请求（它在搜索范围中没有找到所需的类）时，子加载器才会尝试自己去加载。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;好处：java类随着它的类加载器一起具备了一种带有优先级的层次关系。例如类java.lang.Object，它存放在rt.jar中，无论哪个类加载器要加载这个类，最终都会委派给启动类加载器进行加载，因此Object类在程序的各种类加载器环境中都是同一个类。相反，如果用户自己写了一个名为java.lang.Object的类，并放在程序的Classpath中，那系统中将会出现多个不同的Object类，java类型体系中最基础的行为也无法保证，应用程序也会变得一片混乱。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;java.lang.ClassLoader中几个最重要的方法:</span></p><br><div class="cnblogs_code"><br><pre><span style="font-family: 'courier new', courier; font-size: 16px;"><span style="color: #008000;">//</span><span style="color: #008000;">加载指定名称（包括包名）的二进制类型，供用户调用的接口</span><br><span style="color: #0000ff;">public</span> Class&lt;?&gt;<span style="color: #000000;"> loadClass(String name);<br></span><span style="color: #008000;">//</span><span style="color: #008000;">加载指定名称（包括包名）的二进制类型，同时指定是否解析（但是，这里的resolve参数不一定真正能达到解析的效果），供继承用</span><br><span style="color: #0000ff;">protected</span> synchronized Class&lt;?&gt;<span style="color: #000000;"> loadClass(String name, boolean resolve);<br></span><span style="color: #0000ff;">protected</span> Class&lt;?&gt;<span style="color: #000000;"> findClass(String name)<br></span><span style="color: #008000;">//</span><span style="color: #008000;">定义类型，一般在findClass方法中读取到对应字节码后调用，可以看出不可继承（说明：JVM已经实现了对应的具体功能，解析对应的字节码，产生对应的内部数据结构放置到方法区，所以无需覆写，直接调用就可以了）</span><br><span style="color: #0000ff;">protected</span> final Class&lt;?&gt; defineClass(String name, <span style="color: #0000ff;">byte</span>[] b, <span style="color: #0000ff;">int</span> off, <span style="color: #0000ff;">int</span> len) throws ClassFormatError{}</span></pre><br></div><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">如下是实现双亲委派模型的主要代码：</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;"><img style="float: left;" src="http://images.cnitblog.com/blog/400827/201409/172127007684697.png" alt=""></span></p><br><p>&nbsp;</p><br><div id="tony_body"><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><p>&nbsp;</p><br><h2>三、反射</h2><br></div><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reflection机制允许程序在正在执行的过程中，利用Reflection&nbsp;APIs取得任何已知名称的类的内部信息，包括：package、&nbsp;type&nbsp;parameters、&nbsp;superclass、&nbsp;implemented&nbsp;interfaces、&nbsp;inner&nbsp;classes、&nbsp;outer&nbsp;classes、&nbsp;fields、&nbsp;constructors、&nbsp;methods、&nbsp;modifiers等，并可以在执行的过程中，动态生成instances、变更fields内容或唤起methods。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1、获取构造方法</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">Class类提供了四个public方法，用于获取某个类的构造方法。</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">Constructor&nbsp;getConstructor(Class[]&nbsp;params) &nbsp; &nbsp;&nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">根据构造函数的参数，返回一个具体的具有public属性的构造函数</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">　　　　Constructor&nbsp;getConstructors() &nbsp; &nbsp;&nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">返回所有具有public属性的构造函数数组</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">　　　　Constructor&nbsp;getDeclaredConstructor(Class[]&nbsp;params) &nbsp; &nbsp;&nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">根据构造函数的参数，返回一个具体的构造函数（不分public和非public属性）</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">　　　　Constructor&nbsp;getDeclaredConstructors() &nbsp; &nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">返回该类中所有的构造函数数组（不分public和非public属性）</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;"><img style="float: left;" src="http://images.cnitblog.com/blog/400827/201409/172128068463077.png" alt=""></span></p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">2、获取类的成员方法</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">与获取构造方法的方式相同，存在四种获取成员方法的方式。</span><span style="font-family: 'courier new', courier; font-size: 16px;">　</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">Method&nbsp;getMethod(String&nbsp;name,&nbsp;Class[]&nbsp;params) &nbsp; &nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">根据方法名和参数，返回一个具体的具有public属性的方法</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">　　　　Method[]&nbsp;getMethods() &nbsp; &nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">返回所有具有public属性的方法数组</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">　　　　Method&nbsp;getDeclaredMethod(String&nbsp;name,&nbsp;Class[]&nbsp;params)&nbsp;&nbsp;&nbsp;&nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">根据方法名和参数，返回一个具体的方法（不分public和非public属性）</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">　　　　Method[]&nbsp;getDeclaredMethods() &nbsp; &nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">返回该类中的所有的方法数组（不分public和非public属性）</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">　　</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;"><img style="float: left;" src="http://images.cnitblog.com/blog/400827/201409/172128597681209.png" alt=""></span></p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0">&nbsp;</p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">3、获取类的成员变量（成员属性）</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">存在四种获取成员属性的方法</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">　　　　Field&nbsp;getField(String&nbsp;name) &nbsp; &nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">根据变量名，返回一个具体的具有public属性的成员变量</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">　　　　Field[]&nbsp;getFields() &nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">返回具有public属性的成员变量的数组</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">　　　　Field&nbsp;getDeclaredField(String&nbsp;name) &nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">根据变量名，返回一个成员变量（不分public和非public属性）</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">　　　　Field[]&nbsp;getDelcaredFields() &nbsp; &nbsp;</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">返回所有成员变量组成的数组（不分public和非public属性）</span></p><br><p class="p0"><span style="font-family: 'courier new', courier; font-size: 16px;">&nbsp;</span></p><br><p><span style="font-size: 16px;">&nbsp;参考：</span></p><br><p><span style="font-size: 16px;">《深入理解JVM虚拟机》</span></p><br><p><span style="font-size: 16px;"><span style="font-family: 'courier new', courier;"><a href="http://unmi.cc/java-reflectasm-bytecode-usage/" target="_blank">Java 下高效的反射工具包 ReflectASM 使用例解</a></span></span>&nbsp;</p><br><p><span style="font-size: 16px;"><a id="cb_post_title_url" href="http://www.cnblogs.com/mengdd/p/3725472.html" target="_blank" rel="external">ReflectUitls类的编写和对反射机制的解析</a></span></p><br><p>&nbsp;<a href="https://github.com/cglib/cglib" target="_blank">Cglib源码</a></p><div id="MySignature"></div><br><div class="clear"></div><br><div id="blog_post_info_block"><br><div id="BlogPostCategory"></div><br><div id="EntryTag"></div><br><div id="blog_post_info"><br></div>

</div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/05/11/restful-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/11/restful-02/" itemprop="url">转载:JAX-RS规范基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-11T17:44:30+08:00">
                2017-05-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="article_content" class="article_content"><br><br><p><strong><span style="font-size:18px; background-color:rgb(102,255,255)">1：概念与常用注解</span></strong></p><br><p><span style="font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px">JAX-RS是一套用java实现REST服务的规范，提供了一些标注将一个资源类，一个</span><a target="_blank" title="POJO" class="new" href="http://liugang594.iteye.com/w/index.php?title=POJO&amp;action=edit&amp;redlink=1" style="font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px; color:rgb(16,138,198)"><span style="color:rgb(186,0,0)">POJO</span></a><span style="font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px">Java类，封装为Web资源。标注包括：</span></p><br><p></p><br><ul style="margin:0px 0px 1.5em; padding:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br><li style="margin:0px 0px 0.25em 30px; padding:0px">@Path，标注资源类或方法的相对路径</li><li style="margin:0px 0px 0.25em 30px; padding:0px">@GET，@PUT，@POST，@DELETE，标注方法是用的HTTP请求的类型</li><li style="margin:0px 0px 0.25em 30px; padding:0px">@Produces，标注返回的MIME媒体类型</li><li style="margin:0px 0px 0.25em 30px; padding:0px">@Consumes，标注可接受请求的<a target="_blank" title="MIME" href="http://liugang594.iteye.com/wiki/MIME" style="color:rgb(16,138,198)">MIME</a>媒体类型</li><li style="margin:0px 0px 0.25em 30px; padding:0px">@PathParam，@QueryParam，@HeaderParam，@CookieParam，@MatrixParam，@FormParam,分别标注方法的参数来自于HTTP请求的不同位置，例如@PathParam来自于URL的路径，@QueryParam来自于URL的查询参数，@HeaderParam来自于HTTP请求的头信息，@CookieParam来自于HTTP请求的Cookie。</li></ul><br><div><strong><span style="font-size:18px; background-color:rgb(102,255,255)">2：JAX-RS的几种实现</span></strong></div><br><div><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br>&nbsp; &nbsp; 目前JAX-RS的实现包括：</p><br><ul style="margin:0px 0px 1.5em; padding:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br><li style="margin:0px 0px 0.25em 30px; padding:0px"><a target="_blank" title="Apache CXF" href="http://liugang594.iteye.com/wiki/Apache_CXF" style="color:rgb(16,138,198)">Apache CXF</a>，开源的<a target="_blank" title="Web服务" href="http://liugang594.iteye.com/wiki/Web%E6%9C%8D%E5%8A%A1" style="color:rgb(16,138,198)">Web服务</a>框架。</li><li style="margin:0px 0px 0.25em 30px; padding:0px"><a target="_blank" title="Jersey" class="new" href="http://liugang594.iteye.com/w/index.php?title=Jersey&amp;action=edit&amp;redlink=1" style="color:rgb(16,138,198)"><span style="color:rgb(186,0,0)">Jersey</span></a>，<br> 由<a target="_blank" title="Sun" href="http://liugang594.iteye.com/wiki/Sun" style="color:rgb(16,138,198)">Sun</a>提供的JAX-RS的参考实现。</li><li style="margin:0px 0px 0.25em 30px; padding:0px"><a target="_blank" title="RESTEasy" class="new" href="http://liugang594.iteye.com/w/index.php?title=RESTEasy&amp;action=edit&amp;redlink=1" style="color:rgb(16,138,198)"><span style="color:rgb(186,0,0)">RESTEasy</span></a>，<a target="_blank" title="JBoss" href="http://liugang594.iteye.com/wiki/JBoss" style="color:rgb(16,138,198)">JBoss</a>的实现。</li><li style="margin:0px 0px 0.25em 30px; padding:0px"><a target="_blank" title="Restlet" class="new" href="http://liugang594.iteye.com/w/index.php?title=Restlet&amp;action=edit&amp;redlink=1" style="color:rgb(16,138,198)"><span style="color:rgb(186,0,0)">Restlet</span></a>，由Jerome<br> Louvel和Dave Pawson开发，是最早的REST框架，先于JAX-RS出现。</li><li style="margin:0px 0px 0.25em 30px; padding:0px"><a target="_blank" title="Apache Wink" class="new" href="http://liugang594.iteye.com/w/index.php?title=Apache_Wink&amp;action=edit&amp;redlink=1" style="color:rgb(16,138,198)"><span style="color:rgb(186,0,0)">Apache<br> Wink</span></a>，一个<a target="_blank" title="Apache软件基金会" href="http://liugang594.iteye.com/wiki/Apache%E8%BD%AF%E4%BB%B6%E5%9F%BA%E9%87%91%E4%BC%9A" style="color:rgb(16,138,198)">Apache软件基金会</a>孵化器中的项目，其服务模块实现JAX-RS规范</li></ul><br><div><span style="font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:18px"><span style="line-height:25.1875px; background-color:rgb(102,255,255)"><strong>3：常用注解范例</strong></span></span></div><br><div><span style="font-family:Helvetica,Tahoma,Arial,sans-serif"><span style="font-size:14px; line-height:25.1875px"><span style="color:#ff0000">（1）<span style="font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px">PathParam</span></span></span></span></div><br><div><span style="font-family:Helvetica,Tahoma,Arial,sans-serif"><span style="font-size:14px; line-height:25.1875px"><span style="font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"></span></span></span><br><div class="dp-highlighter" id="" style="font-family:Monaco,'DejaVu Sans Mono','Bitstream Vera Sans Mono',Consolas,'Courier New',monospace; width:679px; overflow:auto; margin-left:9px; padding:1px; word-break:break-all; word-wrap:break-word; line-height:25.1875px"><br><div class="bar"><br><div class="tools" style="padding:3px; margin:0px; font-weight:bold">Java代码&nbsp;&nbsp;<a target="_blank" title="收藏这段代码" style="text-decoration:underline"><img class="star" src="http://liugang594.iteye.com/images/icon_star.png" alt="收藏代码" style="border:0px"></a></div><br></div><br><ol start="1" class="dp-j" style="font-size:1em; line-height:1.4em; margin:0px 0px 1px; padding:2px 0px; border:1px solid rgb(209,215,220); list-style-position:initial"><br><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span class="keyword" style="font-weight:bold">public</span>&nbsp;<span class="keyword" style="font-weight:bold">class</span>&nbsp;CustomerResource&nbsp;{&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;…&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Path</span>(<span class="string">&quot;{id}&quot;</span>)&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@GET</span>&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Produces</span>(<span class="string">&quot;application/xml&quot;</span>)&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight:bold">public</span>&nbsp;StreamingOutput&nbsp;getCustomer(<span class="annotation">@PathParam</span>(<span class="string">&quot;id&quot;</span>)&nbsp;<span class="keyword" style="font-weight:bold">int</span>&nbsp;id)&nbsp;{&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;…&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br>&nbsp;</p><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br>此处，取得{id}的&#20540;，并试图转换成一个int型的&#20540;。</p><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br></p><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br><strong>可以同时使用多个PathParam</strong>:</p><br><div class="dp-highlighter" id="" style="font-family:Monaco,'DejaVu Sans Mono','Bitstream Vera Sans Mono',Consolas,'Courier New',monospace; width:679px; overflow:auto; margin-left:9px; padding:1px; word-break:break-all; word-wrap:break-word; line-height:25.1875px"><br><div class="bar"><br><div class="tools" style="padding:3px; margin:0px; font-weight:bold">Java代码&nbsp;&nbsp;<a target="_blank" title="收藏这段代码" style="text-decoration:underline"><img class="star" src="http://liugang594.iteye.com/images/icon_star.png" alt="收藏代码" style="border:0px"></a></div><br></div><br><ol start="1" class="dp-j" style="font-size:1em; line-height:1.4em; margin:0px 0px 1px; padding:2px 0px; border:1px solid rgb(209,215,220); list-style-position:initial"><br><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span class="annotation">@Path</span>(<span class="string">&quot;/customers&quot;</span>)&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span class="keyword" style="font-weight:bold">public</span>&nbsp;<span class="keyword" style="font-weight:bold">class</span>&nbsp;CustomerResource&nbsp;{&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;…&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Path</span>(<span class="string">&quot;{first}-{last}&quot;</span>)&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@GET</span>&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Produces</span>(<span class="string">&quot;application/xml&quot;</span>)&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight:bold">public</span>&nbsp;StreamingOutput&nbsp;getCustomer(<span class="annotation">@PathParam</span>(<span class="string">&quot;first&quot;</span>)&nbsp;String&nbsp;firstName,&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@PathParam</span>(<span class="string">&quot;last&quot;</span>)&nbsp;String&nbsp;lastName)&nbsp;{&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;…&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>} &nbsp;</li></ol><br></div><br><br><br></div><br></div><br><p></p><br><p style="color:rgb(255,0,0); margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br>（2）<span style="color:rgb(255,0,0); font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px">@QueryParam</span></p><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br>很显然，QueryParam用来获取查询参数，对于 GET /customers?start=0&amp;size=10 ，例如：</p><br><div class="dp-highlighter" id="" style="font-family:Monaco,'DejaVu Sans Mono','Bitstream Vera Sans Mono',Consolas,'Courier New',monospace; width:679px; overflow:auto; margin-left:9px; padding:1px; word-break:break-all; word-wrap:break-word; line-height:25.1875px"><br><div class="bar"><br><div class="tools" style="padding:3px; margin:0px; font-weight:bold">Java代码&nbsp;&nbsp;<a target="_blank" title="收藏这段代码" style="color:rgb(16,138,198); text-decoration:underline"><img class="star" src="http://liugang594.iteye.com/images/icon_star.png" alt="收藏代码" style="border:0px"></a></div><br></div><br><ol start="1" class="dp-j" style="font-size:1em; line-height:1.4em; margin:0px 0px 1px; padding:2px 0px; border:1px solid rgb(209,215,220); list-style-position:initial; color:rgb(43,145,175)"><br><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black"><span class="annotation" style="color:rgb(100,100,100)">@Path</span>(<span class="string" style="color:blue">&quot;/customers&quot;</span>)&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black"><span class="keyword" style="color:rgb(127,0,85); font-weight:bold">public</span>&nbsp;<span class="keyword" style="color:rgb(127,0,85); font-weight:bold">class</span>&nbsp;CustomerResource&nbsp;{&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation" style="color:rgb(100,100,100)">@GET</span>&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation" style="color:rgb(100,100,100)">@Produces</span>(<span class="string" style="color:blue">&quot;application/xml&quot;</span>)&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="color:rgb(127,0,85); font-weight:bold">public</span>&nbsp;String&nbsp;getCustomers(<span class="annotation" style="color:rgb(100,100,100)">@QueryParam</span>(<span class="string" style="color:blue">&quot;start&quot;</span>)&nbsp;<span class="keyword" style="color:rgb(127,0,85); font-weight:bold">int</span>&nbsp;start,&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation" style="color:rgb(100,100,100)">@QueryParam</span>(<span class="string" style="color:blue">&quot;size&quot;</span>)&nbsp;<span class="keyword" style="color:rgb(127,0,85); font-weight:bold">int</span>&nbsp;size)&nbsp;{&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;…&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">}&nbsp;&nbsp;</span></li></ol><br></div><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br>这里start为0，size为10.</p><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br>同上面的PathParam，也可以用UriInfo去获取QueryParam，例如：</p><br><div class="dp-highlighter" id="" style="font-family:Monaco,'DejaVu Sans Mono','Bitstream Vera Sans Mono',Consolas,'Courier New',monospace; width:679px; overflow:auto; margin-left:9px; padding:1px; word-break:break-all; word-wrap:break-word; line-height:25.1875px"><br><div class="bar"><br><div class="tools" style="padding:3px; margin:0px; font-weight:bold">Java代码&nbsp;&nbsp;<a target="_blank" title="收藏这段代码" style="color:rgb(16,138,198); text-decoration:underline"><img class="star" src="http://liugang594.iteye.com/images/icon_star.png" alt="收藏代码" style="border:0px"></a></div><br></div><br><ol start="1" class="dp-j" style="font-size:1em; line-height:1.4em; margin:0px 0px 1px; padding:2px 0px; border:1px solid rgb(209,215,220); list-style-position:initial; color:rgb(43,145,175)"><br><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black"><span class="annotation" style="color:rgb(100,100,100)">@Path</span>(<span class="string" style="color:blue">&quot;/customers&quot;</span>)&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black"><span class="keyword" style="color:rgb(127,0,85); font-weight:bold">public</span>&nbsp;<span class="keyword" style="color:rgb(127,0,85); font-weight:bold">class</span>&nbsp;CustomerResource&nbsp;{&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation" style="color:rgb(100,100,100)">@GET</span>&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation" style="color:rgb(100,100,100)">@Produces</span>(<span class="string" style="color:blue">&quot;application/xml&quot;</span>)&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="color:rgb(127,0,85); font-weight:bold">public</span>&nbsp;String&nbsp;getCustomers(<span class="annotation" style="color:rgb(100,100,100)">@Context</span>&nbsp;UriInfo&nbsp;info)&nbsp;{&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;start&nbsp;=&nbsp;info.getQueryParameters().getFirst(<span class="string" style="color:blue">&quot;start&quot;</span>);&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;size&nbsp;=&nbsp;info.getQueryParameters().getFirst(<span class="string" style="color:blue">&quot;size&quot;</span>);&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;…&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">} &nbsp;</span></li></ol><br></div><br>（3）<span style="color:rgb(255,0,0); font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px">@FormParam</span><br><div><span style="font-family:Helvetica,Tahoma,Arial,sans-serif"><span style="font-size:14px; line-height:25.1875px"><span style="font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><span style="font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"></span></span></span></span><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br>很自然，FormParam用于提取POST请求中的Form参数，其中Content-Type被假设为application/x-www-formurlencoded。例如有以下Form请求</p><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br>&nbsp;</p><br><div class="dp-highlighter" id="" style="font-family:Monaco,'DejaVu Sans Mono','Bitstream Vera Sans Mono',Consolas,'Courier New',monospace; width:679px; overflow:auto; margin-left:9px; padding:1px; word-break:break-all; word-wrap:break-word; line-height:25.1875px"><br><div class="bar"><br><div class="tools" style="padding:3px; margin:0px; font-weight:bold">Html代码&nbsp;&nbsp;<a target="_blank" title="收藏这段代码" style="text-decoration:underline"><img class="star" src="http://liugang594.iteye.com/images/icon_star.png" alt="收藏代码" style="border:0px"></a></div><br></div><br><ol start="1" class="dp-xml" style="font-size:1em; line-height:1.4em; margin:0px 0px 1px; padding:2px 0px; border:1px solid rgb(209,215,220); list-style-position:initial"><br><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span class="tag" style="font-weight:bold">&lt;</span><span class="tag-name" style="font-weight:bold">FORM</span>&nbsp;<span class="attribute">action</span>=<span class="attribute-value">&quot;<a href="http://example.com/customers&amp;quot" target="_blank" rel="external">http://example.com/customers&amp;quot</a>;</span>&nbsp;<span class="attribute">method</span>=<span class="attribute-value">&quot;post&quot;</span><span class="tag" style="font-weight:bold">&gt;</span>&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="font-weight:bold">&lt;</span><span class="tag-name" style="font-weight:bold">P</span><span class="tag" style="font-weight:bold">&gt;</span>&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;First&nbsp;name:&nbsp;<span class="tag" style="font-weight:bold">&lt;</span><span class="tag-name" style="font-weight:bold">INPUT</span>&nbsp;<span class="attribute">type</span>=<span class="attribute-value">&quot;text&quot;</span>&nbsp;<span class="attribute">name</span>=<span class="attribute-value">&quot;firstname&quot;</span><span class="tag" style="font-weight:bold">&gt;</span><span class="tag" style="font-weight:bold">&lt;</span><span class="tag-name" style="font-weight:bold">BR</span><span class="tag" style="font-weight:bold">&gt;</span>&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last&nbsp;name:&nbsp;<span class="tag" style="font-weight:bold">&lt;</span><span class="tag-name" style="font-weight:bold">INPUT</span>&nbsp;<span class="attribute">type</span>=<span class="attribute-value">&quot;text&quot;</span>&nbsp;<span class="attribute">name</span>=<span class="attribute-value">&quot;lastname&quot;</span><span class="tag" style="font-weight:bold">&gt;</span><span class="tag" style="font-weight:bold">&lt;</span><span class="tag-name" style="font-weight:bold">BR</span><span class="tag" style="font-weight:bold">&gt;</span>&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="font-weight:bold">&lt;</span><span class="tag-name" style="font-weight:bold">INPUT</span>&nbsp;<span class="attribute">type</span>=<span class="attribute-value">&quot;submit&quot;</span>&nbsp;<span class="attribute">value</span>=<span class="attribute-value">&quot;Send&quot;</span><span class="tag" style="font-weight:bold">&gt;</span>&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="font-weight:bold">&lt;/</span><span class="tag-name" style="font-weight:bold">P</span><span class="tag" style="font-weight:bold">&gt;</span>&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span class="tag" style="font-weight:bold">&lt;/</span><span class="tag-name" style="font-weight:bold">FORM</span><span class="tag" style="font-weight:bold">&gt;</span>&nbsp;&nbsp;</li></ol><br></div><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br>可以如下取&#20540;：</p><br><div class="dp-highlighter" id="" style="font-family:Monaco,'DejaVu Sans Mono','Bitstream Vera Sans Mono',Consolas,'Courier New',monospace; width:679px; overflow:auto; margin-left:9px; padding:1px; word-break:break-all; word-wrap:break-word; line-height:25.1875px"><br><div class="bar"><br><div class="tools" style="padding:3px; margin:0px; font-weight:bold">Java代码&nbsp;&nbsp;<a target="_blank" title="收藏这段代码" style="text-decoration:underline"><img class="star" src="http://liugang594.iteye.com/images/icon_star.png" alt="收藏代码" style="border:0px"></a></div><br></div><br><ol start="1" class="dp-j" style="font-size:1em; line-height:1.4em; margin:0px 0px 1px; padding:2px 0px; border:1px solid rgb(209,215,220); list-style-position:initial"><br><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span class="annotation">@Path</span>(<span class="string">&quot;/customers&quot;</span>)&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span class="keyword" style="font-weight:bold">public</span>&nbsp;<span class="keyword" style="font-weight:bold">class</span>&nbsp;CustomerResource&nbsp;{&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@POST</span>&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight:bold">public</span>&nbsp;<span class="keyword" style="font-weight:bold">void</span>&nbsp;createCustomer(<span class="annotation">@FormParam</span>(<span class="string">&quot;firstname&quot;</span>)&nbsp;String&nbsp;first,&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@FormParam</span>(<span class="string">&quot;lastname&quot;</span>)&nbsp;String&nbsp;last)&nbsp;{&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;…&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br>} &nbsp;</li></ol><br></div><br><br><br></div><br>（4）<span style="font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><span style="color:rgb(255,0,0)">HeaderParam</span></span><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br>&nbsp; &nbsp; 很直接，用来提取HTTP Header&#20540;的。例如：</p><br><div class="dp-highlighter" id="" style="font-family:Monaco,'DejaVu Sans Mono','Bitstream Vera Sans Mono',Consolas,'Courier New',monospace; width:679px; overflow:auto; margin-left:9px; padding:1px; word-break:break-all; word-wrap:break-word"><br><div class="bar" style="line-height:25.1875px"><br><div class="tools" style="padding:3px; margin:0px; font-weight:bold">Java代码&nbsp;&nbsp;<a target="_blank" title="收藏这段代码" style="color:rgb(16,138,198); text-decoration:underline"><img class="star" src="http://liugang594.iteye.com/images/icon_star.png" alt="收藏代码" style="border:0px"></a></div><br></div><br><ol start="1" class="dp-j" style="line-height:1.4em; font-size:1em; margin:0px 0px 1px; padding:2px 0px; border:1px solid rgb(209,215,220); list-style-position:initial; color:rgb(43,145,175)"><br><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black"><span class="annotation" style="color:rgb(100,100,100)">@Path</span>(<span class="string" style="color:blue">&quot;/myservice&quot;</span>)&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black"><span class="keyword" style="color:rgb(127,0,85); font-weight:bold">public</span>&nbsp;<span class="keyword" style="color:rgb(127,0,85); font-weight:bold">class</span>&nbsp;MyService&nbsp;{&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation" style="color:rgb(100,100,100)">@GET</span>&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation" style="color:rgb(100,100,100)">@Produces</span>(<span class="string" style="color:blue">&quot;text/html&quot;</span>)&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="color:rgb(127,0,85); font-weight:bold">public</span>&nbsp;String&nbsp;get(<span class="annotation" style="color:rgb(100,100,100)">@HeaderParam</span>(<span class="string" style="color:blue">&quot;Referer&quot;</span>)&nbsp;String&nbsp;referer)&nbsp;{&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;…&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); background-color:rgb(250,250,250); line-height:18px"><br><span style="color:black">} &nbsp;</span></li></ol><br><div><span style="line-height:18px"><br><br></span></div><br><div><span style="line-height:18px">（5）<span style="color:rgb(255,0,0); font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px">@CookieParam</span></span></div><br><div><span style="line-height:18px"><span style="font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px; background-color:rgb(0,0,0)"><span style="font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"></span></span></span><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br>提取cookie信息，例如：</p><br><div class="dp-highlighter" id="" style="font-family:Monaco,'DejaVu Sans Mono','Bitstream Vera Sans Mono',Consolas,'Courier New',monospace; width:679px; overflow:auto; margin-left:9px; padding:1px; word-break:break-all; word-wrap:break-word; line-height:25.1875px"><br><div class="bar"><br><div class="tools" style="padding:3px; margin:0px; font-weight:bold">Java代码&nbsp;&nbsp;<a target="_blank" title="收藏这段代码" style="text-decoration:underline"><img class="star" src="http://liugang594.iteye.com/images/icon_star.png" alt="收藏代码" style="border:0px"></a></div><br></div><br><ol start="1" class="dp-j" style="font-size:1em; line-height:1.4em; margin:0px 0px 1px; padding:2px 0px; border:1px solid rgb(209,215,220); list-style-position:initial"><br><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:18px"><br><span class="annotation">@Path</span>(<span class="string">&quot;/myservice&quot;</span>)&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:18px"><br><span class="keyword" style="font-weight:bold">public</span>&nbsp;<span class="keyword" style="font-weight:bold">class</span>&nbsp;MyService&nbsp;{&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@GET</span>&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Produces</span>(<span class="string">&quot;text/html&quot;</span>)&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight:bold">public</span>&nbsp;String&nbsp;get(<span class="annotation">@CookieParam</span>(<span class="string">&quot;customerId&quot;</span>)&nbsp;<span class="keyword" style="font-weight:bold">int</span>&nbsp;custId)&nbsp;{&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;…&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:18px"><br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li style="font-size:1em; margin:0px 0px 0px 38px; padding:0px 0px 0px 10px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:18px"><br>}&nbsp;&nbsp;</li></ol><br></div><br><p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:Helvetica,Tahoma,Arial,sans-serif; font-size:14px; line-height:25.1875px"><br>这里注入了的是一个cookie的&#20540;，如果想取得更多的信息，而不仅仅是基本&#20540;，则可以直接注入javax.ws.rs.core.Cookie对象，例如：</p><br><div class="dp-highlighter" id="" style="font-family:Monaco,'DejaVu Sans Mono','Bitstream Vera Sans Mono',Consolas,'Courier New',monospace; width:679px; overflow:auto; margin-left:9px; padding:1px; word-break:break-all; word-wrap:break-word; line-height:25.1875px"><br><div class="bar"><br><div class="tools" style="padding:3px; margin:0px; font-weight:bold">Java代码&nbsp;&nbsp;<a target="_blank" title="收藏这段代码" style="text-decoration:underline"><img class="star" src="http://liugang594.iteye.com/images/icon_star.png" alt="收藏代码" style="border:0px"></a></div><br></div>

</div></div></div></div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://bloodorange2017.github.io/archives/2017/05/11/restful-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XueCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://bloodorange2017.github.io/images/img_head_001.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XueCheng Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/11/restful-01/" itemprop="url">转载:RESTful 接口规范</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-11T11:52:43+08:00">
                2017-05-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="cnblogs_post_body"><p>原文地址：<a href="http://www.coderli.com/translate-restful-standard-resolved" target="_blank" rel="external">http://www.coderli.com/translate-restful-standard-resolved</a></p><br><p>&nbsp;</p><br><p><a href="http://www.coder.com/" target="_blank" rel="external">OneCoder</a>最近一直在使用Restful API，最近正好看到一篇自定义restful接口规范的&ldquo;抛砖引玉&rdquo;得的文章，索性翻译一下，与大家分享。</p><br><div>原文地址：<a href="http://java.dzone.com/articles/restful-standard-resolved" target="_blank" rel="external">http://java.dzone.com/articles/restful-standard-resolved</a>&nbsp;&nbsp;</div><br><div>&nbsp;</div><br><div>最近，我正在使用RESTfull的方式构建一个web服务。尽管现在有很多的一般的指导和提示告诉你如何定义restful接口，但是却没有一个明确的标准或大家都接受的schema定义去遵循。</div><br><div>&nbsp;</div><br><div>在网上获取了一些信息后，我打算打破这一局面：）我打算分享一下我定义的规则和结构，并且很希望能得到一些反馈来帮助我完善这个规则，所以，不要犹豫，请毫无留情给我指出错误和毛病吧。</div><br><div>&nbsp;</div><br><div>高级别的模式是：</div><br><div>http(s)://server.com/app-name/{version}/{domain}/{rest-convention}</div><br><div>&nbsp;</div><br><div>这里，{version}代表api的版本信息。{domain}是一个你可以用来定义任何技术的区域(例如：安全-允许指定的用户可以访问这个区域。)或者业务上的原因。(例如：同样的功能在同一个前缀之下。)</div><br><div>&nbsp;</div><br><div>{rest-convention} 代表这个域(domain)下，约定的rest接口集合。</div><br><div>&nbsp;</div><br><div><strong>单资源(&nbsp;singular-resourceX&nbsp;)</strong></div><br><div>url样例：order/&nbsp; (order即指那个单独的资源X)</div><br><ul><br><li>GET &ndash; 返回一个新的order</li><br><li>POST- 创建一个新的order，从post请求携带的内容获取值。</li><br></ul><br><div>&nbsp;</div><br><div><strong>单资源带id(singular-resourceX/{id}&nbsp;)</strong></div><br><div>URL样例：order/1 ( order即指那个单独的资源X&nbsp;)</div><br><ul><br><li>GET &ndash; 返回id是1的order</li><br><li>DELETE &ndash; 删除id是1的order</li><br><li>PUT &ndash; 更新id是1的order，order的值从请求的内容体中获取。</li><br></ul><br><div>&nbsp;</div><br><div><strong>复数资源(plural-resourceX/)</strong></div><br><div>URL样例:orders/</div><br><ul><br><li>GET &ndash; 返回所有orders</li><br></ul><br><div>&nbsp;</div><br><div><strong>复数资源查找(plural-resourceX/search)</strong></div><br><div>URL样例：orders/search?name=123</div><br><ul><br><li>GET &ndash; 返回所有满足查询条件的order资源。(实例查询，无关联) &ndash; order名字等于123的。</li><br></ul><br><div>&nbsp;</div><br><div><strong>复数资源查找(plural-resourceX/searchByXXX)</strong></div><br><div>URL样例：orders/searchByItems?name=ipad</div><br><ul><br><li>GET &ndash; 将返回所有满足自定义查询的orders &ndash; 获取所有与items名字是ipad相关联的orders。</li><br></ul><br><div>&nbsp;</div><br><div><strong>单数资源(singular-resourceX/{id}/pluralY)</strong></div><br><div>URL样例：order/1/items/ (这里order即为资源X，items是复数资源Y)</div><br><ul><br><li>GET &ndash; 将返回所有与order id 是1关联的items。</li><br></ul><br><div>&nbsp;</div><br><div><strong>singular-resourceX/{id}/singular-resourceY/</strong></div><br><div>URL样例：order/1/item/</div><br><ul><br><li>GET &ndash; 返回一个瞬时的新的与order id是1关联的item实例。</li><br><li>POST &ndash; 创建一个与order id 是1关联的item实例。Item的值从post请求体中获取。</li><br></ul><br><div>&nbsp;</div><br><div><strong>singular-resourceX/{id}/singular-resourceY/{id}/singular-resourceZ/</strong></div><br><div>URL样例：order/1/item/2/package/</div><br><ul><br><li>GET &ndash; 返回一个瞬时的新的与item2和order1关联的package实例。</li><br><li>POST &ndash; 创建一个新的与item 2和order1关联的package实例，package的值从post请求体中获得。</li><br></ul><br><div>&nbsp;</div><br><div>上面的规则可以在继续递归下去，并且复数资源后面永远不会再跟随负数资源。</div><br><div>总结几个关键点，来更清晰的表述规则。</div><br><div><br><ul><br><li>在使用复数资源的时候，返回的是最后一个复数资源使用的实例。</li><br><li>在使用单个资源的时候，返回的是最后一个但是资源使用的实例。</li><br><li>查询的时候，返回的是最后一个复数实体使用的实例(们)。</li><br></ul><br></div><br><div>希望你的关注能帮助我完整这个结构并解决你可能偶然遇到的问题。</div><br><div>&nbsp;</div><br><div>在下一篇文章里，在这个结构完善之后，我将会一些技术上的样例如何在Spring MVC3.1中，使用它。</div></div><div id="MySignature"></div><br><div class="clear"></div><br><div id="blog_post_info_block"><br><div id="BlogPostCategory"></div><br><div id="EntryTag"></div><br><div id="blog_post_info"><br></div><br><div class="clear"></div><br><div id="post_next_prev"></div><br></div>


          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://bloodorange2017.github.io/images/img_head_001.jpg"
               alt="XueCheng" />
          <p class="site-author-name" itemprop="name">XueCheng</p>
           
              <p class="site-description motion-element" itemprop="description">Do one thing at a time, and do well.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">65</span>
                <span class="site-state-item-name">Artikel</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XueCheng</span>
</div>


<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

<script type="text/javascript"
color="160,160,233" opacity='0.4' zIndex="-2" count="16" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
